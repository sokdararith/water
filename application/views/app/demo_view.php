<div id="wrapperApplication" class="container-fluid"></div>
<!-- template section starts -->
<script type="text/x-kendo-template" id="layout">
	<div id="menu"></div>			
	<div id="content" class="row-fluid"></div>
</script>
<script type="text/x-kendo-template" id="blank-tmpl">
</script>
<script type="text/x-kendo-template" id="menu-tmpl">
	<div class="menu-hidden sidebar-hidden-phone menu-left hidden-print">
		<div class="navbar main" id="main-menu">
			<ul class="topnav">
				<li><a href="<?php echo base_url(); ?>demo"><i class="icon-home"></i></a></li>
		        <li class="dropdown dd-1 span3">
					<a href="\#" class="dropdown-toggle brand" data-toggle="dropdown" id="brand-menu"><img src="<?php echo base_url()?>uploads/logo/logo.png" style="height: 60px;"></a>
		        	<ul  id="main-top-navigation" class="dropdown-menu" data-role="listview" data-bind="source: instMod" data-template="main-menu-template">
		        	</ul>
		        </li>
			</ul>
			<ul class="topnav" id="secondary-menu">
			</ul>
			<ul class="topnav pull-right">
				<li>
					<a data-bind="attr: {href: page}"><span data-bind="text: getLogin().username"></span></a>
				</li>
				<li class="dropdown">
					<a href="\#" class="dropdown-toggle" data-toggle="dropdown"> <span data-bind="text: lang.lang.language"></span> <i class="caret"></i></a>
					<ul class="dropdown-menu" id="dropdownMenu">
						<li><a href="#" data-bind="click: lang.changeToKh">KHMER</a></li>
            			<li><a href="#" data-bind="click: lang.changeToEn">ENGLISH</a></li>
		        	</ul>
		        </li>
				<li><a href="#/manage" data-bind="click: logout"><i class="icon-power-off"></i></a></li>
			</ul>
		</div>
	</div>
<script type="text/x-kendo-template" id="main-menu-template">
	# var name = name.toLowerCase();#
	<li><a href="\#/#=href#">#=langVM.lang[name]#</a></li>
</script>
<script type="text/x-kendo-template" id="login-template">
 	<div class="container-960">
		<div class="row">
			<div class="span3 offset4">
				<label for="email">អីម៉ែល</label>
				<input type="email" placeholder="email" data-bind="value: username, events: {onmouseout: validateEmail}">
				<label for="password">លេខសំងាត់</label>
				<input type="password" placeholder="password" data-bind="value: password">
				<button class="btn btn-primary" data-bind="click: login">ចូល</button>
				<a data-bind="click: registerBtn">ចុះឈ្មោះ</a><br/>				
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="signup-template">
 	<div class="container-960">
		<div class="row">
			<div class="span3 offset4">
				<label for="email">អីម៉ែល</label>
				<input type="email" placeholder="email" data-bind="value: username">
				<label for="password">លេខសំងាត់</label>
				<input type="password" placeholder="password" data-bind="value: password">
				<label for="password">វាយលេខសំងាត់ម្ដងែៀត</label>
				<input type="password" placeholder="password" data-bind="value: _password">
				<button class="btn" data-bind="click: signup">ចុះឈ្មោះ</button>
				<a data-bind="click: loginBtn">ចូល</a>
				<br/>				
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="page">
	<div id="col1" class="span2">
		<ul class="nav nav-tabs nav-stacked">
			<li><a href="#/page/password">Change Password</a></li>
		</ul>
	</div>
	<div id="col2" class="span10">
		<div class="row">
			<div class="span6">
				<button class="btn btn-primary btn-block" data-bind="click: createComp">Create Company</button>
			</div>
			<div class="span6">
				<button class="btn btn-default btn-block">Request Admin to add you</button>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="create-company-template">
	<div class="container-960">
		<div class="row">
			<div class="span4 offset4">
				<div class="widget"​ style="overflow: hidden">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind="click: close">X</span>
						<h3 style="text-align: center">ពតមានក្រុមហ៊ុន</h3>
					</div>
					<div class="widget-body">
						<label for="name">Name</label>
						<input type="text" data-bind="value: newInst.name" />
						<label for="name">Email</label>
						<input type="text" data-bind="value: newInst.email" />
						<label for="name">VAT Number</label>
						<input type="text" data-bind="value: newInst.vat_no" />
						<label for="name">Fiscal Date</label>
						<input type="text" data-bind="value: newInst.fiscal_date" />
						<label for="name">Tax Regime</label>
						<input type="text" data-role="dropdownlist" 
							   data-bind="source: taxRegimes, value: newInst.tax_regime"
							   data-text-field="type"
							   data-value-field="code"
							   data-option-label="---រើសមួយ---" />
						<label for="name">Legal Name</label>
						<input type="text" data-bind="value: newInst.legal_name" />
						<label for="name">Date Founded</label>
						<input type="text" data-role="datepicker" data-bind="value: newInst.date_founded" />
						<label for="name">address</label>
						<input type="text" data-bind="value: newInst.address" />
						<label for="name">រូបិយប័ណ្ដ</label>
						<input type="text" data-role="dropdownlist" 
							   data-bind="source: currency, value: newInst.locale" 
							   data-option-label="---រើសមួយ---"
							   data-value-field="locale" 
							   data-text-field="code" />
						<label for="name">description</label>
						<textarea data-bind="value: newInst.description" cols="30" rows="10"></textarea>
						<label for="name">Country</label>
						<input type="text" data-role="dropdownlist" 
							   data-bind="source: countries, value: newInst.country" 
							   data-text-field="name" 
							   data-value-field="id"
							   data-option-label="---"
							   style="width: 220px;" />
						<label for="name">Province</label>
						<input type="text" data-role="dropdownlist" 
						       data-bind="source: provinces, value: newInst.province" 
						       data-text-field="local" 
						       data-value-field="id"
						       data-option-label="---"
						       style="width: 220px;" />
						<label for="name">Industry</label>
						<input type="text" data-role="dropdownlist" 
							   data-bind="source: industry, value: newInst.industry" 
							   data-text-field="name" 
							   data-value-field="id"
							   data-option-label="---"
							   style="width: 220px;" />
						<label for="name">Type</label>
						<input type="text" data-role="dropdownlist" 
							   data-bind="source: types, value: newInst.type" 
							   data-text-field="name" 
							   data-value-field="id"
							   data-option-label="---"
							   style="width: 220px;" /><br/>
						<button class="btn btn-primary" data-bind="click: saveIntitute">Submit</button>
						<div id="createComMessage"></div>
					</div>
				</div>
			</div>			
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="page-admin">
	<div id="col1" class="span2">
		<ul class="nav nav-tabs nav-stacked">
			<li><a href="#/page/companyInfo">ពតមានក្រុមហ៊ុន</a></li>
			<li><a href="#/page/companyLogo">ប្តូរូបសញ្ញាក្រុមហ៊ុន</a></li>
			<li><a href="#/page/userlist">បញ្ជីអ្នកប្រើ</a></li>
			<li><a href="#/page/employee">បុគ្កលិក</a></li>
			<li><a href="#/page/password">ប្តូលេខសំងាត់</a></li>
		</ul>
	</div>
	<div id="col2" class="span10">
	</div>
</script>
<script type="text/x-kendo-template" id="page-admin-userlist">
	<span class="btn btn-success pull-right" data-bind="click: add"><i class="icon-plus"></i> បន្ថែបុគ្គលិក</span>
	<table class="table">
		<thead>
			<tr>
				<th>ឈ្មោះ</th>
				<th>សិទ្ធ</th>
				<th>...</th>
			</tr>
		</thead>
		<tbody
			data-role="listview" data-bind="source: dataStore" data-template="page-admin-userlist-template"
		></tbody>
	</table>
	<div data-role="pager" data-bind="source: dataStore"></div>
</script>
<script type="text/x-kendo-template" id="page-admin-userlist-template">
	<tr>
		<td>#:username#</td>
		<td>#:permission.name#</td>
		<td>
			<span class="btn btn-default" data-bind="click: editRight"><i class="icon-edit-sign"></i></span> 
			<span class="btn btn-default" data-bind="click: remove"><i class="icon-remove-sign"></i></span> 
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="page-admin-userlist-add-template">
	<div class="span4 offset3">
		<label for="user">User</label>
		<input type="text" placeholder="user" data-bind="value: current.username"/>
		<label for="password">Password</label>
		<input type="password" placeholder="password" data-bind="value: current.password"/>
		<label for="role">Role</label>
		<input type="text" placeholder="role" 
			   data-role="dropdownlist" 
			   data-option-label="---"
			   data-bind="source: roleDS, value: current.permission" 
			   data-text-field="name" 
			   data-value-field="id" />
		<button class="btn btn-success" data-bind="click: sync">កត់ត្រា</button>
		<button class="btn btn-default" data-bind="click: cancelAdd">Cancel</button>
	</div>
</script>
<script type="text/x-kendo-template" id="page-admin-userlist-edit-role-template">
	<div class="span4 offset3">
		<label for="role">Role</label>
		<input type="text" placeholder="role" 
			   data-role="dropdownlist" 
			   data-bind="source: roleDS, value: current.permission" 
			   data-text-field="name" 
			   data-value-field="id" />
		<button class="btn btn-success" data-bind="click: sync">កត់ត្រា</button>
		<button class="btn btn-default" data-bind="click: cancelAdd">Cancel</button>
	</div>
</script>
<script type="text/x-kendo-template" id="page-admin-userlist-password-template">
	<div class="span4 offset4">
		<label for="password">Password</label>
		<input type="password" placeholder="password" 
			   data-bind="value: password" />
		<label for="password">Confirm Password</label>
		<input type="password" placeholder="cpassword" 
			   data-bind="value: _password" /><br/>
		<button class="btn btn-success" data-bind="click: changePwd">កត់ត្រា</button>
		<button class="btn btn-default" data-bind="click: cancelAdd">Cancel</button>
	</div>
</script>
<script type="text/x-kendo-template" id="page-admin-comany-logo-template">
	<div class="container-960">
		<div class="row">
			<div class="span4 offset4">
				<div class="widget"​ style="overflow: hidden">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind="click: close">X</span>
						<h3 style="text-align: center; font-size: 14px;"​>ស្លាកក្រុមហ៊ុន</h3>
					</div>
					<div class="widget-body">
						<input type="file" data-role="upload" name="userFile"
							   data-async="{saveUrl:'http://rith.local/banhji/api/banhji/logo', saveField:'userFile'}"
							   data-bind="events: {success:onSuccessUpload}"
							   data-localization="{select: 'រើសរូប', dropFilesHere: 'ទំលាក់រូបត្រង់នេះ'}" />
						<div id="createComMessage"></div>
					</div>
				</div>
			</div>			
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="index">
	<div class="row">
		<div class="span6">
			<div class="row">
				<div class="span12" style="padding-left: 0; margin-left: 0; margin-top: 0;">
					<ul id="module-image">
						<li style="text-align:center;">
							<a href="#/customers">
								<img src="<?php echo base_url(); ?>resources/img/Customer.png" alt="Customer">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.customer"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="#/vendors">
								<img src="<?php echo base_url(); ?>resources/img/supplier.png" alt="Vendor">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.vendor"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="#/accounting_dashboard">
								<img src="<?php echo base_url(); ?>resources/img/Accounting.png" alt="Accounting">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.accounting"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="#/inventories">
								<img src="<?php echo base_url(); ?>resources/img/Inventory.png" alt="Inventory">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.inventory"></span></span>
						</li>
					</ul>
				</div>
				
				<div class="span12" style="padding-left: 0; margin-left: 0; margin-top: 30px;">
					<h4 style="margin-left: 35px; width: 450px;"><span data-bind="text: lang.lang.subcribed_industry_modules"></span></h4>
					<ul id="module-image" data-role="listview" data-bind="source: modules" data-template="institute-module-page-list1-template">
				</div>
			</div>	
		</div>
		<div class="span6">
			<div class="row">
				<div class="span8">
					<h2 data-bind="text: companyInf().institute[0].legal_name"></h2>
					<span id="today-date" data-bind="text: curDate"></span><br/>
					VAT: <span data-bind="text: companyInf().institute[0].vat_number"></span>
				</div>
				<div class="span3">
					<img data-bind="attr: {src: getLogo()}" alt="" />
				</div>
				<div class="span12"><hr/></div>
				
				</div>
				<div class="span11">
					<input data-role="datepicker"
					   data-format="dd-MM-yyyy"
	                   data-bind="value: selectedDate,
	                   events: { change: dateChanges }">

					<div style="height: 300px;" id="index-income-graph"></div>
				</div>
				
				<div class="span12">
					<div class="row">
						<div class="padding-bottom-none-phone span6">
							<a href="" class="widget-stats widget-stats-primary widget-stats-4">
								<span class="txt"><span data-bind="text: lang.lang.cash_balance"></span></span>
								<span class="count" style="font-size: 25px;" data-bind="text: cashBal"></span>
								<div class="clearfix"></div>
								<i class="icon-play-circle"></i>
							</a>
						</div>
						<div class="padding-bottom-none-phone span6">
							<a href="" class="widget-stats widget-stats-primary widget-stats-4">
								<span class="txt"><span data-bind="text: lang.lang.total_sale"></span></span>
								<span class="count" style="font-size: 25px;" data-bind="text: totalSale"></span>
								<div class="clearfix"></div>
								<i class="icon-play-circle"></i>
							</a>
						</div>
					</div>						
				</div>
				<br>
				<div class="span12">
					<div class="widget widget-heading-simple widget-body-simple">		
		
						<div class="widget-body">

							<!-- Row -->
							<div class="row-fluid">
								<div class="span3">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-gray widget-stats-1">
										<span class="txt"><span data-bind="text: lang.lang.open_invoice"></span></span>
										<div class="clearfix"></div>
										<span class="count" data-bind="text: totalOpenInvoice"></span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>
								<div class="span3">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-1">
										<span class="txt"><span data-bind="text: lang.lang.unpaid_bill"></span></span>
										<div class="clearfix"></div>
										<span class="count" data-bind="text: totalUnbill"></span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>
								<div class="span3">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-gray widget-stats-2">
										<span class="count" data-bind="text: totalCustomer"></span>
										<span class="txt"><span data-bind="text: lang.lang.customers"></span></span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>
								<div class="span3">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-2">
										<span class="count" data-bind="text: totalOrder"></span>
										<span class="txt"><span data-bind="text: lang.lang.order"></span></span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>								
							</div>
							<!-- // Row END -->
							
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>

	<div class="row-fluid">
		<div style="margin-top: 10px; margin-left: 0;" align="center">
			<p>© 2016 BanhJi Co., Ltd. All rights reserved. BanhJi is the registered trademarks of BanhJi Co., Ltd. 
			<br>
			Terms and conditions, features, support, pricing, and service options subject to change without notice.</p>
		</div>	
	</div>		
</script>
<script type="text/x-kendo-template" id="institute-module-page-list1-template">
	# name = name.toLowerCase(); #
	<li style="text-align:center;">
		<div class="product">
			<a href="\#/#=href#">
            	<img data-bind="attr: {src: image_url}" />
            </a>
            <span style="font-size: 14px; font-weight: bold; color: \#000000" >
            	 #=langVM.lang[name]#
            </span>	           
        </div>
	</li>
</script>
<script type="text/x-kendo-template" id="top-customer-template">
	<tr>
		<td>#=surname# #=name#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="login-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span3 offset4">
				<label for="email">អីម៉ែល</label>
				<input type="email" placeholder="email" data-bind="value:email, events: {change: validateEmail}">
				<label for="password">លេខសំងាត់</label>
				<input type="password" placeholder="password" data-bind="value:password, events: {change: validatePWD}">
				<button class="btn btn-primary" data-bind="click:login">ចាក់ចូល</button>
				<button class="btn" data-bind="click:register">ចុះឈ្មោះ</button><br/>
				<div id="dialog" style="invisibility: hidden; padding-top: 20px; color: red">សូមពិនិត្យអីម៉េល​ រឺ លេខសំងាត់។</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="my-tmpl">
	<div class="container">
		<div class="row">
			<div class="span2">
				<ul class="nav nav-tabs nav-stacked">
				  	<li><a href="#/my">My Detail</a></li>
				  	<li><a href="#/my/changePWD">Change Password</a></li>
				  	<li><a href="#/my/addEmail">Add Email</a></li>
				  	<li><a href="#/my/addPhone">Add Phone</a></li>
				</ul>
			</div>
			<div class="span10" id="myContainer">kfjsdklfjsdklf</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="my-detail-tmpl"></script>
<script type="text/x-kendo-template" id="my-password-tmpl"></script>
<script type="text/x-kendo-template" id="my-email-tmpl"></script>
<script type="text/x-kendo-template" id="my-phone-tmpl"></script>
<script type="text/x-kendo-template" id="my-edit-picture-tmpl"></script>
<script type="text/x-kendo-template" id="admin-tmpl">
	<div class="container">
		<div class="row">
			<div class="span12" id="myContainer"></div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="admin-userList-tmpl">
	<table class="table">
		<thead>
			<tr>
				<td>
					ឈ្មោះប្រើ
				</td>
				<td>នៅប្រើ</td>
				<td>ថ្ងៃបង្ើត</td>
				<td>ថ្ងៃកែ</td>
				<td><button>ថ្មី</button></td>
			</tr>
		</thead>
		<tbody data-role="listview" data-bind="source: dataStore" data-template="userList-tmpl"></tbody>
	</table>
	<div data-role="pager" data-bind="source: dataStore"></div>
</script>
<script type="text/x-kendo-template" id="admin-structure-tmpl">
	<div class="widget">
		<div class="widget-head">
			<span class="btn btn-primary pull-right" data-bind="click: close">X</span>
			<h4 class="heading glyphicons circle_info"><i></i> <a id="title">បញ្ជីចំណាត់ថ្នាក់</a> </h4>
		</div>
		<div class="widget-body">
			<div class="well">
				<a href="#/structure/new" class="btn btn-primary"> <i class="icon-plus"></i> បង្កើតថ្មី</a>
				<table class="table table-white">
					<thead>
						<tr style="background-color: #14385C; color: #ffffff">
							<td>ព៌ណនា</td>
							<td>ថ្ងៃបង្ើត</td>
							<td>ថ្ងៃកែ</td>
							<td>កំពុងប្រើ</td>
							<td></td>
						</tr>
					</thead>
					<tbody data-role="listview" 
						   data-bind="source: dataStore" 
						   data-template="admin-structure-list-tmpl" 
						   data-selectable='true'></tbody>
				</table>
			</div>				
			<div data-role="pager" data-bind="source: dataStore" data-page-size='true' data-refresh='true'></div>
		</div>			
	</div>
</script>
<script type="text/x-kendo-template" id="admin-structure-list-tmpl">
	<tr>
		<td>#=name#</td>
		<td>#=created_at#</td>
		<td>#=updated_at#</td>
		<td><input type="checkbox"  data-bind="checked: active" /></td>
		<td>
			<a href="\#/structure/#=id#">កែ</a>&nbsp;|&nbsp;
			<a href="\#/structure/#=id#/segments">ថ្នាក់រង</a>&nbsp;|&nbsp;
			<a href="\#/structure/new">ថ្មី</a>
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="admin-structure-new-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span4 offset4">
				<div class="widget">
					<div class="widget-head">
						<button class="btn btn-primary pull-right" data-bind="click: close">X</button>
						<span style="padding-left: 15px; font-size: bold;">ចំណាត់ថ្នាក់ថ្មី</span>
					</div>
					<div class="widget-body">
					 	<label for="description">ពតមានលំអិត</label>
					 	<input type="text" data-bind="value: current.name" /><br/>
					 	<input type="checkbox" data-bind="checked: current.active" /> កំពុងប្រើ
					 	<button data-bind="click: save" class="btn btn-warning pull-right">រក្សាទុក</button><br>
					</div>
				</div>
			</div>
		</div>
	</div>			
</script>
<script type="text/x-kendo-template" id="admin-structure-segment-list-tmpl">
	<tr>
		<td><button class="btn" data-bind="click: segSelected">រើសមួយ</button></td>
		<td>#=code_length#</td>
		<td>#=name#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="admin-structure-single-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span4 offset4">
				<div class="widget">
					<div class="widget-head">
						<button class="btn btn-primary pull-right" data-bind="click: close">X</button>
						<span style="padding-left: 15px; font-size: bold;">ចំណាត់ថ្នាក់ថ្មី</span>
					</div>
					<div class="widget-body">
					 	<label for="description">ពតមានលំអិត</label>
					 	<input type="text" data-bind="value: current.name" /><br/>
					 	<input type="checkbox" data-bind="checked: current.active" /> កំពុងប្រើ
					 	<button data-bind="click: save" class="btn btn-warning pull-right">រក្សាទុក</button><br>
					</div>
				</div>
			</div>
		</div>
	</div>	
</script>
<script type="text/x-kendo-template" id="admin-segment-items-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span6 offset3">
				<div class="widget">
					<div class="widget-head">
						<button class="btn btn-primary pull-right" data-bind="click: closedX">X</button>
						<span style="padding-left: 15px; font-size: bold;">ចំណាត់ថ្នាក់ថ្មី</span>
					</div>
					<div class="widget-body">
						<div id="segment-list-container"></div>
					</div>
				</div>
			</div>
		</div>
	</div>	
</script>
<script type="text/x-kendo-template" id="admin-segment-items-list-conatiner-tmpl">
	<input style="margin-left: 255px;" type="text" data-role="dropdownlist" 
	 				   data-bind="source: segmentDS, value: segment.id, events: {change: sort}" 
	 				   data-value-field="id" 
	 				   data-text-field="name" />
	 				   <button data-bind="click: add"><i class="icon-plus-sign"></i></button>
	<div data-role="grid" 
		 data-bind="source: ds"
		 data-columns="[{title: 'កូដ'}, {title: 'ឈ្មោះ'}, {title: '&nbsp;' }]"
	 	 data-row-template="admin-segment-items-list-tmpl">
	</div>
</script>
<script type="text/x-kendo-template" id="admin-segment-items-list-action-tmpl">
	<table class="table">
		<tr>
			<td>ចំណាត់ថ្នាក់</td>
			<td><input type="text" data-role="dropdownlist" 
	 				   data-bind="source: segmentDS, value: segment.id, events: {change: sort}, enabled: editable" 
	 				   data-value-field="id" 
	 				   data-text-field="name" /></td>
		</tr>
		<tr>
			<td>កូដ</td>
			<td><input type="text" data-bind="value: current.code" /></td>
		</tr>
		<tr>
			<td>ឈ្មោះ</td>
			<td><input type="text" data-bind="value: current.name" /></td>
		</tr>
		<tr>
			<td></td>
			<td><button class="btn" data-bind="click: save"><i class="icon-plus-sign"></i> រក្សាទុក</button>
			<button class="btn" data-bind="click: cancel"><i class="icon-remove-sign"></i> បោះបង់</button></td>
		</tr>
	</table>	
</script>
<script type="text/x-kendo-template" id="admin-segment-items-list-tmpl">
	<tr>
		<td>#=code#</td>
		<td>#=name#</td>
		<td>
			<button class="btn" data-bind="click: edit"><i class="icon-edit"></i></button>
			<button class="btn" data-bind="click: remove"><i class="icon-trash"></i></button>
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="userList-tmpl">
	<tr>
		<td>#=username#</td>
		<td>#=status#</td>
		<td>#=created_at#</td>
		<td>#=updated_at#</td>
		<td>
			<a href="\#/userList/#=id#/edit">កែ</a>&nbsp;|&nbsp;
			<a href="\#/userList/#=id#/changePassword">កែលេខសំងាត់</a>&nbsp;|&nbsp;
			<a href="\#/userList/new">ថ្មី</a>
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="userList-new-tmpl">
	<div>
		<label for="username">ឈ្មោះប្រើ</label>
	 	<input type="text" data-bind="value: current.username" /><br/>
	 	<label for="password">លេខសំងាត់</label>
	 	<input type="password" data-bind="value: current.password" /><br/>
	 	<input type="checkbox" data-bind="checked: current.status" />&nbsp;នៅប្រើ<br/>
	 	<button data-bind="click: save">រក្សាទុក</button><br>
	 </div>
</script>
<script type="text/x-kendo-template" id="userList-edit-tmpl">
	<div>
	 	<label for="username">ឈ្មោះប្រើ</label>
	 	<input type="text" data-bind="value: current.username" disabled/><br/>
	 	<input type="checkbox" data-bind="checked: current.status" />&nbsp;នៅប្រើ<br/>
	 	<button data-bind="click: save">រក្សាទុក</button><br>
	</div>
</script>
<script type="text/x-kendo-template" id="userList-password-tmpl">
	<div>
	 	<label for="password">លេខសំងាត់</label>
	 	<input type="password" data-bind="value: password" /><br/>
	 	<label for="confirmedPWD">បញ្ជាក់លេខសំងាត់</label>
	 	<input type="password" data-bind="value: confirmedPWD" /><br/>
	 	<button data-bind="click: savePassword">រក្សាទុក</button><br>
	 </div>
</script>
<script type="text/x-kendo-template" id="admin-companyList-tmpl">	
</script>
<script type="text/x-kendo-template" id="company">
	<div class="container-fluid mainContainer">
		<div class="row full-height">
			<div id="mySidebar" class="span2 main full-height">
				<ul class="nav nav-list">
					<li><a href="#company">ក្រុមហ៊ុន</a></li>
					<li><a href="#company/new">បង្កើតថ្មី</a></li>
					<li><a href="#company/assign">បញ្ចូលអ្នកប្រើ</a></li>
				</ul>
			</div>
			<div id="companyContent" class="span10"></div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="companyList">
	<table class="table table-striped">
		<tbody data-role="listview" data-bind="source: company.dataSource"
								  data-template="companyListItem">
		</tbody>
	</table>
</script>
<script type="text/x-kendo-template" id="companyListItem">
	<tr>
		<td>#=name#</td>
		<td>#=legalName#</td>
		<td>#=phone#</td>
		<td>#=mobile#</td>
		<td>#=email#</td>
		<td>#=address#</td>
		<td><a href="\#company/assign">បញ្ចូលអ្នកប្រើ</a></td>
	</tr>
</script>
<!-- new vendor section -->
<script type="text/x-kendo-template" id="vendor-menu-tmpl">
	<li>
		<a href='#/pocenter'>Purchase Order</a>
	</li>
	<li>
		<a href='#/vendors/u/new'>Create Vendor</a>
	</li>
	<li>
		<a href='#/vendorReceiveBill'>Bill From Vendor</a>
	</li>
	<li>
		<a href='#/payment/vendor'>Cashier</a>
	</li>
	<li>
		<a href='#/vendor_payment_report'>Report</a>
	</li>
</script>
<script type="text/x-kendo-template" id="vendors-section-tmpl">
	<div class="widget widget-heading-simple widget-body-white widget-employees">				
		<div class="widget-body padding-none">	
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" style="height: 755px;">
					<div class="innerAll">
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" id="search" data-bind="click: findVendor"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" data-bind="value: key" placeholder="Search" id="searchField">
								</div>
							</div>
						</form>
					</div>
					<span class="results" data-bind="text: dataSource.total"></span>
					<div class="table table-condensed" id="sidebar" style="width: 292px"
						 data-role="grid" data-bind="source: dataSource" 
						 data-row-template="vendor-list-tmpl"
						 data-columns="[{title: 'Name'}]"
						 data-selectable=true
						 data-height="655"
						 data-pageable="true"
						 data-scrollable="{virtual: true}"></div>
				</div>
				<div class="span9 innerAll">
					<div id="vendorDashboard" class="row" style="margin-left: 5px;"></div>					
				</div>
			</div>	
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="vendors-section-dashboard-tmpl">
	<div class="row">
		<div class="span6">
			<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

			    <!-- Widget Heading -->
			    <div class="widget-head">

			        <!-- Tabs -->
			        <ul class="pull-right">
			            <li>Filter by</li>
			            
			            <li class="glyphicons circle_info active"><span data-toggle="tab" data-target="#tab4-8"><i></i></span>
			            </li>	
			            <li class="glyphicons google_maps"><span data-toggle="tab" data-target="#tab5-8"><i></i></span>
			            </li>							            
			            <li class="glyphicons phone"><span data-toggle="tab" data-target="#tab6-8"><i></i></span>
			            </li>
			            <li class="glyphicons edit"><span data-bind="click: edit"><i></i></span>
			            </li>
			            <li class="glyphicons user_add"><a href="#/vendors/u/new"><i></i></a>
			            </li>
			            <li class="glyphicons circle_plus"><span data-toggle="tab" data-target="#tab8-8"><i></i></span>
			            </li>							            
			        </ul>
			        <div class="clearfix"></div>
			        <!-- // Tabs END -->

			    </div>
			    <!-- Widget Heading END -->

			    <div class="widget-body">
			        <div class="tab-content">
			            <!-- INFO Tab content -->
			            <div id="tab4-8" class="tab-pane box-generic active">
			            	<div class="row-fluid">
				            	<div class="span6">
									<div class="widget widget-heading-simple widget-body-gray margin-none">
										<div class="widget-head">
											<h4 class="heading glyphicons user"><i></i> <span data-bind="text: current.company"></span></h4>
										</div>
										<div class="widget-body">
											<ul class="unstyled icons margin-none">
												<li class="glyphicons group"><i></i> Type: <span data-bind="text: current.type.name"></span></li>
												<li class="glyphicons phone"><i></i> Phone: <span data-bind="text: current.phone"></span></li>
												<li class="glyphicons envelope"><i></i> Email <span data-bind="text: current.email"></span></li>
												<li class="glyphicons calendar"><i></i> Register <span data-bind="text: current.created_at">2012-04-13</span></li>
											</ul>
										</div>
									</div>
								</div>
								<div class="span6">
									<div class="widget widget-heading-simple widget-body-gray margin-none">
										<div class="widget-head">
											
										</div>
										<div class="widget-body">
											<p><i class="icon-home"></i> VAT: <span data-bind="text: current.vat_no"></span></p>
											<p><i class="icon-dollar"></i> Currency:  <span data-bind="text: current.currency.code"></span></p>
											<p><i class="icon-money"></i> Address <span data-bind="text: current.address"></span></p>
										</div>
									</div>
								</div>
							</div>
			            </div>
			            <!-- // INFO Tab content END -->
			            <div id="tab5-8" class="tab-pane box-generic">							            	
						    <div id="map" style="height: 180px"></div>
			            </div>
			            <!-- NOTE Tab content -->
			            <div id="tab6-8" class="tab-pane box-generic">							            	
						    <div class="control-group">
						    	<div data-role="grid" data-bind="source: vendorPhones" data-auto-bind='false' data-columns="[{field: 'phone', title:'Phone'}, {field: 'name', title:'Name'},{field: 'department', title:'Department'},{field: 'type', title:'Type'}]"></div>
							</div>
			            </div>
			            <!-- // NOTE Tab content END -->

			            <!-- INVOICE Tab content -->
			            <div id="tab8-8" class="tab-pane box-generic">
			            	<table class="table table-borderless table-condensed cart_total">
				            	<tbody>
				            	<tr>
				            		<td>
				            			<a href="#/vendors/u/po" class="btn btn-block btn-inverse">Purchase Order</a>
				            		</td>
				            		<td>
				            			<a href="#/vendors/u/grn" class="btn btn-block btn-inverse">Good Receipt</a>
				            		</td>
				            	</tr>
				            	<tr>
				            		<td>
				            			<a href="#/bills/purchase/new" class="btn btn-block btn-inverse">Purchase</a>
				            		</td>
				            		<td>
				            			<a href="#/bills/expense/new" class="btn btn-block btn-inverse">Expense</a>
				            		</td>
				            	</tr>
			            	</tbody></table>
			            </div>
			            <!-- // INVOICE Tab content END -->								            

			        </div>
			    </div>
			</div>
		</div>
		<div class="span6 innerL">
			<div class="row">
				<div class="span6">
					<div class="widget-stats widget-stats-inverse widget-stats-5">
						<span class="glyphicons briefcase"><i></i></span>
						<span class="txt" style="font-size: 10pt">PO<span data-bind="text: poNum" ></span></span>
						<div class="clearfix"></div>
					</div>
				</div>
				<div class="span6">
					<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: doNothing">
						<span class="glyphicons coins"><i></i></span>
						<span class="txt" style="font-size: 10pt">Monthly Expense<span style="font-size: 17px;" data-bind="text: monthlyExpense"></span></span>
						<div class="clearfix"></div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="span6">
					<div class="widget-stats widget-stats-info widget-stats-5">
						<span class="glyphicons notes"><i></i></span>
						<span class="txt" style="font-size: 10pt"><span data-bind="text: invNum" ></span>Open Invoice</span>
						<div class="clearfix"></div>
					</div>
				</div>
				<div class="span6">
					<div class="widget-stats widget-stats-default widget-stats-5">
						<span class="glyphicons circle_exclamation_mark"><i></i></span>
						<span class="txt" style="font-size: 10pt"><span data-bind="text: invONum" ></span>Over Due Invioce</span>
						<div class="clearfix"></div>
					</div>
				</div>
			</div>			
		</div>
	</div><br/>
	<div class="row">
		<div class="span12">
			<div style="text-align: center;">
				<input type="text" data-role="dropdownlist" data-bind="source: dateType, events: {change: dateTypeSelect}" data-index="1" class="dateSelect" />
				<input type="text" data-role="datepicker" data-bind="value: startDate, events: {change: dateChange}"/>
				<input type="text" data-role="datepicker" data-bind="value: endDate" />
				<span data-bind="click: filterBill" class="k-button" data-role="button"><i class="icon-search"></i></span>
			</div>
		</div><br/>
		<div class="well span12">
			<div data-role="grid" class='table table-white table-condensed' 
	    		     data-bind="source: billDS"
	    		     data-columns="[
	    		     	{title: '<i class=icon-th-list></i>', width: '30px'},
	    		     	{field: 'type', title: 'Type', width: '90px'},
	    		     	{field: 'invoice_number', title: 'Reference', width: '120px'},
	    		     	{field: 'amount', title: 'Amount'},
	    		     	{field: 'paid', title: 'Paid'},
	    		     	{title: 'Over Due', width: '100px'},
	    		     	{field: 'status', title: 'Status', width: '100px'},
	    		     	{field: 'due_date', title: 'Due Date', width: '90px'},
	    		     	{field: '&nbsp;', title: 'Action'}
	    		     ]"
	    		     data-height="370"
	    		     data-pageable="{
	    		     	numeric: false,
	    		     	messages: {
	    		     		display: 'Disply {0}-{1} of {2}',
	    		     		empty: 'There is no data'
	    		     	}
	    		     }"
	    		     data-selectable=true
	    		     data-no-records="true"
	    		     data-messages="{noRecords: 'There is no data'}"
	    		     data-row-template="vendor-single-bill-list-tmpl"
	    		     >
	    		</div>
		</div>
	</div>			
</script>
<script type="text/x-kendo-template" id="vendor-single-bill-list-tmpl">
	<tr>
		<td>
			# if(type === 'po') {#
				<a href="\#/vendors/u/po/#=id#"><i class="icon-th-list"></i></a>
			# } else {#
				<a href="\#/bills/#=type#/#=id#"><i class="icon-th-list"></i></a>
			# } #
		</td>
		<td>
			# if(type=== "po") {#
				PO
			#} else if(type=== "purchase") {#
				<a href="\#/bills/#=type#/#=id#">Purchase</a>
			# } else if(type=== "expense") {#
				<a href="\#/bills/#=type#/#=id#">Expense</a>
			# } else if(type=== "grn") {#
				<a href="\#/vendors/u/grn/#=id#">Good Receipt</a>
			# } #
		</td>
		<td>
			#=invoice_number#
		</td>
		<td>#=kendo.toString(amount, 'c2')#</td>
		<td>#=kendo.toString(paid, 'c2')#</td>
		<td>
			# if(type=== "po") {#
				---
			#} else {#
				# var today = new Date(); #
				# var due = new Date(due_date); #

				#if(due.getTime() < today.getTime()) { #
					# var milliSecondPerDay = 86400 * 1000; #
					# due.setHours(0,0,0,1); #
					# today.setHours(23,59,59,999); #
					# var diff = today - due; #
					# var days= Math.ceil(diff/milliSecondPerDay); #
					# var week= Math.floor(days/7); #
					# days = days - (week * 2); #
					# startDay = due.getDay(); #
					# endDay = today.getDay(); #
					# if(startDay - endDay > 0) { #
						# days = days - 1; #
					#}#
					#if(startDay == 0 && endDay !=6){#
						# days = days - 1; #
					#}#
					#if(startDay == 6 && endDay !=0){#
						# days = days - 1; #
					#}#
					#if(days  === 1) {#
						0 day
					#} else {#
						#= days # days
					#}#
					
				#} else {#
					---
				# } #
			# } #
		</td>
		<td>
			# if(status === 'open') {#
				Open
			# } else if (status === 'partial'){#
				Partial
			# }else {#
				Paid
			# } #
		</td>
		<td>#:kendo.toString(new Date(due_date), 'dd-MM-yyyy')#</td>
		<td></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="vendor-list-tmpl">
	<tr><td>
		<div data-bind="click: selected">
			#if(company) {#
				<span>#=company#</span>
			#}#
		</div>
	</td></tr>
</script>
<script type="text/x-kendo-template" id="vendor-new-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span12">
				<div class="widget vendor-form">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
				        <h4 class="heading">Vendor</h4>
				    </div>
				    <div class="widget-body">
				        <table class="table">
				        	<tr>
				        		<td>Company Name</td>
				        		<td>
				        			<input type="text" id="company" name="company" class="k-textbox" data-bind="value: current.company" required
				        				   validationMessage="Require" />
				        		</td>
				        		<td>Type</td>
				        		<td><input type="text" name="vendorType" style="width: 220px;" data-role="dropdownlist"
				        				   data-bind="source: contactTypes, value: current.type"
				        				   data-text-field="name"
				        				   data-value-field="id"
				        				   data-auto-bind=false
				        				   data-option-label="&nbsp;" required validationMessage="Required" /></td>
				        	</tr>
				        	<tr>
				        		<td>Company In English</td>
				        		<td><input type="text" class="k-textbox" data-bind="value: current.company_en" /></td>
				        		<td>Website</td>
				        		<td><input type="text" class="k-textbox" data-bind="value: current.website" /></td>
				        	</tr>
				        	<tr>
				        		<td>VAT</td>
				        		<td><input type="text" class="k-textbox" data-bind="value: current.vat_no" /></td>
				        		<td>Phone</td>
				        		<td><input type="tel"
				        				   data-role="maskedtextbox"
				        				   data-mask="(000) 000-000-0009"
				        				   data-bind="value: current.phone"
				        				   placeholder="(000) 000-000X" /></td>
				        	</tr>
				        	<tr>
				        		<td>Address</td>
				        		<td><input type="text" class="k-textbox" data-bind="value: current.address" /></td>
				        		<td>Email</td>
				        		<td><input type="email" class="k-textbox" data-bind="value: current.email" /></td>
				        	</tr>
				        	<tr>
				        		<td>Business Type</td>
				        		<td><input type="text" style="width: 220px;" data-role="dropdownlist" 
				        				   data-bind="source: businessType, value: current.business_type"
				        				   data-text-field="type"
				        				   data-value-field="id"
				        				   data-option-label="&nbsp;" required validationMessage="Required" /></td>
				        		<td>Is local business</td>
				        		<td><input type="checkbox" data-bind="checked: current.is_local" /> Yes</td>			        		
				        	</tr>
				        	<tr>
				        		<td>Payment Option 1</td>
				        		<td><input type="text" style="width: 220px;" data-role="dropdownlist"
				        				   data-bind="source: paymentOptions, value: current.payment_main, events: { change: selectPaymentOption }"
				        				   data-text-field="name"
				        				   data-value-field="id"
				        				   data-option-label="&nbsp;" /></td>
				        		<td>Currency</td>
				        		<td><input type="text" style="width: 220px;" class="input"
				        				   data-bind="source: currencyDS.dataSource, value: current.currency"
				        				   data-role="dropdownlist"
				        				   data-text-field="code"
				        				   data-value-field="id" /></td>
				        	</tr>
				        	<tr>
				        		<td>Payment Option 2</td>
				        		<td><input type="text" style="width: 220px;" data-role="dropdownlist"
				        				   data-bind="source: paymentOptions, value: current.payment_second, events: { change: selectPaymentOption }"
				        				   data-text-field="name"
				        				   data-value-field="id"
				        				   data-option-label="&nbsp;" /></td>
				        		<td>Payment Term</td>
				        		<td><input type="text" style="width: 220px;" data-role="dropdownlist" 
				        				   data-bind="source: paymentTerm, value: current.payment_term" 
				        				   data-text-field="name"
				        				   data-value-field="id"
				        				   data-option-label="&nbsp;" /></td>
				        	</tr>
				        	<tr>
				        		<td>Account Payable</td>
				        		<td><input type="text" style="width: 220px;" data-role="dropdownlist" name="apaccount"
				        				   data-bind="source: apAccount, value: current.ap"
				        				   data-text-field="name"
				        				   data-value-field="id"
				        				   data-template="accountDropDownList"
				        				   data-option-label="&nbsp;" required validationMessage="Required" /></td>
				        		<td>Disount Account</td>
				        		<td><input type="text" style="width: 220px;" data-role="dropdownlist" name="discountaccount"
				        			 	   data-bind="source: discountAC, value: current.purchaseDiscount"
				        			 	   data-text-field="name"
				        				   data-value-field="id"
				        				   data-template="accountDropDownList"
				        				   data-option-label="&nbsp;" required validationMessage="Required" /></td>
				        	</tr>
				        	<tr>
				        		<td>Prepaid Account</td>
				        		<td><input type="text" style="width: 220px;" data-role="dropdownlist"  name="prepaidaccount"
				        				   data-bind="source: prepaidAC, value: current.prepaid"
				        				   data-text-field="name"
				        				   data-value-field="id"
				        				   data-template="accountDropDownList"
				        				   data-option-label="&nbsp;" required validationMessage="Required" /></td>
				        		<td>Credit Limit</td>
				        		<td><input type="number" style="width: 220px;" data-role="numerictextbox" 
				        				   data-bind="value: current.credit_limit"
				        				   data-decimals="2"
				        				   data-min="0" /></td>
				        	</tr>
				        	<tr data-bind="visible: paidByBank">
				        		<td>Bank</td>
				        		<td>
			        				<input type="text" style="width: 220px;" class="input" 
			        					   data-role="dropdownlist" 
			        					   data-bind="source: bankModel.ds, value: current.bank"
			        					   data-value-field="id"
			        					   data-text-field="name" />
				        				
				        		</td>
				        		<td>Bank Account Number</td>
				        		<td>
				        			<input type="text" data-bind="value: current.bank_account_number" />
				        		</td>
				        	</tr>
				        	<tr data-bind="visible: paidByBank">
				        		<td>Account Name</td>
				        		<td><input type="text" class="k-textbox" data-bind="value: current.bank_account_name" /></td>
				        		<td>Bank Address</td>
				        		<td><input type="text" class="k-textbox" data-bind="value: current.bank_address" /></td>
				        	</tr>
				        	<tr data-bind="visible: paidByCheck">
				        		<td>Name on Check</td>
				        		<td><input type="text" class="k-textbox" data-bind="value: current.name_on_cheque" /></td>
				        		<td></td>
				        		<td></td>
				        	</tr>
				        	<tr>
				        		<td colspan="4">
				        			<table class="table table-condensed">
										<thead>
											<tr>
												<th width="30" class="center"><span data-bind="click: addPhone"><i class="icon-plus"></i></span></th>
												<th>Name</th>
												<th>Department</th>
												<th>Phone Number</th>
												<th>Type</th>
												<th></th>
											</tr>
										</thead>
										<tbody data-role="listview" 
													data-bind="source: vendorPhones" 
													data-template="vendor-phone-list-add-tmpl"
										></tbody>
									</table>
				        		</td>
				        	</tr>
				        </table>
				    </div>
				</div>
				<div style="text-align: right">
					<button class="btn btn-primary span3 pull-right" data-bind="click: saveClose">
						Save and Close
					</button>
					<button class="btn btn-default span3 pull-right" data-bind="click: save">
						Save and Continue</button>
					</button>					
					<button class="btn btn-warning span3 pull-right" data-bind="visible: isEdit, events: {click: remove}">
						Delete
					</button>
				</div>
				<div data-role="notification" id="notification" 
					 data-width="250px" 
					 data-position="{top: 25, right: 10}"></div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="vendor-phone-list-add-tmpl">
	<tr>
		<td></td>
		<td><input type="text" data-bind="value: name"/></td>
		<td><input type="text" data-role="dropdownlist" 
							   data-bind="source: departments, value: department" 
							   data-text-field="description" 
							   data-value-field="department" /></td>
		<td><input type="text" data-role="maskedtextbox" data-mask="(000) 000-000-0009" data-bind="value: phone"/></td>
		<td><input type="text" data-role="dropdownlist" 
							   data-bind="source: phoneTypes, value: type" 
							   data-text-field="description" 
							   data-value-field="type" /></td>
		<td><span class="glyphicons no-js delete" data-bind="click: removePhone"><i></i></span></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="accountDropDownList">
	<span>#=code#&nbsp;#=name#</span>
</script>
<!-- end new vendor section -->
<script type="text/x-kendo-template" id="vendors-purchase-form-header-tmpl">
	<div id="bill-header" class="container-960">
		<div class="widget" style="overflow: hidden">
			<button class="btn btn-primary pull-right" style="margin-right: 60px;" data-bind="click: close">X</button>
			<div class="widget-head">	
				<h4 class="heading glyphicons notes"><i></i> Purchase Form</h4>
			</div>
			<div class="widget-body">
				<table class="table bill-form">
					<tbody>
						<tr>
								<td width="200">Paid in Cash</td>
								<td><input type="checkbox" data-bind="checked: form.current.paidCash, events: {change: form.getAccount}" /></td>
								<td width="200">Account</td>
								<td><input type="text" style="width: 220px;"
									data-role="combobox"
									data-bind="source: form.account, value: form.current.account"
									data-text-field="name"
									data-value-field="id"
									data-option-label="Select One" /></td>
						</tr>
						<tr>
							<td>Vendor</td>
							<td>
								<div class="input-append">
								<input class="span11" type="text" data-bind="value: form.current.vendor.company" required/>
								<button class="btn" data-bind="click: form.getVendor"><i class="icon-search"></i></button>
							</td>
							<td>PO</td>
							<td><input id="purchase_po" type="text" style="width: 220px;" /></td>
						</tr>
						<tr>
							<td>Voucher</td>
							<td><input type="text" data-bind="value: form.current.voucher" /></td>
							<td>Invoice Number</td>
							<td><input type="text" data-bind="value: form.current.invoice_number" /></td>
						</tr>
						<tr>
							<td>Comment</td>
							<td><input type="text" data-bind="value: form.current.comment" /></td>
							<td>Payment Method</td>
							<td><input type="text" style="width: 220px;" data-role="dropdownlist"
									   data-bind="source: pmtMethod, value: form.current.payment_term"
									   data-text-field="name"
									   data-value-field="id" /></td>
						</tr>
						<tr>
							<td>Segment</td>
							<td><select data-role="multiselect" 
												   data-bind="source: form.classDS, value: form.current.segment, events: {change: changeValue}" 
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="select"
												   style="width: 220px" /></select></td>
							<td>Date</td>
							<td><input type="text" data-role="datepicker" data-bind="value: form.current.due_date" style="width: 220px;" /></td>
						</tr>
					</tbody>
				</table>
				<table class="table table-condensed">
					<thead style="background-color: darkblue; color: #fff; font-weight: bold">
						<tr>
							<td><i class="icon-plus" data-bind="click: addItem"></i></td>
							<td>No.</td>
							<td>Item</td>
							<td>Description</td>
							<td>Unit</td>
							<td>Price</td>
							<td>Amount</td>
							<td>Tax</td>
						</tr>
					</thead>
					<tbody data-role="listview" data-bind="source: itemDS" data-template="vendors-bill-form-purchase-list-tmpl" data-auto-bind=false></tbody>
				</table>
				<button class="btn btn-inverse" data-bind="click: addItem"><i class="icon-plus icon-white"></i></button><br/>
				<div class="pull-left span3">
					<textarea name="" id="notice" data-bind="value: form.current.notice" cols="60" rows="5"></textarea>
				</div>
				<div class="pull-left span3">
					<textarea name="" id="internal-notice" data-bind="value: form.current.internal_notice" cols="60" rows="5"></textarea>
				</div>
				<div class="pull-right span4">
					<table style="width: 100%;">
						<tr style="background-color: #000">
							<td colspan="2"></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">Sub Total</td>
							<td><input  style="text-align: right;" type='text' data-role="numerictextbox" data-bind="value: form.current.amount" data-format="c2" disabled></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">VAT</td>
							<td style="text-align: right;"><span data-bind="text: form.current.taxAmount"></span></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">Total</td>
							<td style="text-align: right;"><span data-bind="text: form.grandTotal"></span></td>
						</tr>
						<tr>
							<td colspan="2"></td>
						</tr>
					</table>
				</div>
				<div class="notification" data-role="notification" 
							 data-width="250px" 
							 data-position="{top: 25, right: 10}"></div>
				<div class="span12" style="text-align: center; padding-bottom: 10px;">
					<span class="btn btn-icon btn-primary glyphicons circle_ok"  data-bind="click: save"><i></i>Save</span>
					<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: close">Cancel</span>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="vendors-bill-form-purchase-list-tmpl">
	<tr>
		<td><i class="icon-trash" data-bind="click: removeItem"></i></td>
		<td><span data-bind="text: number"></span></td>
		<td><input style="width: 150px" type="text" 
				   data-role="dropdownlist" 
				   data-bind="source: itemArrayList, value: item" 
				   data-text-field="name" 
				   data-value-field="id"
				   data-option-label="Select ONe" /></td>
		<td><input style="width: 100%" type="text" data-bind="value: item.description" /></td>
		<td><input data-role="numerictextbox" style="width: 140px;" type="text" data-bind="value: unit, events: {change: computeAmount}" /></td>
		<td><input data-role="numerictextbox" style="width: 140px;" type="text" data-bind="value: rate, events: {change: computeAmount}" /></td>
		<td><span data-bind="text: amount"></span></td>
		<td><input type="checkbox" data-bind="checked: isTaxed, events: {change: getTax}" /></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="vendors-expense-form-header-tmpl">
	<div id="bill-header" class="container-960">
		<div class="widget" style="overflow: hidden">	
			<div class="widget-head">	
				<button class="btn btn-primary pull-right" data-bind="click: close">X</button>
				<h4 class="heading glyphicons notes"><i></i> Expense Form</h4>
			</div>
			<div class="widget-body">
				<table class="table bill-form">
					<tbody>
						<tr>
								<td width="200">Paid in Cash</td>
								<td><input type="checkbox" data-bind="checked: form.current.paidCash, events: {change: form.getAccount}" /></td>
								<td width="200">Account</td>
								<td><input type="text" style="width: 220px;"
									data-role="combobox"
									data-bind="source: form.account, value: form.current.account"
									data-template="account-item-template"
									data-text-field="name"
									data-value-field="id"
									data-option-label="Select One" />	
								</td>
						</tr>
						<tr>
							<td>Vendor</td>
							<td>
								<div class="input-append">
								<input class="span11" type="text" data-bind="value: form.current.vendor.company" required/>
								<button class="btn" data-bind="click: form.getVendor"><i class="icon-search"></i></button>
							</td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>Voucher</td>
							<td><input type="text" data-bind="value: form.current.voucher" /></td>
							<td>Invoice Number</td>
							<td><input type="text" data-bind="value: form.current.invoice_number" /></td>
						</tr>
						<tr>
							<td>Comment</td>
							<td><input type="text" data-bind="value: form.current.comment" /></td>
							<td>Payment Term</td>
							<td><input type="text" style="width: 220px;" data-role="dropdownlist"
									   data-bind="source: pmtMethod, value: form.current.payment_term"
									   data-text-field="name"
									   data-value-field="id" /></td>
						</tr>
						<tr>
							<td>Segment</td>
							<td><select data-role="multiselect" 
												   data-bind="source: form.classDS, value: form.current.segment, events: {change: changeValue}" 
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="select"
												   style="width: 220px" /></select></td>
							<td>Date</td>
							<td><input type="text" data-role="datepicker" data-bind="value: form.current.expected_date, events: {change: form.getDue}" style="width: 220px;" /></td>
						</tr>
					</tbody>
				</table>

				<table class="table table-condensed">
					<thead style="background-color: darkblue; color: #fff; font-weight: bold">
						<tr>
							<td><i class="icon-plus" data-bind="click: addItem"></i></td>
							<td>No</td>
							<td>Account</td>
							<td>Description</td>
							<td>Price</td>
							<td>Amount</td>
							<td>Tax</td>
						</tr>
					</thead>
					<tbody data-role="listview" data-bind="source: itemDS" data-template="vendors-bill-form-expense-list-tmpl" data-auto-bind=false></tbody>
				</table>

				<button class="btn btn-inverse" data-bind="click: addItem"><i class="icon-plus icon-white"></i></button><br/>
				<div class="pull-left span3">
					<textarea name="" id="notice" data-bind="value: form.current.notice" cols="60" rows="5"></textarea>
				</div>
				<div class="pull-left span3">
					<textarea name="" id="internal-notice" data-bind="value: form.current.internal_notice" cols="60" rows="5"></textarea>
				</div>
				<div class="pull-right span4">
					<table style="width: 100%;">
						<tr style="background-color: #000">
							<td colspan="2"></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">Sub Total</td>
							<td><input style="text-align: right;" type='text' data-role="numerictextbox" data-bind="value: form.current.amount" data-format="c2" disabled></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">
								<input type="text" data-role="combobox" data-placeholder="( --- Tax --- )"
								 	   data-bind="source: taxItems, value: taxRate, events: {change: onTaxSelected}"
								 	   data-text-field="id"
								 	   data-value-field="name">
							</td>
							<td style="text-align: right;"><span data-bind="text: form.current.taxAmount"></span></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">Total</td>
							<td style="text-align: right;"><span data-bind="text: form.grandTotal"></span></td>
						</tr>
					</table>
				</div>
				<div class="notification" data-role="notification" 
							 data-width="250px" 
							 data-position="{top: 25, right: 10}"></div>
				<div class="span12" style="text-align: center; padding-bottom: 10px;">
					<span class="btn btn-icon btn-primary glyphicons circle_ok"  data-bind="click: save"><i></i>Save</span>
					<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: close">Cancel</span>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="vendors-bill-form-expense-list-tmpl">
	<tr>
		<td><i class="icon-trash" data-bind="click: removeItem"></i></td>
		<td><span data-bind="text: number"></span></td>
		<td><input style="width: 100%" type="text" 
				   data-role="dropdownlist" 
				   data-bind="source: accountList, value: account" 
				   data-template="account-item-template"
				   data-text-field="name" 
				   data-value-field="id"
				   data-option-label="Select One" /></td>
		<td><input style="width: 100%" type="text" data-bind="value: item.description" /></td>
		<td><input data-role="numerictextbox" style="width: 140px;" type="text" data-bind="value: rate, events: {change: computeAmount}" /></td>
		<td><span data-bind="text: amount"></span></td>
		<td><input type="checkbox" data-bind="checked: isTaxed, events: {change: form.getTax}" /></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="account-item-template">
	#=code#-#=name#
</script>
<script type="text/x-kendo-template" id="accounts-list-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span3 offset4">
				<div class="widget">
					<div class="widget-head">
						<h4 class="heading">Vendor List</h4>
						<span class="pull-right" data-bind="click: billVM.close">X</span>
					</div>
					<div class="widget-body">
						<div class="input-append">
							<input type="text" class="input span10" data-bind="value: key" />
							<button class="btn" data-bind="click: search"><i class="icon-search"></i></button>
						</div>
						<div id="vendorListView"></div>
					</div>
				</div>				
			</div>
		</div>
	</div>
</script>
<script  type="text/x-kendo-template" id="bill-list-container-tmpl">
	<div>
		<div>
			<input type="text" data-role="dropdownlist" 
				   data-bind="source: dateList, events:{change: dateSort}" 
				   data-value-field="id" 
				   data-text-field="name"
				   data-option-label="Select One" />
			<input type="text" name="from" data-role="datepicker" data-bind="value: from" />
			<input type="text" name="to" data-role="datepicker" data-bind="value: to" />
			<button class="btn btn-primary" type="button" data-bind="click: searchBill"><i class="icon-search"></i></button>
		</div>
	</div>
	<div class="well">
		<table class="table table-condensed">
			<tbody>
				<tr>
					<td>Cash Account</td>
					<td><input type="text" data-role="dropdownlist" 
				       data-bind="source: accountVM.dataStore, value: cashAccount, events: {open: getCashAccount}" 
				       data-text-field="name" 
				       data-value-field="id" 
				       data-auto-bind=false /></td>
					<td>Description</td>
					<td><input type="text" data-bind="value: payment.memo"/></td>
				</tr>
			</tbody>
		</table>
	</div>
	
	<table class="table">
		<thead>
			<tr>
				<th></th>
				<th>Bill</th>
				<th>Amount</th>
				<th>Status</th>
				<th>Paid</th>
				<th>Over Due</th>
				<th>Amount Remain</th>
				<th>Discount</th>
				<th></th>
			</tr>
		</thead>
		<tbody data-role="listview" 
			   data-bind="source: paymentArr" 
			   data-auto-bind=false 
			   data-template="bill-list-item-tmpl"></tbody>
	</table>
	<button class="btn" id="payBillBtn" data-bind="click: payThoseBills">Pay Bill</button>
	<div data-role="notification" class="notification" 
					 data-width="330px" 
					 data-position="{bottom: 10, right: 10}"></div>
</script>
<script  type="text/x-kendo-template" id="bill-list-item-tmpl">
	<tr>
		<td><input type="checkbox" data-bind="checked: makePayment, events: {click: singleBillSelect}" /></td>
		<td><a href="\#/bills/#=reference.id#">#=reference.invoice_number#</a></td>
		<td>#=kendo.toString(reference.amount, 'c2')#</td>
		<td>
			# if(reference.status==='open') {#
				Open
			#} else if(reference.status === 'partial') {#
				Partial
			#} else {#
				Paid
			#}#
		</td>
		<td>#=reference.due_date#</td>
		<td>
			# var today = new Date(); #
			# var due = new Date(reference.due_date); #

			#if(due.getTime() < today.getTime()) { #
				# var milliSecondPerDay = 86400 * 1000; #
				# due.setHours(0,0,0,1); #
				# today.setHours(23,59,59,999); #
				# var diff = today - due; #
				# var days= Math.ceil(diff/milliSecondPerDay); #
				# var week= Math.floor(days/7); #
				# days = days - (week * 2); #
				# startDay = due.getDay(); #
				# endDay = today.getDay(); #
				# if(startDay - endDay > 0) { #
					# days = days - 1; #
				#}#
				#if(startDay == 0 && endDay !=6){#
					# days = days - 1; #
				#}#
				#if(startDay == 6 && endDay !=0){#
					# days = days - 1; #
				#}#
				#if(days  === 1) {#
					0 day
				#} else {#
					#= days # days
				#}#
				
			#} else {#
				---
			# } #
		</td>
		<td><input type="text" data-role="numerictextbox" data-bind="value: amount, events: {change: payCommute}" style="width:1500xp;" /></td>
		<td><input type="text" data-role="numerictextbox" data-bind="value: discount" style="width:1500xp;" /></td>
		<td>
			<i class="icon-tasks" data-bind="click: getDetail"></i>
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="payment-tmpl">
	<button data-bind="click: close" class="pull-right">X</button>
	<h2>Make Payment</h2>
	<table class="table">
		<tbody>
			<tr>
				<th>Cash Account:</th>
				<th></th>
				<th>Check:</th>
				<th></th>
			</tr>
			<tr>
				<th>Date:</th>
				<th></th>
				<th>Voucher:</th>
				<th></th>
			</tr>
			<tr>
				<th>Segment:</th>
				<th></th>
				<th>Description:</th>
				<th></th>
			</tr>
		</tbody>
	</table>
	<table class="table">
		<thead>
			<tr>
				<th>Bill</th>
				<th>Amount</th>
				<th>Discount</th>
				<th>Fine</th>
				<th>Rate</th>
			</tr>
		</thead>
		<tbody data-role="listview" data-bind="source: DS" data-template="payment-list-tmpl" data-auto-bind=false></tbody>
	</table>
	<button class="btn btn-primary pull-right" data-bind="click: save">Save</button>
</script>
<script type="text/x-kendo-template" id="payment-list-tmpl">
	#if(!id) {#
	<tr>
		<td>#=reference.id#</td>
		<td><input type="text" data-bind="value: amount" /></td>
		<td><input type="text" data-bind="value: discount" /></td>
		<td><input type="text" data-bind="value: fine" /></td>
		<td>#=rate#</td>
	</tr>
	#}#
</script>
<!-- Purchase Order Starts-->
<script type="text/x-kendo-template" id="purchase-order-tmpl">
	<div class="container-960">
		<div class="widget" style="overflow: hidden">
			<div class="widget-head">
				<button class="btn btn-primary pull-right" style="margin-right: 10px;" data-bind="click: close">X</button>
				<h4 class="heading glyphicons notes"><i></i> Purchase Order</h4>
			</div>
			<div class="widget-body">
				<table class="table table-condensed bill-form">
					<tbody>
						<tr>
							<td>Purchase Order Number (*)</td>
							<td><input type="text" data-bind="value: current.invoice_number" required /></td>
							<td>Date</td>
							<td><input type="text" data-role="datepicker" data-bind="value: current.due_date" /></td>
						</tr>
						<tr>
							<td>Vendor (*)</td>
							<td>
								<div class="input-append">
								<input class="span11" type="text" data-bind="value: current.vendor.company" required/>
								<button class="btn" data-bind="click: getVendor"><i class="icon-search"></i></button>
							</td>
							<td>Expected Date</td>
							<td><input type="text" data-role="datepicker" data-bind="value: current.expected_date" /></td>
						</tr>
						<tr>
							<td>Segment</td>
							<td><select data-role="multiselect" 
												   data-bind="source: classDS, value: current.segment, events: {change: changeValue}"
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="select"
												   style="width: 220px" /></select></td>
							<td>Sale Order</td>
							<td><input type="text" disabled/></td>
						</tr>
						<tr>
							<td>Address</td>
							<td><textarea name="address" id="address" data-bind="value: current.address" cols="30" rows="2"></textarea></td>
							<td>Delivery Address</td>
							<td><textarea data-bind="value: current.delivery_address" name="delivery_address" id="delivery_address" cols="30" rows="2"></textarea></td>
						</tr>
					</tbody>
				</table>
				<table class="table table-condensed">
					<thead style="background-color: darkblue; color: #fff; font-weight: bold">
						<tr>
							<td><i class="icon-plus" data-bind="click: addItem"></i></td>
							<td>No.</td>
							<td>Item</td>
							<td>Description</td>
							<td>Unit</td>
							<td>Price</td>
							<td>Amount</td>
							<td>Tax</td>
						</tr>
					</thead>
					<tbody data-role="listview" data-bind="source: itemDS.ds" data-template="po-list-template" data-auto-bind=false></tbody>
				</table>
				<div class="pull-left span3">
					<textarea name="" id="notice" data-bind="value: current.notice" cols="60" rows="5"></textarea>
				</div>
				<div class="pull-left span3">
					<textarea name="" id="internal-notice" data-bind="value: current.internal_notice" cols="60" rows="5"></textarea>
				</div>
				<div class="pull-right span4">
					<table style="width: 100%;">
						<tr style="background-color: #000">
							<td colspan="2"></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">Sub Total</td>
							<td><input type='text' data-role="numerictextbox" data-bind="value: current.amount" data-format="c2" disabled></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">VAT</td>
							<td><span data-bind="text: current.taxAmount"></span></td>
						</tr>
						<tr>
							<td style="text-align: right; width: 100px;">Total</td>
							<td><span data-bind="text: grandTotal"></span></td>
						</tr>
					</table>
				</div>
				<div class="notification" data-role="notification" 
							 data-width="250px" 
							 data-position="{top: 25, right: 10}"></div>
				<div class="span12" style="text-align: center; padding-bottom: 10px;">
					<span class="btn btn-icon btn-primary glyphicons circle_ok"  data-bind="click: save"><i></i>Save and Continue</span>
					<span class="btn btn-icon btn-primary glyphicons circle_ok"  data-bind="click: saveClose"><i></i>Save and Close</span>
					<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: close">Cancel</span>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="po-list-template">
	<tr>
		<td><i class="icon-plus" data-bind="click: addItem"></i> <i class="icon-minus" data-bind="click: removeItem"></i></td>
		<td><span data-bind="text: number"></span></td>
		<td><input style="width: 100%" type="text" 
				   data-role="dropdownlist" 
				   data-bind="source: itemArrayList, value: item" 
				   data-text-field="name" 
				   data-value-field="id"
				   data-option-label="Select One" /></td>
		<td><input style="width: 100%" type="text" data-bind="value: item.description" /></td>
		<td><input data-role="numerictextbox" style="width: 140px;" type="text" data-bind="value: unit, events: {change: computeAmount}" /></td>
		<td><input data-role="numerictextbox" style="width: 140px;" type="text" data-bind="value: rate, events: {change: computeAmount}" /></td>
		<td><span data-bind="text: amount"></span></td>
		<td><input type="checkbox" data-bind="checked: isTaxed, events: {change: getTax}" /></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="po-center-template">
	<div class="widget widget-heading-simple widget-body-white widget-employees">				
		<div class="widget-body padding-none">	
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" style="height: 730px;">
					<div class="innerAll">
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" id="search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" value="" placeholder="Search" id="searchField">
								</div>
							</div>
							<div class="select2-container" style="width: 100%;">
								<div class="overflow-hidden">
									<select name="" id="searchOptions" style="width: 100%;" tabindex="-1">
										<option value="class_id">Class</option>
						                <option value="name">Name</option>
									</select>
								</div>
							</div>
						</form>
					</div>
					<span class="results" data-bind="text: billVM.ds.total"></span>
					<div class="table table-condensed" id="sidebar" style="height: 605px;"
						 data-role="grid" data-bind="source: billVM.ds" 
						 data-row-template="po-center-list-template"
						 data-columns="[{title: 'PO List'}]"
						 data-selectable=true
						 data-height="600"
						 data-scrollable="{virtual: true}"
						 data-auto-bind=false></div>
				</div>
				<div class="span9">
					<div class="row" style="margin-left: 5px;">
						<div class="well">
							<fieldset>
								<legend>Vendor</legend>
									<table class="table">
										<tbody>
											<tr>
												<td>ID.</td>
												<td><span data-bind="text: current.vendor[0].id"></span></td>
												<td>Phone</td>
												<td><span data-bind="text: current.vendor[0].phone"></span></td>
											</tr>
											<tr>
												<td>Name</td>
												<td><span data-bind="text: current.vendor[0].company"></span></td>
												<td>Name (English)</td>
												<td><span data-bind="text: current.vendor[0].company_en"></span></td>
											</tr>
											<tr>
												<td>Email</td>
												<td><span data-bind="text: current.vendor[0].email"></span></td>
												<td>Is local company</td>
												<td><input type="checkbox" name="localCo" data-bind="checked: current.vendor[0].is_local" /> Yes</td>
											</tr>
										</tbody>
									</table>
							</legend>
						</div>
						<table class="table table-striped table-bordered">
							<thead>
								<tr>
									<th>Item</th>
									<th>Description</th>
									<th>Unit</th>
									<th>Price</th>
									<th>Amount</th>
								</tr>
							</thead>
							<tbody data-role="listview" 
								   data-bind="source: billVM.itemDS.ds" 
								   data-template="po-center-item-list-template"
								   data-auto-bind=false></tbody>
						</table>
						<a href="#/vendors/u/grn" class="btn btn-primary" data-bind="disabled: is_grn">Receive Goods</a> 
						<a href="#/bills/purchase/new" class="btn btn-warning" data-bind="disabled: is_bill">Enter Bill</a>
					</div>					
				</div>
			</div>	
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="po-center-list-template">
	<tr data-bind="click: selected">
		<td>#:invoice_number#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="po-center-item-list-template">
	<tr>
		<td>#=item.name#</td>
		<td>#=item.description#</td>
		<td>#=unit#</td>
		<td>#=amount#</td>
		<td>#:kendo.toString(unit * amount, 'c2')#</td>
	</tr>
</script>
<!-- Purchase Order ends -->
<!-- vendor end -->
<!-- vendor payment -->
<script type="text/x-kendo-template" id="vendors-payment-template">
	<div class="container-fluid">
		<div class="row">
			<div class="span12">
				<div class="widget">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind="click: close">X</span>
						<h3 style="padding-left: 10px; font-size: 18px;">Cashier</h3>
					</div>
					<div class="widget-body">
						<div class="row">
							<div class="span3 innerL">
								<div class="well">
									<div class="input-append">
										<input style="width: 190px;" type="text" placeholder="Vender ID"​ data-bind="value: vendorID" />
										<button data-bind="click: findVendor" class="btn btn-primary"><i class="icon-search"></i></button>
									</div>
	    		     				<table class="table table-stripe" data-bind="visible: show">
	    		     					<tr>
	    		     						<td>Name</td>
	    		     						<td><span data-bind="text: currentV.company"></span></td>
	    		     					</tr>
	    		     					<tr>
	    		     						<td>VAT</td>
	    		     						<td><span data-bind="text: currentV.vat_no"></span></td>
	    		     					</tr>
	    		     					<tr>
	    		     						<td>Currency</td>
	    		     						<td><span data-bind="text: currentV.currency.code"></span></td>
	    		     					</tr>
	    		     					<tr>
	    		     						<td>Credit Limit</td>
	    		     						<td><span data-bind="text: currentV.credit_limit"></span></td>
	    		     					</tr>
	    		     				</table>
								</div>
							</div>
							<div class="span9">
								<div class="row">
									<div style="margin-left: 10px;" class="span12 well">
										<div class="row-fluid">
											<div class="span4">
												<div class="innerAll padding-bottom-none-phone">
													<div class="widget-stats widget-stats-gray widget-stats-4"> 
														<span class="txt">Bill(s) Paid</span>
														<span class="count" data-bind="text: tInvToday"></span>
														<span class="glyphicons user"><i></i></span>
														<div class="clearfix"></div>
														<i class="icon-play-circle"></i> 
													</div>
												</div>
											</div>

											<div class="span4">
												<div class="innerAll padding-bottom-none-phone">
													<div class="widget-stats widget-stats-primary widget-stats-4">
														<span class="txt">Daily Payment</span>
														<span class="count"><span data-bind="text: tAmtToday" style="font-size: 35px;">0៛</span></span>
														<span class="glyphicons coins"><i></i></span>
														<div class="clearfix"></div>
														<i class="icon-play-circle"></i>
													</div>
												</div>
											</div>

											<div class="span4">
												<div class="innerAll padding-bottom-none-phone">
													<a href="#/vendor_payment_report" class="widget-stats widget-stats-inverse widget-stats-4">
														<span class="txt">Payment Report</span>
														<span class="glyphicons refresh"><i></i></span>
														<div class="clearfix"></div>
													</a>
												</div>
											</div>				
										</div>
									</div>
									<div class="span12">
										<div id="exampleValidate" data-role="validator">
										 <!-- //End row-fluid -->						
										<br>

										<table class="table table-bordered table-striped" data-bind="visible: show">
									        <thead>
									            <tr>
									                <th>Pay</th>
									                <th>Date</th>						                
									                <th>Name</th>
									                <th>Bill</th>
									                <th>Amount</th>
									                <th class="right">Paid</th>
									                <th class="right" width="110bb">Payment</th>							                
									            </tr>
									        </thead>
									        <tbody data-role="listview" data-auto-bind="false" 
									        	   data-template="payment-vednor-row-template" 
									        	   data-bind="source: tmp" 
									        	   class="k-widget k-listview"></tbody>						        
									    </table>						    

										<br>
										<div id="status"></div>
										<br>
										<div class="row-fluid" data-bind="visible: show">
											<div class="span8">						
												<table>
													<tbody>
														<tr>
															<td style="width: 100px;">Date</td>
										              		<td>
										              			<input id="paymentDate" name="paymentDate" data-role="datepicker" data-bind="value: paymentDate" data-format="dd-MM-yyyy" required="" data-required-msg="Require Date" type="text" class="k-input">
															</td>
															<td>Total Amount:</td>
															<td align="right"><input type="text" data-bind="value: total" class="k-input k-textbox" style="width: 160px;" /></td>
														</tr>
											            </tr><tr>
															<td>Cash Account</td>
															<td>
																<input id="cashAccount" 
																	data-bind="source: cashAccount,value: account"  
																	data-required-msg="Required" 
																	data-role="dropdownlist"
																	data-text-field="name",
																	data-value-field="id"
																	data-option-label="---Select One---"
																	style="display: none;">											
															</td>
															<td>Payment Voucher:</td>
															<td align="right"><input type="text" data-bind="value: voucher" class="k-input k-textbox" style="width: 160px;" /></td>
														</tr>
														<tr>
															<td valign="top">Segment</td>
															<td valign="top"><select data-role="multiselect" 
														   		data-bind="source: classDS, value: segment, events: {change: changeValue}" 
														   		data-value-field="id" 
														   		data-text-field="name"
														   		data-placeholder="---Select One---"
														   		style="width: 160px" /></select>
														    </td>
															<td valign="top">Notice</td>
															<td colspan='3'>
																<textarea style="width: 150px;" name="" id="" cols="30" rows="5" data-bind="value: memo"></textarea>
															</td>
														</tr>										
													</tbody>
												</table>							
											</div>																			
											<div class="span4">
												<div class="innerAll padding-bottom-none-phone" data-bind="click: makePayment">
													<a id="save" name="save" class="widget-stats widget-stats-info widget-stats-4">
														<span class="txt">Amount Paid</span>
														<span class="count" style="font-size: 35px;" data-bind="text: total">៛</span>
														<span class="glyphicons cart_in"><i></i></span>
														<div class="clearfix"></div>
														<i class="icon-play-circle"></i>
													</a>
												</div>								
											</div>
										</div>

									</div>
									</div>
								</div>
							</div>
						</div>
					</div>	
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="payment-vednor-row-template">
	<tr>
		<td><input type="checkbox" data-bind="checked: isPaid, events: { change: tick }" /></td>
		<td>#=due#</td>
		<td>#=vendor.company#</td>
		<td>#=invoice#</td>
		<td>#=amountBilled#</td>
		<td>#=paid#</td>
		<td><input type="text" data-bind="value: amount, events: { change: tick }" style="width: 100px" /></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="vendors-payment-report-template">
	<div class="container-fluid">
		<div class="row">
			<div class="span12">
				<div class="widget">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind="click: close">X</span>
						<h3 style="padding-left: 10px; font-size: 18px;">Payment Report</h3>
					</div>
					<div class="widget-body">
						<div class="row innerAll">
							<div class="span12">
								<div style="text-align: center;">
									<input type="text" data-role="dropdownlist" data-bind="source: dateType, events: {change: dateTypeSelect}" data-index="1" class="dateSelect" />
									<input type="text" data-role="datepicker" data-bind="value: startDate, events: {change: dateChange}"/>
									<input type="text" data-role="datepicker" data-bind="value: endDate" />
									<span data-bind="click: findPmt" class="k-button" data-role="button"><i class="icon-filter"></i></span>
								</div><br >
								<div class="well">
									<table class="table table-white">
										<thead>
											<tr style="background-color: #12385C; color: #ffffff">
												<th>Date</th>
												<th>Name</th>
												<th>Type</th>
												<th>Bill Number</th>
												<th>Amount</th>
											</tr>
										</thead>
										<tbody data-role="listview" 
											   data-bind="source: pmtDS" 
											   data-template="vendor-payment-report-list-tmpl"
											   data-auto-bind=false></tbody>
										<tfoot>
											<tr>
												<td colspan='5'>
												
												</td>
											</tr>
										</tfoot>
									</table>
									<div data-role="pager" data-bind="source: pmtDS"></div>
								</div>
							</div>
						</div>
					</div>	
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="vendor-payment-report-list-tmpl">
	<tr>
		<td>#: kendo.toString(payment_date, 'dd-MM-yyyy')#</td>
		<td><a href="\#/vendors">#=contact[0].company#</a></td>
		<td>#=type#</td>
		<td><a href="\#/bills/#=type#/#=reference_id#">#=reference_id#</a></td>
		<td style="text-align: right">#= kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<!-- end vendor payment -->
<!-- Accounting Section Starts -->
<script type="text/x-kendo-template" id="accounting-menu-tmpl">
	<li>
		<a href='#/accounting_dashboard' class="glyphicons home"><i></i></a>
	</li>
	<li><a href="#/accounts">Chart of Accounts</a></li>
	<li class="dropdown">
		<a href="#" class="dropdown-toggle" data-toggle="dropdown">កត់ត្រាប្រតិបត្តិការ <i class="caret"></i></a>
		<ul class="dropdown-menu" id="dropdownMenu">
			<li id="home-menu"><a href="#/accounts/u/gl">General Leger</a></li>
			<li id="customer-menu"><a href="#/customers">ទាញទិន្នានុប្បវត្តិ</a></li>
			<li id="vendor-menu"><a href="#/bills/expense/new">Expense</a></li>
			<li id="account-menu"><a href="#/bills/purchase/new">Purchase</a></li>
			<li id="water-menu"><a href="#/cashier/receipt">Receipt</a></li>
			<li id="electricity-menu"><a href="#/invoice">Invoice</a></li>
			<li id="water-menu"><a href="#/payment/vendor">Payment</a></li>
			<li id="water-menu"><a href="#/cashiers">Cash Receipt</a></li>
    	</ul>
	</li>
	<li><a href="#/currency_rate">Exchange Rate</a></li>
	<li>
		<a href="#" class="dropdown-toggle" data-toggle="dropdown">Accounting Report <i class="caret"></i></a>
		<ul class="dropdown-menu" id="dropdownMenu">
			<li id="home-menu"><a href="#/trial_balance">Trial Balance</a></li>
			<li id="customer-menu"><a href="#/journalReport">Journal</a></li>
			<li id="vendor-menu"><a href="#/glReport">General Ledger</a></li>
    	</ul>
	</li>
	<li>
		<a href='#/accounting_setting' class='glyphicons settings'><i></i></a>
	</li>
</script>
<script type="text/x-kendo-template" id="accounting-dashboard-tmpl">
	<div class="widget widget-heading-simple widget-body-white widget-employees">				
		<div class="widget-body padding-none">	
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" style="height: 700px;">
					<div class="innerAll">
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" id="search" data-bind="click: find"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" data-bind="value: accountKeyId" placeholder="Search" id="searchField">
								</div>
							</div>
						</form>
					</div>
					<span class="results" data-bind="text: accounts.dataStore.total"></span>
					<div class="table table-condensed" id="sidebar" style="height: 580px;"
						 data-role="grid" data-bind="source: accounts.dataStore" 
						 data-row-template="accountChartTmpl"
						 data-columns="[{title: 'Account'}]"
						 data-selectable=true
						 data-height="600"
						 data-pageable="true"
						 data-scrollable="{virtual: true}"></div>
				</div>
				<div class="span9 innerAll">
					<div id="vendorDashboard" class="row" style="margin-left: 5px;">
						<div class="row-fluid">
							<div class="span5">
								<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">
							    	<!-- Widget Heading -->
							    	<div class="widget-head">				
								        <!-- Tabs -->
								        <ul class="pull-right">
								            <li class="glyphicons circle_info active"><span data-toggle="tab" data-target="#tab1-5"><i></i></span>
								            </li>
								            <li class="glyphicons circle_plus"><a href="#/accounts/u/new"><i></i></a>
			            					</li>
								        </ul>
								        <div class="clearfix"></div>
								        <!-- // Tabs END -->
									</div>
		    						<!-- Widget Heading END -->

								    <div class="widget-body">
								        <div class="tab-content">
								            <!-- Tab content -->
								            <div id="tab1-5" class="tab-pane active box-generic">
								            	<div class="row-fluid">
								            		<div class="span10">
								            			លេខកូដគណនី៖ <span class="strong" data-bind="text: current.code"></span><br/>
										            	ឈ្មោះគណនី៖ <span class="strong" data-bind="text: current.name"></span><br/>
										            	គណនីមេ៖ <span class="strong" data-bind="text: current.parentAccount.name"></span><br/>
										            	ប្រភេទគណនី៖ <span class="strong" data-bind="text: current.type.name"></span><br/>
										            	រូបបិយវត្ថុគណនី៖ <span class="strong" data-bind="text: current.type.name"></span><br/>
										            	ពីពណ៍នា៖ <span class="strong" data-bind="text: current.description"></span>
								            		</div>
								            		<div class="span2" style="margin-bottom: -30px;">
									            		<span class="btn btn-default btn-block" data-bind="click: edit"><i class="icon-pencil"></i></span><br/>
									            		<span class="btn btn-primary btn-block" data-bind="text: current.type.nature"></span>
									            	</div>
								            	</div>
								            </div>
								            <!-- // Tab content END -->

								            <!-- Tab content -->
								            <div id="tab2-5" class="tab-pane box-generic">
								                	<h4>Tab #2 content heading</h4>
								                <p>Donec at nunc dui. Integer eget sem sit amet arcu bibendum elementum vel sit amet risus. Fusce libero lorem, fermentum vitae lacinia dapibus, vestibulum ac enim. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos
								                    himenaeos. Vestibulum accumsan risus sed lorem tincidunt eget faucibus sapien tempor. Proin ac feugiat dolor. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum ante ipsum primis
								                    in faucibus orci luctus et ultrices posuere cubilia Curae.</p>
								            </div>
								            <!-- // Tab content END -->
								        </div>
								    </div>
								</div>

							</div>
							<div class="span7">
								<div class='row-fluid' style='margin-bottom: 8px;'>
									<div class="span12">
										<div class="widget-stats widget-stats-gray widget-stats-2">
											<span class="count" data-bind="text: todayBalance"></span>
											<span class="txt">Balance upto today</span>
										</div>
									</div>
								</div>
								<div class='row-fluid'>
									<div class="span6">
										<div class="widget-stats widget-stats-gray widget-stats-2">
											<span class="count" data-bind="text: recurring.count"></span>
											<span class="txt">Recurring Transaction</span>
										</div>
									</div>
									<div class="span6">
										<div class="widget-stats widget-stats-gray widget-stats-2">
											<span class="count" data-bind="text: transactionOccurred"></span>
											<span class="txt">Transactions</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="separator bottom"></div>
						<div style="text-align: center;">
							<input type="text" data-role="dropdownlist" data-bind="source: dateType, events: {change: dateTypeSelect}" data-index="1" class="dateSelect" />
							<input type="text" data-role="datepicker" data-bind="value: startDate, events: {change: dateChange}"/>
							<input type="text" data-role="datepicker" data-bind="value: endDate" />
							<span data-bind="click: filter" class="k-button" data-role="button"><i class="icon-search"></i></span>
						</div><br/>
						<div class="well">
							<div data-role="grid"
								 data-bind="source: journal.entries"
								 data-columns="[
								 	{title: '&nbsp', width: '25px'},
								 	{title: 'Type'},
									{title: 'Description'},
									{title: 'Segment'},
									{title: 'Dr.'},
									{title: 'Cr.'},
									{title: '', width: '30px'}								 
								 ]"
								 data-height="400px"
								 data-row-template="accounting-dashboard-grid-list-tmpl"></div>
							<div data-role='pager' data-bind="source: journal.entries"></div>
						</div>							
					</div>					
				</div>
			</div>	
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="accounting-dashboard">
	<div class="innerAll">
		<div class="span4">
			<div class="well">
				<span style="text-align: right">Accounting Standard៖ ស្តងដាររាបាយកាណ៍ហិរញ្ញវត្ថុទាក់ទង​នឹងហិរញ្ញវិត្ថុអន្តរជាតិនៃកម្ពុជាសម្រាប់សហគ្រាសធុនតូច Accounting reporting standard</span>
				<div class="separator bottom"></div>
				<button class="btn btn-primary">Khmer Standard</button>
				<button class="btn btn-primary" style="font-size: 9.95pt;">Download this Standard</button>
				<div class="separator bottom"></div>
				Reporting Date៖ Janurary 1<subscript>st</subscript> to December 31<subscript>st</subscript><br/>
				Reporting Currency៖ Riel (KHR)
			</div>				
			<div class="separator buttom"></div>
			<div>
				<div id="account-dash-graph"></div>
			</div>
		</div>
		<div class="span4">
			<div style="text-align: center;">
				រយៈពេលពី&nbsp;
					<input type="text" data-role="datepicker" data-bind="value: dateFrom" style="width: 130px;" />
					<input type="text" data-role="datepicker" data-bind="value: dateTo, events: {change: onDateChange}" style="width: 130px;" />
					<button data-role="button" data-bind="click: searchByDate"><i class="icon-search"></i></button>
			</div>
			<div class="separator buttom"></div>
			<h2 style="text-align: center;">Financial Report</h2>
			<div style="text-align: center;">Frome &nbsp;<span data-bind="text: dateTo" data-format="dd-MM-yyyy"></span></div>
			<div class="separator buttom"></div>
			<div class="widget widget-body-white">
				<div class="widge-body">
					<table class="table table-borderless table-condensed table-striped">
						<thead>
							<tr>
								<th>Asset</th>
								<th></th>
							</tr>
						</thead>
						<tbody data-role="listview" data-bind="source: balanceSheet.assetDS" data-auto-bind=false data-template="accounting-balance-sheet-list-tmpl"></tbody>
						<tfoot>
							<tr>
								<td>Total Asset</td>
								<td style="text-align: right"><span data-bind="text: balanceSheet.totalAsset"></span></td>
							</tr>
						</tfoot>
					</table>
					<hr/>
					<table class="table table-borderless table-condensed table-striped">
						<thead>
							<tr>
								<th>Liability and Equity</th>
								<th></th>
							</tr>
						</thead>
						<tbody data-role="listview" data-bind="source: balanceSheet.liabilityDS" data-auto-bind=false data-template="accounting-balance-sheet-list-tmpl"></tbody>
						<tfoot>
							<tr>
								<td>Total Liability and Equity</td>
								<td style="text-align: right"><span data-bind="text: balanceSheet.totalLiabEq"></span></td>
							</tr>
						</tfoot>
					</table>
				</div>
			</div>
		</div>
		<div class="span4">
			<div class="row-fluid">
				<div class="span6">
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count" data-bind="text: transactionOccurred"></span>
						<span class="txt">Transaction</span>
					</a>
				</div>
				<div class="span6">
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count" data-bind="text: recurring.count"></span>
						<span class="txt">Recurring Transaction</span>
					</a>
				</div>
			</div>
			<br/>
			<div class="row-fluid">
				<div class="span6">
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count" data-bind="text: balanceSheet.getXRatio"></span>
						<span class="txt">Current Ratio</span>
					</a>
				</div>
				<div class="span6">
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count" data-bind="text: balanceSheet.getQRatio"></span>
						<span class="txt">Quick Ratio</span>
					</a>
				</div>
			</div>
			<table class="table">
				<tbody>
					<tr>
						<td width="280">Return on Capital Employed</td>
						<td style='text-align: right;'><span data-bind="text: getROCE"></span> %</td>
					</tr>
					<tr>
						<td>Gross Profit Margin</td>
						<td style='text-align: right;'><span data-bind="text: getGPM"></span> %</td>
					</tr>
					<tr>
						<td>Net Profit Margin</td>
						<td style='text-align: right;'><span data-bind="text: getNPM"></span> %</td>
					</tr>
					<tr>
						<td>Asset Turnover</td>
						<td style='text-align: right;'><span data-bind="text: getAssetTurnOver"></span> %</td>
					</tr>
					<tr>
						<td>
							Account Receivable Collection Period
						</td>
						<td style='text-align: right;'><span data-bind="text: getARCP"></span> Day(s)</td>
					</tr>
					<tr>
						<td>Inventory Turnover</td>
						<td style='text-align: right;'><span data-bind="text: getInventoryTurnOver"></span>Day(s)</td>
					</tr>
					<tr>
						<td></td>
						<td style='text-align: right;'><span data-bind="text: getNumberSeven"></span> Day(s)</td>
					</tr>
				</tbody>
			</table>				
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="accounting-balance-sheet-list-tmpl">
	<tr>
		<td>#=type#</td>
		# var amount = 0.00 #
		# if(accounts.length > 0) {#
			# for(var i = 0; i < accounts.length; i++) {#
				# amount += kendo.parseFloat(accounts[i].amount); #
			#}#			
		#}#
		<td style="text-align: right">#=amount#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="accounting-trialBalance-tmpl">
	<div class="container-960">
		<div class="span12">
			<button class="btn btn-primary pull-right" data-bind="click: back">X</button>
			From &nbsp;
				<input type="text" data-role="datepicker" data-bind="value: dateTo" style="width: 200px;" />
				<button data-role="button" data-bind="click: searchDate"><i class="icon-search"></i></button>
			<div class="separator buttom"></div>
			<h3 style="text-align: center">Trial Balance</h3>
			<table class="table table-primary table-borderless table-striped table-condensed table-pricing-2">
				<thead>
					<tr>
						<th style="text-align: center">Code</th>
						<th style="text-align: center">Account</th>
						<th style="text-align: center">Dr</th>
						<th style="text-align: center">Cr</th>
					</tr>
				</thead>
				<tbody data-role="listview" data-bind="source: trialBalance.dataSource" data-template="accounting-trialBalance-list-tmpl"></tbody>
				<tfoot style="background-color: #eeeeee; color: #000000; font-weight: bold">
					<tr>
						<td></td>
						<td></td>
						<td><span data-bind="text: trialBalance.tbDebit"></span></td>
						<td><span data-bind="text: trialBalance.tbCredit"></span></td>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="accounting-trialBalance-list-tmpl">
	<tr>
		<td>#=code#</td>
		<td>#=account#</td>
		<td style="text-align: right">#=dr#</td>
		<td style="text-align: right">#=cr#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="accounting-dashboard-grid-list-tmpl">
 <tr>
 	<td>
 		#if(journal.type==='po') {#
 			<a href="\#/vendors/u/po/#=journal.reference#"><i class="icon-th-list"></i></a>
 		#} else if (journal.type === 'gl') {#
 			<a href="\#/accounts/u/gl/#=journal.id#"><i class="icon-th-list"></i></a>
 		#} else {#
 			<a href="\#/bills/#=journal.type#/#=journal.reference#"><i class="icon-th-list"></i></a>
 		#}#	
 	</td>
 	<td>#=journal.type#</td>
 	<td>#=memo#</td>
 	<td>
 		#for(var i = 0; i < segment.length; i++) {#
 			#=segment[i].code#
 		#}#
 	</td>
 	<td>
 		# if (is_debit === 'true') {# 
 			#=amount#
 		#}#
 	</td>
 	<td># if (is_debit === 'false') {# 
 			#=amount#
 		#}#
 	</td>
 	<td></td>
 </tr>
</script>
<script type="text/x-kendo-template" id="accountChartTmpl">
	<tr data-bind="click: selected">
		<td>
			#if(parentAccount.id !== 0) {#
				&nbsp;&nbsp;&nbsp;&nbsp;
			#} else#
			#=code# - #=name#
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="account-new-tmpl">
	<div class="span10 offset1">
		<table class="table">
			<tr>
				<td>Type of Account:</td>
				<td><input type="text" data-role="dropdownlist" data-bind="source: types, value: current.type" data-text-field="name" data-value-field="id" /></td>
			</tr>
			<tr>
				<td>Parent Account:</td>
				<td><input type="text" data-role="combobox" data-bind="source: ds, value: current.parentAccount"
							           data-text-field="name"
							           data-value-field="id" />
				</td>
			</tr>
			<tr>
				<td>Code:</td>
				<td><input type="text" data-bind="value: current.code" /></td>
			</tr>
			<tr>
				<td>Account Name:</td>
				<td><input type="text" data-bind="value: current.name" /></td>
			</tr>
			<tr>
				<td>Account Name (En):</td>
				<td><input type="text" data-bind="value: current.name_en" /></td>
			</tr>
			<tr>
				<td>Description:</td>
				<td><input type="text" data-bind="value: current.description" /></td>
			</tr>
		</table>
		<div data-role="notification" id="notification" 
			 data-width="250px" 
			 data-position="{top: 25, right: 10}"></div>
		<button class="btn" data-bind="click: save">Save</button>
	</div>
</script>
<script type="text/x-kendo-template" id="parent-account-tmpl">
	<tr>
		<td>#=code# - #=name#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="journal-account-tmpl">
	<div class="container">
		<div class="row">
			<div class="span12">
				<div class="widget">
					<div class="widget-head">	
						<h4 class="heading glyphicons notes"><i></i> Journal</h4>
						<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
					</div>
					<div class="widget-body">
						<div class="well">
							<span>JV No.</span>
							<input type="text" data-bind="value: current.voucher"
								   data-role="maskedtextbox"
								   data-mask="&&-0000000" />
							<span>Date</span>
							<input type="text" data-role="datepicker" 
								   data-bind="value: current.issuedDate"
								   data-format="dd-MM-yyyy"
								   data-parse-formats="yyyy-MM-dd" />
							Type of Transaction: 
							<input type="text" 
								data-role="dropdownlist" 
								data-bind="source: types, value:current.type"
								data-text-field="name"
								data-value-field="id" />
						</div>
						<div>
							Recurring <input type="checkbox" data-bind="checked: isRecurred, events: {change: createRecurring}" /> &nbsp;
							<span style="width: 400px;">How often does it recurr?</span> 
							<input type="text" data-role="dropdownlist" 
								   data-bind='source: recurringVM.recurringDS, value: recurringVM.current.recurring_number'
								   data-value-field="id"
								   data-text-field="name"
								   style="width: 90px;" />
							When is the next date for recurring? 
							<input type="text" 
								   data-role="datepicker"
								   data-bind="value: recurringVM.current.date"
								   data-format="dd-MM" style="width: 90px;" />
						</div>
						<div class="separator buttom"></div>
						<div class="widget">
							<div class="widget-head">
								<h2 class="heading">Description</h2>
							</div>
							<div class="widget-body">
								<textarea data-bind="value: current.memo" style='width: 100%; height: 50px;'></textarea>
							</div>
						</div>
						<table class="table">
							<thead>
								<tr>
									<th><button class="btn" data-bind="click: addEntry">+</button></th>
									<th>Account</th>
									<th>Description</th>
									<th>Name</th>
									<th>Segment</th>	
									<th>Dr.</th>
									<th>Cr.</th>								
								</tr>
							</thead>
							<tbody data-role="listview" data-bind="source: entries" data-template="journal-entry-account-tmpl">
							</tbody>
							<tfoot>
								<tr>
									<td></td>
									<td><span data-bind="text: debit"></span></td>
									<td><span data-bind="text: credit"></span></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td colspan="6">
										
									</td>
								</tr>
							</tfoot>
						</table>
						<div style="text-align: right">
							<button class="btn btn-primary" style="width: 220px;" data-bind="click: save">Save and Continue</button>
							<button class="btn btn-success" style="width: 220px;" data-bind="click: saveNClose">Save and Close</button>
							<button class="btn btn-danger" style="width: 220px;" data-bind="click: close">Cancel</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="journal-entry-account-tmpl">
	<tr>
		<td><span class="btn"><i class="icon-remove" data-bind="click: removeEntry"></i></span></td>
		<td>
			<input type="text" data-role="dropdownlist" data-bind="source: accountList, value: account" data-auto-bind=false data-text-field="name" data-value-field="id" />
		</td>
		<td><input style="width: 140px;" type="text" data-bind="value: memo" /></td>
		<td><input style="width: 100px;" 
										  type="text" 
										  data-role="combobox" 
										  data-virtual=true 
										  data-bind="source: people.dataSource, value: contact" 
										  data-value-field="id" 
										  data-text-field="name"
										  data-filter="contains"
										  data-min-length=5
										   /></td>
		<td><select style="width: 100px;" data-role="multiselect" style="width: 150px" 
										   data-bind="source: classDS, value: segment, events: {change: changeValue}" 
										   data-value-field="id" 
										   data-text-field="name"
										   data-placeholder="select"
										   data-item-template="class-list-tmpl"
										   data-auto-bind=false
										   style="width: 220px" /></select></td>
		<td><input type="text" style="width: 150px" data-bind="value: debit, events:{change: totalDebit, blur: check}" /></td>
		<td><input type="text" style="width: 150px" data-bind="value: credit, events:{change: totalCredit, blur: check}" /></td>		
	</tr>
</script>
<script type="text/x-kendo-template" id="journal-report-tmpl">
	<h3 data-bind="text: companyInf()[0].legal_name" style="text-align:center"></h3>
	<h4 style="text-align:center">Journal Report</h4><br/>
	<div style="text-align: center;">
		<input type="text" data-role="dropdownlist" data-bind="source: dateType, events: {change: dateTypeSelect}" data-index="1" class="dateSelect" />
		<input type="text" data-role="datepicker" data-bind="value: startDate, events: {change: dateChange}"/>
		<input type="text" data-role="datepicker" data-bind="value: endDate" />
		<span data-bind="click: filter" class="k-button" data-role="button"><i class="icon-search"></i></span>
	</div><br/>
	<table class='table table-striped table-white'>
		<thead style="background-color: #00bbff; color: #ffffff">
			<tr>
				<th>#</th>
				<th>Type</th>
				<th>Date</th>
				<th>Num</th>
				<th>Name</th>
				<th>Memo</th>
				<th>Segment</th>
				<th>Account</th>
				<th>Dr</th>
				<th>Cr</th>
			</tr>
		</thead>
		<tbody
			data-role="listview" 
			data-bind="source: journal" 
			data-template="journal-report-list-tmpl"
			data-auto-bind="false"
		></tbody>
		<tfoot>
			<tr>
				<td colspan="8"></td>
				<td style="text-align: right; font-weight: bold; border-bottom: 5px double #000000; width; 190px; padding: 5px;">
					<span data-bind="text: jDebit" style="font-size: 14px; color: #dd1919"></span>
				</td>
				<td style="text-align: right; font-weight: bold; border-bottom: 5px double #000000; width; 190px; padding: 5px;">
					<span data-bind="text: jCredit" style="font-size: 14px; color: #dd1919"></span>
				</td>
			</tr>
		</tfoot>
	</table>
</script>
<script type="text/x-kendo-template" id="journal-report-list-tmpl">
	<tr>
		<td>#=id#</td>
		<td>
			#if(type === 'pmt') {#
				Payment
			#} else if(type === 'purchase') {#
				Purchase
			#} else if(type === 'expense') {#
				Expense
			#} else if(type === 'adj') {#
				Adjustment
			#} else if(type === 'invoice') {#
				Invoice
			#} else if(type === 'eInvoice') {#
				Electricity Invoice
			#} else if(type === 'wInvoice') {#
				Water Invoice
			#} else if(type === 'deposit') {#
				Deposit
			#} else if(type === 'Receipt') {#
				Receipt
			#}#				
		</td>
		<td>#=kendo.toString(date, 'dd-MM-yyyy')#</td>
		<td>#=voucher#</td>
		<td>#=contact.surname# #=contact.name#</td>
		<td>#=memo#</td>
		<td>

		</td>
		<td>
			#for (var i = 0; i < entries.length; i++) {#
				#= entries[i].account.code # #=entries[i].account.name# <br/>
			# } #
		</td>
		<td style="text-align: right">
			# var amount = 0; #
			#for (var i = 0; i < entries.length; i++) {#
				#if(entries[i].is_debit === 'true') {#
					# amount += kendo.parseFloat(entries[i].amount) #
					#= entries[i].amount #  <br/>
				# } else {#
					<br/>
				# } #
			# } #
			<hr/>
			<strong>#= kendo.toString(amount, 'c') #</strong>
		</td>
		<td style="text-align: right">
			# var amount = 0; #
			#for (var i = 0; i < entries.length; i++) {#
				#if(entries[i].is_debit === 'false') {#
					# amount += kendo.parseFloat(entries[i].amount) #
					#= entries[i].amount #  <br/>
				# } else {#
					<br/>
				# } #
			# } #
			<hr/>
			<strong>#= kendo.toString(amount, 'c') #</strong>
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="journal-ledger-report-tmpl">
	<h3 data-bind="text: companyInf()[0].legal_name" style="text-align:center"></h3>
	<h4 style="text-align:center">General Ledger Report</h4><br/>
	<div style="text-align: center;">
		<input type="text" data-role="dropdownlist" data-bind="source: dateType, events: {change: dateTypeSelect}" data-index="1" class="dateSelect" />
		<input type="text" data-role="datepicker" data-bind="value: startDate, events: {change: dateChange}"/>
		<input type="text" data-role="datepicker" data-bind="value: endDate" />
		<span data-bind="click: filterGL" class="k-button" data-role="button"><i class="icon-search"></i></span>
	</div><br/>
	<table class='table table-white'>
		<thead style="background-color: #00bbff; color: #ffffff">
			<tr>
				<th>Type</th>
				<th>Date</th>
				<th>Number</th>
				<th>Name</th>
				<th>Description</th>
				<th>Segment</th>
				<th>Account</th>
				<th>Amount</th>
				<th>Debit</th>
				<th>Crdit</th>
				<th>Balance</th>
			</tr>
		</thead>
		<tbody
			data-role="listview" 
			data-bind="source: gl" 
			data-template="journal-ledger-report-list-tmpl"
			data-auto-bind="false"
		></tbody>
	</table>
</script>
<script type="text/x-kendo-template" id="journal-ledger-report-list-tmpl">
	<tr>
		<td><strong>#=code#-#=name#</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		<td style="text-align: right">#=balance#</td>
	</tr>
	# var tmpbalance = 0, tmpamount = 0; #
	# tmpbalance = balance; #
	# for(var i = 0; i < entries.length; i++) {#
		# tmpbalance += kendo.parseFloat(entries[i].amount); #
		# tmpamount += kendo.parseFloat(entries[i].amount); #
		<tr style="font-size: 10px; font-weight: italic;">
			<td> 
				#if(entries[i].type === 'pmt') {#
					&nbsp;Payment
				#} else if(entries[i].type === 'purchase') {#
					&nbsp;Purchase
				#} else if(entries[i].type === 'expense') {#
					&nbsp;Expense
				#} else if(entries[i].type === 'adj') {#
					&nbsp;Adjustment
				#} else if(entries[i].type === 'invoice') {#
					&nbsp;Invoice
				#} else if(entries[i].type === 'eInvoice') {#
					&nbsp;Electricity Invoice
				#} else if(entries[i].type === 'wInvoice') {#
					&nbsp;Water Invoice
				#} else if(entries[i].type === 'deposit') {#
					&nbsp;Deposit
				#} else if(entries[i].type === 'Receipt') {#
					&nbsp;Receipt
				#}#		
			</td>
			<td>#=entries[i].dateTime#</td>
			<td>#=entries[i].voucher#</td>
			<td>#=entries[i].contact.surname# #=entries[i].contact.name#</td>
			<td>#=entries[i].memo#</td>
			<td></td>
			<td>
			</td>
			<td>	
			</td>
			<td style="text-align: right">
				#=entries[i].dr#
			</td>
			<td>
				#=entries[i].cr#
			</td>
			
			<td style="text-align: right">#= tmpbalance #</td>
		</tr>
	#}#
	<tr>
		<td>Total #=code#-#=name#</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		<td><div style="border-top: 3px double black; text-align: right">#=tmpamount#</div></td>
		<td><div style="border-top: 3px double black; text-align: right">#=tmpbalance#</div></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="class-list-tmpl">
	<span>
		#=name# (#=segment.name#)
	</span>
</script>
<script type="text/x-kendo-template" id="cashier-tmpl">
	<h1><img src="./uploads/pictures/banhji_cashier.png" alt="" width="300" height="100" /></h1>
	<div class="widget widget-heading-simple widget-body-white widget-employees">				
		<div class="widget-body padding-none">	
			<div class="row-fluid row-merge" style="margin-right: 0">
				<div class="span2 listWrapper" style="height: 755px;">
					<div class="innerAll">
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" id="search" data-bind="click: findVendor"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" data-bind="value: key" placeholder="Search" id="searchField">
								</div>
							</div>
						</form>
					</div>
					<span class="results" data-bind="text: people.dataSource.total()">
					</span>
					<div class="table table-condensed" id="sidebar"
						 data-role="grid" data-bind="source: people.dataSource" 
						 data-row-template="cashier-people-list-tmpl"
						 data-columns="[{title: 'Name'}]"
						 data-selectable=true
						 data-height="655"
						 data-pageable="false"
						 data-scrollable="{virtual: true}"></div>
				</div>
				<div class="span10">
					<div class="widget widget-tabs widget-tabs-double widget-tabs-white">
					    <!-- Tabs Heading -->
					    <div class="widget-head">
					        <ul>
					            <li class="active" id="cashier-payment-id"><a href="#tab1-2" class="glyphicons user" data-toggle="tab"><i></i><span class="strong">ទូទាត់ប្រាក់</span></a>
					            </li>
					            <li class="" id="cashier-receipt-id"><a href="#tab2-2" class="glyphicons calculator" data-toggle="tab"><i></i><span class="strong">ទទួលប្រាក់</span><span>ទទួលប្រាក់</span></a>
					            </li>
					            <li class="" id="cashier-deposit-id"><a href="#tab3-2" class="glyphicons credit_card" data-toggle="tab"><i></i><span class="strong">ដាក់ប្រាក់</span><span>ដាក់ប្រាក់</span></a>
					            </li>
					            <li class="" id="cashier-transfer-id"><a href="#tab4-2" class="glyphicons circle_ok" data-toggle="tab"><i></i><span class="strong">ផ្ទេរប្រាក់</span><span>ផ្ទេរប្រាក់</span></a>
					            </li>
					        </ul>
					    </div>
					    <!-- // Tabs Heading END -->

					    <div class="widget-body">
					        <div class="tab-content">
					            <!-- Tab content -->
					            <div class="tab-pane active" id="tab1-2">
					                <div class="row">
										<div class="span12">
											<div class="row-fluid">
												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<div class="widget-stats widget-stats-gray widget-stats-4"> 
															<span class="txt">Invoice paid</span>
															<span class="count" data-bind="text: vendors.tInvToday"></span>
															<span class="glyphicons user"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i> 
														</div>
													</div>
												</div>

												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<div class="widget-stats widget-stats-primary widget-stats-4">
															<span class="txt">បង់ប្រាក់ប្រចាំថ្ងៃ</span>
															<span class="count"><span data-bind="text: vendors.tAmtToday" style="font-size: 35px;">0៛</span></span>
															<span class="glyphicons coins"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i>
														</div>
													</div>
												</div>

												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a href="#/vendor_payment_report" class="widget-stats widget-stats-inverse widget-stats-4">
															<span class="txt">របាយការណ៍បង់ប្រាក់</span>
															<span class="glyphicons refresh"><i></i></span>
															<div class="clearfix"></div>
														</a>
													</div>
												</div>				
											</div>
										</div>
									</div>
									<div class="row">
										<div class="span12">
											<div id="exampleValidate" data-role="validator">
											 <!-- //End row-fluid -->
											<table class="table table-bordered table-striped innerL" data-bind="visible: show">
										        <thead>
										            <tr>
										                <th>បង់</th>
										                <th>Date</th>						                
										                <th>ឈ្មោះ</th>
										                <th>វិក្កយបត្រ</th>
										                <th>ទឹកប្រាក់</th>
										                <th class="right">បង់បាន</th>
										                <th class="right" width="110bb">ទទួលប្រាក់</th>							                
										            </tr>
										        </thead>
										        <tbody data-role="listview" data-auto-bind="false" 
										        	   data-template="payment-vednor-row-template" 
										        	   data-bind="source: vendors.tmp" 
										        	   class="k-widget k-listview"></tbody>						        
										    </table>
										</div>
										<div id="status"></div>
										<div class="innerL" data-bind="visible: show">
											<div class="span7">						
												<table>
													<tbody>
														<tr>
															<td style="width: 100px;">Date Receipt</td>
										              		<td>
										              			<input id="paymentDate" name="paymentDate" data-role="datepicker" data-bind="value: vendors.paymentDate" data-format="dd-MM-yyyy" required="" data-required-msg="Require Date" type="text" class="k-input">
															</td>
															<td>Total Amount:</td>
															<td align="right"><input type="text" data-bind="value: vendors.total" class="k-input k-textbox" style="width: 160px;" /></td>
														</tr>
											            </tr><tr>
															<td>Cash Account</td>
															<td>
																<input id="cashAccount" 
																	data-bind="source: vendors.cashAccount, value: vendors.account"  
																	data-required-msg="Require Cash Account" 
																	data-role="dropdownlist"
																	data-text-field="name",
																	data-value-field="id"
																	data-option-label="---រើសមួយ---"
																	style="display: none;">											
															</td>
															<td>សក្ខីប័ត្រចំណាយ:</td>
															<td align="right"><input type="text" data-bind="value: vendors.voucher" class="k-input k-textbox" style="width: 160px;" /></td>
														</tr>
														<tr>
															<td valign="top">ចំណាត់ថ្នាក់</td>
															<td valign="top"><select data-role="multiselect" 
														   		data-bind="source: vendors.classDS, value: segment, events: {change: vendors.changeValue}" 
														   		data-value-field="id" 
														   		data-text-field="name"
														   		data-placeholder="---រើសមួយ---"
														   		style="width: 160px" /></select>
														    </td>
															<td valign="top">ចំណាំ</td>
															<td colspan='3'>
																<textarea style="width: 150px;" name="" id="" cols="30" rows="5" data-bind="value: vendors.memo"></textarea>
															</td>
														</tr>										
													</tbody>
												</table>							
											</div>																			
											<div class="span4 pull-right">
												<div class="innerAll padding-bottom-none-phone" data-bind="click: vendors.makePayment">
													<a id="save" name="save" class="widget-stats widget-stats-info widget-stats-4">
														<span class="txt">ទឹកប្រាក់ទទួលបាន</span>
														<span class="count" style="font-size: 35px;" data-bind="text: vendors.total">៛</span>
														<span class="glyphicons cart_in"><i></i></span>
														<div class="clearfix"></div>
														<i class="icon-play-circle"></i>
													</a>
												</div>							
											</div>
										</div>
									</div>
									</div>
					            </div>
					            <!-- // Tab content END -->

					            <!-- Tab content -->
					            <div class="tab-pane" id="tab2-2">
					                <div class="row-fluid">
										<div id="saveCashierCustomerValidate" class="span12">
											<div class="row-fluid">
												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a href="javascript:void(0)" class="widget-stats widget-stats-gray widget-stats-4"> 
															<span class="txt">អតិថិជន</span>
															<span class="count" data-bind="text: vendors.total_customer"></span>
															<span class="glyphicons user"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i> 
														</a>
													</div>
												</div>
												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a href="#/wPayment_summary" class="widget-stats widget-stats-primary widget-stats-4">
															<span class="txt">បង់ប្រាក់ប្រចាំថ្ងៃ</span>
															<span class="count"><span data-bind="text: vendors.total_payment" style="font-size: 35px;"></span></span>
															<span class="glyphicons coins"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i>
														</a>
													</div>
												</div>
												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a href="#/reconcile" class="widget-stats widget-stats-inverse widget-stats-5">
															<span class="glyphicons refresh"><i></i></span>
															<span class="txt">ផ្ទៀងផ្ទាត់ &<br><br> ផ្ទេរសាច់ប្រាក់</span>
															<div class="clearfix"></div>
														</a>
													</div>
												</div>				
											</div> <!-- //End row-fluid -->
											<br>
											<table class="table table-bordered table-striped table-white">
										        <thead>
										            <tr>
										                <th></th>
										                <th>ល.រ</th>						                
										                <th>Date</th>
										                <th>ឈ្មោះ</th>
										                <th>វិក្កយបត្រ</th>
										                <th class="right">ទឹកប្រាក់</th>
										                <th class="right">ទទួលប្រាក់</th>							                
										            </tr>
										        </thead>
										        <tbody data-role="listview"
										        		data-auto-bind="false"					        		 
										        		data-template="cashier-row-dawine-template" 
										        		data-bind="source: customers.invoiceList"></tbody>
										        <tfoot data-template="cashier-footer-dawine-template" 
										        		data-bind="source: this"></tfoot>						        
										    </table>						    

											<br>
											
											<span id="notification"></span>

											<div class="row-fluid">
												<div class="span4">						
													<table>
														<tr>
															<td>Date</td>
										              		<td>
										              			<input id="txtPaymentDate" name="txtPaymentDate" 
										              				data-role="datepicker" 
										              				data-format="dd-MM-yyyy"
										              				data-parse-formats="dd-MM-yyyy"
											              			data-bind="value: customers.payment_date" 
											              			required data-required-msg="Require Date" />
															</td>
														</tr>										
														<tr>
										                    <td>វីធីបង់ប្រាក់</td>
										                  	<td>
										                  		<input id="ddlPaymentMethod" id="ddlPaymentMethod"
										                  			   data-role="dropdownlist"
													                   data-auto-bind="false"
													                   data-value-primitive="true"
													                   data-text-field="name"
													                   data-value-field="id"
													                   data-bind="value: customers.payment_method_id,
													                              source: customers.paymentMethodDS"									                   
													                   required data-required-msg="Require វីធីបង់ប្រាក់" />						                  					                  		
										                  	</td>
										                <tr>
														<tr>
											                <td>លេខកូដសែក</td>
											                <td><input id="check_no" class="k-textbox" data-bind="value: customers.check_no" style="width: 161px;" /></td>
											            <tr>
											            <tr>
															<td>Cash Account</td>
															<td>
																<input id="ddlCashAccount" name="ddlCashAccount" 
																		data-bind="value: customers.account_id" 
																		required data-required-msg="Require Cash Account" />												
															</td>
														</tr>										
													</table>							
												</div>																
												<div class="span4">
													<table>	
														<tr>
															<td>ទទួលប្រាក់សរុប:</td>
															<td align="right"><span data-bind="text: customers.pay_amount"></span></td>
														</tr>									
														<tr>
															<td>បញ្ចុះតំលៃ:</td>
															<td>
																<input data-role="numerictextbox" 
																		data-format="c0" data-culture="km-KH" 
																		data-bind="value: customers.discount, events: {change : customers.change}" />
															</td>
														</tr>
														<tr>
															<td>ទឹកប្រាក់ពិន័យ:</td>							
															<td>
																<input data-role="numerictextbox" 
																		data-format="c0" data-culture="km-KH" 
																		data-bind="value: customers.fine, events: {change : customers.change}" />
															</td>
														</tr>										
														<tr>
															<td>នៅខ្វះ</td>
															<td align="right"><span data-bind="text: customers.remain"></span></td>
														</tr>
													</table>		          	
												</div>

												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a id="saveCashierCustomer" name="save" class="widget-stats widget-stats-info widget-stats-4">
															<span class="txt">ទឹកប្រាក់ទទួលបាន</span>
															<span class="count" style="font-size: 35px;" data-bind="text: customers.receive_amount"></span>
															<span class="glyphicons cart_in"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i>
														</a>
													</div>								
												</div>
											</div>
										</div>
							        </div>
						        </div>
					            <!-- // Tab content END -->

					            <!-- Tab content -->
					            <div class="tab-pane" id="tab3-2">
					            	<div class="row-fluid">
					            		<div class="span6">
					            			<label for="voucher">លេខសក្ខីបត្រ័</label>
											<input type="text" style="width: 95%" data-bind="value: deposit.current.voucher" />
											<label for="from">ដាក់ទៅ</label>
											<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source: deposit.accounts, value: deposit.from.account" data-value-field="id" data-text-field="name" />
											<label for="description"​ style="margin-top: 10px">Description</label>
											<textarea style="width: 95%" name="" id="" cols="30" rows="3" data-bind="value: deposit.current.memo"></textarea>
											<button data-bind="click: deposit.save" class="btn btn-default btn-block">រក្សាទុក</button>
					            		</div>
					            		<div class="span6">
										<i class="icon-plus" data-bind="click: deposit.addEntry"></i>
										<ul style="list-style: none; padding: 5px; margin: 3px 0; width: 95%" class="striped" data-role="listview" data-bind="source: deposit.entries" data-template="entry-list"></ul>
					            		</div>
					            	</div>
					            </div>
					            <!-- // Tab content END -->

					            <!-- Tab content -->
					            <div class="tab-pane" id="tab4-2">
					            	<div class="row-fluid">
					            		<div class="span6">
					            			<label for="voucher">លេខសក្ខីបត្រ័</label>
											<input type="text" style="width: 95%" data-bind="value: transfer.current.voucher" />
											<label for="from">ពីគណនី</label>
											<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source:  transfer.accounts, value:  transfer.from.account" data-value-field="id" data-text-field="name" />
											<label for="description"​ style="margin-top: 10px">Description</label>
											<textarea style="width: 95%" name="" id="" cols="30" rows="3" data-bind="value:  transfer.current.memo"></textarea>
											<button data-bind="click: transfer.save" class="btn btn-default btn-block">រក្សាទុក</button>
					            		</div>
					            		<div class="span6">
											<i class="icon-plus" data-bind="click: transfer.addEntry"></i>
											<ul style="list-style: none; padding: 5px; margin: 0; width: 96%" class="stripe"data-role="listview" data-bind="source:  transfer.entries" data-template="entry-transfer-list"></ul>
					            		</div>
					            	</div>
					            </div>
						        <!-- // Tab content END -->
						    </div>
					    </div>
					</div>
				</div>					
			</div>	
		</div>
	</div>
</script>
<script id="cashier-transaction-row-dash-template" type="text/x-kendo-tmpl">
    <tr>        
        <td>#:kendo.toString(new Date(issued_date), "dd-MM-yy")#</td>
        <td>#:type# </td>
        <td align="right">#:kendo.toString(kendo.parseFloat(amount), "c", locale)#</td>        
   	</tr>
</script>
<script id="cashier-row-dawine-template" type="text/x-kendo-tmpl">		
	<tr id="rowGrid-#:id#">
		<td>
			<input type="checkbox" data-bind="checked: isPay, events:{change: checkPay}">			
		</td>
		<td class="sno">1</td>			
		<td>#:kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>		
		<td>#=fullname#</td>
		<td>#:number#</td>				
		<td class="right">#:kendo.toString(amount, "c", locale)#</td>
		<td class="right">
			<input data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: pay_amount, events: {change : change}" 
					style="width: 120px;">
			<i class="icon-trash" data-bind="events: { click: remove "></i>						
		</td>				
    </tr>   
</script>
<script id="cashier-footer-dawine-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="7" style="font-size:30px;">
            ប្រាក់ត្រូវបង់សរុប: #:customers.receive_amount#
        </td>
    </tr>
</script>
<script type="text/x-kendo-template" id="cashier-people-list-tmpl">
	<tr data-bind="click: onSelected">
	#if(company !== "") {#
		<td>#=company#</td>
	#} else {#
		<td>#=name#</td>
	#}#
	</tr>
</script>
<script type="text/x-kendo-template" id="cashier-deposit-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span4 offset4">
				<div class="widget">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
						<h4 class="heading glyphicons circle_info"><i></i> <a id="title">Deposit</a></h4>
					</div>
					<div class="widget-body">
						<label for="voucher">Voucher</label>
						<input type="text" style="width: 95%" data-bind="value: current.voucher" />
						<i class="icon-plus" data-bind="click: addEntry"></i>
						<ul style="list-style: none; padding: 5px; margin: 0; width: 95%" class="stripe"data-role="listview" data-bind="source: entries" data-template="entry-list"></ul>
						<label for="from">To</label>
						<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source: accounts, value: from.account" data-value-field="id" data-text-field="name" />
						<label for="description"​ style="margin-top: 10px">Description</label>
						<textarea style="width: 95%" name="" id="" cols="30" rows="3" data-bind="value: current.memo"></textarea>
						<button data-bind="click: save" class="btn-default btn-block">Save</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="entry-list">
	<li>
	<div class="pull-right">
		<i class="icon-plus" data-bind="click: deposit.addEntry"></i><br/>
		<i class="icon-minus" data-bind="click: deposit.removeEntry"></i>
	</div>
	<label for="account">From</label>
	<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source: accounts, value: account" data-text-field="name" data-value-field="id" />
	<label for="amount">Amount</label>
	<input type="text" data-bind="value: amount" />
	<label for="check">Cheque</label>
	<input type="text" data-bind="value: check" />
	<label for="description">Description</label>
	<input type="text" data-bind="value: memo" />
	<label for="segment">Segment</label>
	<select data-role="multiselect" style="width: 220px" 
		   data-bind="source: deposit.segments, value: segment, events: {change: deposit.changeValue}" 
		   data-value-field="id" 
		   data-text-field="name"
		   data-placeholder="select"
		   data-item-template="class-list-tmpl"
		   data-auto-bind=false
		   style="width: 220px" /></select>
	</li>
</script>
<script type="text/x-kendo-template" id="cashier-transfer-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span4 offset4">
				<div class="widget">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
						<h4 class="heading glyphicons circle_info"><i></i> <a id="title">Transfer</a></h4>
					</div>
					<div class="widget-body">
						<label for="voucher">Voucher</label>
						<input type="text" style="width: 95%" data-bind="value: current.voucher" />
						<label for="from">From</label>
						<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source: accounts, value: from.account" data-value-field="id" data-text-field="name" />
						<label for="description"​ style="margin-top: 10px">Description</label>
						<textarea style="width: 95%" name="" id="" cols="30" rows="3" data-bind="value: current.memo"></textarea>
						<i class="icon-plus" data-bind="click: addEntry"></i>
						<ul style="list-style: none; padding: 5px; margin: 0; width: 96%" class="stripe"data-role="listview" data-bind="source: entries" data-template="entry-transfer-list"></ul>
						<button data-bind="click: save" class="btn-default btn-block">Save</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="entry-transfer-list">
	<li>
	<div class="pull-right">
		<i class="icon-plus" data-bind="click:  transfer.addEntry"></i><br/>
		<i class="icon-minus" data-bind="click:  transfer.removeEntry"></i>
	</div>
	<label for="account">To</label>
	<input type="text" style="width: 220px" data-role="dropdownlist" data-bind="source:  transfer.accounts, value: account" data-text-field="name" data-value-field="id" />
	<label for="amount">Amount</label>
	<input type="text" data-bind="value: amount" />
	<label for="check">Cheque</label>
	<input type="text" data-bind="value: check" />
	<label for="description">Description</label>
	<input type="text" data-bind="value: memo" />
	<label for="segment">Segment</label>
	<select data-role="multiselect" style="width: 220px" 
		   data-bind="source:  transfer.segments, value: segment, events: {change:  transfer.changeValue}" 
		   data-value-field="id" 
		   data-text-field="name"
		   data-placeholder="select"
		   data-item-template="class-list-tmpl"
		   data-auto-bind=false
		   style="width: 220px" /></select>
	</li>
</script>
<script type="text/x-kendo-template" id="accounting-page-template">
	<div class="container-960">
		<div class="row">
			<div class="span10 offset1">
				<div class="widget">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
						<h3 class="heading">គណនី</h3>
					</div>
					<div class="widget-body" id="account-new-form">
						<table class="table">
							<tbody>
								<tr>
									<td>Type</td>
									<td><input type="text" data-role="combobox" class="span4"
										   data-bind="source: types, value: accounting.current.type, events: {change: onTypeChange}" 
										   data-text-field="name"
										   data-placeholder="--- Select One ---"
										   name="cbAccountType" 
										   data-value-field="id" style="width: 220px;"
										   required data-required-msg="Require" /><br/>
										   <span class="k-invalid-msg" data-for="cbAccountType"></span>
										   </td>
									<td width="130">Parent Account</td>
									<td><input type="text" data-role="combobox" class="span4"
									       data-bind="source: coa, value: accounting.current.parentAccount" 
									       data-template="accounting-coa-template"
									       data-text-field="name" 
									       data-value-field="id" style="width: 220px;" /></td>
								</tr>
								<tr>
									<td>Account Name</td>
									<td><input type="text" data-bind="value: accounting.current.name" placeholder="Account" style="width: 220px;" /></td>
									<td>Code</td>
									<td><input type="text" data-bind="value: accounting.current.code" placeholder="Code" style="width: 207px;" /></td>
								</tr>
								<tr>
									<td>Account Name (En)</td>
									<td><input type="text" data-bind="value: accounting.current.name_en" placeholder="Account Name" style="width: 220px;" /></td>
									<td>Description</td>
									<td><input type="text" data-bind="value: accounting.current.description" placeholder="Description" /></td>
								</tr>
								<tr>
									<td colspan="4">
										For Tax Desclearaton <input type="checkbox" name="" id=""/>
									</td>
								</tr>
							</tbody>
						</table>
						<table class='table well' data-bind="visible: showCash">
							<tbody>
								<tr>
									<td width="130">Bank</td>
									<td><input style="width: 220px;" type="text" data-role="combobox" /></td>
									<td>Bank Account Number</td>
									<td><input type="text"/></td>
								</tr>
								<tr>
									<td>Currency</td>
									<td><input style="width: 220px;" type="text" data-role="combobox" /></td>
									<td></td>
									<td></td>
								</tr>
							</tbody>
						</table>
						<div style="text-align: right">
							<button class="btn btn-primary" style="width: 220px;" data-bind="click: save">Save and Continue</button>
							<button class="btn btn-success" style="width: 220px;" data-bind="click: saveClose">Save and Close</button>
							<button class="btn btn-danger" style="width: 220px;" data-bind="click: close">Cancel</button>
						</div>							
					</div>
				</div>	
			</div>
		</div>
	</div>			
</script>
<script type="text/x-kendo-template" id="accounting-coa-template">
	#=code# - #=name#
</script>
<script type="text/x-kendo-template" id="grn-form-template">
	<div class="container-960">
		<div class="row">
			<div class="span12">
				<div class="widget">
					<div class="ribbon-wrapper" style="z-index: 999999;"><div class="ribbon default"><span data-bind="text: ribbon"></span></div></div>
					<div class="widget-head">	
						<h4 class="heading glyphicons notes"><i></i> Good Received Note</h4>
					</div>
					<div class="widget-body">
						<div class="row">
							<div class="well span12" style="margin-left: 7px;">
								<table>
									<tr>
										<td width="150">Select PO</td>
										<td><input type="text" style="width: 220px;"
															   data-role="combobox" 
															   data-bind="source: poDS, 
															   			  value: current.invoice_number, 
															   			  events:{change: selectedPO},
															   			  disabled: disablePO" 
															   data-text-field="invoice_number" 
															   data-value-field="id"
															   data-min-length="4"
															   data-filter="startswith" /></td>
										<td width="200"></td>
										<td width="150">Segment</td>
										<td><select data-role="multiselect" 
										   data-bind="source: classDS, value: current.segment, events: {change: changeValue}" 
										   data-value-field="id" 
										   data-text-field="name"
										   data-placeholder="select"
										   style="width: 220px" /></select></td>
									</tr>
									<tr>
										<td width="150">Vendor</td>
										<td><input type="text" data-bind="value: current.vendor.company" /></td>
										<td width="200"></td>
										<td width="150">Date</td>
										<td><input type="text" style="width: 220px;"
															   data-role="datepicker" 
															   data-bind="value: current.due_date" /></td>
									</tr>
									<tr>
										<td width="150">Voucher</td>
										<td><input type="text" data-bind="value: current.voucher" /></td>
										<td width="200"></td>
										<td width="150"></td>
										<td></td>
									</tr>
								</table>
								<table class="table">
									<thead>
										<tr style="background-color: #000; color: #fff">
											<th width="25" style="text-align:center;"><i data-bind="click: addItem" class="icon-plus"></i></th>
											<th>Item</th>
											<th>Description</th>
											<th width="150">PO</th>
											<th width="150">Amount Received</th>
											<th>នៅសល់</th>
										</tr>
									</thead>
									<tbody data-role="listview" data-bind="source: itemDS" 
										   data-template="grn-item-list-template"
										   data-auto-bind=false></tbody>
									<tfoot>
										<tr>
											<td colspan="3" style="text-align:right;">Total</td>
											<td><span data-bind="text: totalQty"></span></td>
										</tr>
									</tfoot>
								</table>
								<div class="span12" style="text-align: center; padding-bottom: 10px;">
									<span class="btn btn-icon btn-primary glyphicons circle_ok"  data-bind="click: save"><i></i>Save</span>
									<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: close">Cancel</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="grn-item-list-template">
	<tr>
		<td>
			<i data-bind="click: addItem" class="icon-plus"></i>
			<i data-bind="click: removeItem" class="icon-minus"></i>
		</td>
		<td width="250"><input type="text" style="width: 250px;" data-role="dropdownlist" data-bind="source: items, value: item" data-text-field="name" data-value-field="id" /></td>
		<td><input type="text" data-bind="value: item.description" /></td>
		<td><span data-bind="text: unit"></span></td>
		<td><input type="text" style="width: 100px;" data-bind="value: unitReceipt, events: {change: total, blur: lineTotal}" /></td>
		<td><span data-bind="text: balance"></span></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="test-template">
	<div class="widget">
		<div class="widget-head">
			<span class="btn btn-primary pull-right" data-bind="click: close">X</span>
			<h4 style="text-align: center">Purchase Order</h4>
		</div>
		<div class="widget-body">
			<div
				data-role="grid"
				data-bind="source: billVM.ds"
				data-columns="['id', 'vendor', '&nbsp;', '&nbsp;']"
				data-row-template="po-list-center-template"
				data-auto-bind=false
				data-height="400px"
			></div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="po-list-center-template">
	<tr>
		<td>#=id#</td>
		<td>#=vendor.company#</td>
		<td>
			#if(status !== 'partial' || status == 'open') {#
				<a href="\#/grn/#:id#/po"><button class="btn btn-primary"><i class="icon-check-empty"></i> GRN</button></a>
			#} else {#
				<button class="btn btn-default"><i class="icon-check"></i> GRN</button>
			#}#
		</td>
		<td>
			#if(status === 'partial' || status == 'open') {#
				<a href="\#/purchase/#:id#/po"><button class="btn btn-primary"><i class="icon-check-empty"></i> Bill</button></a>
			#} else {#
				<button class="btn btn-default"><i class="icon-check"></i> Bill</button>
			#}#
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="purchase-return-template">
	<div class="container-960">
		<div class="row">
			<div class="span12">
				<div class="widget">
					<div class="widget-head">
						<button class="pull-right btn btn-primary">X</button>
						<h3 style="margin-left: 15px; font-size: 14pt">Purchase Return</h3>
					</div>
					<div class="widget-body">
						<div class="row">
							<div class="span6 offset4">
								លេខវិក្កយប័ត្រ <div class="input-append">
								  <input class="span12" data-bind="value: keyword" type="text">
								  <button class="btn" type="button" data-bind="click: search"><i class="icon-search"></i></button>
								</div>
							</div>
						</div>
						<div class="row" style="padding: 5px;" data-bind="visible: hasData">
							<div class="span12">
								<div class="well">
									<table class="table table-white">
										<tbody>
											<tr>
												<td width="150">Vendor</td>
												<td wdith="230"><span data-bind="text: current.vendor.company"></span></td>
												<td width="150">Bill Number</td>
												<td wdith="230"><span data-bind="text: current.invoice_number"></span></td>
											</tr>
											<tr>
												<td>Voucher</td>
												<td><span data-bind="text: current.voucher"></span></td>
												<td>Segment</td>
												<td><select data-role="multiselect" 
												   data-bind="source: classDS, value: current.segment" 
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="select" /></select>
											   </td>
											</tr>
											<tr>
												<td colspan="4" style="text-align: center"><span data-bind="text: status"></span></td>
											</tr>
											
										</tbody>
									</table>
								</div>
								<div style="width: 100%; text-align:center;">
									<input type="text" data-role="dropdownlist" data-bind="source: accounts, value: cashAC, visible: useCash" data-text-field="name" data-value-field="id" />
								</div><br/>
								<table class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Item</th>
											<th>Description</th>
											<th>Unit</th>
											<th>Price</th>
											<th>Amount</th>
											<th>Return</th>
											<th>Tax</th>
										</tr>
									</thead>
									<tbody data-role="listview" 
										   data-bind="source: prData" 
										   data-template="purchase-return-list-template"
										   data-auto-bind=false></tbody>
									<tfoot>
										<tr>
											<td colspan="7" style="text-align:center">
												<button class="btn" style="width: 100px;" data-bind="invisible: isOpen, click: refund">Refund</button>
												<button class="btn" style="width: 100px;" data-bind="invisible: isOpen, click: offset">Offset</button>
												<button class="btn" style="width: 100px;" data-bind="visible: isOpen, click: save">Return</button>
											</td>
										</tr>
									</tfoot>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="purchase-return-list-template">
	<tr>
		<td>#=item.name#</td>
		<td>#=item.description#</td>
		<td>#=unit#</td>
		<td>#=cost#</td>
		<td>#=total#</td>
		<td><input type="text" data-bind="value: back, events: {change: check}" /></td>
		<td>
			#if(isTaxed === true) {#
				<i class="icon-check"></i>
			#} else {#
				<i class="icon-check-empty"></i>
			# } #
		</td>
	</tr>
</script>
<!-- Accounting Section Ends -->
<script type="text/x-kendo-template" id="accounting-menu-tmpl">
	<li>
		<a href='#/accounting_dashboard' class="glyphicons home"><i></i></a>
	</li>
	<li><a href="#/accounts">Chart of Accounts</a></li>
	<li class="dropdown">
		<a href="#" class="dropdown-toggle" data-toggle="dropdown">កត់ត្រាប្រតិបត្តិការ <i class="caret"></i></a>
		<ul class="dropdown-menu" id="dropdownMenu">
			<li id="home-menu"><a href="#/accounts/u/gl">General Leger</a></li>
			<li id="customer-menu"><a href="#/customers">ទាញទិន្នានុប្បវត្តិ</a></li>
			<li id="vendor-menu"><a href="#/bills/expense/new">Expense</a></li>
			<li id="account-menu"><a href="#/bills/purchase/new">Purchase</a></li>
			<li id="water-menu"><a href="#/cashier/receipt">Receipt</a></li>
			<li id="electricity-menu"><a href="#/invoice">Invoice</a></li>
			<li id="water-menu"><a href="#/payment/vendor">Payment</a></li>
			<li id="water-menu"><a href="#/cashiers">Cash Receipt</a></li>
    	</ul>
	</li>
	<li><a href="#/currencies">Exchange Rate</a></li>
	<li>
		<a href="#" class="dropdown-toggle" data-toggle="dropdown">Accounting Report <i class="caret"></i></a>
		<ul class="dropdown-menu" id="dropdownMenu">
			<li id="home-menu"><a href="#/trial_balance">Trial Balance</a></li>
			<li id="customer-menu"><a href="#/journalReport">Journal</a></li>
			<li id="vendor-menu"><a href="#/glReport">General Ledger</a></li>
    	</ul>
	</li>
	<li>
		<a href='#/accounting_setting' class='glyphicons settings'><i></i></a>
	</li>
</script>
<script type="text/x-kendo-template" id="accounting-dashboard-tmpl">
	<div class="widget widget-heading-simple widget-body-white widget-employees">				
		<div class="widget-body padding-none">	
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" style="height: 700px;">
					<div class="innerAll">
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" id="search" data-bind="click: find"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" data-bind="value: accountKeyId" placeholder="Search" id="searchField">
								</div>
							</div>
						</form>
					</div>
					<span class="results" data-bind="text: accounts.dataStore.total"></span>
					<div class="table table-condensed" id="sidebar" style="height: 580px;"
						 data-role="grid" data-bind="source: accounts.dataStore" 
						 data-row-template="accountChartTmpl"
						 data-columns="[{title: 'Account'}]"
						 data-selectable=true
						 data-height="600"
						 data-pageable="true"
						 data-scrollable="{virtual: true}"></div>
				</div>
				<div class="span9 innerAll">
					<div id="vendorDashboard" class="row" style="margin-left: 5px;">
						<div class="row-fluid">
							<div class="span5">
								<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">
							    	<!-- Widget Heading -->
							    	<div class="widget-head">				
								        <!-- Tabs -->
								        <ul class="pull-right">
								            <li class="glyphicons circle_info active"><span data-toggle="tab" data-target="#tab1-5"><i></i></span>
								            </li>
								            <li class="glyphicons circle_plus"><a href="#/accounts/u/new"><i></i></a>
			            					</li>
								        </ul>
								        <div class="clearfix"></div>
								        <!-- // Tabs END -->
									</div>
		    						<!-- Widget Heading END -->

								    <div class="widget-body">
								        <div class="tab-content">
								            <!-- Tab content -->
								            <div id="tab1-5" class="tab-pane active box-generic">
								            	<div class="row-fluid">
								            		<div class="span10">
								            			លេខកូដគណនី៖ <span class="strong" data-bind="text: current.code"></span><br/>
										            	ឈ្មោះគណនី៖ <span class="strong" data-bind="text: current.name"></span><br/>
										            	គណនីមេ៖ <span class="strong" data-bind="text: current.parentAccount.name"></span><br/>
										            	ប្រភេទគណនី៖ <span class="strong" data-bind="text: current.type.name"></span><br/>
										            	រូបបិយវត្ថុគណនី៖ <span class="strong" data-bind="text: current.type.name"></span><br/>
										            	ពីពណ៍នា៖ <span class="strong" data-bind="text: current.description"></span>
								            		</div>
								            		<div class="span2" style="margin-bottom: -30px;">
									            		<span class="btn btn-default btn-block" data-bind="click: edit"><i class="icon-pencil"></i></span><br/>
									            		<span class="btn btn-primary btn-block" data-bind="text: current.type.nature"></span>
									            	</div>
								            	</div>
								            </div>
								            <!-- // Tab content END -->

								            <!-- Tab content -->
								            <div id="tab2-5" class="tab-pane box-generic">
								                	<h4>Tab #2 content heading</h4>
								                <p>Donec at nunc dui. Integer eget sem sit amet arcu bibendum elementum vel sit amet risus. Fusce libero lorem, fermentum vitae lacinia dapibus, vestibulum ac enim. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos
								                    himenaeos. Vestibulum accumsan risus sed lorem tincidunt eget faucibus sapien tempor. Proin ac feugiat dolor. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum ante ipsum primis
								                    in faucibus orci luctus et ultrices posuere cubilia Curae.</p>
								            </div>
								            <!-- // Tab content END -->
								        </div>
								    </div>
								</div>

							</div>
							<div class="span7">
								<div class='row-fluid' style='margin-bottom: 8px;'>
									<div class="span12">
										<div class="widget-stats widget-stats-gray widget-stats-2">
											<span class="count" data-bind="text: todayBalance"></span>
											<span class="txt">Balance upto today</span>
										</div>
									</div>
								</div>
								<div class='row-fluid'>
									<div class="span6">
										<div class="widget-stats widget-stats-gray widget-stats-2">
											<span class="count" data-bind="text: recurring.count"></span>
											<span class="txt">Recurring Transaction</span>
										</div>
									</div>
									<div class="span6">
										<div class="widget-stats widget-stats-gray widget-stats-2">
											<span class="count" data-bind="text: transactionOccurred"></span>
											<span class="txt">Transactions</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="separator bottom"></div>
						<div style="text-align: center;">
							<input type="text" data-role="dropdownlist" data-bind="source: dateType, events: {change: dateTypeSelect}" data-index="1" class="dateSelect" />
							<input type="text" data-role="datepicker" data-bind="value: startDate, events: {change: dateChange}"/>
							<input type="text" data-role="datepicker" data-bind="value: endDate" />
							<span data-bind="click: filter" class="k-button" data-role="button"><i class="icon-search"></i></span>
						</div><br/>
						<div class="well">
							<div data-role="grid"
								 data-bind="source: journal.entries"
								 data-columns="[
								 	{title: '&nbsp', width: '25px'},
								 	{title: 'Type'},
									{title: 'Description'},
									{title: 'Segment'},
									{title: 'Dr.'},
									{title: 'Cr.'},
									{title: '', width: '30px'}								 
								 ]"
								 data-height="400px"
								 data-row-template="accounting-dashboard-grid-list-tmpl"></div>
							<div data-role='pager' data-bind="source: journal.entries"></div>
						</div>							
					</div>					
				</div>
			</div>	
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="accounting-dashboard">
	<div class="innerAll">
		<div class="span4">
			<div class="well">
				<span style="text-align: right">Accounting Standard: Cambodian International Financial Reporting Standards for SMEs</span>
				<div class="separator bottom"></div>
				<button class="btn btn-primary">Khmer Version</button>
				<button class="btn btn-primary" style="font-size: 9.95pt;">English Version</button>
				<div class="separator bottom"></div>
				Reporting Date៖ Janurary 1<subscript>st</subscript> to December 31<subscript>st</subscript><br/>
				Reporting Currency៖ Riel (KHR)
			</div>				
			<div class="separator buttom"></div>
			<div>
				<div id="account-dash-graph"></div>
			</div>
		</div>
		<div class="span4">
			<div style="text-align: center;">
				From &nbsp;
					<input type="text" data-role="datepicker" data-bind="value: dateFrom" style="width: 130px;" />
					<input type="text" data-role="datepicker" data-bind="value: dateTo, events: {change: onDateChange}" style="width: 130px;" />
					<button data-role="button" data-bind="click: searchByDate"><i class="icon-search"></i></button>
			</div>
			<div class="separator buttom"></div>
			<h2 style="text-align: center;">Statement of Financial Position</h2>
			<div style="text-align: center;">Frome &nbsp;<span data-bind="text: dateTo" data-format="dd-MM-yyyy"></span></div>
			<div class="separator buttom"></div>
			<div class="widget widget-body-white">
				<div class="widge-body">
					<table class="table table-borderless table-condensed table-striped">
						<thead>
							<tr>
								<th>ASSETS</th>
								<th></th>
							</tr>
						</thead>
						<tbody data-role="listview" data-bind="source: balanceSheet.assetDS" data-auto-bind=false data-template="accounting-balance-sheet-list-tmpl"></tbody>
						<tfoot>
							<tr>
								<td>Total AssetS</td>
								<td style="text-align: right"><span data-bind="text: balanceSheet.totalAsset"></span></td>
							</tr>
						</tfoot>
					</table>
					<hr/>
					<table class="table table-borderless table-condensed table-striped">
						<thead>
							<tr>
								<th>LIABILITIES AND EQUITY </th>
								<th></th>
							</tr>
						</thead>
						<tbody data-role="listview" data-bind="source: balanceSheet.liabilityDS" data-auto-bind=false data-template="accounting-balance-sheet-list-tmpl"></tbody>
						<tfoot>
							<tr>
								<td>Total Liabilities and Equity</td>
								<td style="text-align: right"><span data-bind="text: balanceSheet.totalLiabEq"></span></td>
							</tr>
						</tfoot>
					</table>
				</div>
			</div>
		</div>
		<div class="span4">
			<div class="row-fluid">
				<div class="span6">
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count" data-bind="text: transactionOccurred"></span>
						<span class="txt">No. of Transactions</span>
					</a>
				</div>
				<div class="span6">
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count" data-bind="text: recurring.count"></span>
						<span class="txt">Recurring Transactions</span>
					</a>
				</div>
			</div>
			<br/>
			<div class="row-fluid">
				<div class="span6">
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count" data-bind="text: balanceSheet.getXRatio"></span>
						<span class="txt">Current Ratio</span>
					</a>
				</div>
				<div class="span6">
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count" data-bind="text: balanceSheet.getQRatio"></span>
						<span class="txt">Quick Ratio</span>
					</a>
				</div>
			</div>
			<table class="table">
				<tbody>
					<tr>
						<td width="280">Return on Capital Employed</td>
						<td style='text-align: right;'><span data-bind="text: getROCE"></span> %</td>
					</tr>
					<tr>
						<td>Gross Profit Margin</td>
						<td style='text-align: right;'><span data-bind="text: getGPM"></span> %</td>
					</tr>
					<tr>
						<td>Net Profit Margin</td>
						<td style='text-align: right;'><span data-bind="text: getNPM"></span> %</td>
					</tr>
					<tr>
						<td>Asset Turnover</td>
						<td style='text-align: right;'><span data-bind="text: getAssetTurnOver"></span> %</td>
					</tr>
					<tr>
						<td>
							Account Receivable Collection Period
						</td>
						<td style='text-align: right;'><span data-bind="text: getARCP"></span> Day(s)</td>
					</tr>
					<tr>
						<td>Inventory Turnover</td>
						<td style='text-align: right;'><span data-bind="text: getInventoryTurnOver"></span>Day(s)</td>
					</tr>
					<tr>
						<td></td>
						<td style='text-align: right;'><span data-bind="text: getNumberSeven"></span> Day(s)</td>
					</tr>
				</tbody>
			</table>				
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="accounting-balance-sheet-list-tmpl">
	<tr>
		<td>#=type#</td>
		# var amount = 0.00 #
		# if(accounts.length > 0) {#
			# for(var i = 0; i < accounts.length; i++) {#
				# amount += kendo.parseFloat(accounts[i].amount); #
			#}#			
		#}#
		<td style="text-align: right">#=amount#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="accounting-trialBalance-tmpl">
	<div class="container-960">
		<div class="span12">
			<button class="btn btn-primary pull-right" data-bind="click: back">X</button>
			From &nbsp;
				<input type="text" data-role="datepicker" data-bind="value: dateTo" style="width: 200px;" />
				<button data-role="button" data-bind="click: searchDate"><i class="icon-search"></i></button>
			<div class="separator buttom"></div>
			<h3 style="text-align: center">Trial Balance</h3>
			<table class="table table-primary table-borderless table-striped table-condensed table-pricing-2">
				<thead>
					<tr>
						<th style="text-align: center">Code</th>
						<th style="text-align: center">Account</th>
						<th style="text-align: center">Dr</th>
						<th style="text-align: center">Cr</th>
					</tr>
				</thead>
				<tbody data-role="listview" data-bind="source: trialBalance.dataSource" data-template="accounting-trialBalance-list-tmpl"></tbody>
				<tfoot style="background-color: #eeeeee; color: #000000; font-weight: bold">
					<tr>
						<td></td>
						<td></td>
						<td><span data-bind="text: trialBalance.tbDebit"></span></td>
						<td><span data-bind="text: trialBalance.tbCredit"></span></td>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="accounting-trialBalance-list-tmpl">
	<tr>
		<td>#=code#</td>
		<td>#=account#</td>
		<td style="text-align: right">#=dr#</td>
		<td style="text-align: right">#=cr#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="accounting-dashboard-grid-list-tmpl">
 <tr>
 	<td>
 		#if(journal.type==='po') {#
 			<a href="\#/vendors/u/po/#=journal.reference#"><i class="icon-th-list"></i></a>
 		#} else if (journal.type === 'gl') {#
 			<a href="\#/accounts/u/gl/#=journal.id#"><i class="icon-th-list"></i></a>
 		#} else {#
 			<a href="\#/bills/#=journal.type#/#=journal.reference#"><i class="icon-th-list"></i></a>
 		#}#	
 	</td>
 	<td>#=journal.type#</td>
 	<td>#=memo#</td>
 	<td>
 		#for(var i = 0; i < segment.length; i++) {#
 			#=segment[i].code#
 		#}#
 	</td>
 	<td>
 		# if (is_debit === 'true') {# 
 			#=amount#
 		#}#
 	</td>
 	<td># if (is_debit === 'false') {# 
 			#=amount#
 		#}#
 	</td>
 	<td></td>
 </tr>
</script>
<script type="text/x-kendo-template" id="accountChartTmpl">
	<tr data-bind="click: selected">
		<td>
			#if(parentAccount.id !== 0) {#
				&nbsp;&nbsp;&nbsp;&nbsp;
			#} else#
			#=code# - #=name#
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="account-new-tmpl">
	<div class="span10 offset1">
		<table class="table">
			<tr>
				<td>Type of Account:</td>
				<td><input type="text" data-role="dropdownlist" data-bind="source: types, value: current.type" data-text-field="name" data-value-field="id" /></td>
			</tr>
			<tr>
				<td>Parent Account:</td>
				<td><input type="text" data-role="combobox" data-bind="source: ds, value: current.parentAccount"
							           data-text-field="name"
							           data-value-field="id" />
				</td>
			</tr>
			<tr>
				<td>Code:</td>
				<td><input type="text" data-bind="value: current.code" /></td>
			</tr>
			<tr>
				<td>Account Name:</td>
				<td><input type="text" data-bind="value: current.name" /></td>
			</tr>
			<tr>
				<td>Account Name (En):</td>
				<td><input type="text" data-bind="value: current.name_en" /></td>
			</tr>
			<tr>
				<td>Description:</td>
				<td><input type="text" data-bind="value: current.description" /></td>
			</tr>
		</table>
		<div data-role="notification" id="notification" 
			 data-width="250px" 
			 data-position="{top: 25, right: 10}"></div>
		<button class="btn" data-bind="click: save">Save</button>
	</div>
</script>
<script type="text/x-kendo-template" id="parent-account-tmpl">
	<tr>
		<td>#=code# - #=name#</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="journal-account-tmpl">
	<div class="container">
		<div class="row">
			<div class="span12">
				<div class="widget">
					<div class="widget-head">	
						<h4 class="heading glyphicons notes"><i></i> Journal</h4>
						<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
					</div>
					<div class="widget-body">
						<div class="well">
							<span>JV No.</span>
							<input type="text" data-bind="value: current.voucher"
								   data-role="maskedtextbox"
								   data-mask="&&-0000000" />
							<span>Date</span>
							<input type="text" data-role="datepicker" 
								   data-bind="value: current.issuedDate"
								   data-format="dd-MM-yyyy"
								   data-parse-formats="yyyy-MM-dd" />
							Type of Transaction: 
							<input type="text" 
								data-role="dropdownlist" 
								data-bind="source: types, value:current.type"
								data-text-field="name"
								data-value-field="id" />
						</div>
						<div>
							Recurring <input type="checkbox" data-bind="checked: isRecurred, events: {change: createRecurring}" /> &nbsp;
							<span style="width: 400px;">How often does it recurr?</span> 
							<input type="text" data-role="dropdownlist" 
								   data-bind='source: recurringVM.recurringDS, value: recurringVM.current.recurring_number'
								   data-value-field="id"
								   data-text-field="name"
								   style="width: 90px;" />
							When is the next date for recurring? 
							<input type="text" 
								   data-role="datepicker"
								   data-bind="value: recurringVM.current.date"
								   data-format="dd-MM" style="width: 90px;" />
						</div>
						<div class="separator buttom"></div>
						<div class="widget">
							<div class="widget-head">
								<h2 class="heading">Description</h2>
							</div>
							<div class="widget-body">
								<textarea data-bind="value: current.memo" style='width: 100%; height: 50px;'></textarea>
							</div>
						</div>
						<table class="table">
							<thead>
								<tr>
									<th><button class="btn" data-bind="click: addEntry">+</button></th>
									<th>Account</th>
									<th>Description</th>
									<th>Name</th>
									<th>Segment</th>	
									<th>Dr.</th>
									<th>Cr.</th>								
								</tr>
							</thead>
							<tbody data-role="listview" data-bind="source: entries" data-template="journal-entry-account-tmpl">
							</tbody>
							<tfoot>
								<tr>
									<td></td>
									<td><span data-bind="text: debit"></span></td>
									<td><span data-bind="text: credit"></span></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td colspan="6">
										
									</td>
								</tr>
							</tfoot>
						</table>
						<div style="text-align: right">
							<button class="btn btn-primary" style="width: 220px;" data-bind="click: save">Save and Continue</button>
							<button class="btn btn-success" style="width: 220px;" data-bind="click: saveNClose">Save and Close</button>
							<button class="btn btn-danger" style="width: 220px;" data-bind="click: close">Cancel</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="journal-entry-account-tmpl">
	<tr>
		<td><span class="btn"><i class="icon-remove" data-bind="click: removeEntry"></i></span></td>
		<td>
			<input type="text" data-role="dropdownlist" data-bind="source: accountList, value: account" data-auto-bind=false data-text-field="name" data-value-field="id" />
		</td>
		<td><input style="width: 140px;" type="text" data-bind="value: memo" /></td>
		<td><input style="width: 100px;" 
										  type="text" 
										  data-role="combobox" 
										  data-virtual=true 
										  data-bind="source: people.dataSource, value: contact" 
										  data-value-field="id" 
										  data-text-field="name"
										  data-filter="contains"
										  data-min-length=5
										   /></td>
		<td><select style="width: 100px;" data-role="multiselect" style="width: 150px" 
										   data-bind="source: classDS, value: segment, events: {change: changeValue}" 
										   data-value-field="id" 
										   data-text-field="name"
										   data-placeholder="select"
										   data-item-template="class-list-tmpl"
										   data-auto-bind=false
										   style="width: 220px" /></select></td>
		<td><input type="text" style="width: 150px" data-bind="value: debit, events:{change: totalDebit, blur: check}" /></td>
		<td><input type="text" style="width: 150px" data-bind="value: credit, events:{change: totalCredit, blur: check}" /></td>		
	</tr>
</script>
<script type="text/x-kendo-template" id="journal-report-tmpl">
	<h3 data-bind="text: companyInf()[0].legal_name" style="text-align:center"></h3>
	<h4 style="text-align:center">Journal Report</h4><br/>
	<div style="text-align: center;">
		<input type="text" data-role="dropdownlist" data-bind="source: dateType, events: {change: dateTypeSelect}" data-index="1" class="dateSelect" />
		<input type="text" data-role="datepicker" data-bind="value: startDate, events: {change: dateChange}"/>
		<input type="text" data-role="datepicker" data-bind="value: endDate" />
		<span data-bind="click: filter" class="k-button" data-role="button"><i class="icon-search"></i></span>
	</div><br/>
	<table class='table table-striped table-white'>
		<thead style="background-color: #00bbff; color: #ffffff">
			<tr>
				<th>#</th>
				<th>Type</th>
				<th>Date</th>
				<th>Num</th>
				<th>Name</th>
				<th>Memo</th>
				<th>Segment</th>
				<th>Account</th>
				<th>Dr</th>
				<th>Cr</th>
			</tr>
		</thead>
		<tbody
			data-role="listview" 
			data-bind="source: journal" 
			data-template="journal-report-list-tmpl"
			data-auto-bind="false"
		></tbody>
		<tfoot>
			<tr>
				<td colspan="8"></td>
				<td style="text-align: right; font-weight: bold; border-bottom: 5px double #000000; width; 190px; padding: 5px;">
					<span data-bind="text: jDebit" style="font-size: 14px; color: #dd1919"></span>
				</td>
				<td style="text-align: right; font-weight: bold; border-bottom: 5px double #000000; width; 190px; padding: 5px;">
					<span data-bind="text: jCredit" style="font-size: 14px; color: #dd1919"></span>
				</td>
			</tr>
		</tfoot>
	</table>
</script>
<script type="text/x-kendo-template" id="journal-report-list-tmpl">
	<tr>
		<td>#=id#</td>
		<td>
			#if(type === 'pmt') {#
				Payment
			#} else if(type === 'purchase') {#
				Purchase
			#} else if(type === 'expense') {#
				Expense
			#} else if(type === 'adj') {#
				Adjustment
			#} else if(type === 'invoice') {#
				Invoice
			#} else if(type === 'eInvoice') {#
				Electricity Invoice
			#} else if(type === 'wInvoice') {#
				Water Invoice
			#} else if(type === 'deposit') {#
				Deposit
			#} else if(type === 'Receipt') {#
				Receipt
			#}#				
		</td>
		<td>#=kendo.toString(date, 'dd-MM-yyyy')#</td>
		<td>#=voucher#</td>
		<td>#=contact.surname# #=contact.name#</td>
		<td>#=memo#</td>
		<td>

		</td>
		<td>
			#for (var i = 0; i < entries.length; i++) {#
				#= entries[i].account.code # #=entries[i].account.name# <br/>
			# } #
		</td>
		<td style="text-align: right">
			# var amount = 0; #
			#for (var i = 0; i < entries.length; i++) {#
				#if(entries[i].is_debit === 'true') {#
					# amount += kendo.parseFloat(entries[i].amount) #
					#= entries[i].amount #  <br/>
				# } else {#
					<br/>
				# } #
			# } #
			<hr/>
			<strong>#= kendo.toString(amount, 'c') #</strong>
		</td>
		<td style="text-align: right">
			# var amount = 0; #
			#for (var i = 0; i < entries.length; i++) {#
				#if(entries[i].is_debit === 'false') {#
					# amount += kendo.parseFloat(entries[i].amount) #
					#= entries[i].amount #  <br/>
				# } else {#
					<br/>
				# } #
			# } #
			<hr/>
			<strong>#= kendo.toString(amount, 'c') #</strong>
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="journal-ledger-report-tmpl">
	<h3 data-bind="text: companyInf()[0].legal_name" style="text-align:center"></h3>
	<h4 style="text-align:center">General Ledger Report</h4><br/>
	<div style="text-align: center;">
		<input type="text" data-role="dropdownlist" data-bind="source: dateType, events: {change: dateTypeSelect}" data-index="1" class="dateSelect" />
		<input type="text" data-role="datepicker" data-bind="value: startDate, events: {change: dateChange}"/>
		<input type="text" data-role="datepicker" data-bind="value: endDate" />
		<span data-bind="click: filterGL" class="k-button" data-role="button"><i class="icon-search"></i></span>
	</div><br/>
	<table class='table table-white'>
		<thead style="background-color: #00bbff; color: #ffffff">
			<tr>
				<th>Type</th>
				<th>Date</th>
				<th>Number</th>
				<th>Name</th>
				<th>Description</th>
				<th>Segment</th>
				<th>Account</th>
				<th>Amount</th>
				<th>Debit</th>
				<th>Crdit</th>
				<th>Balance</th>
			</tr>
		</thead>
		<tbody
			data-role="listview" 
			data-bind="source: gl" 
			data-template="journal-ledger-report-list-tmpl"
			data-auto-bind="false"
		></tbody>
	</table>
</script>
<script type="text/x-kendo-template" id="journal-ledger-report-list-tmpl">
	<tr>
		<td><strong>#=code#-#=name#</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		<td style="text-align: right">#=balance#</td>
	</tr>
	# var tmpbalance = 0, tmpamount = 0; #
	# tmpbalance = balance; #
	# for(var i = 0; i < entries.length; i++) {#
		# tmpbalance += kendo.parseFloat(entries[i].amount); #
		# tmpamount += kendo.parseFloat(entries[i].amount); #
		<tr style="font-size: 10px; font-weight: italic;">
			<td> 
				#if(entries[i].type === 'pmt') {#
					&nbsp;Payment
				#} else if(entries[i].type === 'purchase') {#
					&nbsp;Purchase
				#} else if(entries[i].type === 'expense') {#
					&nbsp;Expense
				#} else if(entries[i].type === 'adj') {#
					&nbsp;Adjustment
				#} else if(entries[i].type === 'invoice') {#
					&nbsp;Invoice
				#} else if(entries[i].type === 'eInvoice') {#
					&nbsp;Electricity Invoice
				#} else if(entries[i].type === 'wInvoice') {#
					&nbsp;Water Invoice
				#} else if(entries[i].type === 'deposit') {#
					&nbsp;Deposit
				#} else if(entries[i].type === 'Receipt') {#
					&nbsp;Receipt
				#}#		
			</td>
			<td>#=entries[i].dateTime#</td>
			<td>#=entries[i].voucher#</td>
			<td>#=entries[i].contact.surname# #=entries[i].contact.name#</td>
			<td>#=entries[i].memo#</td>
			<td></td>
			<td>
			</td>
			<td>	
			</td>
			<td style="text-align: right">
				#=entries[i].dr#
			</td>
			<td>
				#=entries[i].cr#
			</td>
			
			<td style="text-align: right">#= tmpbalance #</td>
		</tr>
	#}#
	<tr>
		<td>Total #=code#-#=name#</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		<td><div style="border-top: 3px double black; text-align: right">#=tmpamount#</div></td>
		<td><div style="border-top: 3px double black; text-align: right">#=tmpbalance#</div></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="class-list-tmpl">
	<span>
		#=name# (#=segment.name#)
	</span>
</script>
<script type="text/x-kendo-template" id="cashier-tmpl">
	<h1><img src="./uploads/pictures/banhji_cashier.png" alt="" width="300" height="100" /></h1>
	<div class="widget widget-heading-simple widget-body-white widget-employees">				
		<div class="widget-body padding-none">	
			<div class="row-fluid row-merge" style="margin-right: 0">
				<div class="span2 listWrapper" style="height: 755px;">
					<div class="innerAll">
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" id="search" data-bind="click: findVendor"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" data-bind="value: key" placeholder="Search" id="searchField">
								</div>
							</div>
						</form>
					</div>
					<span class="results" data-bind="text: people.dataSource.total()">
					</span>
					<div class="table table-condensed" id="sidebar"
						 data-role="grid" data-bind="source: people.dataSource" 
						 data-row-template="cashier-people-list-tmpl"
						 data-columns="[{title: 'Name'}]"
						 data-selectable=true
						 data-height="655"
						 data-pageable="false"
						 data-scrollable="{virtual: true}"></div>
				</div>
				<div class="span10">
					<div class="widget widget-tabs widget-tabs-double widget-tabs-white">
					    <!-- Tabs Heading -->
					    <div class="widget-head">
					        <ul>
					            <li class="active" id="cashier-payment-id"><a href="#tab1-2" class="glyphicons user" data-toggle="tab"><i></i><span class="strong">ទូទាត់ប្រាក់</span></a>
					            </li>
					            <li class="" id="cashier-receipt-id"><a href="#tab2-2" class="glyphicons calculator" data-toggle="tab"><i></i><span class="strong">ទទួលប្រាក់</span><span>ទទួលប្រាក់</span></a>
					            </li>
					            <li class="" id="cashier-deposit-id"><a href="#tab3-2" class="glyphicons credit_card" data-toggle="tab"><i></i><span class="strong">ដាក់ប្រាក់</span><span>ដាក់ប្រាក់</span></a>
					            </li>
					            <li class="" id="cashier-transfer-id"><a href="#tab4-2" class="glyphicons circle_ok" data-toggle="tab"><i></i><span class="strong">ផ្ទេរប្រាក់</span><span>ផ្ទេរប្រាក់</span></a>
					            </li>
					        </ul>
					    </div>
					    <!-- // Tabs Heading END -->

					    <div class="widget-body">
					        <div class="tab-content">
					            <!-- Tab content -->
					            <div class="tab-pane active" id="tab1-2">
					                <div class="row">
										<div class="span12">
											<div class="row-fluid">
												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<div class="widget-stats widget-stats-gray widget-stats-4"> 
															<span class="txt">Invoice paid</span>
															<span class="count" data-bind="text: vendors.tInvToday"></span>
															<span class="glyphicons user"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i> 
														</div>
													</div>
												</div>

												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<div class="widget-stats widget-stats-primary widget-stats-4">
															<span class="txt">បង់ប្រាក់ប្រចាំថ្ងៃ</span>
															<span class="count"><span data-bind="text: vendors.tAmtToday" style="font-size: 35px;">0៛</span></span>
															<span class="glyphicons coins"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i>
														</div>
													</div>
												</div>

												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a href="#/vendor_payment_report" class="widget-stats widget-stats-inverse widget-stats-4">
															<span class="txt">របាយការណ៍បង់ប្រាក់</span>
															<span class="glyphicons refresh"><i></i></span>
															<div class="clearfix"></div>
														</a>
													</div>
												</div>				
											</div>
										</div>
									</div>
									<div class="row">
										<div class="span12">
											<div id="exampleValidate" data-role="validator">
											 <!-- //End row-fluid -->
											<table class="table table-bordered table-striped innerL" data-bind="visible: show">
										        <thead>
										            <tr>
										                <th>បង់</th>
										                <th>Date</th>						                
										                <th>ឈ្មោះ</th>
										                <th>វិក្កយបត្រ</th>
										                <th>ទឹកប្រាក់</th>
										                <th class="right">បង់បាន</th>
										                <th class="right" width="110bb">ទទួលប្រាក់</th>							                
										            </tr>
										        </thead>
										        <tbody data-role="listview" data-auto-bind="false" 
										        	   data-template="payment-vednor-row-template" 
										        	   data-bind="source: vendors.tmp" 
										        	   class="k-widget k-listview"></tbody>						        
										    </table>
										</div>
										<div id="status"></div>
										<div class="innerL" data-bind="visible: show">
											<div class="span7">						
												<table>
													<tbody>
														<tr>
															<td style="width: 100px;">Date Receipt</td>
										              		<td>
										              			<input id="paymentDate" name="paymentDate" data-role="datepicker" data-bind="value: vendors.paymentDate" data-format="dd-MM-yyyy" required="" data-required-msg="Require Date" type="text" class="k-input">
															</td>
															<td>Total Amount:</td>
															<td align="right"><input type="text" data-bind="value: vendors.total" class="k-input k-textbox" style="width: 160px;" /></td>
														</tr>
											            </tr><tr>
															<td>Cash Account</td>
															<td>
																<input id="cashAccount" 
																	data-bind="source: vendors.cashAccount, value: vendors.account"  
																	data-required-msg="Require Cash Account" 
																	data-role="dropdownlist"
																	data-text-field="name",
																	data-value-field="id"
																	data-option-label="---រើសមួយ---"
																	style="display: none;">											
															</td>
															<td>សក្ខីប័ត្រចំណាយ:</td>
															<td align="right"><input type="text" data-bind="value: vendors.voucher" class="k-input k-textbox" style="width: 160px;" /></td>
														</tr>
														<tr>
															<td valign="top">ចំណាត់ថ្នាក់</td>
															<td valign="top"><select data-role="multiselect" 
														   		data-bind="source: vendors.classDS, value: segment, events: {change: vendors.changeValue}" 
														   		data-value-field="id" 
														   		data-text-field="name"
														   		data-placeholder="---រើសមួយ---"
														   		style="width: 160px" /></select>
														    </td>
															<td valign="top">ចំណាំ</td>
															<td colspan='3'>
																<textarea style="width: 150px;" name="" id="" cols="30" rows="5" data-bind="value: vendors.memo"></textarea>
															</td>
														</tr>										
													</tbody>
												</table>							
											</div>																			
											<div class="span4 pull-right">
												<div class="innerAll padding-bottom-none-phone" data-bind="click: vendors.makePayment">
													<a id="save" name="save" class="widget-stats widget-stats-info widget-stats-4">
														<span class="txt">ទឹកប្រាក់ទទួលបាន</span>
														<span class="count" style="font-size: 35px;" data-bind="text: vendors.total">៛</span>
														<span class="glyphicons cart_in"><i></i></span>
														<div class="clearfix"></div>
														<i class="icon-play-circle"></i>
													</a>
												</div>							
											</div>
										</div>
									</div>
									</div>
					            </div>
					            <!-- // Tab content END -->

					            <!-- Tab content -->
					            <div class="tab-pane" id="tab2-2">
					                <div class="row-fluid">
										<div id="saveCashierCustomerValidate" class="span12">
											<div class="row-fluid">
												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a href="javascript:void(0)" class="widget-stats widget-stats-gray widget-stats-4"> 
															<span class="txt">អតិថិជន</span>
															<span class="count" data-bind="text: vendors.total_customer"></span>
															<span class="glyphicons user"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i> 
														</a>
													</div>
												</div>
												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a href="#/wPayment_summary" class="widget-stats widget-stats-primary widget-stats-4">
															<span class="txt">បង់ប្រាក់ប្រចាំថ្ងៃ</span>
															<span class="count"><span data-bind="text: vendors.total_payment" style="font-size: 35px;"></span></span>
															<span class="glyphicons coins"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i>
														</a>
													</div>
												</div>
												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a href="#/reconcile" class="widget-stats widget-stats-inverse widget-stats-5">
															<span class="glyphicons refresh"><i></i></span>
															<span class="txt">ផ្ទៀងផ្ទាត់ &<br><br> ផ្ទេរសាច់ប្រាក់</span>
															<div class="clearfix"></div>
														</a>
													</div>
												</div>				
											</div> <!-- //End row-fluid -->
											<br>
											<table class="table table-bordered table-striped table-white">
										        <thead>
										            <tr>
										                <th></th>
										                <th>ល.រ</th>						                
										                <th>Date</th>
										                <th>ឈ្មោះ</th>
										                <th>វិក្កយបត្រ</th>
										                <th class="right">ទឹកប្រាក់</th>
										                <th class="right">ទទួលប្រាក់</th>							                
										            </tr>
										        </thead>
										        <tbody data-role="listview"
										        		data-auto-bind="false"					        		 
										        		data-template="cashier-row-dawine-template" 
										        		data-bind="source: customers.invoiceList"></tbody>
										        <tfoot data-template="cashier-footer-dawine-template" 
										        		data-bind="source: this"></tfoot>						        
										    </table>						    

											<br>
											
											<span id="notification"></span>

											<div class="row-fluid">
												<div class="span4">						
													<table>
														<tr>
															<td>Date</td>
										              		<td>
										              			<input id="txtPaymentDate" name="txtPaymentDate" 
										              				data-role="datepicker" 
										              				data-format="dd-MM-yyyy"
										              				data-parse-formats="dd-MM-yyyy"
											              			data-bind="value: customers.payment_date" 
											              			required data-required-msg="Require Date" />
															</td>
														</tr>										
														<tr>
										                    <td>វីធីបង់ប្រាក់</td>
										                  	<td>
										                  		<input id="ddlPaymentMethod" id="ddlPaymentMethod"
										                  			   data-role="dropdownlist"
													                   data-auto-bind="false"
													                   data-value-primitive="true"
													                   data-text-field="name"
													                   data-value-field="id"
													                   data-bind="value: customers.payment_method_id,
													                              source: customers.paymentMethodDS"									                   
													                   required data-required-msg="Require វីធីបង់ប្រាក់" />						                  					                  		
										                  	</td>
										                <tr>
														<tr>
											                <td>លេខកូដសែក</td>
											                <td><input id="check_no" class="k-textbox" data-bind="value: customers.check_no" style="width: 161px;" /></td>
											            <tr>
											            <tr>
															<td>Cash Account</td>
															<td>
																<input id="ddlCashAccount" name="ddlCashAccount" 
																		data-bind="value: customers.account_id" 
																		required data-required-msg="Require Cash Account" />												
															</td>
														</tr>										
													</table>							
												</div>																
												<div class="span4">
													<table>	
														<tr>
															<td>ទទួលប្រាក់សរុប:</td>
															<td align="right"><span data-bind="text: customers.pay_amount"></span></td>
														</tr>									
														<tr>
															<td>បញ្ចុះតំលៃ:</td>
															<td>
																<input data-role="numerictextbox" 
																		data-format="c0" data-culture="km-KH" 
																		data-bind="value: customers.discount, events: {change : customers.change}" />
															</td>
														</tr>
														<tr>
															<td>ទឹកប្រាក់ពិន័យ:</td>							
															<td>
																<input data-role="numerictextbox" 
																		data-format="c0" data-culture="km-KH" 
																		data-bind="value: customers.fine, events: {change : customers.change}" />
															</td>
														</tr>										
														<tr>
															<td>នៅខ្វះ</td>
															<td align="right"><span data-bind="text: customers.remain"></span></td>
														</tr>
													</table>		          	
												</div>

												<div class="span4">
													<div class="innerAll padding-bottom-none-phone">
														<a id="saveCashierCustomer" name="save" class="widget-stats widget-stats-info widget-stats-4">
															<span class="txt">ទឹកប្រាក់ទទួលបាន</span>
															<span class="count" style="font-size: 35px;" data-bind="text: customers.receive_amount"></span>
															<span class="glyphicons cart_in"><i></i></span>
															<div class="clearfix"></div>
															<i class="icon-play-circle"></i>
														</a>
													</div>								
												</div>
											</div>
										</div>
							        </div>
						        </div>
					            <!-- // Tab content END -->

					            <!-- Tab content -->
					            <div class="tab-pane" id="tab3-2">
					            	<div class="row-fluid">
					            		<div class="span6">
					            			<label for="voucher">លេខសក្ខីបត្រ័</label>
											<input type="text" style="width: 95%" data-bind="value: deposit.current.voucher" />
											<label for="from">ដាក់ទៅ</label>
											<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source: deposit.accounts, value: deposit.from.account" data-value-field="id" data-text-field="name" />
											<label for="description"​ style="margin-top: 10px">Description</label>
											<textarea style="width: 95%" name="" id="" cols="30" rows="3" data-bind="value: deposit.current.memo"></textarea>
											<button data-bind="click: deposit.save" class="btn btn-default btn-block">រក្សាទុក</button>
					            		</div>
					            		<div class="span6">
										<i class="icon-plus" data-bind="click: deposit.addEntry"></i>
										<ul style="list-style: none; padding: 5px; margin: 3px 0; width: 95%" class="striped" data-role="listview" data-bind="source: deposit.entries" data-template="entry-list"></ul>
					            		</div>
					            	</div>
					            </div>
					            <!-- // Tab content END -->

					            <!-- Tab content -->
					            <div class="tab-pane" id="tab4-2">
					            	<div class="row-fluid">
					            		<div class="span6">
					            			<label for="voucher">លេខសក្ខីបត្រ័</label>
											<input type="text" style="width: 95%" data-bind="value: transfer.current.voucher" />
											<label for="from">ពីគណនី</label>
											<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source:  transfer.accounts, value:  transfer.from.account" data-value-field="id" data-text-field="name" />
											<label for="description"​ style="margin-top: 10px">Description</label>
											<textarea style="width: 95%" name="" id="" cols="30" rows="3" data-bind="value:  transfer.current.memo"></textarea>
											<button data-bind="click: transfer.save" class="btn btn-default btn-block">រក្សាទុក</button>
					            		</div>
					            		<div class="span6">
											<i class="icon-plus" data-bind="click: transfer.addEntry"></i>
											<ul style="list-style: none; padding: 5px; margin: 0; width: 96%" class="stripe"data-role="listview" data-bind="source:  transfer.entries" data-template="entry-transfer-list"></ul>
					            		</div>
					            	</div>
					            </div>
						        <!-- // Tab content END -->
						    </div>
					    </div>
					</div>
				</div>					
			</div>	
		</div>
	</div>
</script>
<script id="cashier-transaction-row-dash-template" type="text/x-kendo-tmpl">
    <tr>        
        <td>#:kendo.toString(new Date(issued_date), "dd-MM-yy")#</td>
        <td>#:type# </td>
        <td align="right">#:kendo.toString(kendo.parseFloat(amount), "c", locale)#</td>        
   	</tr>
</script>
<script id="cashier-row-dawine-template" type="text/x-kendo-tmpl">		
	<tr id="rowGrid-#:id#">
		<td>
			<input type="checkbox" data-bind="checked: isPay, events:{change: checkPay}">			
		</td>
		<td class="sno">1</td>			
		<td>#:kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>		
		<td>#=fullname#</td>
		<td>#:number#</td>				
		<td class="right">#:kendo.toString(amount, "c", locale)#</td>
		<td class="right">
			<input data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: pay_amount, events: {change : change}" 
					style="width: 120px;">
			<i class="icon-trash" data-bind="events: { click: remove "></i>						
		</td>				
    </tr>   
</script>
<script id="cashier-footer-dawine-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="7" style="font-size:30px;">
            ប្រាក់ត្រូវបង់សរុប: #:customers.receive_amount#
        </td>
    </tr>
</script>
<script type="text/x-kendo-template" id="cashier-people-list-tmpl">
	<tr data-bind="click: onSelected">
	#if(company !== "") {#
		<td>#=company#</td>
	#} else {#
		<td>#=name#</td>
	#}#
	</tr>
</script>
<script type="text/x-kendo-template" id="cashier-deposit-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span4 offset4">
				<div class="widget">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
						<h4 class="heading glyphicons circle_info"><i></i> <a id="title">Deposit</a></h4>
					</div>
					<div class="widget-body">
						<label for="voucher">Voucher</label>
						<input type="text" style="width: 95%" data-bind="value: current.voucher" />
						<i class="icon-plus" data-bind="click: addEntry"></i>
						<ul style="list-style: none; padding: 5px; margin: 0; width: 95%" class="stripe"data-role="listview" data-bind="source: entries" data-template="entry-list"></ul>
						<label for="from">To</label>
						<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source: accounts, value: from.account" data-value-field="id" data-text-field="name" />
						<label for="description"​ style="margin-top: 10px">Description</label>
						<textarea style="width: 95%" name="" id="" cols="30" rows="3" data-bind="value: current.memo"></textarea>
						<button data-bind="click: save" class="btn-default btn-block">Save</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="entry-list">
	<li>
	<div class="pull-right">
		<i class="icon-plus" data-bind="click: deposit.addEntry"></i><br/>
		<i class="icon-minus" data-bind="click: deposit.removeEntry"></i>
	</div>
	<label for="account">From</label>
	<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source: accounts, value: account" data-text-field="name" data-value-field="id" />
	<label for="amount">Amount</label>
	<input type="text" data-bind="value: amount" />
	<label for="check">Cheque</label>
	<input type="text" data-bind="value: check" />
	<label for="description">Description</label>
	<input type="text" data-bind="value: memo" />
	<label for="segment">Segment</label>
	<select data-role="multiselect" style="width: 220px" 
		   data-bind="source: deposit.segments, value: segment, events: {change: deposit.changeValue}" 
		   data-value-field="id" 
		   data-text-field="name"
		   data-placeholder="select"
		   data-item-template="class-list-tmpl"
		   data-auto-bind=false
		   style="width: 220px" /></select>
	</li>
</script>
<script type="text/x-kendo-template" id="cashier-transfer-tmpl">
	<div class="container-960">
		<div class="row">
			<div class="span4 offset4">
				<div class="widget">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
						<h4 class="heading glyphicons circle_info"><i></i> <a id="title">Transfer</a></h4>
					</div>
					<div class="widget-body">
						<label for="voucher">Voucher</label>
						<input type="text" style="width: 95%" data-bind="value: current.voucher" />
						<label for="from">From</label>
						<input type="text" style="width: 98%" data-role="dropdownlist" data-bind="source: accounts, value: from.account" data-value-field="id" data-text-field="name" />
						<label for="description"​ style="margin-top: 10px">Description</label>
						<textarea style="width: 95%" name="" id="" cols="30" rows="3" data-bind="value: current.memo"></textarea>
						<i class="icon-plus" data-bind="click: addEntry"></i>
						<ul style="list-style: none; padding: 5px; margin: 0; width: 96%" class="stripe"data-role="listview" data-bind="source: entries" data-template="entry-transfer-list"></ul>
						<button data-bind="click: save" class="btn-default btn-block">Save</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="entry-transfer-list">
	<li>
	<div class="pull-right">
		<i class="icon-plus" data-bind="click:  transfer.addEntry"></i><br/>
		<i class="icon-minus" data-bind="click:  transfer.removeEntry"></i>
	</div>
	<label for="account">To</label>
	<input type="text" style="width: 220px" data-role="dropdownlist" data-bind="source:  transfer.accounts, value: account" data-text-field="name" data-value-field="id" />
	<label for="amount">Amount</label>
	<input type="text" data-bind="value: amount" />
	<label for="check">Cheque</label>
	<input type="text" data-bind="value: check" />
	<label for="description">Description</label>
	<input type="text" data-bind="value: memo" />
	<label for="segment">Segment</label>
	<select data-role="multiselect" style="width: 220px" 
		   data-bind="source:  transfer.segments, value: segment, events: {change:  transfer.changeValue}" 
		   data-value-field="id" 
		   data-text-field="name"
		   data-placeholder="select"
		   data-item-template="class-list-tmpl"
		   data-auto-bind=false
		   style="width: 220px" /></select>
	</li>
</script>
<script type="text/x-kendo-template" id="accounting-page-template">
	<div class="container-960">
		<div class="row">
			<div class="span10 offset1">
				<div class="widget">
					<div class="widget-head">
						<span class="btn btn-primary pull-right" data-bind='click: close'>X</span>
						<h3 class="heading">គណនី</h3>
					</div>
					<div class="widget-body" id="account-new-form">
						<table class="table">
							<tbody>
								<tr>
									<td>Type</td>
									<td><input type="text" data-role="combobox" class="span4"
										   data-bind="source: types, value: accounting.current.type, events: {change: onTypeChange}" 
										   data-text-field="name"
										   data-placeholder="--- Select One ---"
										   name="cbAccountType" 
										   data-value-field="id" style="width: 220px;"
										   required data-required-msg="Require" /><br/>
										   <span class="k-invalid-msg" data-for="cbAccountType"></span>
										   </td>
									<td width="130">Parent Account</td>
									<td><input type="text" data-role="combobox" class="span4"
									       data-bind="source: coa, value: accounting.current.parentAccount" 
									       data-template="accounting-coa-template"
									       data-text-field="name" 
									       data-value-field="id" style="width: 220px;" /></td>
								</tr>
								<tr>
									<td>Account Name</td>
									<td><input type="text" data-bind="value: accounting.current.name" placeholder="Account" style="width: 220px;" /></td>
									<td>Code</td>
									<td><input type="text" data-bind="value: accounting.current.code" placeholder="Code" style="width: 207px;" /></td>
								</tr>
								<tr>
									<td>Account Name (En)</td>
									<td><input type="text" data-bind="value: accounting.current.name_en" placeholder="Account Name" style="width: 220px;" /></td>
									<td>Description</td>
									<td><input type="text" data-bind="value: accounting.current.description" placeholder="Description" /></td>
								</tr>
								<tr>
									<td colspan="4">
										For Tax Desclearaton <input type="checkbox" name="" id=""/>
									</td>
								</tr>
							</tbody>
						</table>
						<table class='table well' data-bind="visible: showCash">
							<tbody>
								<tr>
									<td width="130">Bank</td>
									<td><input style="width: 220px;" type="text" data-role="combobox" /></td>
									<td>Bank Account Number</td>
									<td><input type="text"/></td>
								</tr>
								<tr>
									<td>Currency</td>
									<td><input style="width: 220px;" type="text" data-role="combobox" /></td>
									<td></td>
									<td></td>
								</tr>
							</tbody>
						</table>
						<div style="text-align: right">
							<button class="btn btn-primary" style="width: 220px;" data-bind="click: save">Save and Continue</button>
							<button class="btn btn-success" style="width: 220px;" data-bind="click: saveClose">Save and Close</button>
							<button class="btn btn-danger" style="width: 220px;" data-bind="click: close">Cancel</button>
						</div>							
					</div>
				</div>	
			</div>
		</div>
	</div>			
</script>
<script type="text/x-kendo-template" id="accounting-coa-template">
	#=code# - #=name#
</script>
<script type="text/x-kendo-template" id="grn-form-template">
	<div class="container-960">
		<div class="row">
			<div class="span12">
				<div class="widget">
					<div class="ribbon-wrapper" style="z-index: 999999;"><div class="ribbon default"><span data-bind="text: ribbon"></span></div></div>
					<div class="widget-head">	
						<h4 class="heading glyphicons notes"><i></i> Good Received Note</h4>
					</div>
					<div class="widget-body">
						<div class="row">
							<div class="well span12" style="margin-left: 7px;">
								<table>
									<tr>
										<td width="150">Select PO</td>
										<td><input type="text" style="width: 220px;"
															   data-role="combobox" 
															   data-bind="source: poDS, 
															   			  value: current.invoice_number, 
															   			  events:{change: selectedPO},
															   			  disabled: disablePO" 
															   data-text-field="invoice_number" 
															   data-value-field="id"
															   data-min-length="4"
															   data-filter="startswith" /></td>
										<td width="200"></td>
										<td width="150">Segment</td>
										<td><select data-role="multiselect" 
										   data-bind="source: classDS, value: current.segment, events: {change: changeValue}" 
										   data-value-field="id" 
										   data-text-field="name"
										   data-placeholder="select"
										   style="width: 220px" /></select></td>
									</tr>
									<tr>
										<td width="150">Vendor</td>
										<td><input type="text" data-bind="value: current.vendor.company" /></td>
										<td width="200"></td>
										<td width="150">Date</td>
										<td><input type="text" style="width: 220px;"
															   data-role="datepicker" 
															   data-bind="value: current.due_date" /></td>
									</tr>
									<tr>
										<td width="150">Voucher</td>
										<td><input type="text" data-bind="value: current.voucher" /></td>
										<td width="200"></td>
										<td width="150"></td>
										<td></td>
									</tr>
								</table>
								<table class="table">
									<thead>
										<tr style="background-color: #000; color: #fff">
											<th width="25" style="text-align:center;"><i data-bind="click: addItem" class="icon-plus"></i></th>
											<th>Item</th>
											<th>Description</th>
											<th width="150">PO</th>
											<th width="150">Amount Received</th>
											<th>នៅសល់</th>
										</tr>
									</thead>
									<tbody data-role="listview" data-bind="source: itemDS" 
										   data-template="grn-item-list-template"
										   data-auto-bind=false></tbody>
									<tfoot>
										<tr>
											<td colspan="3" style="text-align:right;">Total</td>
											<td><span data-bind="text: totalQty"></span></td>
										</tr>
									</tfoot>
								</table>
								<div class="span12" style="text-align: center; padding-bottom: 10px;">
									<span class="btn btn-icon btn-primary glyphicons circle_ok"  data-bind="click: save"><i></i>Save</span>
									<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: close">Cancel</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="grn-item-list-template">
	<tr>
		<td>
			<i data-bind="click: addItem" class="icon-plus"></i>
			<i data-bind="click: removeItem" class="icon-minus"></i>
		</td>
		<td width="250"><input type="text" style="width: 250px;" data-role="dropdownlist" data-bind="source: items, value: item" data-text-field="name" data-value-field="id" /></td>
		<td><input type="text" data-bind="value: item.description" /></td>
		<td><span data-bind="text: unit"></span></td>
		<td><input type="text" style="width: 100px;" data-bind="value: unitReceipt, events: {change: total, blur: lineTotal}" /></td>
		<td><span data-bind="text: balance"></span></td>
	</tr>
</script>
<script type="text/x-kendo-template" id="test-template">
	<div class="widget">
		<div class="widget-head">
			<span class="btn btn-primary pull-right" data-bind="click: close">X</span>
			<h4 style="text-align: center">Purchase Order</h4>
		</div>
		<div class="widget-body">
			<div
				data-role="grid"
				data-bind="source: billVM.ds"
				data-columns="['id', 'vendor', '&nbsp;', '&nbsp;']"
				data-row-template="po-list-center-template"
				data-auto-bind=false
				data-height="400px"
			></div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="po-list-center-template">
	<tr>
		<td>#=id#</td>
		<td>#=vendor.company#</td>
		<td>
			#if(status !== 'partial' || status == 'open') {#
				<a href="\#/grn/#:id#/po"><button class="btn btn-primary"><i class="icon-check-empty"></i> GRN</button></a>
			#} else {#
				<button class="btn btn-default"><i class="icon-check"></i> GRN</button>
			#}#
		</td>
		<td>
			#if(status === 'partial' || status == 'open') {#
				<a href="\#/purchase/#:id#/po"><button class="btn btn-primary"><i class="icon-check-empty"></i> Bill</button></a>
			#} else {#
				<button class="btn btn-default"><i class="icon-check"></i> Bill</button>
			#}#
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="purchase-return-template">
	<div class="container-960">
		<div class="row">
			<div class="span12">
				<div class="widget">
					<div class="widget-head">
						<button class="pull-right btn btn-primary">X</button>
						<h3 style="margin-left: 15px; font-size: 14pt">Purchase Return</h3>
					</div>
					<div class="widget-body">
						<div class="row">
							<div class="span6 offset4">
								លេខវិក្កយប័ត្រ <div class="input-append">
								  <input class="span12" data-bind="value: keyword" type="text">
								  <button class="btn" type="button" data-bind="click: search"><i class="icon-search"></i></button>
								</div>
							</div>
						</div>
						<div class="row" style="padding: 5px;" data-bind="visible: hasData">
							<div class="span12">
								<div class="well">
									<table class="table table-white">
										<tbody>
											<tr>
												<td width="150">Vendor</td>
												<td wdith="230"><span data-bind="text: current.vendor.company"></span></td>
												<td width="150">Bill Number</td>
												<td wdith="230"><span data-bind="text: current.invoice_number"></span></td>
											</tr>
											<tr>
												<td>Voucher</td>
												<td><span data-bind="text: current.voucher"></span></td>
												<td>Segment</td>
												<td><select data-role="multiselect" 
												   data-bind="source: classDS, value: current.segment" 
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="select" /></select>
											   </td>
											</tr>
											<tr>
												<td colspan="4" style="text-align: center"><span data-bind="text: status"></span></td>
											</tr>
											
										</tbody>
									</table>
								</div>
								<div style="width: 100%; text-align:center;">
									<input type="text" data-role="dropdownlist" data-bind="source: accounts, value: cashAC, visible: useCash" data-text-field="name" data-value-field="id" />
								</div><br/>
								<table class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Item</th>
											<th>Description</th>
											<th>Unit</th>
											<th>Price</th>
											<th>Amount</th>
											<th>Return</th>
											<th>Tax</th>
										</tr>
									</thead>
									<tbody data-role="listview" 
										   data-bind="source: prData" 
										   data-template="purchase-return-list-template"
										   data-auto-bind=false></tbody>
									<tfoot>
										<tr>
											<td colspan="7" style="text-align:center">
												<button class="btn" style="width: 100px;" data-bind="invisible: isOpen, click: refund">Refund</button>
												<button class="btn" style="width: 100px;" data-bind="invisible: isOpen, click: offset">Offset</button>
												<button class="btn" style="width: 100px;" data-bind="visible: isOpen, click: save">Return</button>
											</td>
										</tr>
									</tfoot>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="purchase-return-list-template">
	<tr>
		<td>#=item.name#</td>
		<td>#=item.description#</td>
		<td>#=unit#</td>
		<td>#=cost#</td>
		<td>#=total#</td>
		<td><input type="text" data-bind="value: back, events: {change: check}" /></td>
		<td>
			#if(isTaxed === true) {#
				<i class="icon-check"></i>
			#} else {#
				<i class="icon-check-empty"></i>
			# } #
		</td>
	</tr>
</script>

<!-- currency section -->
<script type="text/x-kendo-template" id="accounting-setting-template">
	<div class="widget widget-heading-simple widget-body-white">
		<div class="widget-head">
			<h2 class="heading">Accounting General Settings</h2>
		</div>
		<div class="widget-body">
			<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

			    <!-- Tabs Heading -->
			    <div class="widget-head span3">
			        <ul>
			            <li class="active"><a href="#tab1-1" data-toggle="tab"><span>&nbsp;Reporting Standard</span></a>
			            </li>
			            <li><a href="#tab2-1" data-toggle="tab"><i></i><span>&nbsp;Reporting Date</span></a>
			            </li>
			            <li><a href="#tab3-1" data-toggle="tab"><i></i><span class="strong">&nbsp;Reporing Currency</span></a>
			            </li>
			            <li><a href="#tab4-1" data-toggle="tab"><i></i><span class="strong">&nbsp;Accounting</span></a>
			            </li>
			            <li><a href="#tab5-1" data-toggle="tab"><i></i><span class="strong">&nbsp;Segment</span></a>
			            </li>
			            <li><a href="#tab6-1" data-toggle="tab"><i></i><span class="strong">&nbsp;Transaction Item</span></a>
			            </li>
			        </ul>
			    </div>
			    <!-- // Tabs Heading END -->

			    <div class="widget-body span9">
			        <div class="tab-content">

			            <!-- Tab content -->
			            <div class="tab-pane active" id="tab1-1">
			                Accounting Reporting Standard Options
			                <div class="well">
			                	Cambodian International Financial Reporting Standards for SMEs
			                </div>
			                <p>
			                	សំគាល់៖ Banhji​ មិនធានាថាអ្នក​អាចបំពេញគ្រប់លក្ខ័ខណ្ឌដែលមាន​ចែងក្នុងស្តង់ដារខាងលើនេះ Banhji គ្រាន់តែផ្ដល់អោយទម្រង់របាយការណ័​ហិរញ្ញវត្ថុគំរូ
			                	ដែលផ្អែកតាមរបាយការណ៍ហិរញ្ញវត្ថុគំរូ​សំរាប់សហគ្រាសធុនតូចនិង​មធ្យម​របស់​ស្តងដាររបាយការណ៍​ហិរញ្ញវ្តុ​ទាក់ទង​នឹង​ហិរញ្ញវត្ថុ​អន្តរជាតិ​នៃកម្ពុជា​សមហរាប់​សហគ្រាសធុនតុច​និង​មធ្យម​
			                	ដែលបាន​បោះផ្សាយជាសាធារណៈដោយ​ក្រុមប្រឹក្សាជាតិគណនេយ្យ​នៅ​ឆ្នាំ​២០១៣។
			                </p>
			            </div>
			            <!-- // Tab content END -->

			            <!-- Tab content -->
			            <div class="tab-pane" id="tab2-1">
			            	<div class="well">
			            		Date Started: <input type="text" data-role="datepicker" data-bind="enabled: editable,value: currentInstitute.financial_year" /> once set cannot be changed.
			            	</div>
			            	<div class="well">
			            		Reporting Date: <input type="text" data-role="datepicker" data-bind="value: currentInstitute.financial_report_date" /> please choose reporting date.
			            	</div>
			            	<button class="btn btn-primary pull-right" data-bind="click: saveFinacialDate">Save</button>
			            </div>
			            <!-- // Tab content END -->

			            <!-- Tab content -->
			            <div class="tab-pane" id="tab3-1">
			                <div class="widget widget-heading-simple widget-body-gray">
			                	<div class="widget-head">
			                		<h2 class="heading">Reporting Currency:&nbsp;<h3 class="heading" data-bind="text: currentInstitute.report_locale"></h3></h2>
			                	</div>
			                	<div class="widget-body">
			                		<div class="well" style="background-color: #999999; color: #ffffff">
			                			Locale <span data-bind="text: currentInstitute.locale"></span> ពេលកំណត់រួចមិនអាចប្ដូរបានទេ
			                		</div>
			                		<button data-bind="click: currencies.addNew" class="btn btn-primary pull-right"><i class="icon-plus-sign"></i></button>
			                		<h3>Rate</h3>
			                		<table class="table table-borderless table-striped table-pricing-2">
			                			<thead>
			                				<tr>
			                					<th>Date</th>
			                					<th>Currency</th>
			                					<th width="100">Exchange Rate</th>
			                					<th>Source</th>
			                					<th>Update Method</th>
			                					<th></th>
			                				</tr>
			                			</thead>
			                			<tbody data-role="listView" 
			                				   data-bind="source: currencies.dataSource"
			                				   data-edit-template="currency-list-edit-template"
			                				   data-template="currency-list-template"></tbody>
			                		</table>
			                		<div class="span5"
			                			 data-role="window"
			                			 data-actions="{}"
			                			 data-position="{top: '50%', left: '35%'}"
			                			 data-title="Currency"
			                			 data-bind="visible: currencies.formVisible">
			                			 <table class="table">
			                			 	<tr>
			                			 		<td>Code:</td>
			                			 		<td><input type="text" data-bind="value: currencies.current.code"></td>
			                			 	</tr>
			                			 	<tr>
			                			 		<td>Country:</td>
			                			 		<td><input type="text" data-bind="value: currencies.current.country"></td>
			                			 	</tr>
			                			 	<tr>
			                			 		<td>Rate</td>
			                			 		<td><input type="text" data-bind="value: currencies.current.rate"></td>
			                			 	</tr>
			                			 	<tr>
			                			 		<td>Locale</td>
			                			 		<td><input type="text" data-bind="value: currencies.current.locale"></td>
			                			 	</tr>
			                			 	<tr>
			                			 		<td></td>
			                			 		<td><input type="checkbox" data-bind="checked: currencies.current.enabled" /> Active</td>
			                			 	</tr>
			                			 </table>								
										<div class="edit-buttons pull-right">
									        <button class="k-button k-update-button" data-bind="click: currencies.saveClose"><span class="k-icon k-update"></span></button>
									        <button class="k-button k-cancel-button" data-bind="click: currencies.cancel"><span class="k-icon k-cancel"></span></button>
									    </div>
									</div>
			                	</div>
			                </div>
			            </div>
			            <!-- // Tab content END -->

			            <!-- Tab content -->
			            <div class="tab-pane" id="tab4-1">
			                សដសដស
			            </div>
			            <!-- // Tab content END -->
			            <!-- Tab content -->
			            <div class="tab-pane" id="tab5-1">
			                <div class="well">
								<a href="#/structure/new" class="btn btn-primary"> <i class="icon-plus"></i> Add</a>
								<table class="table table-white">
									<thead>
										<tr style="background-color: #14385C; color: #ffffff">
											<td>Description</td>
											<td>Date</td>
											<td>Update Date</td>
											<td>Active</td>
											<td></td>
										</tr>
									</thead>
									<tbody data-role="listview" 
										   data-bind="source: segments.dataStore" 
										   data-template="admin-structure-list-tmpl" 
										   data-selectable='true'></tbody>
								</table>
							</div>				
							<div data-role="pager" data-bind="source: dataStore" data-page-size='true' data-refresh='true'></div>
			            </div>
			            <!-- // Tab content END -->
			            <!-- Tab content -->
			            <div class="tab-pane" id="tab6-1">
			                <div class="well">
								<div class="btn btn-primary" data-bind="click: transactionItem.add"><i class="icon-plus-sign"></i> Add</div>
								<div data-role='grid' 
									data-bind="source: transactionItem.dataSource" 
									data-columns="[{title: 'Name'},{title: 'Description'},{title: 'Status'}, {title: '&nbsp;'}]"
									data-row-template="accountingItem-list-template"
									data-auto-bind=true></div>
							</div>				
							<div data-role="pager" data-bind="source: transactionItem.dataSource" data-page-size='true' data-refresh='true'></div>
			            </div>
			            <!-- // Tab content END -->

			        </div>

			    </div>
			</div>
		</div>
	</div>
</script>
<script type="text/x-kendo-template" id="accountingItem-list-template">
	<tr>
		<td>#=name#</td>
		<td>#=description#</td>
		<td>
		 #if(status === '1') {#
		 	Active
		 #} else {#
		 	Inactivve
		 #}#
		 </td>
		 <td>
		 	<div class="btn btn-primary" data-bind="click: getItem"><i class="icon-edit-sign"></i> Edit</div>​
		 	<div id="models-bootbox-confirm" class="btn btn-warning" data-bind="click: remove"><i class="icon-remove-sign"></i>​ Delete</div>​
		 </td>
	</tr>
</script>
<script type="text/x-kendo-template" id="currency-list-template">
	<tr>
		<td>#=updated_at#</td>
		<td>#=code#</td>
		<td>#:kendo.toString(rate, 'n')#</td>
		<td>df</td>
		<td>
			# if(update_method === 'automatic') {#
				Automatic
			#} else {#
				Manual
			# } #
		</td>
		<td width="80">
			<div class="edit-buttons">
                <button class="k-button k-edit-button" data-bind='click:currencies.edit'><span class="k-icon k-edit"></span></button>
                <button class="k-button k-delete-button"><span class="k-icon k-delete"></span></button>
            </div>				
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="currency-page-template">
	<h3>Exchange Rate List</h3>
	<table class="table table-borderless table-striped table-pricing-2">
		<thead>
			<tr>
				<th>Date</th>
				<th>Currency</th>
				<th width="100">Rate</th>
				<th>Source</th>
				<th>Update Method</th>
				<th></th>
			</tr>
		</thead>
		<tbody data-role="listView" 
			   data-bind="source: dataSource"
			   data-template="currency-page-list-template"></tbody>
	</table>
</script>
<script type="text/x-kendo-template" id="currency-page-list-template">
	<tr>
		<td>#=updated_at#</td>
		<td>#=code#</td>
		<td>#:kendo.toString(rate, 'n')#</td>
		<td>df</td>
		<td>
			# if(update_method === 'automatic') {#
				Automatic
			#} else {#
				Manual
			# } #
		</td>
		<td width="80">
							
		</td>
	</tr>
</script>
<script type="text/x-kendo-template" id="currency-list-edit-template">
	<div class="product-view k-widget">
		<dl>
			<dd>fdsfsd</dd>
			<dd>dfdsf</dd>
			<dd><input type="text" datas-bind="value: rate" /></dd>
			<dd>df</dd>
			<dd>dsfdsf</dd>
		</dl>
		<div class="edit-buttons">
	        <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
	        <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
	    </div>
	</div>
</script>
<!-- end currency section -->

<!-- DAWINE ================================================================================================================================= -->

<!-- ***************************
 *	Accounting Section        *
**************************** -->
<script id="currencyRate" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Exchange Rate</h4>							        	
				    </div>
				    <div class="widget-body">

				    	<div class="row-fluid">
					    	<div class="span6 alert alert-primary">Company currency: </div>
					    	<div class="span6 alert alert-primary">Reporting currency: </div>
				    	</div>

				    	<div class="hidden-print well">
				    		<input id="cbbCurrency" placeholder="Select currency ..." style="width: 300px;" />

				            <input id="sorter" name="sorter"
					    	   data-role="dropdownlist"                   
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList" />
					                                   
					        <input id="sdate" name="sdate"						           
					           data-bind="value: sdate"
					           placeholder="From ..." />
					        
					       	<input id="edate" name="edate"						           
					           data-bind="value: edate"
					           placeholder="To ..." />

				            <button id="search" type="button" data-role="button"><i class="icon-search"></i></button>
			          		|
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>							
				    	</div>						

						<div align="center">
							<span id="strDate"></span>
						</div>

						<br>					
						
						<button class="btn btn-inverse hidden-print" data-bind="click: openWindow"><i class="icon-plus icon-white"></i> Add New Rate</button>
						&nbsp;
						<span class="hidden-print">Please click on the column header to sort based on currency.</span>

						<div data-role="grid"
							 data-sortable="true"							 
							 data-row-template="currencyRate-row-template"			                
			                 data-columns="[
                                { 'field': 'date', 'title':'Date', width: 90 },
                                { 'field': 'currency_id', 'title':'Code', width: 60 },
                                { 'field': 'currency_id', 'title':'Country' },
                                { 'field': 'rate', 'title':'Rate', width: 140 },
                                { 'field': 'source', 'title':'Source', width: 70 },
                                { 'field': 'method', 'title':'Method', width: 70 },
                                { 'title':'', width: 130 }
                             ]"
			                 data-bind="source: dataSource"></div>

			            <div data-role="pager" 
						    	data-auto-bind="false"
					            data-bind="source: dataSource"></div>

					    <span id="notification"></span>

					    <div id="window" data-role="window" data-visible="false" data-modal="true" data-resizable="false" data-iframe="true">				    	
							<table class="table table-borderless table-condensed cart_total" style="width: 400px;">
								<tr>
									<td>										
								    	<input data-role="combobox"
							                   data-placeholder="Select Currency"
							                   data-value-primitive="true"
							                   data-text-field="code"
							                   data-value-field="id"
							                   data-template="currencyRate-currency-template"
							                   data-bind="value: obj.currency_id,
							                              source: currencyDS"
							                   style="width: 100%" />
						            </td>
				            	</tr>
				            	<tr>
									<td>
						                <input id="date" name="date" 
						            		data-role="datepicker"			            		
				        					data-bind="value: obj.date" 
				        					data-format="dd-MM-yyyy"
				        					data-parse-formats="yyyy-MM-dd" 
				        					placeholder="dd-MM-yyyy" required data-required-msg="required"
				        					style="width: 100%" />
				        			</td>
				            	</tr>
				            	<tr>
									<td>
				        				<input data-role="numerictextbox"
						                   data-format="n"		                   
						                   data-bind="value: obj.rate"
						                   placeholder="Rate(per 1 unit of base currency) ..."
						                   style="width: 100%" />
						            </td>
				            	</tr>
			                </table>

			                <p>
			                	Note: The exchange rate here is equivalent to 1 unit of base currency.
			                </p>			               
				            
				            <div align="center">
								<span class="btn btn-success btn-icon glyphicons ok_2" data-bind="click: save"><i></i>Save</span>
								<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindow"><i></i>Close</span>
							</div>					  
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="currencyRate-row-template" type="text/x-kendo-tmpl">		
	<tr>			
		<td>#=kendo.toString(new Date(date), "dd-MM-yyyy")#</td>		
		<td>#=currency.length>0?currency[0].code:""#</td>
		<td>#=currency.length>0?currency[0].country:""#</td>
		<td align="right">#=kendo.toString(rate, "n10")#</td>					
		<td>#=source#</td>
		<td>#=method#</td>				
		<td>
			<span data-bind="click: edit"><i class="icon-edit"></i> Edit</span>
    		|
    		<span data-bind="click: delete"><i class="icon-remove"></i> Delete</span>			
		</td>		
    </tr>   
</script>
<script id="currencyRate-currency-template" type="text/x-kendo-template">	
	#=code# #=country#
</script>


<!-- ***************************
 *	Vendor Section            *
**************************** -->
<script id="vendorCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" style="height: 700px;">
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="number or name ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>
							<div class="select2-container" style="width: 100%;">								
																
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: contactDS.total()"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid" 
						 data-bind="source: contactDS"
						 data-auto-bind="false" 
						 data-row-template="vendorCenter-vendor-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							            <li style="font-size: large; color: black; font-weight: bold;">
							            	<span data-bind="text: obj.number"></span>
							            	-
							            	<span data-bind="text: obj.surname"></span>
							            	<span data-bind="text: obj.name"></span>
							            </li>
							            <li class="glyphicons stats active"><span data-toggle="tab" data-target="#tab1-7"><i></i></span>
							            </li>
							            <li class="glyphicons riflescope"><span data-toggle="tab" data-target="#tab2-7"><i></i></span>
							            </li>							            
							            <li class="glyphicons circle_info"><span data-toggle="tab" data-target="#tab3-7"><i></i></span>
							            </li>							            
							            <li class="glyphicons pen"><span data-toggle="tab" data-target="#tab4-7"><i></i></span>
							            </li>
							            <li class="glyphicons edit"><span data-bind="click: goEditContact"><i></i></span>
							            </li>							            
							            <li class="glyphicons user_add"><a href="#/vendor"><i></i></a>
							            </li>
							            <li class="glyphicons circle_plus"><span data-toggle="tab" data-target="#tab7-7"><i></i></span>
							            </li>							            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- GRAPH Tab content -->
							            <div id="tab1-7" class="tab-pane active box-generic">
							            	<div id="sale-graph" style="height: 180px;"></div>
							            </div>
							            <!-- // GRAPH Tab content END -->

							            <!-- SEARCH Tab content -->
							            <div id="tab2-7" class="tab-pane box-generic">
							                <input data-role="dropdownlist"
							                	   data-auto-bind="false"
						            			   data-option-label="(--- Vendor Type ---)"					            			   		                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: contact_type_id,
								                              source: contactTypeDS"
								                   style="width: 100%"/>

							                <input data-role="dropdownlist"
						            			   data-option-label="(--- Currency ---)"					            			   		                   
								                   data-value-primitive="true"
								                   data-text-field="code"
								                   data-value-field="id"
								                   data-bind="value: currency_id,
								                              source: currencyDS"
								                   style="width: 100%"/>

								            <br><br>
								            <span class="btn btn-primary btn-icon glyphicons search pull-right" data-bind="click: search"><i></i> <span data-bind="text: lang.lang.search"></span></span>
								            <br>
							            </div>
							            <!-- // SEARCH Tab content END -->							            

							            <!-- INFO Tab content -->
							            <div id="tab3-7" class="tab-pane box-generic">
							            	<div class="row-fluid">
								            	<div class="span6">
										
													<!-- Bio -->
													<div class="widget widget-heading-simple widget-body-gray margin-none">
														<div class="widget-head">
															<h4 class="heading glyphicons user"><i></i> <span data-bind="text: obj.number"></span> <span data-bind="text: obj.fullname"></span></h4>
														</div>
														<div class="widget-body">
															<ul class="unstyled icons margin-none">
																<li class="glyphicons group"><i></i> Type: <span data-bind="text: obj.contact_type"></span></li>
																<li class="glyphicons phone"><i></i> Phone: <span data-bind="text: obj.phone"></span></li>
																<li class="glyphicons envelope"><i></i> Email: <span data-bind="text: obj.email"></span></li>
																<li class="glyphicons calendar"><i></i> Registered: <span data-bind="text: obj.registered_date"></span></li>
															</ul>
														</div>
													</div>
													<!-- // Bio END -->
													
												</div>
												<div class="span6">
													<!-- Bio -->
													<div class="widget widget-heading-simple widget-body-gray margin-none">
														<div class="widget-head">
															<h4 class="heading glyphicons edit" data-bind="click: goEditContact"><i></i> <span data-bind="text: lang.lang.edit"></span></h4>
														</div>
														<div class="widget-body">
															<p><i class="icon-home"></i> <span data-bind="text: obj.address"></span></p>
														</div>
													</div>
													<!-- // Bio END -->
												</div>
											</div>
							            </div>
							            <!-- // INFO Tab content END -->

							            <!-- NOTE Tab content -->
							            <div id="tab4-7" class="tab-pane box-generic">

										    <div class="chat-controls">															
												<form class="margin-none">
													<div class="row-fluid">
														<div class="span10">
															<input type="text" name="message" class="input-block-level margin-none" data-bind="value: note" placeholder="កំណត់Memo ...">
														</div>
														<div class="span2">
															<span class="btn btn-block btn-primary" data-bind="click: saveNote"><span data-bind="text: lang.lang.save"></span></span>
														</div>
													</div>
												</form>															
											</div>

											<br>

									    	<div data-role="grid"
									    	 	 data-height="100"
					 							 data-scrollable="{virtual: true}"									                 
								                 data-row-template="vendorCenter-note-tmpl"
								                 data-bind="source: noteDS"
								                 data-columns="[{title: ''}]"></div>
											
							            </div>
							            <!-- // NOTE Tab content END -->

							            <!-- INVOICE Tab content -->
							            <div id="tab7-7" class="tab-pane box-generic">
							            	<table class="table table-borderless table-condensed cart_total">
								            	<tr>
								            		<td width="50%">
								            			<span class="btn btn-block btn-primary" data-bind="click: goPO">Purchase Order</span>
								            		</td>
								            		<td width="50%">
								            			<span class="btn btn-block btn-inverse" data-bind="click: goDeposit">Deposit</span>								            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goGRN">Goods Receive Note</span>								            			
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goExpense">Expense</span>								            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goPurchase">Debit Note</span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goPurchase">Purchase</span>								            											            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goPayBill">Pay Bills</span>								            			
								            		</td>
								            	</tr>								            	
							            	</table>
							            </div>
							            <!-- // INVOICE Tab content END -->								            

							        </div>
							    </div>
							</div>
						</div>

						<div class="span6">
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons coins"><i></i></span>
										<span class="txt">Balance<span data-bind="text: balance" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-inverse widget-stats-5" data-bind="click: loadPO">
										<span class="glyphicons truck"><i></i></span>
										<span class="txt">PO<span data-bind="text: po" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons circle_exclamation_mark"><i></i></span>
										<span class="txt"><span data-bind="text: openInvoice"></span> Open</span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadOverInvoice">
										<span class="glyphicons turtle"><i></i></span>
										<span class="txt"><span data-bind="text: overInvoice"></span> Over Due</span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>											          	
		          	</div>
					
					<div>
						<input data-role="dropdownlist"                   
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					                      events: { change: dateChanges }"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      events: { change: dateChanges }"
					           placeholder="To ..." >
					    
					    <button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th>Date</th>
								<th>Type</th>								
								<th>Reference No</th>
								<th>Amount</th>
								<th>Status</th>
								<th>Action</th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="vendorCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="vendorCenter-vendor-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				<span class="strong">
					#=number# #=fullname#				
				</span>
			</div>
		</td>
	</tr>
</script>
<script id="vendorCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <td>
        	#if(type==="PO"){#								
				<a href="\#/po/#=id#"><i></i> #=number#</a>	
			#}else if(type==="Purchase"){#
        		<a href="\#/purchase/#=id#"><i></i> #=number#</a>        	        		
			#}else if(type==="Expense"){#
        		<a href="\#/expense/#=id#"><i></i> #=number#</a>        	
        	#}else if(type==="GRN"){#        		
        		<a href="\#/grn/#=id#"><i></i> #=number#</a>        	
        	#}else if(type==="Payment"){#
        	
        	#}else{#
        		#=number#
        	#}#
        </td>
    	<td class="right">#=kendo.toString(amount/rate, locale=="km-KH"?"c0":"c", "c", locale)#</td>
    	<td>        	
        	#if(type==="Purchase" || type==="Expense"){#
        		#if(status==="0" || status==="2") {#
        			# var date = new Date(), dueDate = new Date(due_date).getTime(), toDay = new Date(date).getTime(); #
					#if(dueDate < toDay) {#
						Over Due #:Math.floor((toDay - dueDate)/(1000*60*60*24))# days
					#} else {#
						#:Math.floor((dueDate - toDay)/(1000*60*60*24))# days to pay
					#}#
				#} else {#
					Paid
				#}#
        	#}else if(type==="PO" || type==="GRN"){#
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Done        			
        		#}#        	
        	#}#			
		</td>    	
    	<td align="center">
			#if(type==="Purchase"){#
				<a href="\#/purchase/#=id#"><i></i> Send</a>

				#if(status==="0" || status==="2"){#					
					| <a href="\#/purchase/#=id#"><i></i> Pay</a>
				#}#
			#}else if(type==="Expense"){#
        		<a href="\#/expense/#=id#"><i></i> Send</a>

				#if(status==="0" || status==="2"){#					
					| <a href="\#/expense/#=id#"><i></i> Pay</a>
				#}#        	
        	#}else if(type==="GDN"){#        		
        		#if(status==="0"){#
        			
        		#}#
        	#}#
		</td>     	
    </tr>
</script>
<script id="vendorCenter-note-tmpl" type="text/x-kendo-template">
	<tr>
		<td>			
			<blockquote>
				<small class="author">
					<span class="strong">#=creator#</span> :
					<cite>#=kendo.toString(new Date(noted_date), "g")#</cite>
				</small>					
				<p>#=note#</p>
			</blockquote>				
		</td>
	</tr>	
</script>

<script id="vendor" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons circle_info"><i></i> Vendor</h4>							        	
					    </div>
					    <div class="widget-body">

					    	<div class="row-fluid">
					    		<div class="span6 well">

									<div class="row-fluid">

										<div class="span6">														
											<!-- Group -->
											<div class="control-group">										
												<label for="ddlContactType">Vendor Type <span style="color:red">*</span></label>
												<input id="ddlContactType" name="ddlContactType"
													   data-role="dropdownlist"
													   data-option-label="(--- Select ---)"
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.contact_type_id,
									                   			  disabled: obj.is_pattern, 
									                              source: contactTypeDS,
									                              events:{change: contactTypeChanges}"
									                   required data-required-msg="required"
									                   style="width: 100%;" />									            
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">							
												<label for="number"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>
						              			<input id="number" name="number" class="k-textbox"
							              				data-bind="value: obj.number, disabled: obj.is_pattern" 
							              				placeholder="e.g. ID0001" required data-required-msg="required"
							              				style="width: 100%;" />
							              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
											</div>
											<!-- // Group END -->											
										</div>
									</div>
									
									<div class="row-fluid">
										<div class="span6">						
											<!-- Group -->
											<div class="control-group">
												<label for="surname"><span data-bind="text: lang.lang.surname"></span> <span style="color:red">*</span></label>
							              		<input id="surname" name="surname" class="k-textbox" data-bind="value: obj.surname, disabled: obj.is_pattern" 
									              		placeholder="surname ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">								
												<label for="name"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
									            <input id="name" name="name" class="k-textbox" data-bind="value: obj.name, disabled: obj.is_pattern" 
									              		placeholder="name ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>																		
											<!-- // Group END -->
										</div>
									</div>
									
									<div class="row-fluid">
										<div class="span6">
											<!-- Group -->
											<div class="control-group">
												<label for="companyName"><span data-bind="text: lang.lang.organization_name"></span> </label>
												<input id="companyName" name="companyName" class="k-textbox" data-bind="value: obj.company"									
														placeholder="e.g. PCG & Partner"
														style="width: 100%;" />	
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
												<label for="vatNo">Sale TAX Number</label>								
							            		<input id="vatNo" name="vatNo" class="k-textbox" data-bind="value: obj.vat_no" 
														placeholder="e.g. 01234567897"
														style="width: 100%;" />												
											</div>					
											<!-- // Group END -->
										</div>
									</div>

								</div>

								<div class="span6">
									<div class="row-fluid">	
										<!-- Map -->
										<div id="map" class="span12" style="height: 130px;"></div>
									</div>

									<div class="separator line bottom"></div>

									<div class="row-fluid">	
										<div class="span6">									
											<!-- Group -->
											<div class="control-group">
								    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
												<div class="input-prepend">
													<span class="add-on glyphicons direction"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>									
											<!-- // Group END -->
										</div>	
										
										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
								    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
								    			<div class="input-prepend">
													<span class="add-on glyphicons google_maps"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>										
											</div>
											<!-- // Group END -->
										</div>										
									</div>
								</div>
							</div>								
									
							<!-- // Inner Tabs -->
							<div class="row-fluid">								
								<div class="box-generic">
								    <!-- //Tabs Heading -->
								    <div class="tabsbar tabsbar-1">
								        <ul class="row-fluid row-merge">						            
								            <li class="span2 glyphicons usd active">
								            	<a href="#tab1" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.account"></span></a>
								            </li>
								            <li class="span2 glyphicons credit_card">
								            	<a href="#tab2" data-toggle="tab"><i></i> Payment</a>
								            </li>								            
								            <li class="span2 glyphicons nameplate_alt">
								            	<a href="#tab3" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.info"></span></a>
								            </li>								            
								            <li class="span2 glyphicons parents">
								            	<a href="#tab4" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.agents"></span></a>
								            </li>						            					            
								        </ul>
								    </div>
								    <!-- // Tabs Heading END -->

								    <div class="tab-content">
								        <!-- //ACCOUNTING INFO -->
								        <div class="tab-pane active" id="tab1">
								        	
								        	<div class="row-fluid">

								            	<div class="span3">													
													<!-- Group -->
													<div class="control-group">										
														<label for="ddlAP">Account Payable <span style="color:red">*</span></label>
														<input id="ddlAP" name="ddlAP"
															   data-role="dropdownlist"
															   data-option-label="(--- Select ---)"
											                   data-auto-bind="false"
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.contact_account_id,
											                              source: apDS"
											                   required data-required-msg="required"											                              
											                   style="width: 100%;" />									            
													</div>
													<!-- // Group END -->													
												</div>												
												<div class="span3">
													<!-- Group -->
													<div class="control-group">
														<label for="ddlDiscountAccount"><span data-bind="text: lang.lang.discount_account"></span> <span style="color:red">*</span></label>
														<input id="ddlDiscountAccount" name="ddlDiscountAccount"
																   data-role="dropdownlist"
																   data-option-label="(--- Select ---)"
												                   data-auto-bind="false"
												                   data-value-primitive="true"
												                   data-text-field="name"
												                   data-value-field="id"
												                   data-bind="value: obj.discount_account_id,
												                              source: discountDS"
												                   required data-required-msg="required"											                              
												                   style="width: 100%;" />
												    </div>
													<!-- // Group END -->	
												</div>
												<div class="span3">
													<!-- Group -->
													<div class="control-group">
														<label for="ddlPrePaymentAccount">Prepayment Account <span style="color:red">*</span></label>
														<input id="ddlPrePaymentAccount" name="ddlPrePaymentAccount"
																   data-role="dropdownlist"
																   data-option-label="(--- Select ---)"
												                   data-auto-bind="false"
												                   data-value-primitive="true"
												                   data-text-field="name"
												                   data-value-field="id"
												                   data-bind="value: obj.deposit_account_id,
												                              source: prepaymentDS"
												                   required data-required-msg="required"											                              
												                   style="width: 100%;" />
												    </div>
													<!-- // Group END -->	
												</div>

												<div class="span3">
													<!-- Group -->
													<div class="control-group">
														<label for="ddlTaxItem"><span data-bind="text: lang.lang.vat"></span> </label>
														<input id="ddlTaxItem" name="ddlTaxItem"
															data-bind="value: obj.tax_item_id" 
															style="width: 100%;" />
													</div>
												</div>
																																				
									        </div>								        										        

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">

									        	<div class="span3">
													<!-- Group -->
													<div class="control-group">
														<label for="currency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
											            <input id="currency" name="currency" 
											            	data-role="dropdownlist"
											            	data-value-primitive="true"
											                data-text-field="code"
											                data-value-field="id"
															data-bind="value: obj.currency_id, source: currencyDS"
															data-option-label="(--- Select ---)" 
															required data-required-msg="required" style="width: 100%;" />
													</div>	
													<!-- // Group END -->
												</div>

												<!-- Group -->
												<div class="span3">	
											        <div class="control-group">
														<label for="txtCreditLimit"><span data-bind="text: lang.lang.credit_limit"></span> </label>								              		
											            <input data-role="numerictextbox"
											                   data-format="n"
											                   data-min="0"										                   
											                   data-bind="value: obj.credit_limit"										                  
											                   style="width: 100%;">
													</div>
												</div>												

											</div>
							        	</div>
								        <!-- //ACCOUNTING INFO END -->

								        <!-- //PAYMENT INFO -->
								        <div class="tab-pane" id="tab2">
								        	
							            	<table class="table table-borderless table-condensed cart_total">						            	
							            		<tr>							            			
									                <td>Payment Method</td>
									              	<td>
									              		<input id="ddlPaymentMethod" name="ddlPaymentMethod"
															data-role="dropdownlist"
											            	data-value-primitive="true"
											                data-text-field="name"
											                data-value-field="id"
															data-bind="value: obj.payment_method_id, source: paymentMethodDS"
															data-option-label="(--- Select ---)" 
															style="width: 100%;" />
									              	</td>
									              	<td>Payment Term</td>
									              	<td>
									              		<input id="ddlPaymentTerm" name="ddlPaymentTerm"
															data-role="dropdownlist"
											            	data-value-primitive="true"
											                data-text-field="name"
											                data-value-field="id"
															data-bind="value: obj.payment_term_id, source: paymentTermDS" 
															data-option-label="(--- Select ---)"
															style="width: 100%;" />
									              	</td>									            	
									            </tr>
									            <tr>
									                <td>Bank Name</td>
									              	<td><input class="k-textbox" data-bind="value: obj.bank_name" placeholder="bank name ..." style="width: 100%;" /></td>							              	
									            	<td>Account Number</td>
									              	<td><input class="k-textbox" data-bind="value: obj.bank_account_number" placeholder="account number ..." style="width: 100%;" /></td>
									            </tr>									           							            
									            <tr>
									            	<td>Account Name</td>
									              	<td><input class="k-textbox" data-bind="value: obj.bank_account_name" placeholder="account name ..." style="width: 100%;" />							              	
									            	<td>Bank Address</td>
									              	<td><input class="k-textbox" data-bind="value: obj.bank_address" placeholder="bank address ..." style="width: 100%;" /></td>
									            </tr>
									            <tr>
									            	<td>Name On Check</td>
									            	<td><input class="k-textbox" data-bind="value: obj.name_on_cheque" placeholder="name on check ..." style="width: 100%;" /></td>
									            	<td></td>
									            	<td></td>
									            </tr>									            						            							            								            								            			            
									        </table>
							        	</div>
								        <!-- //PAYMENT INFO END -->

								        <!-- //GENERAL INFO -->
								        <div class="tab-pane" id="tab3">
							            	<table class="table table-borderless table-condensed cart_total">						            	
							            		<tr>
									                <td><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="customerStatus" name="customerStatus" 
									              				data-role="dropdownlist"
											            		data-text-field="name"
								           						data-value-field="id"
								           						data-value-primitive="true" 
											            		data-bind="source: statusList, value: obj.status"
											            		data-option-label="(--- Select ---)"
											            		required data-required-msg="ត្រូវការ ស្ថានភាព" />
									              	</td>							              	
									            	<td><span data-bind="text: lang.lang.register_date"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="registered_date" name="registered_date" 
										            		data-role="datepicker"			            		
							            					data-bind="value: obj.registered_date" 
							            					data-format="dd-MM-yyyy"
							            					data-parse-formats="yyyy-MM-dd" 
							            					placeholder="dd-MM-yyyy" required data-required-msg="required" />
									              	</td>
									            </tr>
									            <tr>
									                <td>Business Type</td>
									              	<td>
									              		<input data-role="dropdownlist"
											            		data-text-field="type"
								           						data-value-field="id"
								           						data-value-primitive="true" 
											            		data-bind="source: businessTypeDS, value: obj.business_type_id"
											            		data-option-label="(--- Select ---)" />
									              	</td>							              	
									            	<td>Is Local Business</td>
									              	<td>
									              		<input type="checkbox" data-bind="checked: obj.is_local" />
									              	</td>
									            </tr>
									            <tr>
									                <td><span data-bind="text: lang.lang.email"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.email" placeholder="e.g. me@email.com" /></td>							              	
									            	<td><span data-bind="text: lang.lang.phone"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.phone" placeholder="e.g. 012 333 444" /></td>
									            </tr>									           							            
									            <tr>
									            	<td><span data-bind="text: lang.lang.address"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.address" placeholder="where you live ..." />							              	
									            	<td><span data-bind="text: lang.lang.memo"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.memo" placeholder="memo ..." /></td>
									            </tr>
									            <tr>
									            	<td><label for="txtBillTo" data-bind="click: copyBillTo"><span data-bind="text: lang.lang.bill_to"></span> <i class="icon-share"></i></label></td>
									              	<td><input class="k-textbox" data-bind="value: obj.bill_to" placeholder="bill to ..." />							              	
									            	<td><span data-bind="text: lang.lang.ship_to"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.ship_to" placeholder="ship to ..." /></td>									              	
									            </tr>							            							            								            								            			            
									        </table>
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //CONTACT PERSON -->
								        <div class="tab-pane" id="tab4">
								        	<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyContactPerson"><i></i> <span data-bind="text: lang.lang.new_agent"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th><span data-bind="text: lang.lang.department"></span></th>						                
										                <th><span data-bind="text: lang.lang.phone"></span></th>
										                <th><span data-bind="text: lang.lang.email"></span></th>
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"										        						        		 
										        		data-template="vendor-contact-person-row-tmpl" 
										        		data-bind="source: contactPersonDS">
										        </tbody>										        						        
										    </table>
							        	</div>
								        <!-- //CONTACT PERSON END -->
								    </div>
								</div>
							</div>

							<br>											
							
							<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
							</div>
							<!-- // Form actions END -->

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="vendor-contact-person-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="name" name="name" 
					type="text" class="k-textbox" 
					data-bind="value: name"
					placeholder="eg: Mr. John" 
					required="required" validationMessage="required" style="width: 190px;" />
            <span data-for="name" class="k-invalid-msg"></span>
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: department" placeholder="eg: Accounting" style="width: 190px;" />
		</td>		
		<td>
			<input type="text" class="k-textbox" data-bind="value: phone" placeholder="eg: 012 333 444" style="width: 190px;" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: email" placeholder="eg: john@email.com" style="width: 190px;" />
		</td>		
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteContactPerson"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="po" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Purchase Order</h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.customer"></span></td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='po-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.number"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>
									<tr>
										<td>Segment</td>
										<td>
											<select data-role="multiselect" 
												   data-bind="source: segmentItemDS, value: obj.segments, events:{change: segmentChanges}"
												   data-value-primitive="true"
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="(--- Select ---)"
												   style="width: 100%" /></select>
										</td>
									</tr>								           
									<tr>
										<td colspan="2">
											<span data-bind="text: lang.lang.address"></span>
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width:100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> <span data-bind="text: lang.lang.paid"></span></span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.billing_date"></span></td>
										<td>
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.issued_date" 
													required data-required-msg="required" />
										</td>
									</tr>									
									<tr>
										<td>Expected Date</td>
										<td>
											<input id="dueDate" name="dueDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.due_date" 
													required data-required-msg="required" />
										</td>
									</tr>
									<tr>
										<td colspan="2">
											<span data-bind="text: lang.lang.ship_to"></span>
											<br>
											<textarea id="txtShipTo" cols="0" rows="2" class="k-textbox" style="width:100%;" data-bind="value: obj.ship_to"></textarea>
										</td>
									</tr>						            								
								</table>           		          	
						    </div>
						</div>								
						
						<!-- Item List -->
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center"><span data-bind="text: lang.lang.no"></span></th>
									<th class="center"><span data-bind="text: lang.lang.item"></span></th>								
									<th class="center"><span data-bind="text: lang.lang.description"></span></th>
									<th style="width: 230px;" class="center"><span data-bind="text: lang.lang.qty"></span></th>
									<th style="width: 120px;" class="center"><span data-bind="text: lang.lang.price"></span></th>
									<th style="width: 80px;" class="center"><span data-bind="text: lang.lang.amount"></span></th>
									<th style="width: 1%;" class="center"><span data-bind="text: lang.lang.tax"></span></th>
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="po-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						
						<br>
						
						<!-- Lower Part -->
						<div class="row-fluid">				
							<div class="span8">
								Memo:
								<br>
								<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo" placeholder="memo for customer"></textarea>
								<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo2" placeholder="memo for internal"></textarea>
							</div>

							<div class="span4">
								<table width="100%">								
									<tr align="right">
										<td>Sub Total:</td>
										<td width="50%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr align="right">
										<td align="top">
											<input data-role="dropdownlist"
												   data-option-label="(--- Tax ---)"								                   
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="source: vatDS, value: obj.vat_id, events: {change: changes}"
								                   style="width: 130px;" />																										
										</td>
										<td><span data-bind="text: vat"></span></td>
									</tr>
									<tr align="right">
										<td>Total:</td>
										<td><span data-bind="text: total"></span></td>
									</tr>						
								</table>
							</div>													
						</div>

						<br>

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i><span data-bind="text: lang.lang.print"></span></span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="po-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.po.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: unit, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: priceList, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>					
		<td>
			<input id="price" name="price" data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>		
		<td class="right">
			<span data-format="n" 
					data-culture=#:locale#
					data-bind="text: amount" 
					style="width: 100%;"></span> 						
		</td>
		<td>
			<input type="checkbox" data-bind="checked: has_vat, events: {change : changes}" />			
		</td>		
    </tr>   
</script>
<script id="po-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="grn" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Goods Receive Note</h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Customer</td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='grn-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td>Number</td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>															           
									<tr>
										<td colspan="2">
											Address
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width:100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> Paid</span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Date</td>
										<td>
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.issued_date" 
													required data-required-msg="required" />
										</td>
									</tr>																		
						            <tr>
						            	<td>
						            		<input data-role="dropdownlist"
								                   data-option-label="(-- Get ---)"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.reference_type,
								                              source: referenceTypes,
								                              events:{change: loadReference}"
								                   style="width: 100%" />						            						            		
						            	</td>				
										<td>
											<input data-role="dropdownlist"
													data-auto-bind="false"
						              				data-value-primitive="true"
													data-text-field="number" 
						              				data-value-field="id"						              				 
						              				data-bind="value: obj.reference_id,
						              							source: referenceDS,
						              							enabled: bolReference,						              							
						              							events:{change: referenceChange}" 
						              				data-option-label="(--- Select ---)" />
										</td>
									</tr>								
								</table>           		          	
						    </div>
						</div>								
						
						<!-- Item List -->
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center">No.</th>
									<th class="center">Item</th>								
									<th class="center">Description</th>
									<th style="width: 250px;" class="center">Qty</th>									
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="grn-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						
						<br>
						
						<!-- Lower Part -->
						<div class="row-fluid">				
							<div class="span8">
								Memo:
								<br>
								<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
								<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							</div>

							<div class="span4">
								<table width="100%">									
									<tr align="right">
										<td>Total:</td>
										<td><span data-bind="text: total"></span></td>
									</tr>						
								</table>
							</div>													
						</div>

						<br>

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> Print</span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="grn-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.grn.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: unit, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: priceList, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>				
    </tr>   
</script>
<script id="grn-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="purchase" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Purchase</h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>
								            <input type="radio" name="engine" id="engine1" class="k-radio" value="Purchase" data-bind="checked: obj.type, events:{change:radioChanges}">
								            <label class="k-radio-label" for="engine1">Cash</label>
								        </td>
								        <td> 
								            <input type="radio" name="engine" id="engine2" class="k-radio" value="Purchase_Credit" data-bind="checked: obj.type, events:{change:radioChanges}">
								            <label class="k-radio-label" for="engine2">Credit</label>									          
										</td>
									</tr>									
									<tr>
										<td>Vendor</td>
										<td>
											<input id="cbbContact" name="cbbContact" 
							    				   data-role="combobox"
								                   data-placeholder="vendor ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='purchase-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td>Number</td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>
									<tr>
										<td>Segment</td>
										<td>
											<select data-role="multiselect" 
												   data-bind="source: segmentItemDS, value: obj.segments, events:{change: segmentChanges}" 
												   data-value-primitive="true"
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="(--- Select ---)"
												   style="width: 100%" /></select>
										</td>
									</tr>								           
									<tr>
										<td colspan="2">
											Address
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width: 100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> Paid</span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Billing Date</td>
										<td>
											<input id="issuedDate" name="issuedDate" data-role="datepicker" 
													data-bind="value: obj.issued_date" data-format="dd-MM-yyyy" 
													required data-required-msg="required" />											
										</td>
									</tr>
									<tr data-bind="invisible: isCash">
										<td><span data-bind="text: lang.lang.due_date"></span></td>
										<td>
											<input id="dueDate" name="dueDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.due_date,
															   disabled: isCash" 
													required data-required-msg="required" />
										</td>
									</tr>									
									<tr data-bind="visible: isCash">
										<td>Payment Method</td>
										<td>
											<input id="paymentMethod" name="paymentMethod"
											   data-role="dropdownlist"
											   data-option-label="(--- Select ---)"							                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.payment_method_id,
							                   			  enabled: isCash, 
							                              source: paymentMethodDS"
							                   required data-required-msg="required" 
							                   style="width: 100%" />
										</td>
									</tr>	
									<tr data-bind="visible: isCash">
						                <td>Cheque</td>						              	
						              	<td><input class="k-textbox" data-bind="value: obj.check_no" style="width:100%;" /></td>
						            </tr>				
									<tr data-bind="visible: isCash">
										<td>Cash Account</td>
										<td>
											<input id="cashAccount" name="cashAccount"
											   data-role="dropdownlist"
											   data-option-label="(--- Select ---)"
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-template="purchase-cash-account-template"
							                   data-bind="value: obj.account_id,
							                   			  enabled: isCash,
							                              source: cashAccountDS"
							                   required data-required-msg="required" 
							                   style="width: 100%" />
										</td>
									</tr>																					
						            <tr>
						            	<td>
						            		<input data-role="dropdownlist"
								                   data-option-label="(-- Get ---)"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.reference_type,
								                              source: referenceTypes,
								                              events:{change: loadReference}"
								                   style="width: 100%" />						            						            		
						            	</td>				
										<td>
											<select data-role="dropdownlist"
													data-option-label="(--- Select ---)"
													data-auto-bind="false"
						              				data-value-primitive="true"
													data-text-field="number" 
						              				data-value-field="id"						              				 
						              				data-bind="value: obj.reference_id,
						              							source: referenceDS,
						              							enabled: bolReference,						              							
						              							events:{change: referenceChange}" 
						              				style="width: 100%" ></select>
										</td>
									</tr>								
								</table>           		          	
						    </div>
						</div>								
						
						<!-- Item List -->
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center">No.</th>
									<th class="center">Item</th>								
									<th class="center">Description</th>
									<th style="width: 230px;" class="center">Qty</th>
									<th style="width: 120px;" class="center">Price</th>
									<th style="width: 80px;" class="center">Amount</th>
									<th style="width: 1%;" class="center">Tax</th>
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="purchase-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						
						<br>
						
						<!-- Lower Part -->
						<div class="row-fluid">				
							<div class="span8">
								Memo:
								<br>
								<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
								<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							</div>

							<div class="span4">
								<table width="100%">								
									<tr align="right">
										<td>Sub Total:</td>
										<td width="50%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr align="right">
										<td align="top">
											<input data-role="dropdownlist"
												   data-option-label="(--- Tax ---)"								                   
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="source: vatDS, value: obj.vat_id, events: {change: changes}"
								                   style="width: 130px;" />																										
										</td>
										<td><span data-bind="text: vat"></span></td>
									</tr>
									<tr align="right">
										<td>Total:</td>
										<td><span data-bind="text: total"></span></td>
									</tr>						
								</table>
							</div>													
						</div>

						<br>

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> Print</span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="purchase-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.purchase.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: unit, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: priceList, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>					
		<td>
			<input id="price" name="price" data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>		
		<td class="right">
			<span data-format="n" 
					data-culture=#:locale#
					data-bind="text: amount" 
					style="width: 100%;"></span> 						
		</td>
		<td>
			<input type="checkbox" data-bind="checked: has_vat, events: {change : changes}" />			
		</td>		
    </tr>   
</script>
<script id="purchase-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>
<script id="purchase-cash-account-template" type="text/x-kendo-tmpl">		
	#=code# #=name#
</script>

<script id="vendorSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2>General Setting</h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons group" data-toggle="tab"><i></i><span class="strong">Vendor Type</span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons credit_card" data-toggle="tab"><i></i><span class="strong">Payment Method</span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong">Payment Term</span></a>
	            </li>	                       
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">

	            <!-- Tab Contact Type content -->
	            <div class="tab-pane active" id="tab1-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="Enter New Vendor Type here ..." data-bind="value: contactTypeName">
					    <button class="btn btn-default" type="button" data-bind="click: addContactType"><i class="icon-plus"></i> Add New</button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Type</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="vendorSetting-edit-contact-type-template"
				                data-template="vendorSetting-contact-type-template"
				                data-bind="source: contactTypeDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Contact Type content END -->

	            <!-- Tab Payment Method content -->
	            <div class="tab-pane" id="tab2-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="Enter new Payment Method here ..." data-bind="value: paymentMethodName">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentMethod"><i class="icon-plus"></i> Add New</button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Name</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="vendorSetting-edit-payment-method-template"
				                data-template="vendorSetting-payment-method-template"
				                data-bind="source: paymentMethodDS"></tbody>
	            	</table>			            
	            </div>
	            <!-- // Tab Payment Method content END -->

	            <!-- Tab Payment Term content -->
	            <div class="tab-pane" id="tab3-1">
            		<div class="input-append">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="New Payment Term ..." data-bind="value: paymentTermName">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="Net Due in ..." data-bind="value: paymentTermNetDue">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="Discount if paid within ..." data-bind="value: paymentTermDiscountPeriod">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="Discount % ..." data-bind="value: paymentTermDiscountPercentage">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentTerm"><i class="icon-plus"></i> Add New</button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Term</th>
	            				<th>Net Due(days)</th>	            				
	            				<th>Discount if paid within(days)</th>
	            				<th>Discount %</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="vendorSetting-edit-payment-term-template"
				                data-template="vendorSetting-payment-term-template"
				                data-bind="source: paymentTermDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Payment Term content END -->

	        </div>
	    </div>

	</div>
</script>
<script id="vendorSetting-contact-type-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#:name#
   		</td>
   		<td>   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#
		        <span class="k-button" data-bind="click: goPattern">Pattern</span>
		   	</div>		   	
   		</td>
   	</tr>
</script>
<script id="vendorSetting-edit-contact-type-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="vendorSetting-payment-method-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
		</td>
   	</tr>
</script>
<script id="vendorSetting-edit-payment-method-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="vendorSetting-payment-term-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
    		 #:net_due#
   		</td>
   		<td>
    		 #:discount_period#
   		</td>
   		<td>
    		 #:discount_percentage#
   		</td>
   		<td>
   			#if(is_system=="0"){#
	   			<div class="edit-buttons">       
			        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
			   	</div>
		   	#}#
   		</td>
   	</tr>
</script>
<script id="vendorSetting-edit-payment-term-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <table class="table table-borderless table-condensed cart_total">                
            <tr>
            	<td>Term:</td>
            	<td>
	                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
	                <span data-for="ProductName" class="k-invalid-msg"></span>
	            </td>
            </tr>
            <tr>
            	<td>Net Due In:</td>
            	<td>
	                <input type="text" class="k-textbox" data-bind="value:net_due" name="NetDue" required="required" validationMessage="required" />
	                <span data-for="term" class="k-invalid-msg"></span>
	            </td>
            </tr>
            <tr>
            	<td>Discount If Paid Within:</td>
            	<td>
	                <input type="text" class="k-textbox" data-bind="value:discount_period" />
	                <span data-for="percentage" class="k-invalid-msg"></span>
	            </td>
            </tr>
            <tr>
            	<td>Discount %</td>
            	<td>
	                <input type="text" class="k-textbox" data-bind="value:discount_percentage" />
	                <span data-for="percentage" class="k-invalid-msg"></span>
	            </td>
            </tr>               
        </table>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>


<!-- ***************************
 *	SME Section               *
**************************** -->
<script id="customerCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" style="height: 700px;">
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="Customer ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>
							<div class="select2-container" style="width: 100%;">								
																
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: contactDS.total"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid" 
						 data-bind="source: contactDS"
						 data-auto-bind="false" 
						 data-row-template="customerCenter-customer-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							            <li><span data-bind="text: lang.lang.filter_by"></span></li>
							            <li class="glyphicons stats active"><span data-toggle="tab" data-target="#tab1-7"><i></i></span>
							            </li>
							            <li class="glyphicons riflescope"><span data-toggle="tab" data-target="#tab2-7"><i></i></span>
							            </li>							            
							            <li class="glyphicons circle_info"><span data-toggle="tab" data-target="#tab3-7"><i></i></span>
							            </li>							            
							            <li class="glyphicons pen"><span data-toggle="tab" data-target="#tab4-7"><i></i></span>
							            </li>
							            <li class="glyphicons edit"><span data-bind="click: goEditContact"><i></i></span>
							            </li>
							            <li class="glyphicons user_add"><a href="#/customer"><i></i></a>
							            </li>
							            <li class="glyphicons circle_plus"><span data-toggle="tab" data-target="#tab7-7"><i></i></span>
							            </li>							            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- GRAPH Tab content -->
							            <div id="tab1-7" class="tab-pane active box-generic">
							            	<div id="sale-graph" style="height: 180px;"></div>
							            </div>
							            <!-- // GRAPH Tab content END -->

							            <!-- SEARCH Tab content -->
							            <div id="tab2-7" class="tab-pane box-generic">
							                <input data-role="dropdownlist"
							                	   data-auto-bind="false"
						            			   data-option-label="(--- Customer Type ---)"					            			   		                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: contact_type_id,
								                              source: contactTypeDS"
								                   style="width: 100%"/>

							                <input data-role="dropdownlist"
						            			   data-option-label="(--- Currency ---)"					            			   		                   
								                   data-value-primitive="true"
								                   data-text-field="code"
								                   data-value-field="id"
								                   data-bind="value: currency_id,
								                              source: currencyDS"
								                   style="width: 100%"/>

								            <br><br>
								            <span class="btn btn-primary btn-icon glyphicons search pull-right" data-bind="click: search"><i></i> <span data-bind="text: lang.lang.search"></span></span>
								            <br>
							            </div>
							            <!-- // SEARCH Tab content END -->							            

							            <!-- INFO Tab content -->
							            <div id="tab3-7" class="tab-pane box-generic">
							            	<div class="row-fluid">
								            	<div class="span6">
										
													<!-- Bio -->
													<div class="widget widget-heading-simple widget-body-gray margin-none">
														<div class="widget-head">
															<h4 class="heading glyphicons user"><i></i> <span data-bind="text: obj.wnumber"></span> <span data-bind="text: obj.fullname"></span></h4>
														</div>
														<div class="widget-body">
															<ul class="unstyled icons margin-none">
																<li class="glyphicons group"><i></i> <span data-bind="text: obj.contact_type"></span></li>
																<li class="glyphicons phone"><i></i> <span data-bind="text: obj.phone"></span></li>
																<li class="glyphicons envelope"><i></i> <span data-bind="text: obj.email"></li>
																<li class="glyphicons calendar"><i></i> <span data-bind="text: obj.registered_date"></li>
															</ul>
														</div>
													</div>
													<!-- // Bio END -->
													
												</div>
												<div class="span6">
													<!-- Bio -->
													<div class="widget widget-heading-simple widget-body-gray margin-none">
														<div class="widget-head">
															<h4 class="heading glyphicons edit" data-bind="click: goEditContact"><i></i> <span data-bind="text: lang.lang.edit"></span></h4>
														</div>
														<div class="widget-body">
															<p><i class="icon-home"></i> <span data-bind="text: obj.address"></span></p>
														</div>
													</div>
													<!-- // Bio END -->
												</div>
											</div>
							            </div>
							            <!-- // INFO Tab content END -->

							            <!-- NOTE Tab content -->
							            <div id="tab4-7" class="tab-pane box-generic">

										    <div class="chat-controls">															
												<form class="margin-none">
													<div class="row-fluid">
														<div class="span10">
															<input type="text" name="message" class="input-block-level margin-none" data-bind="value: note" placeholder="កំណត់Memo ...">
														</div>
														<div class="span2">
															<span class="btn btn-block btn-primary" data-bind="click: saveNote"><span data-bind="text: lang.lang.save"></span></span>
														</div>
													</div>
												</form>															
											</div>

											<br>

									    	<div data-role="grid"
									    	 	 data-height="100"
					 							 data-scrollable="{virtual: true}"									                 
								                 data-row-template="customerCenter-note-tmpl"
								                 data-bind="source: noteDS"
								                 data-columns="[{title: ''}]"></div>
											
							            </div>
							            <!-- // NOTE Tab content END -->

							            <!-- INVOICE Tab content -->
							            <div id="tab7-7" class="tab-pane box-generic">
							            	<table class="table table-borderless table-condensed cart_total">
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goEstimate"><span data-bind="text: lang.lang.estimate"></span></span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goInvoice">Invoice</span>
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goSO">Sale Order</span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goReceipt">Sale Receipt</span>								            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goGDN">GDN</span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goStatement">Statement</span>
								            		</td>
								            	</tr>
							            	</table>
							            </div>
							            <!-- // INVOICE Tab content END -->								            

							        </div>
							    </div>
							</div>
						</div>

						<div class="span6">
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons coins"><i></i></span>
										<span class="txt">Balance<span data-bind="text: balance" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-inverse widget-stats-5" data-bind="click: loadDeposit">
										<span class="glyphicons briefcase"><i></i></span>
										<span class="txt">Deposit<span data-bind="text: deposit" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons circle_exclamation_mark"><i></i></span>
										<span class="txt"><span data-bind="text: outInvoice"></span> Open</span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadOverInvoice">
										<span class="glyphicons turtle"><i></i></span>
										<span class="txt"><span data-bind="text: overInvoice"></span> Over Due</span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>											          	
		          	</div>
					
					<div>
						<input data-role="dropdownlist"                   
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					                      events: { change: dateChanges }"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      events: { change: dateChanges }"
					           placeholder="To ..." >
					    
					    <button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th>Date</th>
								<th>Type</th>								
								<th>Reference No</th>
								<th>Amount</th>
								<th>Status</th>
								<th>Action</th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="customerCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="customerCenter-customer-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				<span class="strong">
					#=number# #=fullname#				
				</span>
			</div>
		</td>
	</tr>
</script>
<script id="customerCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <td>
        	#if(type==="Invoice"){#								
				<a href="\#/invoice/#=id#"><i></i> #=number#</a>	
			#}else if(type==="Receipt"){#
        		<a href="\#/receipt/#=id#"><i></i> #=number#</a>        	        		
			#}else if(type==="SO"){#
        		<a href="\#/so/#=id#"><i></i> #=number#</a>
        	#}else if(type==="Estimate"){#        		
        		<a href="\#/estimate/#=id#"><i></i> #=number#</a>
        	#}else if(type==="GDN"){#        		
        		<a href="\#/gdn/#=id#"><i></i> #=number#</a>
        	#}else if(type==="Notice"){#
        		#=number#
        	#}else if(type==="Payment"){#

        	#}else if(type==="wInvoice"){#        		
        		<a href="\#/wInvoice_print/#=id#"><i></i> #=number#</a>
        	#}else if(type==="edeposit"){#        		
        		<a href="\#/eDeposit/#=id#"><i></i> #=number#</a>
        	#}else if(type==="wdeposit"){#        		
        		<a href="\#/wDeposit/#=id#"><i></i> #=number#</a>
        	#}else{#
        		#=number#
        	#}#
        </td>
    	<td class="right">#=kendo.toString(amount/rate, locale=="km-KH"?"c0":"c", locale)#</td>
    	<td>        	
        	#if(type==="Invoice" || type==="eInvoice" || type==="wInvoice"){#
        		#if(status==="0" || status==="2") {#
        			# var date = new Date(), dueDate = new Date(due_date).getTime(), toDay = new Date(date).getTime(); #
					#if(dueDate < toDay) {#
						Over Due #:Math.floor((toDay - dueDate)/(1000*60*60*24))# days
					#} else {#
						#:Math.floor((dueDate - toDay)/(1000*60*60*24))# days to pay
					#}#
				#} else {#
					Paid
				#}#
        	#}else if(type==="SO" || type==="GDN"){#
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Done        			
        		#}#
        	#}else if(type==="Estimate"){#        		
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Approved        			
        		#}#
        	#}#			
		</td>    	
    	<td align="center">
			#if(type==="Invoice"){#
				<a href="\#/invoice/#=id#"><i></i> Send</a>

				#if(status==="0" || status==="2"){#					
					| <a href="\#/cashier/#=id#"><i></i> Pay</a>
				#}#
			#}else if(type==="wInvoice"){#
        		#if(status==="0" || status==="2"){#
        			<a href="\#/cashier/#=id#"><i></i> Pay</a>
        		#}#
        	#}else if(type==="Notice"){#
        		#if(status==="0" || status==="2"){#
        			<a href="\#/cashier/#=id#"><i></i> Pay</a>
        		#}#
			#}else if(type==="SO"){#
        		#if(status==="0"){#
        			
        		#}#
        	#}else if(type==="Estimate"){#
        		<a href="\#/estimate/#=id#"><i></i> Send</a>        		
        		#if(status==="0"){#
        			
        		#}#
        	#}else if(type==="GDN"){#        		
        		#if(status==="0"){#
        			
        		#}#
        	#}#
		</td>     	
    </tr>
</script>
<script id="customerCenter-note-tmpl" type="text/x-kendo-template">
	<tr>
		<td>			
			<blockquote>
				<small class="author">
					<span class="strong">#=creator#</span> :
					<cite>#=kendo.toString(new Date(noted_date), "g")#</cite>
				</small>					
				<p>#=note#</p>
			</blockquote>				
		</td>
	</tr>	
</script>

<script id="customer" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons circle_info"><i></i> Customer</h4>							        	
					    </div>
					    <div class="widget-body">

					    	<div class="row-fluid">
					    		<div class="span6 well">									
									<div class="row-fluid">
										<div class="span6">														
											<!-- Group -->
											<div class="control-group">										
												<label for="ddlCustomerType"><span data-bind="text: lang.lang.customer_type"></span> <span style="color:red">*</span></label>
												<input id="ddlCustomerType" name="ddlCustomerType"
													data-bind="value: obj.contact_type_id" 
													required data-required-msg="required" style="width: 100%;" />									            
											</div>
											<!-- // Group END -->
										</div>

										<div class="span2">	
											<!-- Group -->
											<div class="control-group">							
												<label for="numberHead">អក្សរកូដ <span style="color:red">*</span></label>
						              			<input id="numberHead" name="numberHead" class="k-textbox"
							              				data-bind="value: obj.number_head" 
							              				placeholder="e.g. ID" required data-required-msg="required"
							              				style="width: 100%;" />
											</div>
											<!-- // Group END -->											
										</div>

										<div class="span4">	
											<!-- Group -->
											<div class="control-group">							
												<label for="number"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>
						              			<input id="number" name="number" class="k-textbox"
							              				data-bind="value: obj.number, events:{change: checkExistingNumber}" 
							              				placeholder="e.g. 0001" required data-required-msg="required"
							              				style="width: 75%;" />							              		
							              		<button type="button" data-role="button" data-bind="click: setNumber"><i class="icon-refresh"></i></button>
							              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
											</div>
											<!-- // Group END -->											
										</div>
									</div>
									
									<div class="row-fluid">
										<div class="span6">						
											<!-- Group -->
											<div class="control-group">
												<label for="surname"><span data-bind="text: lang.lang.surname"></span> <span style="color:red">*</span></label>
							              		<input id="surname" name="surname" class="k-textbox" data-bind="value: obj.surname" 
									              		placeholder="surname ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">								
												<label for="name"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
									            <input id="name" name="name" class="k-textbox" data-bind="value: obj.name" 
									              		placeholder="name ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>																		
											<!-- // Group END -->
										</div>
									</div>
									
									<div class="row-fluid" data-bind="visible: isCompany">
										<div class="span6">
											<!-- Group -->
											<div class="control-group">
												<label for="companyName"><span data-bind="text: lang.lang.organization_name"></span> <span style="color:red">*</span></label>
												<input id="companyName" name="companyName" class="k-textbox" data-bind="enabled: isCompany, value: obj.company"									
														placeholder="e.g. PCG & Partner"
														style="width: 100%;" />	
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
												<label for="vatNo">VAT Number</label>								
							            		<input id="vatNo" name="vatNo" class="k-textbox" data-bind="enabled: isCompany, value: obj.vat_no" 
														placeholder="e.g. 01234567897"
														style="width: 100%;" />												
											</div>					
											<!-- // Group END -->
										</div>
									</div>																
								</div>
								<div class="span6">
									<div class="row-fluid">	
										<!-- Map -->
										<div id="map" class="span12" style="height: 130px;"></div>
									</div>

									<div class="separator line bottom"></div>

									<div class="row-fluid">	
										<div class="span6">									
											<!-- Group -->
											<div class="control-group">
								    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
												<div class="input-prepend">
													<span class="add-on glyphicons direction"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>									
											<!-- // Group END -->
										</div>	
										
										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
								    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
								    			<div class="input-prepend">
													<span class="add-on glyphicons google_maps"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>										
											</div>
											<!-- // Group END -->
										</div>										
									</div>
								</div>
							</div>								
									
							<!-- // Inner Tabs -->
							<div class="row-fluid">								
								<div class="box-generic">
								    <!-- //Tabs Heading -->
								    <div class="tabsbar tabsbar-1">
								        <ul class="row-fluid row-merge">						            
								            <li class="span2 glyphicons usd active">
								            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.account"></span></span></a>
								            </li>								            
								            <li class="span2 glyphicons nameplate_alt">
								            	<a href="#tab2" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.info"></span></span></a>
								            </li>
								            <li class="span2 glyphicons parents">
								            	<a href="#tab3" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.agents"></span></span></a>
								            </li>						            					            
								        </ul>
								    </div>
								    <!-- // Tabs Heading END -->

								    <div class="tab-content">
								        <!-- //ACCOUNTING INFO -->
								        <div class="tab-pane active" id="tab1">
								        	
								        	<div class="row-fluid">								        		
								            	<div class="span3">
													<label for="ddlAR"><span data-bind="text: lang.lang.account_receiveable"></span> <span style="color:red">*</span></label>
													<input id="ddlAR" name="ddlAR"
														data-bind="value: obj.contact_account_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlRA"><span data-bind="text: lang.lang.revenue_account"></span> <span style="color:red">*</span></label>
													<input id="ddlRA" name="ddlRA"
														data-bind="value: obj.ra_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlDepositAccount"><span data-bind="text: lang.lang.deposit_account"></span> <span style="color:red">*</span></label>
													<input id="ddlDepositAccount" name="ddlDepositAccount"
														data-bind="value: obj.deposit_account_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlDiscountAccount"><span data-bind="text: lang.lang.discount_account"></span> <span style="color:red">*</span></label>
													<input id="ddlDiscountAccount" name="ddlDiscountAccount"
														data-bind="value: obj.discount_account_id" 
														required data-required-msg="required" style="width: 100%;" />	
												</div>												
									        </div>

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">
								        		<div class="span3">						
										            <label for="currency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
										            <input id="currency" name="currency" 
										            	data-role="dropdownlist"
										            	data-value-primitive="true"
										                data-text-field="code"
										                data-value-field="id"
														data-bind="value: obj.currency_id, source: currencyDS"
														data-option-label="(--- Select ---)" 
														required data-required-msg="required" style="width: 100%;" />
										        </div>
								            	<div class="span3">
													<label for="ddlPaymentTerm"><span data-bind="text: lang.lang.payment_term"></span></label>
													<input id="ddlPaymentTerm" name="ddlPaymentTerm"
														data-role="dropdownlist"
										            	data-value-primitive="true"
										                data-text-field="name"
										                data-value-field="id"
														data-bind="value: obj.payment_term_id, source: paymentTermDS" 
														data-option-label="(--- Select ---)"
														style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlPaymentMethod"><span data-bind="text: lang.lang.payment_method"></span></label>
													<input id="ddlPaymentMethod" name="ddlPaymentMethod"
														data-role="dropdownlist"
										            	data-value-primitive="true"
										                data-text-field="name"
										                data-value-field="id"
														data-bind="value: obj.payment_method_id, source: paymentMethodDS"
														data-option-label="(--- Select ---)" 
														style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlTaxItem"><span data-bind="text: lang.lang.vat"></span> </label>
													<input id="ddlTaxItem" name="ddlTaxItem"
														data-bind="value: obj.tax_item_id" 
														style="width: 100%;" />
												</div>												
									        </div>

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">	
										        <div class="span3">
													<label for="txtCreditLimit"><span data-bind="text: lang.lang.credit_limit"></span> </label>								              		
										            <input data-role="numerictextbox"
										                   data-format="n"
										                   data-min="0"										                   
										                   data-bind="value: obj.credit_limit"										                  
										                   style="width: 100%;">
												</div>																							
											</div>
							        	</div>
								        <!-- //ACCOUNTING INFO END -->								        							       

								        <!-- //GENERAL INFO -->
								        <div class="tab-pane" id="tab2">
							            	<table class="table table-borderless table-condensed cart_total">						            	
							            		<tr>
									                <td><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="customerStatus" name="customerStatus" 
									              				data-role="dropdownlist"
											            		data-text-field="name"
								           						data-value-field="id"
								           						data-value-primitive="true" 
											            		data-bind="source: statusList, value: obj.status"
											            		data-option-label="(--- Select ---)"
											            		required data-required-msg="ត្រូវការ ស្ថានភាព" />
									              	</td>							              	
									            	<td><span data-bind="text: lang.lang.register_date"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="registered_date" name="registered_date" 
										            		data-role="datepicker"			            		
							            					data-bind="value: obj.registered_date" 
							            					data-format="dd-MM-yyyy"
							            					data-parse-formats="yyyy-MM-dd" 
							            					placeholder="dd-MM-yyyy" required data-required-msg="required" />
									              	</td>
									            </tr>
									            <tr>
									                <td><span data-bind="text: lang.lang.gender"></span></td>
									              	<td><select data-role="dropdownlist" data-bind="source: genders, value: obj.gender"></select></td>							              	
									            	<td><span data-bind="text: lang.lang.phone"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.phone" placeholder="e.g. 012 333 444" /></td>
									            </tr>
									            <tr>
									            	<td><span data-bind="text: lang.lang.address"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.address" placeholder="where you live ..." />							              	
									            	<td><span data-bind="text: lang.lang.email"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.email" placeholder="e.g. me@email.com" />
									            </tr>									            
									            <tr>
									            	<td>
									            		<label for="txtBillTo" data-bind="click: copyBillTo"><span data-bind="text: lang.lang.bill_to"></span> <i class="icon-share"></i></label>											            
									            	</td>
									            	<td>
									            		<input class="k-textbox" data-bind="value: obj.bill_to" placeholder="bill to ..." />
									            	</td>
									            	<td>
									            		<span data-bind="text: lang.lang.ship_to"></span>										            
									            	</td>
									            	<td>
									            		<input class="k-textbox" data-bind="value: obj.ship_to" placeholder="ship to ..." />
									            	</td>
									            </tr>
									            <tr>									            								              	
									            	<td><span data-bind="text: lang.lang.memo"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.memo" placeholder="memo ..." /></td>
									              	<td></td>
									              	<td></td>
									            </tr>							            							            								            								            			            
									        </table>
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //CONTACT PERSON -->
								        <div class="tab-pane" id="tab3">
								        	<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyContactPerson"><i></i> <span data-bind="text: lang.lang.new_agent"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th><span data-bind="text: lang.lang.department"></span></th>						                
										                <th><span data-bind="text: lang.lang.phone"></span></th>
										                <th><span data-bind="text: lang.lang.email"></span></th>
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"										        						        		 
										        		data-template="contact-person-row-tmpl" 
										        		data-bind="source: contactPersonDS">
										        </tbody>										        						        
										    </table>
							        	</div>
								        <!-- //CONTACT PERSON END -->
								    </div>
								</div>
							</div>

							<br>											
							
							<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
							</div>
							<!-- // Form actions END -->

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="contact-person-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="name" name="name" 
					type="text" class="k-textbox" 
					data-bind="value: name"
					placeholder="eg: Mr. John" 
					required="required" validationMessage="required" style="width: 190px;" />
            <span data-for="name" class="k-invalid-msg"></span>
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: department" placeholder="eg: Accounting" style="width: 190px;" />
		</td>		
		<td>
			<input type="text" class="k-textbox" data-bind="value: phone" placeholder="eg: 012 333 444" style="width: 190px;" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: email" placeholder="eg: john@email.com" style="width: 190px;" />
		</td>		
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteContactPerson"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="invoice" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i><span data-bind="text: lang.lang.invoice"></span></h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.customer"></span></td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='invoice-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.number"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>
									<tr>
										<td>Segment</td>
										<td>
											<select data-role="multiselect" 
												   data-bind="source: segmentItemDS, value: obj.segments, events:{change: segmentChanges}"
												   data-value-primitive="true"
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="(--- Select ---)"
												   style="width: 100%" /></select>
										</td>
									</tr>								           
									<tr>
										<td colspan="2">
											<span data-bind="text: lang.lang.address"></span>
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width:100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> <span data-bind="text: lang.lang.paid"></span></span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.billing_date"></span></td>
										<td>
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.issued_date" 
													required data-required-msg="required" />
										</td>
									</tr>	
									<tr>
						                <td><span data-bind="text: lang.lang.payment_term"></span></td>
						              	<td>
						              		<input data-role="dropdownlist"
						              		   data-option-label="(--- Select ---)"							                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.payment_term_id,
							                              source: paymentTermDS"
							                   style="width: 100%;" />						              		
						              	</td>
						            </tr>				
									<tr>
										<td><span data-bind="text: lang.lang.due_date"></span></td>
										<td>
											<input id="dueDate" name="dueDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.due_date" 
													required data-required-msg="required" />
										</td>
									</tr>													
						            <tr>
						            	<td>
						            		<input data-role="dropdownlist"
								                   data-option-label="(-- Get ---)"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.reference_type,
								                              source: referenceTypes,
								                              events:{change: loadReference}"
								                   style="width: 100%" />						            						            		
						            	</td>				
										<td>
											<input data-role="dropdownlist"
													data-auto-bind="false"
						              				data-value-primitive="true"
													data-text-field="number" 
						              				data-value-field="id"						              				 
						              				data-bind="value: obj.reference_id,
						              							source: referenceDS,
						              							enabled: bolReference,						              							
						              							events:{change: referenceChange}" 
						              				data-option-label="(--- Select ---)" />
										</td>
									</tr>								
								</table>           		          	
						    </div>
						</div>								
						
						<!-- Item List -->
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center"><span data-bind="text: lang.lang.no"></span></th>
									<th class="center"><span data-bind="text: lang.lang.item"></span></th>								
									<th class="center"><span data-bind="text: lang.lang.description"></span></th>
									<th style="width: 230px;" class="center"><span data-bind="text: lang.lang.qty"></span></th>
									<th style="width: 120px;" class="center"><span data-bind="text: lang.lang.price"></span></th>
									<th style="width: 80px;" class="center"><span data-bind="text: lang.lang.amount"></span></th>
									<th style="width: 1%;" class="center"><span data-bind="text: lang.lang.tax"></span></th>
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="invoice-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						
						<br>
						
						<!-- Lower Part -->
						<div class="row-fluid">				
							<div class="span8">
								Memo:
								<br>
								<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo" placeholder="memo for customer"></textarea>
								<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo2" placeholder="memo for internal"></textarea>
							</div>

							<div class="span4">
								<table width="100%">								
									<tr align="right">
										<td>Sub Total:</td>
										<td width="50%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr align="right">
										<td align="top">
											<input data-role="dropdownlist"
												   data-option-label="(--- Tax ---)"								                   
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="source: vatDS, value: obj.vat_id, events: {change: changes}"
								                   style="width: 130px;" />																										
										</td>
										<td><span data-bind="text: vat"></span></td>
									</tr>
									<tr align="right">
										<td>Total:</td>
										<td><span data-bind="text: total"></span></td>
									</tr>						
								</table>
							</div>													
						</div>

						<br>

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i><span data-bind="text: lang.lang.print"></span></span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="invoice-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.invoice.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: unit, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: priceList, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>					
		<td>
			<input id="price" name="price" data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>		
		<td class="right">
			<span data-format="n" 
					data-culture=#:locale#
					data-bind="text: amount" 
					style="width: 100%;"></span> 						
		</td>
		<td>
			<input type="checkbox" data-bind="checked: has_vat, events: {change : changes}" />			
		</td>		
    </tr>   
</script>
<script id="invoice-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="receipt" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Sale Receipt</h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Customer</td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='receipt-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td>Number</td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>
									<tr>
										<td>Segment</td>
										<td>
											<select data-role="multiselect" 
												   data-bind="source: segmentItemDS, value: obj.segments, events:{change: segmentChanges}" 
												   data-value-primitive="true"
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="(--- Select ---)"
												   style="width: 100%" /></select>
										</td>
									</tr>								           
									<tr>
										<td colspan="2">
											Address
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width: 100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> Paid</span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Date</td>
										<td>
											<input id="issuedDate" name="issuedDate" data-role="datepicker" 
													data-bind="value: obj.issued_date" data-format="dd-MM-yyyy" 
													required data-required-msg="required" />											
										</td>
									</tr>
									<tr>
										<td>Payment Method</td>
										<td>
											<input id="paymentMethod" name="paymentMethod"
											   data-role="dropdownlist"
											   data-option-label="(--- Select ---)"							                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.payment_method_id,
							                              source: paymentMethodDS"
							                   required data-required-msg="required" 
							                   style="width: 100%" />
										</td>
									</tr>	
									<tr>
						                <td>Cheque</td>						              	
						              	<td><input class="k-textbox" data-bind="value: obj.check_no" style="width:100%;" /></td>
						            </tr>				
									<tr>
										<td>Cash Account</td>
										<td>
											<input id="cashAccount" name="cashAccount"
											   data-role="dropdownlist"
											   data-option-label="(--- Select ---)"
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-template="receipt-cash-account-template"
							                   data-bind="value: obj.account_id,
							                              source: cashAccountDS"
							                   required data-required-msg="required" 
							                   style="width: 100%" />
										</td>
									</tr>													
						            <tr>
						            	<td>
						            		<input data-role="dropdownlist"
								                   data-option-label="(-- Get ---)"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.reference_type,
								                              source: referenceTypes,
								                              events:{change: loadReference}"
								                   style="width: 100%" />						            						            		
						            	</td>				
										<td>
											<select data-role="dropdownlist"
													data-option-label="(--- Select ---)"
													data-auto-bind="false"
						              				data-value-primitive="true"
													data-text-field="number" 
						              				data-value-field="id"						              				 
						              				data-bind="value: obj.reference_id,
						              							source: referenceDS,
						              							enabled: bolReference,						              							
						              							events:{change: referenceChange}" 
						              				style="width: 100%" ></select>
										</td>
									</tr>								
								</table>           		          	
						    </div>
						</div>								
						
						<!-- Item List -->
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center">No.</th>
									<th class="center">Item</th>								
									<th class="center">Description</th>
									<th style="width: 230px;" class="center">Qty</th>
									<th style="width: 120px;" class="center">Price</th>
									<th style="width: 80px;" class="center">Amount</th>
									<th style="width: 1%;" class="center">Tax</th>
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="receipt-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						
						<br>
						
						<!-- Lower Part -->
						<div class="row-fluid">				
							<div class="span8">
								Memo:
								<br>
								<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
								<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							</div>

							<div class="span4">
								<table width="100%">								
									<tr align="right">
										<td>Sub Total:</td>
										<td width="50%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr align="right">
										<td align="top">
											<input data-role="dropdownlist"
												   data-option-label="(--- Tax ---)"								                   
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="source: vatDS, value: obj.vat_id, events: {change: changes}"
								                   style="width: 130px;" />																										
										</td>
										<td><span data-bind="text: vat"></span></td>
									</tr>
									<tr align="right">
										<td>Total:</td>
										<td><span data-bind="text: total"></span></td>
									</tr>						
								</table>
							</div>													
						</div>

						<br>

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> Print</span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="receipt-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.receipt.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: unit, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: priceList, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>					
		<td>
			<input id="price" name="price" data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>		
		<td class="right">
			<span data-format="n" 
					data-culture=#:locale#
					data-bind="text: amount" 
					style="width: 100%;"></span> 						
		</td>
		<td>
			<input type="checkbox" data-bind="checked: has_vat, events: {change : changes}" />			
		</td>		
    </tr>   
</script>
<script id="receipt-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>
<script id="receipt-cash-account-template" type="text/x-kendo-tmpl">		
	#=code# #=name#
</script>

<script id="estimate" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Estimate</h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Customer</td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='estimate-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>
									<tr data-bind="visible: isEdit">				
										<td>Number</td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>
									<tr>
										<td>Segment</td>
										<td>
											<select data-role="multiselect" 
												   data-bind="source: segmentItemDS, value: obj.segments, events:{change: segmentChanges}"
												   data-value-primitive="true"
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="(--- Select ---)"
												   style="width: 100%" /></select>
										</td>
									</tr>																           
									<tr>
										<td colspan="2">
											Address
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width:100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> Paid</span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Date</td>
										<td>
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.issued_date" 
													required data-required-msg="required" />
										</td>
									</tr>						            								
								</table>           		          	
						    </div>
						</div>								
						
						<!-- Item List -->
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center">No.</th>
									<th class="center">Item</th>								
									<th class="center">Description</th>
									<th style="width: 230px;" class="center">Qty</th>
									<th style="width: 120px;" class="center">Price</th>
									<th style="width: 80px;" class="center">Amount</th>
									<th style="width: 1%;" class="center">Tax</th>
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="estimate-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						
						<br>
						
						<!-- Lower Part -->
						<div class="row-fluid">				
							<div class="span8">
								Memo:
								<br>
								<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
								<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							</div>

							<div class="span4">
								<table width="100%">								
									<tr align="right">
										<td>Sub Total:</td>
										<td width="50%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr align="right">
										<td align="top">
											<input data-role="dropdownlist"
												   data-option-label="(--- Tax ---)"								                   
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="source: vatDS, value: obj.vat_id, events: {change: changes}"
								                   style="width: 130px;" />																										
										</td>
										<td><span data-bind="text: vat"></span></td>
									</tr>
									<tr align="right">
										<td>Total:</td>
										<td><span data-bind="text: total"></span></td>
									</tr>						
								</table>
							</div>													
						</div>

						<br>

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> Print</span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="estimate-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.estimate.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: unit, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: priceList, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>					
		<td>
			<input id="price" name="price" data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>		
		<td class="right">
			<span data-format="n" 
					data-culture=#:locale#
					data-bind="text: amount" 
					style="width: 100%;"></span> 						
		</td>
		<td>
			<input type="checkbox" data-bind="checked: has_vat, events: {change : changes}" />			
		</td>		
    </tr>   
</script>
<script id="estimate-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="so" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Sale Order</h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Customer</td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='so-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td>Number</td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>
									<tr>
										<td>Segment</td>
										<td>
											<select data-role="multiselect" 
												   data-bind="source: segmentItemDS, value: obj.segments, events:{change: segmentChanges}" 
												   data-value-primitive="true"
												   data-value-field="id" 
												   data-text-field="name"
												   data-placeholder="(--- Select ---)"
												   style="width: 100%" /></select>
										</td>
									</tr>								           
									<tr>
										<td colspan="2">
											Address
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width:100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> ទូទាត់រួច</span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Date</td>
										<td>
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.issued_date" 
													required data-required-msg="required" />
										</td>
									</tr>												
									<tr>
										<td>Expected Date</td>
										<td>
											<input id="dueDate" name="dueDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.due_date" 
													required data-required-msg="required" />
										</td>
									</tr>													
						            <tr>
						            	<td>
						            		<input data-role="dropdownlist"
								                   data-option-label="(-- Get ---)"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.reference_type,
								                              source: referenceTypes,
								                              events:{change: loadReference}"
								                   style="width: 100%" />						            						            		
						            	</td>				
										<td>
											<input data-role="dropdownlist"
													data-option-label="(--- Select ---)"
													data-auto-bind="false"
						              				data-value-primitive="true"
													data-text-field="number" 
						              				data-value-field="id"						              				 
						              				data-bind="value: obj.reference_id,
						              							source: referenceDS,
						              							enabled: bolReference,						              							
						              							events:{change: referenceChange}" />
										</td>
									</tr>								
								</table>           		          	
						    </div>
						</div>								
						
						<!-- Item List -->
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center">No.</th>
									<th class="center">Item</th>								
									<th class="center">Description</th>
									<th style="width: 230px;" class="center">Qty</th>
									<th style="width: 120px;" class="center">Price</th>
									<th style="width: 80px;" class="center">Amount</th>
									<th style="width: 1%;" class="center">Tax</th>
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="so-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						
						<br>
						
						<!-- Lower Part -->
						<div class="row-fluid">				
							<div class="span8">
								Memo:
								<br>
								<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
								<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							</div>

							<div class="span4">
								<table width="100%">								
									<tr align="right">
										<td>Sub Total:</td>
										<td width="50%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr align="right">
										<td align="top">
											<input data-role="dropdownlist"
												   data-option-label="(--- Tax ---)"								                   
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="source: vatDS, value: obj.vat_id, events: {change: changes}"
								                   style="width: 130px;" />																										
										</td>
										<td><span data-bind="text: vat"></span></td>
									</tr>
									<tr align="right">
										<td>Total:</td>
										<td><span data-bind="text: total"></span></td>
									</tr>						
								</table>
							</div>													
						</div>

						<br>

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> Print</span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="so-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.so.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: unit, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: priceList, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>					
		<td>
			<input id="price" name="price" data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>		
		<td class="right">
			<span data-format="n" 
					data-culture=#:locale#
					data-bind="text: amount" 
					style="width: 100%;"></span> 						
		</td>
		<td>
			<input type="checkbox" data-bind="checked: has_vat, events: {change : changes}" />			
		</td>		
    </tr>   
</script>
<script id="so-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="gdn" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Goods Delivery Note</h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Customer</td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='gdn-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td>Number</td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>															           
									<tr>
										<td colspan="2">
											Address
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width:100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> Paid</span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td>Date</td>
										<td>
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy" 
													data-bind="value: obj.issued_date" 
													required data-required-msg="required" />
										</td>
									</tr>																		
						            <tr>
						            	<td>
						            		<input data-role="dropdownlist"
								                   data-option-label="(-- Get ---)"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.reference_type,
								                              source: referenceTypes,
								                              events:{change: loadReference}"
								                   style="width: 100%" />						            						            		
						            	</td>				
										<td>
											<input data-role="dropdownlist"
													data-auto-bind="false"
						              				data-value-primitive="true"
													data-text-field="number" 
						              				data-value-field="id"						              				 
						              				data-bind="value: obj.reference_id,
						              							source: referenceDS,
						              							enabled: bolReference,						              							
						              							events:{change: referenceChange}" 
						              				data-option-label="(--- Select ---)" />
										</td>
									</tr>								
								</table>           		          	
						    </div>
						</div>								
						
						<!-- Item List -->
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center">No.</th>
									<th class="center">Item</th>								
									<th class="center">Description</th>
									<th style="width: 250px;" class="center">Qty</th>									
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="gdn-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						
						<br>
						
						<!-- Lower Part -->
						<div class="row-fluid">				
							<div class="span8">
								Memo:
								<br>
								<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
								<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:250px" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							</div>

							<div class="span4">
								<table width="100%">									
									<tr align="right">
										<td>Total:</td>
										<td><span data-bind="text: total"></span></td>
									</tr>						
								</table>
							</div>													
						</div>

						<br>

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> Print</span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="gdn-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.gdn.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: unit, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: priceList, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>				
    </tr>   
</script>
<script id="gdn-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="statement" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head hidden-print">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>Statement</h4>							        	
				    </div>
				    <div class="widget-body">					
					
						<div class="hidden-print">
					    	<input id="sorter" name="sorter"
					    	   data-role="dropdownlist"                   
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList" />
					                                   
					        <input id="sdate" name="sdate"						           
					           data-bind="value: sdate"
					           placeholder="From ..." />
					        
					       	<input id="edate" name="edate"						           
					           data-bind="value: edate"
					           placeholder="To ..." />						        	                    	            	
					  		
					  		<button id="search" type="button" data-role="button"><i class="icon-search"></i></button>
					  		|
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>					    	
					    </div>

					    <br>					    

					    <div align="center">
							<h3>Statement</h3>
							
							<span id="strDate"></span>														
						</div>

						<div class="well">
							<table class="table table-invoice">
								<tbody>
									<tr>
										<td style="width: 50%;">											
											<h2 data-bind="text: company.name"></h2>
											<address class="margin-none">												
												<p data-bind="text: company.address"></p>												
												<abbr>Email:</abbr> <span data-bind="text: company.email"></span> <br> 
												<abbr>Phone:</abbr> <span data-bind="text: company.mobile"></span> <br>
												<abbr>Tel:</abbr> <span data-bind="text: company.phone"></span>
											</address>
										</td>
										<td class="right">											
											<h2 data-bind="text: obj.fullname"></h2>
											<address class="margin-none">
												<p data-bind="text: obj.bill_to"></p>
												<abbr>Email:</abbr> <span data-bind="text: obj.email"></span> <br> 
												<abbr>Phone:</abbr> <span data-bind="text: obj.phone"></span>												
											</address>
											<br>
											<div style="font-size: x-large;">Total: <span data-bind="text: total"></span></div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>

						<br>			        
					    
					    <div id="gridAging"></div>

					    <br>

					    <table id="grid">			                
			                <thead>
			                    <tr>
			                        <th>Date</th>
			                        <th>Description</th>
			                        <th>Amount</th>			                        
			                    </tr>
			                </thead>
			                <tbody></tbody>
			            </table>	
						
					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="statement-row-template" type="text/x-kendo-template">	
	<tr data-uid="#: uid #">
		<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
		<td>#=description#</td>
		<td align="right">#=kendo.toString(amount, "c", locale)#</td>		
	</tr>
</script>

<script id="customerSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2>General Setting</h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons group" data-toggle="tab"><i></i><span class="strong">Customer Type</span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons credit_card" data-toggle="tab"><i></i><span class="strong">Payment Method</span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong">Payment Term</span></a>
	            </li>	                        
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">

	            <!-- Tab Branch content -->
	            <div class="tab-pane active" id="tab1-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="type name ..." data-bind="value: contactTypeName">
					    <button class="btn btn-default" type="button" data-bind="click: addContactType"><i class="icon-plus"></i></button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Type</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="customerSetting-edit-contact-type-template"
				                data-template="customerSetting-contact-type-template"
				                data-bind="source: contactTypeDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Branch content END -->

	            <!-- Tab Contact Type content -->
	            <div class="tab-pane" id="tab2-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentMethodName">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentMethod"><i class="icon-plus"></i></button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Name</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-payment-method-template"
				                data-template="customerSetting-payment-method-template"
				                data-bind="source: paymentMethodDS"></tbody>
	            	</table>			            
	            </div>
	            <!-- // Tab Contact Type content END -->

	            <!-- Tab Block content -->
	            <div class="tab-pane" id="tab3-1">
            		<div class="input-append">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentTermName">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="term ..." data-bind="value: paymentTerm">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="% ..." data-bind="value: paymentTermPercentage">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentTerm"><i class="icon-plus"></i></button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Name</th>
	            				<th>Term</th>
	            				<th>%</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-payment-term-template"
				                data-template="customerSetting-payment-term-template"
				                data-bind="source: paymentTermDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Block content END -->

	        </div>
	    </div>

	</div>
</script>
<script id="customerSetting-contact-type-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			#if(is_system=="0"){#
	   			<div class="edit-buttons">       
			        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
			   	</div>
		   	#}#
   		</td>
   	</tr>
</script>
<script id="customerSetting-edit-contact-type-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="customerSetting-payment-method-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
		</td>
   	</tr>
</script>
<script id="customerSetting-edit-payment-method-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="customerSetting-payment-term-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
    		 #:term#
   		</td>
   		<td>
    		 #:discount_percentage#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
		</td>
   	</tr>
</script>
<script id="customerSetting-edit-payment-term-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:net_due" name="term" required="required" validationMessage="required" />
                <span data-for="term" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:discount_percentage" name="percentage" required="required" validationMessage="required" />
                <span data-for="percentage" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>

<script id="customerList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input data-role="dropdownlist"
							   data-option-label="(--- TYPE ---)"
			                   data-auto-bind="false"
			                   data-value-primitive="true"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: contact_type_id,
			                              source: contactTypeDS" />

							<button id="search" type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>		
						</div>

						<h3 align="center"><span data-bind="text: lang.lang.customer_list"></span></h3>
				
						<div id="grid"></div>					
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>

<script id="customerReportCenter" type="text/x-kendo-template">
	<h2>Report</h2>
	<br>

	<div class="row-fluid">
		<div class="span3">
			<h4>Customer Information</h4>
			<div class="well margin-none" style="height: 150px;">
				Description here...
				<ul>
					<li><a href='#/customer_list'>Customer List</a></li>
	  				<li><a href='#/wBrand_new_customer'>Brand New Customer</a></li>	  				
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4>Accounting</h4>
			<div class="well margin-none" style="height: 150px;">
				Description here...
				<ul>
					<li><a href='#/wCustomer_balance'>Custoemr Balance</a></li>	  				 				  				
	  				<br>  
	  				<li><a href='#/wAging_summary'>Aging Summary</a></li> 
	  				<li><a href='#/wAging_detail'>Aging Detail</a></li>
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4>Sale</h4>
			<div class="well margin-none" style="height: 150px;">
				Description here...
				<ul>
					<li><a href='#/wSale_summary'>Sale Summary</a></li>
	  				<li><a href='#/wSale_detail'>Sale Detail</a></li>	  				
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4>Payment</h4>
			<div class="well margin-none" style="height: 150px;">
				Description here...
				<ul>
					<li><a href='#/wPayment_summary'>Payment Summary</a></li> 
  					<li><a href='#/wPayment_detail'>Payment Detail</a></li>
  					<br>  
	  				<li><a href='#/wPayment_by_source_summary'>Payment By Source Summary</a></li>
	  				<li><a href='#/wPayment_by_source_detail'>Payment By Source Detail</a></li> 
				</ul>
			</div>
		</div>
	</div>

	<p class="separator text-center"><i class="icon-ellipsis-horizontal icon-3x"></i></p>
</script>


<!-- ***************************
 *	Cashier Section      	  *
**************************** -->
<script id="cashier" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">				
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3><span data-bind="text: lang.lang.cashier"></span></h3>

					<div class="row-fluid">
						<div class="span3">
							<br>

							<input id="ddlContact" data-bind="value: customer_id" style="width: 100%"  />

							<br><br>							
					      					
							<h5><i class="icon-info-sign"></i> <span data-bind="text: lang.lang.customer_info"></span></h5>				
							<table width="100%" style="background-color:Silver; color:black;">
								<tr>
									<td colspan="2">
										<i class="icon-user icon-li icon-fixed-width"></i> 
										<span data-bind="text: customer.fullIdName"></span>										
									</td>																			
								</tr>
								<tr>
									<td colspan="2">								
										<span data-bind="text: lang.lang.balance"></span>: <span data-bind="text: customer.balance"></span>
										<span data-bind="text: customer.currency[0].code">
									</td>
								</tr>
								<tr>
									<td colspan="2">
										<span data-bind="text: lang.lang.deposit"></span>: <span data-bind="text: customer.deposit"></span>
										<span data-bind="text: customer.currency[0].code">
									</td>							
								</tr>
								<tr>
									<td>
										<i class="icon-money icon-li icon-fixed-width"></i> <span data-bind="text: customer.currency[0].code"></span>
									</td>
									<td>
										<i class="icon-phone icon-li icon-fixed-width"></i> <span data-bind="text: customer.phone"></span>
									</td>
								</tr>											
								<tr>
									<td colspan="2">
										<i class="icon-home icon-li icon-fixed-width"></i> <span data-bind="text: customer.address"></span>
									</td>						
								</tr>
							</table>

							<br>			
							
							<h5><i class="icon-list"></i> <span data-bind="text: lang.lang.activities"></span></h5>

							<table class="table table-bordered table-striped table-white">
						        <thead>
						            <tr>
						            	<th><span data-bind="text: lang.lang.date"></span></th>						                
						                <th><span data-bind="text: lang.lang.type"></span></th>						                
						                <th><span data-bind="text: lang.lang.amount"></span></th>						                						                
						            </tr>
						        </thead>
						        <tbody data-role="listview"
						        		data-auto-bind="false"					        		 
						        		data-template="cashier-transaction-row-template" 
						        		data-bind="source: transactionDS"></tbody>						        					        
						    </table>
							
							<div id="pager" class="k-pager-wrap"					    		
				             	data-role="pager"
				             	data-auto-bind="false" 
				             	data-bind="source: transactionDS"></div>
						
						</div> <!-- //End span3 -->

						<div id="exampleValidator" class="span9">
							<div class="row-fluid">
								<div class="span4">
									<div class="innerAll padding-bottom-none-phone">
										<a href="javascript:void(0)" class="widget-stats widget-stats-gray widget-stats-4"> 
											<span class="txt"><span data-bind="text: lang.lang.customer"></span></span>
											<span class="count" data-bind="text: total_customer"></span>
											<span class="glyphicons user"><i></i></span>
											<div class="clearfix"></div>
											<i class="icon-play-circle"></i> 
										</a>
									</div>
								</div>

								<div class="span4">
									<div class="innerAll padding-bottom-none-phone">
										<a href="#/wPayment_summary" class="widget-stats widget-stats-primary widget-stats-4">
											<span class="txt"><span data-bind="text: lang.lang.today_payment"></span></span>
											<span class="count"><span data-bind="text: total_payment" style="font-size: 35px;"></span></span>
											<span class="glyphicons coins"><i></i></span>
											<div class="clearfix"></div>
											<i class="icon-play-circle"></i>
										</a>
									</div>
								</div>

								<div class="span4">
									<div class="innerAll padding-bottom-none-phone">
										<a href="#/reconcile" class="widget-stats widget-stats-inverse widget-stats-5">
											<span class="glyphicons refresh"><i></i></span>
											<span class="txt"><span data-bind="text: lang.lang.reconcile"></span> &<br><br> <span data-bind="text: lang.lang.transfer"></span></span>
											<div class="clearfix"></div>
										</a>
									</div>
								</div>				

							</div> <!-- //End row-fluid -->
														
							<br>

							<table class="table table-bordered table-striped table-white">
						        <thead>
						            <tr>
						                <th></th>
						                <th><span data-bind="text: lang.lang.no"></span></th>						                
						                <th><span data-bind="text: lang.lang.date"></span></th>
						                <th><span data-bind="text: lang.lang.name"></span></th>
						                <th><span data-bind="text: lang.lang.invoice"></span></th>
						                <th class="right"><span data-bind="text: lang.lang.amount"></span></th>
						                <th class="right"><span data-bind="text: lang.lang.pay"></span></th>							                
						            </tr>
						        </thead>
						        <tbody data-role="listview"
						        		data-auto-bind="false"					        		 
						        		data-template="cashier-row-template" 
						        		data-bind="source: invoiceList"></tbody>
						        <tfoot data-template="cashier-footer-template" 
						        		data-bind="source: this"></tfoot>						        
						    </table>						    

							<br>
							
							<span id="notification"></span>

							<div class="row-fluid">
								<div class="span4">						
									<table>
										<tr>
											<td><span data-bind="text: lang.lang.payment_date"></span></td>
						              		<td>
						              			<input id="txtPaymentDate" name="txtPaymentDate" 
						              				data-role="datepicker" 
						              				data-format="dd-MM-yyyy"
						              				data-parse-formats="dd-MM-yyyy"
							              			data-bind="value: payment_date" 
							              			required data-required-msg="ត្រូវការ ថ្ងៃទទួលប្រាក់" />
											</td>
										</tr>										
										<tr>
						                    <td><span data-bind="text: lang.lang.payment_method"></span></td>
						                  	<td>
						                  		<input id="ddlPaymentMethod" id="ddlPaymentMethod"
						                  			   data-role="dropdownlist"
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: payment_method_id,
									                              source: paymentMethodDS"									                   
									                   required data-required-msg="ត្រូវការ វីធីបង់ប្រាក់" />						                  					                  		
						                  	</td>
						                <tr>
										<tr>
							                <td><span data-bind="text: lang.lang.cheque"></span></td>
							                <td><input id="check_no" class="k-textbox" data-bind="value: check_no" style="width: 161px;" /></td>
							            <tr>
							            <tr>
											<td><span data-bind="text: lang.lang.cash_account"></span></td>
											<td>
												<input id="ddlCashAccount" name="ddlCashAccount" 
														data-bind="value: account_id" 
														required data-required-msg="required" />												
											</td>
										</tr>										
									</table>							
								</div>																
								<div class="span4">
									<table>	
										<tr>
											<td><span data-bind="text: lang.lang.total_payment"></span>:</td>
											<td align="right"><span data-bind="text: pay_amount"></span></td>
										</tr>									
										<tr>
											<td><span data-bind="text: lang.lang.discount"></span>:</td>
											<td>
												<input data-role="numerictextbox" 
														data-format="c0" data-culture="km-KH" 
														data-bind="value: discount, events: {change : change}" />
											</td>
										</tr>
										<tr>
											<td><span data-bind="text: lang.lang.fine"></span>:</td>							
											<td>
												<input data-role="numerictextbox" 
														data-format="c0" data-culture="km-KH" 
														data-bind="value: fine, events: {change : change}" />
											</td>
										</tr>										
										<tr>
											<td><span data-bind="text: lang.lang.remain"></span>:</td>
											<td align="right"><span data-bind="text: remain"></span></td>
										</tr>
									</table>		          	
								</div>

								<div class="span4">
									<div class="innerAll padding-bottom-none-phone">
										<a id="save" name="save" class="widget-stats widget-stats-info widget-stats-4">
											<span class="txt"><span data-bind="text: lang.lang.save"></span></span>
											<span class="count" style="font-size: 35px;" data-bind="text: receive_amount"></span>
											<span class="glyphicons cart_in"><i></i></span>
											<div class="clearfix"></div>
											<i class="icon-play-circle"></i>
										</a>
									</div>								
								</div>
							</div>							

						</div> <!-- //End span9 -->
					</div>
				</div> <!-- //End example -->
			</div>
		</div>
	</div>
</script>
<script id="cashier-transaction-row-template" type="text/x-kendo-tmpl">
    <tr>        
        <td>#:kendo.toString(new Date(issued_date), "dd-MM-yy")#</td>
        <td>#:type# </td>
        <td align="right">#:kendo.toString(kendo.parseFloat(amount), "c", locale)#</td>        
   	</tr>
</script>
<script id="cashier-row-template" type="text/x-kendo-tmpl">		
	<tr id="rowGrid-#:id#">
		<td>
			<input type="checkbox" data-bind="checked: isPay, events:{change: checkPay}">			
		</td>
		<td class="sno">1</td>			
		<td>#:kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>		
		<td>#=fullname#</td>
		<td>#:number#</td>				
		<td class="right">#:kendo.toString(amount, "c", locale)#</td>
		<td class="right">
			<input data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: pay_amount, events: {change : change}" 
					style="width: 120px;">
			<i class="icon-trash" data-bind="events: { click: remove "></i>						
		</td>				
    </tr>   
</script>
<script id="cashier-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="7" style="font-size:30px;">
            Total: #:total()#
        </td>
    </tr>
</script>

<script id="reconcile" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">						
						
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>							

						<div align="center">
							<h4>Reconcile & Transfer</h4>							
							<span data-bind="text: str_date()"></span>
							<br>
							by
							<span data-bind="text: cashier_name"></span>
						</div>

						<table class="table table-bordered table-white">
		            		<thead>
		            			<tr>
		            				<th>Cash</th>	            				
		            				<th>Dollar Qty</th>
		            				<th>Riel Qty</th>
		            				<th>Dollar Amt</th>
		            				<th>Riel Amt</th>	            				
		            				<th>Dollar Qty Transfer</th>
		            				<th>Riel Qty Transfer</th>
		            				<th>Dollar Amt Transfer</th>
		            				<th>Riel Amt Transfer</th>		            				
		            			</tr>
		            		</thead>
		            		<tbody id="lvReconcileItem" data-role="listview"
		            				data-auto-bind="false"			            			
					                data-template="denominationRowTemplate"
					                data-bind="source: reconcileItemDS">
					        </tbody>
		            	</table>

						<br>

						<div class="row-fluid">
							<!-- //Reconcile -->
							<div class="span6">
								<h4 class="heading">Reconcile</h4>

								<table class="table table-condensed">
									<tr>
										<td>Total Paid Today</td>
										<td></td>											
										<td class="right"><span class="count" data-bind="text: obj.received_amount"></span> ៛</td>												
									</tr>
									<tr>
										<td>Remain</td>
										<td></td>											
										<td class="right" style="border-bottom: 1px solid black;"><span class="count" data-bind="text: obj.previous_amount"></span> ៛</td>												
									</tr>
									<tr>
										<td>Cash (A)</td>
										<td></td>												
										<td class="right"><span class="count" data-bind="text: obj.total_cash1"></span> ៛</td>
									</tr>

									<!-- Reconcile -->
									<tr>
										<td>Dollar</td>
										<td>
											$ <span class="count" data-bind="text: obj.usd_amount"></span> x
											<input data-role="numerictextbox" data-format="c0" data-culture="km-KH" data-min="0" data-bind="value: obj.rate, events:{change:change}"  style="width:90px;">
										</td>
										<td class="right"><span class="count" data-bind="text: obj.usd2khr_amount"></span> ៛</td>												
									</tr>
									<tr>
										<td>Riel</td>
										<td></td>
										<td class="right" style="border-bottom: 1px solid black;"><span class="count" data-bind="text: obj.total_cash2"></span> ៛</td>												
									</tr>
									<tr>
										<td>Actual Cash (B)</td>
										<td></td>												
										<td class="right"><span class="count" data-bind="text: obj.reconciled_amount"></span> ៛</td>
									</tr>
									<tr id="reconcileAmount">
										<td>Reconcile(A-B)</td>
										<td></td>												
										<td class="right"><span class="count" data-bind="text: obj.reconciled_amount"></span> ៛</td>
									</tr>																				
								</table>
							</div>

							<!-- //Transfer -->
							<div class="span6">								
								<h4 class="heading">Cash Transfer</h4>								
								
								<table class="table table-condensed">
									<tr>
										<td>Dollar Transfer</td>
										<td>
											$ <span class="count" data-bind="text: obj.transfer_usd"></span> x
											<input data-role="numerictextbox" data-format="c0" data-culture="km-KH" data-min="0" data-bind="value: obj.rate, events:{change:change}"  style="width:90px;">												
										</td>
										<td class="right"><span class="count" data-bind="text: obj.usd2khr_transfer_amount"></span> ៛</td>												
									</tr>
									<tr>
										<td>Riel Transfer</td>
										<td></td>
										<td class="right" style="border-bottom: 1px solid black;"><span class="count" data-bind="text: obj.transfer_khr"></span> ៛</td>												
									</tr>
									<tr>
										<td>Total Transfer</td>
										<td></td>												
										<td class="right"><span class="count" data-bind="text: obj.transfered_amount"></span> ៛</td>
									</tr>
									<tr>
										<td>Balance</td>
										<td></td>												
										<td class="right"><span class="count" data-bind="text: obj.balance"></span> ៛</td>
									</tr>
									<tr>
										<td>Transfer Account</td>
										<td>
											<input id="ddlCashAccount" name="ddlCashAccount" 
													data-bind="value: obj.transfer_account_id" 
													required data-required-msg="required" />
										</td>
										<td>
											<!-- Class here -->
						              	</td>
									</tr>
									<tr class="top">
										<td>Memo:</td>
										<td colspan="2">
											<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo"></textarea>
										</td>										
									</tr>								
								</table>																																			
							</div>									
						</div>

						<!-- Form actions -->
						<div align="right" data-bind="invisible: isExisting">
							<span id="notification"></span>

							<span class="btn btn-icon btn-success glyphicons share" data-bind="click: transferAll"><i></i>Transfer All</span>
							<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>							
							<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
						</div>
						<!-- // Form actions END -->

					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="denominationRowTemplate" type="text/x-kendo-tmpl">		
	<tr>				
		<td class="right">#=denomination#</td>
		<td>
			<input data-role="numerictextbox" data-format="n0" data-min="0" style="width:90px;"
				data-bind="value: usd_qty, events: {change : change}" #: denomination>100 ? disabled="disabled" : "" # >
		</td>
		<td>
			<input data-role="numerictextbox" data-format="n0" data-min="0" style="width:90px;"
				data-bind="value: khr_qty, events: {change : change}" #: denomination<100 ? disabled="disabled" : "" # >
		</td>
		<td class="right">#:kendo.toString(usd_amount,'c')#</td>
		<td class="right">#:kendo.toString(khr_amount,'c0','km-KH')#</td>

		<td bgcolor="silver">
			<input data-role="numerictextbox" data-format="n0" data-min="0" style="width:90px;"
				data-bind="value: usd_transfer, events: {change : change}" #: denomination>100 ? disabled="disabled" : "" # >
		</td>
		<td bgcolor="silver">
			<input data-role="numerictextbox" data-format="n0" data-min="0" style="width:90px;"
				data-bind="value: khr_transfer, events: {change : change}" #: denomination<100 ? disabled="disabled" : "" # >
		</td>
		<td bgcolor="silver" class="right">#:kendo.toString(usd_transfer_amount,'c')#</td>
		<td bgcolor="silver" class="right">#:kendo.toString(khr_transfer_amount,'c0','km-KH')#</td>					
    </tr>   
</script>


<!-- ***************************
 *	Inventory Section      	  *
**************************** -->
<script id="itemDashBoard" type="text/x-kendo-template">
	
	<img src="uploads/pictures/banhji_inventory.png" width="300" height="100" />

	<br>

	<input data-role="datepicker"
	       data-format="dd-MM-yyyy"
	       data-parse-formats="yyyy-MM-dd"
	       data-bind="value: as_of,
	       			events:{change: dateChanges}"
	       placeholder="As of ..." />

	<br><br>		

    <div class="widget widget-heading-simple widget-body-simple">		
		
		<div class="widget-body">

			<!-- Row -->
			<div class="row-fluid">
				<div class="span2">
				
					<!-- Stats Widget -->
					<a href="" class="widget-stats widget-stats-gray widget-stats-1">
						<span class="txt">Inventory Type</span>
						<div class="clearfix"></div>
						<span class="count"><span data-bind="text: type"></span></span>
					</a>
					<!-- // Stats Widget END -->
					
				</div>
				<div class="span2">
				
					<!-- Stats Widget -->
					<a href="" class="widget-stats widget-stats-1">
						<span class="txt">Gross Profit Margin</span>
						<div class="clearfix"></div>
						<span class="count"><span data-bind="text: gross_profit_margin"></span></span>
					</a>
					<!-- // Stats Widget END -->
					
				</div>
				<div class="span2">
				
					<!-- Stats Widget -->
					<a href="" class="widget-stats widget-stats-gray widget-stats-2">
						<span class="count"><span data-bind="text: turnover_day"></span></span>
						<span class="txt">Inventory Turnover day</span>
					</a>
					<!-- // Stats Widget END -->
					
				</div>
				<div class="span6">
				
					<!-- Stats Widget -->
					<a href="" class="widget-stats widget-stats-2">
						<span class="count"><span data-bind="text: total_value"></span></span>
						<span class="txt">Total Inventory Value</span>
					</a>
					<!-- // Stats Widget END -->
					
				</div>								
			</div>
			<!-- // Row END -->
			
		</div>
	</div>

	<br>

	<div class="row-fluid">
		<div class="span4">
			<h4>Top 5 Inventory Turnover Days</h4>
			
			<table class="table table-bordered table-primary table-striped table-vertical-center">
		        <thead>
		            <tr>
		                <th style="width: 1%;" class="center">No.</th>
		                <th>Items</th>
		                <th>Balance</th>		                
		                <th>Days</th>
		            </tr>
		        </thead>
		        <tbody data-role="listview"		        	 
		        	 data-auto-bind="false"                 
	                 data-template="itemDashBoard-top-turnover-day-template"
	                 data-bind="source: topTurnoverDayDS"></tbody>			        
		    </table>			
		</div>
		<div class="span4">
			<h4>Top 5 Suppliers</h4>
			<table class="table table-bordered table-primary table-striped table-vertical-center">
		        <thead>
		            <tr>
		                <th style="width: 1%;" class="center">No.</th>
		                <th>Items</th>
		                <th>Qty</th>
		                <th>Total Purchase</th>		                
		            </tr>
		        </thead>
		        <tbody data-role="listview"
		        	 data-auto-bind="false"                 
	                 data-template="itemDashBoard-top-vendor-item-template"
	                 data-bind="source: topVendorItemDS"></tbody>			        
		    </table>
		</div>
		<div class="span4">
			<h4>Top 5 Best Selling Items</h4>
			<table class="table table-bordered table-primary table-striped table-vertical-center">
		        <thead>
		            <tr>
		                <th style="width: 1%;" class="center">No.</th>
		                <th>Items</th>
		                <th>Qty</th>
		                <th>G.Profit</th>
		                <th>%Margin</th>		                
		            </tr>
		        </thead>
		        <tbody data-role="listview"
		        	 data-auto-bind="false"                 
	                 data-template="itemDashBoard-top-sale-item-template"
	                 data-bind="source: topSaleItemDS"></tbody>			        
		    </table>
		</div>		
	</div>

	<p class="separator text-center"><i class="icon-ellipsis-horizontal icon-3x"></i></p>
</script>
<script id="itemDashBoard-top-turnover-day-template" type="text/x-kendo-tmpl">	
	<tr data-uid="#: uid #">
		<td class="sno">1</td>		
		<td>#=name#</td>		
		<td align="right">#=kendo.toString(cost, "c", banhji.institute.locale)#</td>         
        <td align="right">#=kendo.toString(days, "n0")#</td> 
	</tr>
</script>
<script id="itemDashBoard-top-vendor-item-template" type="text/x-kendo-tmpl">
	<tr>
		<td class="sno1">1</td>		
		<td>#=name#</td>
		<td align="right">#=kendo.toString(unit, "n0")#</td>
        <td align="right">#=kendo.toString(amount, "c", banhji.institute.locale)#</td>		
	</tr>
</script>
<script id="itemDashBoard-top-sale-item-template" type="text/x-kendo-tmpl">
	<tr>
		<td class="sno2">1</td>		
		<td>#=name#</td>
		<td align="right">#=kendo.toString(qty, "n0", banhji.institute.locale)#</td>        
        <td align="right">
        	#amount = qty * price#
        	#margin = (price-cost)*qty#
        	#=kendo.toString(margin, "c", banhji.institute.locale)#
        </td>
        <td align="right">#=kendo.toString(margin/amount, "p")#</td>
	</tr>
</script>
<script id="itemCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" style="height: 700px;">
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="sku or name ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>
							<div class="select2-container" style="width: 100%;">								
																
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: itemDS.total()"></span> Found</span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid" 
						 data-bind="source: itemDS"
						 data-auto-bind="false" 
						 data-row-template="itemCenter-item-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							            <li style="font-size: large; color: black; font-weight: bold;">
							            	<span data-bind="text: obj.sku"></span>
							            	-
							            	<span data-bind="text: obj.name"></span>
							            </li>
							            <li class="glyphicons circle_info active"><span data-toggle="tab" data-target="#tab1-4"><i></i></span>
							            </li>
							            <li class="glyphicons riflescope"><span data-toggle="tab" data-target="#tab2-4"><i></i></span>
							            </li>
							            <li class="glyphicons coins"><span data-bind="click: pricing"><i></i></span>
							            </li>							            							            
							            <li class="glyphicons edit"><span data-bind="click: edit"><i></i></span>
							            </li>							            						            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- Info Tab content -->
							            <div id="tab1-4" class="tab-pane active box-generic">
							            	
											<div class="widget widget-heading-simple widget-body-white">
												<div class="widget-body padding-none">
													<div class="row-fluid row-merge">
														<div class="span6">
															<div class="innerAll center">
																<h5 class="strong muted text-uppercase"><i class="icon-money text-faded"></i> Weighted Avg Cost</h5>
																<span class="text-large strong text-primary"><span data-format="n" data-bind="text: obj.cost"></span></span>
															</div>
														</div>
														<div class="span6">
															<div class="innerAll center muted">
																<h5 class="strong muted text-uppercase"><i class="icon-dollar text-faded"></i> Avg Price</h5>
																<span class="text-large strong"><span data-bind="text: obj.price"></span></span>
															</div>
														</div>
													</div>
												</div>
											</div>
											
							            </div>
							            <!-- // Info Tab content END -->

							            <!-- SEARCH Tab content -->
							            <div id="tab2-4" class="tab-pane box-generic">
							                <table>
									    		<tr>
									    			<td>
												    	<input data-role="dropdownlist"
														   data-option-label="(--- Category ---)"
										                   data-auto-bind="false"
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: category_id,
										                              source: categoryDS,			                              
										                              events: {
										                                change: categoryChanges
										                              }"/>
									            	</td>
									            	<td>
										            	<select data-role="multiselect"
												           data-placeholder="item group ..."
												           data-value-primitive="true"
												           data-text-field="name"
												           data-value-field="id"
												           data-bind="value: selectedItemGroup,
												                      source: itemGroupDS,
												                      enabled: isCategorySelected"
												           style="width: 200px;" 
												    	></select>
												    </td>
												</tr>
											</table>

								            <br><br>
								            <span class="btn btn-primary btn-icon glyphicons search pull-right" data-bind="click: search"><i></i> <span data-bind="text: lang.lang.search"></span></span>
								            <br>
							            </div>
							            <!-- // SEARCH Tab content END -->							            
							           
							        </div>
							    </div>
							</div>
						</div>

						<div class="span6">
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadOnHand">
										<span class="glyphicons coins"><i></i></span>
										<span class="txt">Value OH<span data-bind="text: obj.on_hand" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-inverse widget-stats-5" data-bind="click: loadOnHand">
										<span class="glyphicons thumbs_up"><i></i></span>
										<span class="txt">Qty OH<span data-bind="text: obj.on_hand" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadPO">
										<span class="glyphicons cart_in"><i></i></span>
										<span class="txt"><span data-bind="text: on_po"></span>On PO</span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadSO">
										<span class="glyphicons cart_out"><i></i></span>
										<span class="txt"><span data-bind="text: on_so"></span>On SO</span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>											          	
		          	</div>
					
					<div>
						<input data-role="dropdownlist"                   
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					                      events: { change: dateChanges }"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      events: { change: dateChanges }"
					           placeholder="To ..." >
					    
					    <button type="button" data-role="button" data-bind="click: searchMovement"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th>Date</th>
								<th>Type</th>								
								<th>Reference No</th>
								<th>Qty</th>
								<th>Cost</th>
								<th>Price</th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="itemCenter-transaction-tmpl"
				                data-bind="source: movementDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: movementDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="itemCenter-item-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				<span class="strong">
					#=sku# #=name#				
				</span>
			</div>
		</td>
	</tr>
</script>
<script id="itemCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(invoice[0].issued_date), "dd-MM-yyyy")#</td>
    	<td>#=invoice[0].type#</td>
        <td>#=invoice[0].number#</td>
    	<td>#=kendo.toString(unit*movement, "n0")#</td>
    	<td>#=kendo.toString(cost*rate, "c", "locale")#</td>
    	<td>#=kendo.toString(price*rate, "c", "locale")#</td>  	
    </tr>
</script>
<script id="item" type="text/x-kendo-template">
	<div class="container-960">
		<div id="example" class="k-content">
			
			<!-- Collapsible Widget -->			
			<div class="widget">
			    <div class="widget-head">
			    	<span class="btn btn-primary pull-right" 
							onclick="javascript:window.history.back()">X</span>
			        
			        <h4 class="heading glyphicons cargo"><i></i> <span data-bind="text: lang.lang.item"></span></h4>							        	
			    </div>
			    <div class="widget-body">					
					
			    	<div class="row-fluid">
			    		<div class="span6 well">									
							<div class="row-fluid">
								<div class="span6">														
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlCategory"><span data-bind="text: lang.lang.category"></span> <span style="color:red">*</span></label>
										<input id="categories" data-bind="value: obj.category_id" required data-required-msg="required" style="width: 100%;" />
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlItemGroups"><span data-bind="text: lang.lang.group"></span> </label>
										<input id="itemGroups" data-bind="value: obj.item_group_id" disabled="disabled" style="width: 100%;" />
									</div>
									<!-- // Group END -->												
								</div>
							</div>
							
							<div class="row-fluid">
								<div class="span6">	
									<!-- Group -->
									<div class="control-group">							
										<label for="txtSKU"><span data-bind="text: lang.lang.sku"></span><span style="color:red">*</span></label>
				              			<input id="txtSKU" name="txtSKU" class="k-textbox"
					              				data-bind="value: obj.sku" 
					              				placeholder="e.g. ID0001" 
					              				required data-required-msg="required"
					              				style="width: 100%;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->		
								</div>

								<div class="span6">						
									<!-- Group -->
									<div class="control-group">
										<label for="txtName"><span data-bind="text: lang.lang.item_number"></span> <span style="color:red">*</span></label>
					              		<input id="txtName" name="txtName" class="k-textbox" data-bind="value: obj.name" 
							              		placeholder="item name..." required data-required-msg="required"
							              		style="width: 100%;" />
									</div>
									<!-- // Group END -->	
								</div>								
							</div>

							<div class="row-fluid">
								<div class="span6">																					
									<!-- Group -->
									<div class="control-group">								
										<label for="txtOrderPoint"><span data-bind="text: lang.lang.reorder_point"></span></label>
										<input data-role="numerictextbox"
						                   data-format="n0"
						                   data-min="0"						                   
						                   data-bind="value: obj.order_point"
						                   style="width: 100%">
									</div>																		
									<!-- // Group END -->														
								</div>

								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
							            <input id="ddlStatus" name="ddlStatus" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true" 
						            		data-bind="source: statusList, value: obj.status"
						            		data-option-label="(--- Select ---)"
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->										
								</div>								
							</div>							
						</div>
						<div class="span6">
							<div class="row-fluid">
								<div class="span6">														
									<!-- Group -->
									<div class="control-group">								
										<label for="txtCost"><span data-bind="text: lang.lang.cost"></span></label>
							            <input data-role="numerictextbox"
						                   data-format="n0"
						                   data-min="0"						                   
						                   data-bind="value: obj.cost"
						                   style="width: 100%">
									</div>																		
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlCurrency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
							            <input id="ddlCurrency" name="ddlCurrency"							            	 
				              				data-role="dropdownlist"
				              				data-option-label="(--- Select ---)"
				              				data-value-primitive="true"
						            		data-text-field="code"
			           						data-value-field="id"			           						 
						            		data-bind="source: currencyDS, value: obj.currency_id"						            		
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->									
								</div>
							</div>

							<div class="row-fluid">
								<div class="span6">														
									<!-- Group -->
									<div class="control-group">								
										<label for="txtOnhand"><span data-bind="text: lang.lang.quantity"></span></label>
							            <input data-role="numerictextbox"
						                   data-format="n0"
						                   data-min="0"						                   
						                   data-bind="value: obj.on_hand"
						                   style="width: 100%">
									</div>																		
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">								
										<label for="txtOrderPoint"><span data-bind="text: lang.lang.unit_measure"></span> <span style="color:red">*</span></label>
										<input id="ddlMeasurement" name="ddlMeasurement"
										   data-option-label="(--- Select ---)" 
										   data-role="dropdownlist"						                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.measurement_id,
						                              source: measurementDS"
						                   required data-required-msg="required"
						                   style="width: 100%;" />
									</div>																		
									<!-- // Group END -->											
								</div>
							</div>

							<div class="row-fluid">
								<!-- Group -->
								<div class="control-group">								
									<label for="txtDescription"><span data-bind="text: lang.lang.description"></span></label>
						            <textarea id="txtDescription" cols="0" rows="3" class="k-textbox" 
										data-bind="value: obj.bill_to" style="width: 100%;"></textarea>
								</div>																		
								<!-- // Group END -->
							</div>

						</div>
					</div>								
							
					<!-- // Inner Tabs -->
					<div class="row-fluid">								
						<div class="box-generic">
						    <!-- //Tabs Heading -->
						    <div class="tabsbar tabsbar-1">
						        <ul class="row-fluid row-merge">						            
						            <li class="span2 glyphicons usd active">
						            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.accounting"></span></span></a>
						            </li>
						            <li class="span2 glyphicons circle_info">
						            	<a href="#tab2" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.info"></span></span></a>
						            </li>
						            <li class="span2 glyphicons old_man">
						            	<a href="#tab3" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.vendor"></span></span></a>
						            </li>
						            <li class="span2 glyphicons user">
						            	<a href="#tab4" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.customer"></span></span></a>
						            </li>						            					            						            					            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">
						        <!-- //ACCOUNTING INFO -->
						        <div class="tab-pane active" id="tab1">
						        	<div class="row-fluid">						            	
										<div class="span4">
											<label for="ddlIncome"><span data-bind="text: lang.lang.income_account"></span><span style="color:red">*</span></label>
											<input id="ddlIncome" name="ddlIncome"
												data-bind="value: obj.income_account_id" 
												required data-required-msg="required" style="width: 100%;" />
										</div>
										<div class="span4">
											<label for="ddlCogs"><span data-bind="text: lang.lang.cost_of_good_sold_account"></span><span style="color:red">*</span></label>
											<input id="ddlCogs" name="ddlCogs"
												data-bind="value: obj.cogs_account_id" 
												required data-required-msg="required" style="width: 100%;" />
										</div>
										<div class="span4">
											<label for="ddlInventory"><span data-bind="text: lang.lang.inventory_account"></span><span style="color:red">*</span></label>
											<input id="ddlInventory" name="ddlInventory"
												data-bind="value: obj.inventory_account_id" 
												required data-required-msg="required" style="width: 100%;" />	
										</div>												
							        </div>							        
					        	</div>
						        <!-- //ACCOUNTING INFO END -->						        
						        
						        <!-- //INFO -->
						        <div class="tab-pane" id="tab2">

						        	<div class="row-fluid">

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtSerialNumber"><span data-bind="text: lang.lang.model"></span></label>
						              			<input data-role="dropdownlist"
						              			   data-option-label="(--- Select ---)"								                  
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.brand_id,
								                              source: brandDS"
								                   style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtMeasurement"><span data-bind="text: lang.lang.measurement"></span></label>
						              			<input id="txtMeasurement" name="txtMeasurement" class="k-textbox"
							              				data-bind="value: obj.measurements" 
							              				placeholder="e.g. 4x6mn"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">
											<!-- Group -->
											<div class="control-group">
									            <input type="checkbox" data-bind="checked: obj.favorite" />	<span data-bind="text: lang.lang.favorite"></span>
											</div>																		
											<!-- // Group END -->
										</div>										

						        	</div>						        	

							        <div class="row-fluid">										

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtInternationalCode"><span data-bind="text: lang.lang.international_code"></span></label>
						              			<input id="txtInternationalCode" name="txtInternationalCode" class="k-textbox"
							              				data-bind="value: obj.international_code" 
							              				placeholder="e.g. INT0001"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtColorCode"><span data-bind="text: lang.lang.color"></span></label>
						              			<input id="txtColorCode" name="txtColorCode" class="k-textbox"
							              				data-bind="value: obj.color_code" 
							              				placeholder="e.g. VID0001"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtIMEI"><span data-bind="text: lang.lang.imei"></span></label>
						              			<input id="txtIMEI" name="txtIMEI" class="k-textbox"
							              				data-bind="value: obj.IMIE" 
							              				placeholder="e.g. IMEI0001"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtSerialNumber"><span data-bind="text: lang.lang.serial_number"></span></label>
						              			<input id="txtSerialNumber" name="txtSerialNumber" class="k-textbox"
							              				data-bind="value: obj.serial_number" 
							              				placeholder="e.g. 0001"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>
												
							        </div>							       

					        	</div>
						        <!-- //INFO END -->

						        <!-- //VENDOR -->
						        <div class="tab-pane" id="tab3">
						        						       
						        	<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyItemVendor"><i></i> <span data-bind="text: lang.lang.new_vendor_item"></span></span>
								        	
						        	<table class="table table-bordered table-white">
								        <thead>
								            <tr>
								                <th><span data-bind="text: lang.lang.name"></span></th>
								                <th><span data-bind="text: lang.lang.item_code"></span></th>								                
								                <th width="20px"></th>										               
								            </tr>
								        </thead>
								        <tbody data-role="listview"										        		
								        		data-auto-bind="false"										        						        		 
								        		data-template="item-vendor-row-tmpl" 
								        		data-bind="source: itemVendorDS">
								        </tbody>										        						        
								    </table>

					        	</div>
						        <!-- //VENDOR END -->

						        <!-- //CUSTOMER -->
						        <div class="tab-pane" id="tab4">
						        					       
						        	<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyItemCustomer"><i></i> <span data-bind="text: lang.lang.new_customer_item"></span></span>
								        	
						        	<table class="table table-bordered table-white">
								        <thead>
								            <tr>
								                <th><span data-bind="text: lang.lang.name"></span></th>
								                <th><span data-bind="text: lang.lang.item_code"></span></th>								                
								                <th width="20px"></th>										               
								            </tr>
								        </thead>
								        <tbody data-role="listview"										        		
								        		data-auto-bind="false"										        						        		 
								        		data-template="item-customer-row-tmpl" 
								        		data-bind="source: itemCustomerDS">
								        </tbody>										        						        
								    </table>

					        	</div>
						        <!-- //CUSTOMER END -->
						    </div>
						</div>
					</div>					

					<br>											
							
					<!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
						<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
					</div>
					<!-- // Form actions END -->

				</div> <!-- End Widget-Body List -->
			</div>
			<!-- // Collapsible Widget END -->				
					
		</div>
	</div>
</script>
<script id="item-vendor-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="cbbVendor" name="cbbVendor" 
			   data-role="combobox"
               data-placeholder="vendor ..."
               data-auto-bind="false"
               data-value-primitive="true"
               data-filter="startswith"							                   
               data-min-length="3"							                   
               data-text-field="company"
               data-value-field="id"										                   
               data-bind="value: contact_id,
                          source: vendorList"
               style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: code" placeholder="item code ..." style="width: 100%;" />
		</td>			
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteItemVendor"><i></i></span>									
		</td>		
	</tr>
</script>
<script id="item-customer-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="cbbCustomer" name="cbbCustomer" 
			   data-role="combobox"
               data-placeholder="customer ..."
               data-auto-bind="false"
               data-value-primitive="true"
               data-filter="startswith"							                   
               data-min-length="3"							                   
               data-text-field="fullname"
               data-value-field="id"										                   
               data-bind="value: contact_id,
                          source: customerList"
               style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: code" placeholder="item code ..." style="width: 100%;" />
		</td>			
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteItemCustomer"><i></i></span>									
		</td>		
	</tr>
</script>
<script id="itemCatalog" type="text/x-kendo-template">
	<div class="container-960">
		<div id="example" class="k-content">
			
			<!-- Collapsible Widget -->			
			<div class="widget">
			    <div class="widget-head">
			    	<span class="btn btn-primary pull-right" 
							onclick="javascript:window.history.back()">X</span>
			        
			        <h4 class="heading glyphicons sampler"><i></i> <span data-bind="text: lang.lang.catalogs"></span></h4>							        	
			    </div>
			    <div class="widget-body">					
					
			    	<div class="row-fluid">
			    		<div class="span6 well">							
							<div class="row-fluid">
								<div class="span6">	
									<!-- Group -->
									<div class="control-group">							
										<label for="txtSKU"><span data-bind="text: lang.lang.code"></span> <span style="color:red">*</span></label>
				              			<input id="txtSKU" name="txtSKU" class="k-textbox"
					              				data-bind="value: obj.sku" 
					              				placeholder="e.g. ID0001" 
					              				required data-required-msg="required"
					              				style="width: 100%;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->		
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">
										<label for="txtName"><span data-bind="text: lang.lang.items"></span><span style="color:red">*</span></label>
					              		<input id="txtName" name="txtName" class="k-textbox" data-bind="value: obj.name" 
							              		placeholder="Items Name..." required data-required-msg="required"
							              		style="width: 100%;" />
									</div>
									<!-- // Group END -->	 			
								</div>								
							</div>

							<div class="row-fluid">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtOnhand"><span data-bind="text: lang.lang.status"></span><span style="color:red">*</span></label>
							            <input id="ddlStatus" name="ddlStatus" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true" 
						            		data-bind="source: statusList, value: obj.status"
						            		data-option-label="(--- Select ---)"
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->										
								</div>

								<div class="span6">
									<input type="checkbox" data-bind="checked: obj.favorite" /> <span data-bind="text: lang.lang.favorite"></span>
								</div>															
							</div>							
						</div>
						<div class="span6">							
							<div class="row-fluid">
								<!-- Group -->
								<div class="control-group">								
									<label for="txtDescription"><span data-bind="text: lang.lang.description"></span></label>
						            <textarea id="txtDescription" cols="0" rows="2" class="k-textbox" 
										data-bind="value: obj.bill_to" style="width: 100%;"></textarea>
								</div>																		
								<!-- // Group END -->
							</div>

							<div class="row-fluid">
								<!-- Group -->
								<div class="control-group">								
									<label for="items"><span data-bind="text: lang.lang.select_item_for_catalogs"></span></label>

									<select data-role="multiselect"
						                   data-placeholder="Select..."
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.catalogs,
						                              source: itemDS"
						                   style="width: 100%"
						            ></select>						            
								</div>																		
								<!-- // Group END -->
							</div>																											
						</div>
					</div>
					
					<br>											
							
					<!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
						<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
					</div>
					<!-- // Form actions END -->

				</div> <!-- End Widget-Body List -->
			</div>
			<!-- // Collapsible Widget END -->				
					
		</div>
	</div>
</script>
<script id="itemAssembly" type="text/x-kendo-template">
	<div class="container-960">
		<div id="example" class="k-content">
			
			<!-- Collapsible Widget -->			
			<div class="widget">
			    <div class="widget-head">
			    	<span class="btn btn-primary pull-right" 
							onclick="javascript:window.history.back()">X</span>
			        
			        <h4 class="heading glyphicons fins"><i></i> <span data-bind="text: lang.lang.assembly"></span></h4>							        	
			    </div>
			    <div class="widget-body">					
					
			    	<div class="row-fluid">
			    		<div class="span6 well">							
							<div class="row-fluid">
								<div class="span6">	
									<!-- Group -->
									<div class="control-group">							
										<label for="txtSKU"><span data-bind="text: lang.lang.code"></span> <span style="color:red">*</span></label>
				              			<input id="txtSKU" name="txtSKU" class="k-textbox"
					              				data-bind="value: obj.sku" 
					              				placeholder="e.g. ID0001" 
					              				required data-required-msg="required"
					              				style="width: 100%;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->		
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">
										<label for="txtName"><span data-bind="text: lang.lang.items"></span> <span style="color:red">*</span></label>
					              		<input id="txtName" name="txtName" class="k-textbox" data-bind="value: obj.name" 
							              		placeholder="Items Name..." required data-required-msg="required"
							              		style="width: 100%;" />
									</div>
									<!-- // Group END -->	 			
								</div>								
							</div>

							<div class="row-fluid">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtOnhand"><span data-bind="text: lang.lang.status"></span><span style="color:red">*</span></label>
							            <input id="ddlStatus" name="ddlStatus" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true" 
						            		data-bind="source: statusList, value: obj.status"
						            		data-option-label="(--- Select ---)"
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->										
								</div>

								<div class="span6">
									<input type="checkbox" data-bind="checked: obj.favorite" /> <span data-bind="text: lang.lang.favorite"></span>
								</div>															
							</div>							
						</div>
						<div class="span6">							
							<div class="row-fluid">
								<!-- Group -->
								<div class="control-group">								
									<label for="txtDescription"><span data-bind="text: lang.lang.description"></span></label>
						            <textarea id="txtDescription" cols="0" rows="2" class="k-textbox" 
										data-bind="value: obj.bill_to" style="width: 100%;"></textarea>
								</div>																		
								<!-- // Group END -->
							</div>

							<div class="row-fluid">
								<!-- Group -->
								<div class="control-group">								
									<label for="items"><span data-bind="text: lang.lang.select_item_for_assemply"></span></label>
						           
						            <input data-role="combobox"
						                   data-placeholder="Select Item..."
						                   data-value-primitive="true"
						                   data-auto-bind="false"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: assembly_id,
						                              source: itemDS"
						                   style="width: 90%"/>

						            <button type="button" data-role="button" data-bind="click: addItem"><i class="icon-plus"></i></button>
								</div>																		
								<!-- // Group END -->
							</div>																											
						</div>
					</div>

					<br>

					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				            	<th width="5%"><span data-bind="text: lang.lang.no"></span></th>				                
				                <th width="20%"><span data-bind="text: lang.lang.items"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th width="25%"><span data-bind="text: lang.lang.quantity"></span></th>
				                <th width="15%"><span data-bind="text: lang.lang.p"></span></th>
				                <th width="10%"><span data-bind="text: lang.lang.amount"></span></th>
				                <th width="1%"></th>
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        		data-auto-bind="false" 
				        		data-template="itemAssembly-row-template" 
				        		data-bind="source: assemblyDS"></tbody>				        
				    </table>

				    <br>

				    <div class="row-fluid">
					    <div class="span4 pull-right">
							<div class="well pull-right">
								សរុប៖	<strong data-bind="text: total"></strong>
							</div>							
						</div>
					</div>
					
					<br>											
							
					<!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
						<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span> </div>
					<!-- // Form actions END -->

				</div> <!-- End Widget-Body List -->
			</div>
			<!-- // Collapsible Widget END -->				
					
		</div>
	</div>
</script>
<script id="itemAssembly-row-template" type="text/x-kendo-tmpl">
	<tr>
		<td>
			<i class="icon-trash" data-bind="events: { click: removeItem }"></i>
			#:banhji.itemAssembly.assemblyDS.indexOf(data)+1#
		</td>		
		<td>
			<span data-bind="text: assembly[0].sku"></span>
			<span data-bind="text: assembly[0].name"></span>
		</td>
		<td>
			<span data-bind="text: assembly[0].description"></span>
		</td>
		<td>
			<input id="unit" name="unit" data-role="numerictextbox" 
					data-format="n0" data-min="1"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 100px;" />

			<input data-role="dropdownlist"
				   data-option-label="(--- Select ---)"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="source: price_list, value: measurement_id, events: {change: measurementChanges}"
                   style="width: 100px;" />
		</td>					
		<td>
			<input id="price" name="price" data-role="numerictextbox" 
					data-format="c" data-culture=#:currency[0].locale#
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>		
		<td class="right">
			<span data-format="n" 
					data-culture=#:currency[0].locale#
					data-bind="text: amount" 
					style="width: 100%;"></span> 						
		</td>		
	</tr>
</script>
<script id="priceList" type="text/x-kendo-template">
	<div class="container-960">		
		<div id="example" class="k-content">
			<!-- Collapsible Widget -->			
			<div class="widget">
			    <div class="widget-head">
			    	<span class="btn btn-primary pull-right" 
							onclick="javascript:window.history.back()">X</span>
			        
			        <h4 class="heading glyphicons usd"><i></i> Pricing</h4>							        	
			    </div>
			    <div class="widget-body">

			    	<div class="widget widget-heading-simple widget-body-simple">

			    		<!-- Widget Heading -->
						<div class="widget-head" style="font-size: large; font-weight: bold;">
							<span data-bind="text: obj.sku"></span>
							-
							<span data-bind="text: obj.name"></span>
						</div>
						<!-- // Widget Heading END -->
									
						<div class="widget-body">

							<!-- Row -->
							<div class="row-fluid">
								<div class="span3">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-gray widget-stats-1">
										<span class="glyphicons cart_in"><i></i><span class="txt">Weighted Avg Cost</span></span>
										<div class="clearfix"></div>
										<span class="count"><span data-format="n" data-bind="text: obj.cost" style="font-size: xx-large;"></span></span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>
								<div class="span3">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-1">
										<span class="glyphicons cart_out"><i></i><span class="txt">Avg Price</span></span>
										<div class="clearfix"></div>
										<span class="count"><span data-format="n" data-bind="text: obj.price" style="font-size: xx-large;"></span></span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>
								<div class="span2">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-gray widget-stats-2">
										<span class="count"><span data-format="n0" data-bind="text: obj.on_hand"></span></span>
										<span class="txt">On Hand</span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>
								<div class="span2">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-2">
										<span class="count"><span data-format="n0" data-bind="text: on_po"></span></span>
										<span class="txt">On PO</span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>
								<div class="span2">
								
									<!-- Stats Widget -->
									<a href="" class="widget-stats widget-stats-gray widget-stats-2">
										<span class="count"><span data-format="n0" data-bind="text: on_so"></span></span>
										<span class="txt">On SO</span>
									</a>
									<!-- // Stats Widget END -->
									
								</div>
								
							</div>
							<!-- // Row END -->
														
						</div>
					</div>

					<div id="priceList-window" data-role="window" data-visible="false" data-modal="true" data-resizable="false" data-iframe="true">				    	
						<table>
							<tr>
								<td>Price</td>
								<td>
									<input data-role="numerictextbox"		                   
					                   data-min="0"		                   
					                   data-bind="value: priceList.price" />
								</td>
							</tr>
							<tr>
								<td>Currency</td>
								<td>
									<input data-role="dropdownlist"
										   data-option-label="(--- Select ---)"			                   
						                   data-value-primitive="true"
						                   data-text-field="code"
						                   data-value-field="id"
						                   data-bind="value: priceList.currency_id,
						                              source: currencyDS" />
								</td>
							</tr>
							<tr>
								<td>Unit Price</td>
								<td>
									<input data-role="numerictextbox"		                   
					                   data-min="0"		                   
					                   data-bind="value: priceList.unit_value" />
								</td>
							</tr>
							<tr>
								<td>Unit</td>
								<td>
									<input data-role="dropdownlist"
										   data-option-label="(--- Select ---)"			                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: priceList.measurement_id,
						                              source: unitDS" />
								</td>
							</tr>
						</table>

						<br>

						<span class="btn btn-success btn-icon glyphicons ok_2" data-bind="click: save"><i></i>Save</span>
						<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindow"><i></i>Close</span>  
					</div>				

					<button class="btn btn-inverse" data-bind="click: openWindow"><i class="icon-plus icon-white"></i></button>
					Set New Price
					</br>
					<table class="table table-bordered table-condensed">
				        <thead>
				            <tr>	            	
				            	<th>Price</th>			            		                
				                <th>Unit Value</th>
				                <th>Unit Measurement</th>			                
				                <th></th>	                
				            </tr>
				        </thead>
				        <tbody data-template="priceList-template"
				        	data-auto-bind="false"			        	
				        	data-bind="source: dataSource"></tbody>
				    </table>

					<br>

					<table class="table table-bordered table-condensed">
				        <thead>
				            <tr>	            	
				            	<th>Date</th>
				            	<th>Type</th>	                
				                <th>Reference No</th>				               
				                <th>Quantity</th>
				                <th>Cost</th>
				                <th>Price</th>			                	                
				            </tr>
				        </thead>
				        <tbody data-template="priceList-movement-tmpl"
				        	data-auto-bind="false"
				        	data-pageable="true" 
				        	data-bind="source: recordDS"></tbody>
				    </table>
				    <div id="pager" class="k-pager-wrap"
			             data-role="pager" data-bind="source: recordDS"></div>					

				</div> <!-- End Widget-Body List -->
			</div>
			<!-- // Collapsible Widget END -->			
			
		</div>
	</div>
</script>
<script id="priceList-template" type="text/x-kendo-template">
    <tr>
    	<td>#=kendo.toString(price, "c", currency[0].locale)#</td>    	
    	<td>#=unit_value#</td>
    	<td>#=measurement#</td>    	
    	<td>
    		<span data-bind="click: edit"><i class="icon-edit"></i> Edit</span>
    		|
    		<span data-bind="click: delete"><i class="icon-remove"></i> Delete</span>
    	</td>
    </tr>
</script>
<script id="priceList-movement-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(invoice[0].issued_date), "dd-MM-yyyy")#</td>
    	<td>#=invoice[0].type#</td>
        <td>#=invoice[0].number#</td>
    	<td>#=kendo.toString(unit*movement, "n0")#</td>
    	<td>#=kendo.toString(cost*rate, "c", "locale")#</td>
    	<td>#=kendo.toString(price*rate, "c", "locale")#</td>  	
    </tr>
</script>
<script id="itemRecord" type="text/x-kendo-template">
	<div class="container-960">
		<div id="example" class="k-content">
			
			<!-- Collapsible Widget -->			
			<div class="widget">
			    <div class="widget-head">
			    	<span class="btn btn-primary pull-right" 
							onclick="javascript:window.history.back()">X</span>
			        
			        <h4 class="heading glyphicons retweet_2"><i></i> Item Record</h4>							        	
			    </div>
			    <div class="widget-body">

			    	<div class="widget widget-heading-simple widget-body-white">
					    <div class="widget-body">
					        <div class="innerL">

					            <div class="separator bottom"></div>
					            <div class="glyphicons glyphicon-large cargo">
				                	<i></i>
				                	<h4 data-bind="text: item.name"></h4>

					                Code៖ <span data-bind="text: item.sku"></span> <br>
					                Description៖​ <span data-bind="text: item.description"></span> <br>
					                Quantity៖ <span data-bind="text: item.description"></span> <br>					                
					                Weighted Average Cost៖ <span data-bind="text: item.cost"></span>
					                 
					            </div>

					        </div>
					    </div>
					</div>			
							
					<table class="table table-borderless table-condensed cart_total">						
						<tr>
							<td>Date <span style="color:red">*</span></td>
							<td>
								<input id="issuedDate" name="issuedDate"
									data-role="datepicker"
									data-format="dd-MM-yyyy"									
				                    data-bind="value: obj.issued_date"
				                   style="width: 100%"
				                   required data-required-msg="required">
							</td>
						</tr>
						<tr>
							<td>Reference</td>
							<td>
								<input data-role="combobox"
									   placeholder="Select Reference..."			                   
					                   data-value-primitive="true"
					                   data-text-field="number"
					                   data-value-field="id"
					                   data-bind="value: obj.reference_id,
					                              source: invoiceDS"					                   
					                   style="width: 100%" />
							</td>
						</tr>											
						<tr>
							<td>Supplier</td>
							<td>
								<input data-role="combobox"
									   placeholder="Select Supplier..."			                   
					                   data-value-primitive="true"
					                   data-text-field="company"
					                   data-value-field="id"
					                   data-bind="value: obj.contact_id,
					                              source: contactDS"					                   
					                   style="width: 100%" />
							</td>
						</tr>
						<tr>
							<td>Item <span style="color:red">*</span></td>
							<td>
								<input id="cbbItem" name="cbbItem" 
									   data-role="combobox"
									   placeholder="Select Item..."			                   
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.item_id,
					                              source: itemDS,
					                              events:{change: itemChanges}"					                   
					                   style="width: 100%" 
					                   required data-required-msg="required" />
							</td>
						</tr>																	
						<tr>
							<td>Quantity <span style="color:red">*</span></td>
							<td>
								<input id="txtUnit" name="txtUnit"
								   data-role="numerictextbox"				                                      
				                   data-bind="value: obj.unit"
				                   required data-required-msg="required"
				                   style="width: 100%" />
							</td>
						</tr>											
						<tr>
							<td>Measurement <span style="color:red">*</span></td>
							<td>
								<input id="ddlUnit" name="ddlUnit" 
									   data-role="dropdownlist"
									   data-option-label="(--- Select ---)"			                   
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.measurement_id,
					                              source: measurementDS"					                   
					                   required data-required-msg="required"
					                   style="width: 100%" />
							</td>
						</tr>											
						<tr>
							<td>Price <span style="color:red">*</span></td>
							<td>
								<input id="txtPrice" name="txtPrice"
								   data-role="numerictextbox"				                                      
				                   data-bind="value: obj.price"
				                   required data-required-msg="required"
				                   style="width: 100%" />
							</td>
						</tr>
						<tr>
							<td>Cash <span style="color:red">*</span></td>
							<td>
								<input id="txtAmount" name="txtAmount"
								   data-role="numerictextbox"				                                      
				                   data-bind="value: obj.amount"
				                   required data-required-msg="required"
				                   style="width: 100%" />
							</td>
						</tr>
						<tr>
							<td>Currency <span style="color:red">*</span></td>
							<td>
								<input id="ddlCurrency" name="ddlCurrency" 
									   data-role="dropdownlist"
									   data-option-label="(--- Select ---)"			                   
					                   data-value-primitive="true"
					                   data-text-field="code"
					                   data-value-field="id"
					                   data-bind="value: obj.currency_id,
					                              source: currencyDS"					                   
					                   style="width: 100%" 
					                   required data-required-msg="required" />
							</td>							
						</tr>
						<tr>
							<td>Memo</td>
							<td>
								<textarea id="txtDescription" cols="0" rows="2" class="k-textbox" 
										data-bind="value: obj.memo" style="width: 100%;"></textarea>
							</td>							
						</tr>												
					</table>

					<br>											
							
					<!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
						<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
					</div>
					<!-- // Form actions END -->

				</div> <!-- End Widget-Body List -->
			</div>
			<!-- // Collapsible Widget END -->				
					
		</div>
	</div>
</script>
<script id="itemAdjustment" type="text/x-kendo-template">
	<div class="container-960">
		<div id="example" class="k-content">
			
			<!-- Collapsible Widget -->			
			<div class="widget">
			    <div class="widget-head">
			    	<span class="btn btn-primary pull-right" 
							onclick="javascript:window.history.back()">X</span>
			        
			        <h4 class="heading glyphicons sort"><i></i> Item Adjustment</h4>							        	
			    </div>
			    <div class="widget-body">
			    	<table>
			    		<tr>
			    			<td>
						    	<input data-role="dropdownlist"
								   data-option-label="(--- Category ---)"
				                   data-auto-bind="false"
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: category_id,
				                              source: categoryDS,			                              
				                              events: {
				                                change: categoryChanges
				                              }"/>
			            	</td>
			            	<td>
				            	<select data-role="multiselect"
						           data-placeholder="item group ..."
						           data-value-primitive="true"
						           data-text-field="name"
						           data-value-field="id"
						           data-bind="value: selectedItemGroup,
						                      source: itemGroupDS,
						                      enabled: isCategorySelected"
						           style="width: 200px;" 
						    	></select>
						    </td>
						    <td>
						    	<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
				          		|
								<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
							</td>
						</tr>
					</table>

					<br>

			    	<div data-role="grid"
			    		data-auto-bind="false" 
			    		data-bind="source: lineDS" 
			    		data-toolbar="['excel']" 
			    		data-excel='{ fileName: "item_adjustment.xlsx" }'
			    		data-row-template="itemAdjustment-row-template" 
			    		data-columns='[			    			
			    			{ title: "No.", width:"5%" },
			    			{ title: "Description" },
			    			{ title: "Quantity" },
			    			{ title: "New Qty" },
			    			{ title: "Adjustment" }
			    		]'></div>

					<br>
					
					<div class="row-fluid">
						<div class="span5">				
							<table class="table table-borderless table-condensed cart_total">
								<tr>
									<td>Counter</td>
									<td>
										<input id="cbbReader" name="cbbReader" 
						    				   data-role="combobox"
							                   data-placeholder="select ..."
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-filter="startswith"							                   
							                   data-min-length="3"							                   
							                   data-text-field="fullname"
							                   data-value-field="id"							                   
							                   data-bind="value: obj.contact_id,
							                              source: contactDS"
							                   required data-required-msg="required"
							                   style="width: 100%" />
									</td>
								</tr>					          
								<tr data-bind="visible: isEdit">				
									<td><span data-bind="text: lang.lang.number"></span></td>
									<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
								</tr>
								<tr>
									<td>Segment</td>
									<td>
										<select data-role="multiselect" 
											   data-bind="source: segmentItemDS, value: obj.segments, events:{change: segmentChanges}"
											   data-value-primitive="true"
											   data-value-field="id" 
											   data-text-field="name"
											   data-placeholder="(--- Select ---)"
											   style="width: 100%" /></select>
									</td>
								</tr>								
							</table>
						</div>

					    <div class="span2">
					    	
					    </div>

						<div class="span5">
							<table class="table table-borderless table-condensed cart_total">
								<tr>
									<td>Date</td>
									<td>
										<input id="issuedDate" name="issuedDate" 
												data-role="datepicker"
												data-format="dd-MM-yyyy" 
												data-bind="value: obj.issued_date" 
												required data-required-msg="required" />
									</td>
								</tr>
								<tr>
									<td>Adjustment Account</td>
									<td>
										<input data-role="dropdownlist"
											   data-option-label="(--- Select ---)"							                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.account_id,
							                              source: accountDS"
							                   style="width: 100%;"
							            />
									</td>
								</tr>																					
					            <tr>
					            	<td>Memo</td>
					    			<td>
					    				<textarea cols="0" rows="2" class="k-textbox" data-bind="value: obj.memo" style="width: 100%"></textarea>
					    			</td>
								</tr>								
							</table>           		          	
					    </div>
					</div>
					
					<!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
						<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
					</div>
					<!-- // Form actions END -->

				</div> <!-- End Widget-Body List -->
			</div>
			<!-- // Collapsible Widget END -->				
					
		</div>
	</div>
</script>
<script id="itemAdjustment-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #"> 
    	<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.itemAdjustment.lineDS.indexOf(data)+1#			
		</td>   	
    	<td>#=description#</td>
    	<td align="right">#=kendo.toString(on_hand, "n")#</td>
    	<td align="right">
    		<input class="txt#=uid#" 
    			   data-role="numerictextbox"
                   data-format="n"
                   data-min="0"                   
                   data-bind="value: new_qty,
                   			  events:{ change: onChange }"
                   style="width: 100px;">    		
    	</td>
    	<td align="right">#=kendo.toString(unit, "n")#</td>
    </tr>
</script>
<script id="itemSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2>General Settings: Inventory</h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons bookmark" data-toggle="tab"><i></i><span class="strong">Category</span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons tag" data-toggle="tab"><i></i><span class="strong">Group</span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons ruller" data-toggle="tab"><i></i><span class="strong">Measurement</span></a>
	            </li>
	            <li><a href="#tab4-1" class="glyphicons certificate" data-toggle="tab"><i></i><span class="strong">Brand</span></a>
	            </li>	            
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">	            

	            <!-- Tab Category content -->
	            <div class="tab-pane active" id="tab1-1">
	            	<input data-role="dropdownlist"
            			   data-option-label="(--- Select ---)"            			   			                   
		                   data-value-primitive="true"
		                   data-auto-bind="false"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: category_sub_of,
		                              source: subCategoryDS"/>

		            <div class="input-append">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="Code..." data-bind="value: category_code">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="New..." data-bind="value: category_name">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="abbr..." data-bind="value: category_abbr">					    
					    <button class="btn btn-default" type="button" data-bind="click: addCategory"><i class="icon-plus"></i></button>					  
					</div>
		            
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>	            				            				
	            				<th>Code</th>	
	            				<th>Name</th>	
	            				<th>abbr</th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-category-template"
				                data-template="itemSetting-category-template"
				                data-bind="source: categoryDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Category Type content END -->	            

	            <!-- Tab Item Group content -->
	            <div class="tab-pane" id="tab2-1">
	            	<input data-role="dropdownlist"
            			   data-option-label="(--- Select ---)"            			   			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: item_group_category_id,
		                              source: categoryDS"/>

		            <input data-role="dropdownlist"
            			   data-option-label="(--- Select ---)"            			   			                   
		                   data-value-primitive="true"
		                   data-auto-bind="false"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: item_group_sub_of,
		                              source: subItemGroupDS"/>

		            <div class="input-append">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="Code..." data-bind="value: item_group_code">	
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="New Name..." data-bind="value: item_group_name">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="abbr..." data-bind="value: item_group_abbr">					    
					    <button class="btn btn-default" type="button" data-bind="click: addItemGroup"><i class="icon-plus"></i></button>					  
					</div>
		            
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>	            					            				
	            				<th>Code</th>	
	            				<th>Name</th>	
	            				<th>abbr</th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-item-group-template"
				                data-template="itemSetting-item-group-template"
				                data-bind="source: itemGroupDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Item Group Type content END -->

	            <!-- Tab Measurement content -->
	            <div class="tab-pane" id="tab3-1">
                	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="Measurement..." data-bind="value: measurement_name">					    
					    <button class="btn btn-default" type="button" data-bind="click: addMeasurement"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Measurement</th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-measurement-template"
				                data-template="itemSetting-measurement-template"
				                data-bind="source: measurementDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Measurement content END -->

	            <!-- Tab Brand content -->
	            <div class="tab-pane" id="tab4-1">
	            	<input data-role="dropdownlist"
            			   data-option-label="(--- Measurement ---)"            			   			                   
		                   data-value-primitive="true"
		                   data-auto-bind="false"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: brand_sub_of,
		                              source: subBrandDS"/>

		            <div class="input-append">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="Code..." data-bind="value: brand_code">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="New Brand..." data-bind="value: brand_name">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="abbr..." data-bind="value: brand_abbr">					    
					    <button class="btn btn-default" type="button" data-bind="click: addBrand"><i class="icon-plus"></i></button>					  
					</div>
		            
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Code</th>
	            				<th>Name</th>	            				
	            				<th>abbr</th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-brand-template"
				                data-template="itemSetting-brand-template"
				                data-bind="source: brandDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Brand Type content END -->	            

	        </div>
	    </div>

	</div>
</script>
<script id="itemSetting-category-template" type="text/x-kendo-tmpl">                    
    <tr>    	   	
   		<td>
    		#:code#
   		</td>
   		<td>
    		#:name#
   		</td>
   		<td>
    		#:abbr#
   		</td>   		
   		<td>   					        
	        #if(is_system=="0"){#
	        	<div class="edit-buttons">
		        	<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        	<a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
	        	</div>
	        #}#		   	
   		</td>
   	</tr>
</script>
<script id="itemSetting-edit-category-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>
        	<dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"	                   
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: sub_of,
	                              source: subItemGroupDS"/>
            </dd>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:code" name="code" required="required" validationMessage="required" />
                <span data-for="code" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" name="abbr" required="required" validationMessage="required" />
                <span data-for="abbr" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="itemSetting-item-group-template" type="text/x-kendo-tmpl">                    
    <tr>    	   	
   		<td>
    		#:code#
   		</td>
   		<td>
    		#:name#
   		</td>
   		<td>
    		#:abbr#
   		</td>   		
   		<td>	        
        	<div class="edit-buttons">
	        	<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
	        	<a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
        	</div>	        	   	
   		</td>
   	</tr>
</script>
<script id="itemSetting-edit-item-group-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>
        	<dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: category_id,
	                              source: categoryDS"/>
            </dd>
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"	                   
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: sub_of,
	                              source: subItemGroupDS"/>
            </dd>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:code" name="code" required="required" validationMessage="required" />
                <span data-for="code" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" name="abbr" required="required" validationMessage="required" />
                <span data-for="abbr" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="itemSetting-measurement-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			<div class="edit-buttons">		        
	        	<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
	        	<a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>		        
		   	</div>		   
   		</td>
   	</tr>
</script>
<script id="itemSetting-edit-measurement-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="name" required="required" validationMessage="required" />
                <span data-for="name" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="itemSetting-brand-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:code#
   		</td>
   		<td>
    		 #:name#
   		</td>
   		<td>
    		 #:abbr#
   		</td>
   		<td>
   			<div class="edit-buttons">		        
	        	<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
	        	<a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>		        
		   	</div>		   
   		</td>
   	</tr>
</script>
<script id="itemSetting-edit-brand-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>
        	<dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"	                   
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: sub_of,
	                              source: subBrandDS"/>
            </dd>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="name" required="required" validationMessage="required" />
                <span data-for="name" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" name="abbr" required="required" validationMessage="required" />
                <span data-for="abbr" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="itemReportCenter" type="text/x-kendo-template">
	<h2>Inventory Reports</h2>
	<br>

	<div class="row-fluid">
		<div class="span6">
			<h4>Inventory Position Analysis</h4>
			<div class="well margin-none" style="height: 150px;">
				Description here...
				<ul>					
	  				<li><a href='#/inventory_position_summary'>Inventory Position Summary</a></li> 
	  				<li><a href='#/inventory_position_detail'>Inventory Position Detail</a></li>
	  				<li><a href='#/inventory_sale_by_item'>Inventory Sale by Item Analysis</a></li> 
	  				<li><a href='#/inventory_turnover_list'>Inventory Turnover List</a></li>
	  				<li><a href='#/inventory_list'>Inventory List</a></li> 
				</ul>
			</div>
		</div>		
		<div class="span6">
			<h4>Inventory Movement Reports</h4>
			<div class="well margin-none" style="height: 150px;">
				Description here...
				<ul>
					<li><a href='#/inventory_movement_summary'>Inventory Movement Summary</a></li>
	  				<li><a href='#/inventory_movement_detail'>Inventory Movement Detail</a></li>	  	
					<li><a href='#/inventory_purchase_by_vendor_summary'>Purchase By Supplier Summary</a></li>
	  				<li><a href='#/inventory_purchase_by_vendor_detail'>Purchase By Supplier Detail</a></li>
	  								
				</ul>
			</div>
		</div>				
	</div>

	<p class="separator text-center"><i class="icon-ellipsis-horizontal icon-3x"></i></p>
</script>
<script id="inventoryPositionSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>	            	
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: as_of"
	                   placeholder="As of ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>

	            <br>

	            <div align="center">
					<h3>Inventory Position Summary</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>			

				<div data-role="grid"
					 data-column-menu="true"
					 data-groupable="true"
					 data-row-template="inventory-position-summary-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_position_summary.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                    { 'title': 'SKU' },
	                    { 'title': 'Item' },
	                    { 'field': 'item_group_id', 'title': 'Group' },
	                    { 'field': 'category_id', 'title': 'Category' },
	                    { 'title': 'On Hand' },
	                    { 'title': 'On PO' },
	                    { 'title': 'On SO' },
	                    { 'title': 'Avg Cost' },
	                    { 'title': 'Cost' },
	                    { 'title': 'Avg Price' }
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventory-position-summary-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">
        <td>#=sku#</td>
        <td>#=name#</td>
        <td>#=item_group.length>0?item_group[0].name:''#</td>
        <td>#=category.length>0?category[0].name:''#</td>        
        <td align="right">#=kendo.toString(on_hand, "n0")#</td>
        <td align="right">#=kendo.toString(on_po, "n0")#</td>
        <td align="right">#=kendo.toString(on_so, "n0")#</td>
        <td align="right">#=kendo.toString(cost, "c", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(on_hand*cost, "c", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(price_avg, "c", banhji.institute.locale)#</td>
   </tr>
</script>
<script id="inventoryPositionDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>

	            <br><br>

	            <div align="center">
					<h3>Inventory Position Detail</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>				

				<div data-role="grid"
					 data-column-menu="true"					 
					 data-row-template="inventory-position-detail-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_position_detail.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                    { 'field': 'issued_date', 'title': 'Date' },
	                    { 'title': 'Reference' },	                    
	                    { 'field': 'item_id','title': 'Item' },
	                    { 'title': 'Qty' },
	                    { 'title': 'Price' },	                    
	                    { 'title': 'On Hand' },	                    
	                    { 'title': 'Weighted Avg Cost' },
	                    { 'title': 'Cost' }	                    
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventory-position-detail-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">
        <td>#=kendo.toString(invoice.length>0?invoice[0].issued_date:"", "dd-MM-yyyy")#</td>
        <td><a href="\#/#=invoice.length>0?invoice[0].type:''#/#=id#"><i></i> #=invoice.length>0?invoice[0].number:''#</a></td>        
        <td>#=item[0].sku# #=item[0].name#</td>               
        <td align="right">#=unit#</td>
        <td align="right">#=kendo.toString(price, "c", banhji.institute.locale)#</td>
        <td align="right">#=on_hand#</td>         
        <td align="right">#=kendo.toString(cost, "c", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(on_hand * cost, "c", banhji.institute.locale)#</td>        
   </tr>
</script>
<script id="inventorySaleByItem" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>

	            <br><br>

	            <div align="center">
					<h3>Inventory Sale By Item Analysis</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>				

				<div data-role="grid"
					 data-column-menu="true"
					 data-groupable="true"					 
					 data-row-template="inventory-sale-by-item-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_sale_by_item_analysis.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                    { 'title': 'SKU' },
	                    { 'title': 'Item' },	                    
	                    { 'field': 'item_group_id', 'title': 'Group' },
	                    { 'field': 'category_id','title': 'Category' },
	                    { 'title': 'Qty Sold' },	                    	                    
	                    { 'title': 'W.Avg Price' },	                    	                    
	                    { 'title': 'Sale Revenue' },
	                    { 'title': 'W.Avg Cost' },
	                    { 'title': 'Gross Profit' },
	                    { 'title': 'Margin%' }	                    
	                 ]"></div>
			</div>
		</div>
	</div>
</script>
<script id="inventory-sale-by-item-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">
        <td>#=sku#</td>          
        <td>#=name#</td>
        <td>#=item_group.length>0?item_group[0].name:''#</td>
        <td>#=category.length>0?category[0].name:''#</td>       
        <td align="right">#=kendo.toString(qty, "n0", banhji.institute.locale)#</td>         
        <td align="right">#=kendo.toString(price, "c", banhji.institute.locale)#</td>
        <td align="right">
        	#amount = qty * price#
        	#=kendo.toString(amount, "c", banhji.institute.locale)#
        </td>
        <td align="right">#=kendo.toString(cost, "c", banhji.institute.locale)#</td>
        <td align="right">
        	#margin = (price-cost)*qty#
        	#=kendo.toString(margin, "c", banhji.institute.locale)#
        </td>
        <td align="right">#=kendo.toString(margin/amount, "p")#</td>        
   </tr>
</script>
<script id="inventoryTurnoverList" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>	            	
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: as_of"
	                   placeholder="from ..." />	                                   	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>

	            <br><br>

	            <div align="center">
					<h3>Inventory Turnover List</h3>					
					<span data-bind="text: strDate"></span>														
				</div>				

				<div data-role="grid"
					 data-column-menu="true"
					 data-groupable="true"					 				 
					 data-row-template="inventoryTurnoverList-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_turnover_list.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                    { 'title': 'SKU' },
	                    { 'title': 'Item' },	                    
	                    { 'field': 'item_group_id', 'title': 'Group' },
	                    { 'field': 'category_id', 'title': 'Category' },
	                    { 'title': 'Cost' },	                    	                    
	                    { 'title': 'Days' }	                                        
	                 ]"></div>
			</div>
		</div>
	</div>
</script>
<script id="inventoryTurnoverList-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">
        <td>#=sku#</td>          
        <td>#=name#</td>
        <td>#=item_group.length>0?item_group[0].name:''#</td>
        <td>#=category.length>0?category[0].name:''#</td>       
        <td align="right">#=kendo.toString(cost, "c", banhji.institute.locale)#</td>         
        <td align="right">#=kendo.toString(days, "n0")#</td>             
   	</tr>
</script>
<script id="inventoryList" type="text/x-kendo-template">
	<div class="container-fluid">
		<br>
		<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back();"><i></i></span>

		<h3>Inventory</h3>

		<div class="box-generic">
		    <!-- //Tabs Heading -->
		    <div class="tabsbar">
		        <ul>
		            <li class="glyphicons star active"><a href="#tab1" data-toggle="tab" data-bind="click: searchFavorite"><i></i> Favorite </a>
		            </li>
		            <li class="glyphicons list"><a href="#tab2" data-toggle="tab"><i></i> Category </a>
		            </li>
		            <li class="glyphicons building"><a href="#tab3" data-toggle="tab"><i></i> Vendor </a>
		            </li>		            		            	            
		        </ul>
		    </div>
		    <!-- // Tabs Heading END -->

		    <div class="tab-content">
		        <!-- // FavoriteTab content -->
		        <div class="tab-pane active" id="tab1">
		        		
		        </div>
		        <!-- // Favorite Tab content END -->

		        <!-- // Category Tab content -->
		        <div class="tab-pane" id="tab2">		            
	                <input id="categories" data-bind="value: category_id" />	                
	                <input id="itemGroups" data-bind="value: item_group_id" disabled="disabled" />
            	</div>
		        <!-- // Category Tab content END -->

		        <!-- // Vendor Tab content -->
		        <div class="tab-pane" id="tab3">
		            <div data-role="listview"
		            	 data-auto-bind="false"
		            	 data-selectable="true"			                 
		                 data-template="inventoryList-vendor-template"
		                 data-bind="source: vendorDS, events:{ change: vendorChanges}"></div>
		        </div>
		        <!-- // Vendor Tab content END -->		        
		    </div>

		    <br>

		    <div class="input-append">
			    <input class="col-md-2" id="appendedInputButtons" 
			    	type="text" placeholder="Items ..." 
			    	data-bind="value: searchField, events:{ change: search }">

			    <button class="btn btn-default" data-bind="click: search"><i class="icon-search"></i> Search</button>				    
			</div>
		</div>
		
		<br>

		<table class="table table-bordered">
	        <thead>
	            <tr>
	                <th>SKU</th>
	                <th>Items</th>
	                <th>Description</th>
	                <th>Qty</th>	                
	                <th>Price</th>	                
	            </tr>
	        </thead>
	        <tbody data-template="inventoryList-template"
	        	data-pageable="true" 
	        	data-bind="source: dataSource"></tbody>
	    </table>
	    <div id="pager" class="k-pager-wrap"
	    	 data-auto-bind="false"
             data-role="pager" data-bind="source: dataSource"></div>        

	</div>
</script>
<script id="inventoryList-template" type="text/x-kendo-template">
    <tr>
    	<td>#=sku#</td>
    	<td>#=name#</td>
    	<td>#=description#</td>
    	<td>
    		#if(on_hand<=order_point){#    		
    			<span class="badge badge-danger">#=kendo.toString(on_hand, "n0")#</span>
    		#}else{#
    			<span class="badge badge-info">#=kendo.toString(on_hand, "n0")#</span>
    		#}#

    		#=measurement==null?"":measurement#
    	</td>    	
    	<td>
    		#for(var i=0; i<price_list.length; i++) {#
    			#if(price_list[i].price>0){#
    				<span class="badge badge-inverse"> #=kendo.toString(price_list[i].price, "c", price_list[i].currency[0].locale)# </span> / #=price_list[i].measurement# 
    			#}else{#
    				<span class="badge badge-danger"> #=kendo.toString(price_list[i].price, "c", price_list[i].currency[0].locale)# </span> / #=price_list[i].measurement#
    			#}#
    			<br>    			    						 
			#}#
    	</td>    		
    </tr>
</script>
<script id="inventoryList-vendor-template" type="text/x-kendo-template">
    <div class="product-tmpl">
        <img src="#=image_url#" alt="#: company # image" />
        <h3>#:company#</h3>        
    </div>    
</script>
<style>
    #listView {
        padding: 10px 5px;
        margin-bottom: -1px;
        min-height: 510px;
    }
    .product-tmpl {
        float: left;
        position: relative;
        width: 111px;
        height: 170px;
        margin: 0 5px;
        padding: 0;
    }
    .product-tmpl img {
        width: 110px;
        height: 110px;
    }
    .product-tmpl h3 {
        margin: 0;
        padding: 3px 5px 0 0;
        max-width: 96px;
        overflow: hidden;
        line-height: 1.1em;
        font-size: .9em;
        font-weight: normal;
        text-transform: uppercase;
        color: #999;
    }
    .product-tmpl p {
        visibility: hidden;
    }
    .product-tmpl:hover p {
        visibility: visible;
        position: absolute;
        width: 110px;
        height: 110px;
        top: 0;
        margin: 0;
        padding: 0;
        line-height: 110px;
        vertical-align: middle;
        text-align: center;
        color: #fff;
        background-color: rgba(0,0,0,0.75);
        transition: background .2s linear, color .2s linear;
        -moz-transition: background .2s linear, color .2s linear;
        -webkit-transition: background .2s linear, color .2s linear;
        -o-transition: background .2s linear, color .2s linear;
    }
    .k-listview:after {
        content: ".";
        display: block;
        height: 0;
        clear: both;
        visibility: hidden;
    }
</style>
<script id="inventoryMovementSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>	            

	            <div align="center">
					<h3>Inventory Movement Summary</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>				

				<div data-role="grid"
					 data-column-menu="true"
					 data-groupable="true"
					 data-sortable="true"					 
					 data-row-template="inventory-movement-summary-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_movement_summary.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                 	{ 'field': 'sku', 'title': 'SKU' },	                    
	                    { 'field': 'name', 'title': 'Item' },
	                    { 'field': 'item_group_id', 'title': 'Group' },
	                    { 'field': 'category_id', 'title': 'Category' },
	                    { 'field': 'begining', 'title': 'Begining' },
	                    { 'field': 'purchase', 'title': 'Purchase' },	                    
	                    { 'field': 'sale', 'title': 'Sale' },
	                    { 'field': 'adjustment', 'title': 'Adjustment' },	                    
	                    { 'field': 'balance', 'title': 'Balance' }              
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventory-movement-summary-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">        
        <td>#=sku#</td>        
        <td>#=name#</td>
        <td>#=item_group.length>0?item_group[0].name:''#</td>
        <td>#=category.length>0?category[0].name:''#</td>         
        <td align="right">#=kendo.toString(begining, "n0")#</td>         
        <td align="right">#=kendo.toString(purchase, "n0")#</td>
        <td align="right">#=kendo.toString(sale, "n0")#</td>
        <td align="right">#=kendo.toString(adjustment, "n0")#</td>
        <td align="right">#=kendo.toString(((begining + purchase) - sale) + adjustment, "n0")#</td>        
   </tr>
</script>
<script id="inventoryMovementDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>

	            <div align="center">
					<h3>Inventory Movement Detail</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>				

				<div data-role="grid"
					 data-column-menu="true"
					 data-groupable="true"
					 data-sortable="true"					 
					 data-row-template="inventory-movement-detail-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_movement_detail.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                 	{ 'field': 'invoice[0].issued_date', 'title': 'Date' },
	                 	{ 'field': 'invoice[0].type', 'title': 'Type' },
	                 	{ 'field': 'invoice[0].number', 'title': 'Reference' },	                 	                 
	                    { 'field': 'item[0].sku', 'title': 'Item' },	                    	                                  
	                    { 'field': 'unit', 'title': 'Quantity' },
	                    { 'field': 'cost', 'title': 'Cost' },
	                    { 'field': 'price', 'title': 'Price' },              
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventory-movement-detail-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">        
        <td>#=kendo.toString(invoice.length>0?new Date(invoice[0].issued_date):'', "dd-MM-yyyy")#</td>
        <td>#=invoice.length>0?invoice[0].type:''#</td>        
        <td><a href="\#/#=invoice.length>0?invoice[0].type:''#/#=id#"><i></i> #=invoice.length>0?invoice[0].number:''#</a></td>        
        <td>#=item[0].sku# #=item[0].name#</td>             
        <td align="right">#=kendo.toString(unit * movement, "n0")#</td>
        <td align="right">
        	#if(invoice.length>0){#	        	
	        	#if(invoice[0].type==='Purchase'){#
	        		#=kendo.toString(price, "c", banhji.institute.locale)#
	        	#}else if(invoice[0].type==='Invoice' || invoice[0].type==='Receipt'){#
	        		#=kendo.toString(cost, "c", banhji.institute.locale)#
	        	#}#
	        #}#
        </td>
        <td align="right">
        	#if(invoice.length>0){#
	        	#if(invoice[0].type==='Invoice'){#
	        		#=kendo.toString(price, "c", banhji.institute.locale)#
	        	#}#
        	#}#
        </td>                
   </tr>
</script>
<script id="inventoryPurchaseByVendorSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>
	            
	            <div align="center">
					<h3>Purchase By Supplier Summary</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>				

				<div data-role="grid"
					 data-column-menu="true"					 
					 data-sortable="true"					 
					 data-row-template="inventoryPurchaseByVendorSummary-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_movement_detail.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[	                 	            
	                    { 'field': 'name', 'title': 'Supplier' },	                                                     
	                    { 'field': 'unit', 'title': 'Quantity' },
	                    { 'field': 'amount', 'title': 'Amount' }              
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventoryPurchaseByVendorSummary-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">        
        <td>#=name#</td>        
        <td align="right">#=kendo.toString(unit, "n0")#</td>
        <td align="right">#=kendo.toString(amount, "c", banhji.institute.locale)#</td>        
   </tr>
</script>
<script id="inventoryPurchaseByVendorDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>
	            
	            <div align="center">
					<h3>Purchase By Supplier Detail</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>				

				<div data-role="grid"
					 data-column-menu="true"					 
					 data-sortable="true"					 
					 data-row-template="inventoryPurchaseByVendorDetail-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_movement_detail.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                 	{ 'field': 'issued_date', 'title': 'Date' },
	                 	{ 'field': 'name', 'title': 'Supplier' },
	                 	{ 'field': 'number', 'title': 'Number' },	                 	             	            
	                   	{ 'field': 'item_id', 'title': 'Item' },
	                   	{ 'field': 'unit', 'title': 'Qty' },
	                   	{ 'field': 'price', 'title': 'Price' },                                                    
	                    { 'field': 'amount', 'title': 'Amount' }              
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventoryPurchaseByVendorDetail-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">        
        <td>#=kendo.toString(issued_date, "dd-MM-yyyy")#</td>
        <td>#=name#</td>
        <td><a href="\#/#=type#/#=id#"><i></i> #=number#</a></td>
        <td>#=item[0].name#</td>        
        <td align="right">#=kendo.toString(unit, "n0", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(price, "c0", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(amount, "c0", banhji.institute.locale)#</td>        
   </tr>
</script>

<!-- ***************************
 *	Electricity Section       *
**************************** -->
<script id="eDashBoard" type="text/x-kendo-template">
	<div class="container-fluid menu-hidden sidebar-hidden-phone fluid menu-left">
		<h1>ទំព័រអគ្គីសនី</h1>	
		<div class="row-fluid row-merge border-top">
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="" class="widget-stats widget-stats-primary widget-stats-4">
						<span class="txt">Balance</span>
						<span class="count" style="font-size: 35px;" data-bind="text: balance"></span>
						<span class="glyphicons coins"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="" class="widget-stats widget-stats-inverse widget-stats-4">
						<span class="txt">Deposit</span>
						<span class="count" style="font-size: 35px;" data-bind="text: deposit"></span>
						<span class="glyphicons credit_card"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>			
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="" class="widget-stats widget-stats-gray widget-stats-4">
						<span class="txt">Customer</span>
						<span class="count"​><span data-bind="text: activeCustomer"></span> <span>នាក់</span></span> 
						<span class="glyphicons user"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>			
		</div>

		<div class="row-fluid">			
			<div class="span8">
				<div class="heading-buttons">
					<h2 class="heading pull-left"><i class="icon-bar-chart icon-fixed-width text-primary"></i> លក់ប្រចាំខែ</h2>
					
					<div class="clearfix"></div>
				</div>

				<div class="innerLR innerT">			
					<div id="esale-graph" style="height: 150px;"></div>
				</div>
			</div>

			<div class="span4">
				<div class="widget widget-body-white">
					<div class="widget-head"><h4 class="heading strong text-uppercase">ស្ថានភាពអតិថិជន</h4></div>
					<div class="widget-body padding-none">
						<table class="table table-striped table-vertical-center table-condensed margin-none">
							<tbody>
								<tr>									
									<td class="text-primary border-none">ផ្អាកប្រើប្រាស់</td>
									<td class="text-right strong">
										<span class="badge badge-warning" data-bind="text: voidCustomer"></span>
										នាក់
									</td>
								</tr>
								<tr>									
									<td class="text-primary">ឈប់ប្រើប្រាស់</td>
									<td class="text-right strong">
										<span class="badge badge-important" data-bind="text: inactiveCustomer"></span>
										នាក់
									</td>
								</tr>
								<tr>									
									<td class="text-primary">សរុបទាំងអស់</td>
									<td class="text-right strong">
										<span class="badge badge-inverse" data-bind="text: totalCustomer"></span>
										នាក់
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<div class="widget widget-heading-simple widget-body-white">
					<div class="widget-body padding-none">
						<div class="row-fluid row-merge">
							<div class="span6">
								<div class="innerAll center">
									<h5 class="strong muted text-uppercase"><i class="icon-money text-faded"></i> មិនទាន់បង់ប្រាក់</h5>
									<span class="text-xlarge strong text-primary" data-bind="text: totalUnpaid"></span>
									នាក់
								</div>
							</div>
							<div class="span6">
								<div class="innerAll center muted">
									<h5 class="strong muted text-uppercase"><i class="icon-cut text-faded"></i> ផ្ដាច់ចរន្ត</h5>
									<span class="text-xlarge strong" data-bind="text: totalDisconnect"></span>
									នាក់
								</div>
							</div>
						</div>
					</div>
				</div>								
			</div>			
		</div>	

		<div class="row-fluid">		
	        <div>
	        	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />

	        	<input data-role="datepicker"
	        		   data-format="dd-MM-yyyy"
	                   data-bind="value: sdate,
	                              events: { change: dateChanges }" >

	            <input data-role="datepicker"
	            	   data-format="dd-MM-yyyy"
	                   data-bind="value: edate,
	                              events: { change: dateChanges }" >
	            
	            <button type="button" data-role="button" data-icon="search" data-bind="click: search"></button>
	        </div>
        	
            <div data-role="grid" 
					data-bind="source: saleByLocationDS"
				    data-auto-bind="false"	        
				    data-row-template="esale-by-location-row-template"						                           
				    data-columns='[
				    	{ title: "No.", width: 45 },				       	
				        { title: "Location" },	                     
				        { title: "អតិថិជនកំពុងប្រើប្រាស់" },
				        { title: "អតិថិជនឈប់ប្រើប្រាស់" },
				        { title: "Deposit" },
				        { title: "បរិមាណលក់ភ្លើង" },	            
				        { title: "Amount" },
				        { title: "ជំពាក់" },
				        { title: "Balance" }				                           	                    
				    ]'></div>

    	</div>
    </div>
</script>
<script id="esale-by-location-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td class="sno">1</td>
		<td>#=location_name#</td>		
		<td align="right">#=kendo.toString(active_customer, "n0")# នាក់</td>
		<td align="right">#=kendo.toString(inactive_customer, "n0")#​ នាក់</td>				
		<td align="right">#=kendo.toString(deposit, "c0", banhji.eDashBoard.locale)#</td>
		<td align="right">#=kendo.toString(usage, "n0")# kWh</td>		
		<td align="right">#=kendo.toString(sale, "c0", banhji.eDashBoard.locale)#</td>
		<td align="right">#=kendo.toString(unpaid, "c0", banhji.eDashBoard.locale)#</td>
		<td align="right">#=kendo.toString(sale-unpaid, "c0", banhji.eDashBoard.locale)#</td>				
    </tr>   
</script>

</script>
<script id="eMeter" type="text/x-kendo-template">
	<div class="container-fluid">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="exampleMain" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3>Meter</h3>

					<input id="meters" style="width: 200px" /> |
					<input id="customers" style="width: 200px" />					
					<br><br>

					<div id="meter-window" data-role="window" data-visible="false" data-modal="true" data-resizable="false" data-iframe="true">				    	
					    <div id="example">
					    	<table cellpadding="5" cellspacing="5">			                
				                <tr>
				                  	<td>Type <span style="color:red">*</span></td>
				                  	<td>
				                  		<input id="item" name="item"
				                  			   data-role="dropdownlist"				                  			   
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: meter.item_id, source: itemDS"
							                   data-option-label="(--- Select ---)"
				                  			   required data-required-msg="ត្រូវការ Type" />
				                  	</td>
				                  	<td>Location <span style="color:red">*</span></td>
				                  	<td>
				                  		<input id="location" name="location"				                  				
							                   	data-bind="value: meter.location_id"
							                   	required data-required-msg="ត្រូវការ Location" />
				                  	</td>			                  		                  	                             
				                </tr>
				                <tr>
				                  	<td>លេខកូដកុងទ័រ <span style="color:red">*</span></td>                    
				                  	<td>
				                  		<input id="meterNo" name="meterNo" class="k-textbox" 
				                  				data-bind="value: meter.number" 
				                  				required data-required-msg="ត្រូវការ លេខកូដកុងទ័រ"
				                  				style="width: 160px;" />
				                  	</td>                             
				                	<td>ប្រអប់</td>
				                  	<td>
				                  		<input id="electricityBox" name="electricityBox" 
				                  				disabled="disabled" 
				                  				data-bind="value: meter.electricity_box_id" />				                  			                  				                  		
				                  	</td>
				                </tr>
				                <tr>             
				                  	<td></td>
				                  	<td>
				                  		<input type="checkbox" data-bind="checked: meter.cover_sealed" /> សំណគំរបខ្សែ
				                  		<input type="checkbox" data-bind="checked: meter.ear_sealed" /> សំណត្រចៀក			                  		
				                  	</td>
				                  	<td>អំពែ</td>
				                	<td>
				                		<input data-role="dropdownlist"
				                				data-option-label="(--- Select ---)"
							                   	data-auto-bind="false"
							                   	data-value-primitive="true"
							                   	data-text-field="name"
							                   	data-value-field="id"
							                   	data-bind="value: meter.amperes.id, source: ampereList" />
				                	</td>			                
				                </tr>
				                <tr>
				                	<td>មេគុណ</td>
				                	<td>
				                		<input id="multiplier" name="multiplier"
				                			data-role="numerictextbox" 
				                			data-bind="value: meter.multiplier" 
				                			data-format="#" min="1" step="100" 
				                			placeholder="ឧ.1/10/100/1,000" />
				                	</td>
				                	<td>ចំនួនហ្វា</td>
				                  	<td>
				                  		<input data-role="dropdownlist"
				                  				data-option-label="(--- Select ---)"
							                   	data-auto-bind="false"
							                   	data-value-primitive="true"
							                   	data-text-field="name"
							                   	data-value-field="id"
							                   	data-bind="value: meter.phases.id, source: phaseList" />
				                  	</td>
				                </tr>
				                <tr>             
				                  	<td>ចំនួនខ្ទង់នាឡិកា <span style="color:red">*</span></td>
				                  	<td>
				                  		<input id="maxNo" name="maxNo" 
				                  				data-role="numerictextbox" 
				                  				data-bind="value: meter.max_number" 
				                  				data-format="n0" min="0" 
				                  				placeholder="ឧ.10,000/100,000" 
				                  				required data-required-msg="ត្រូវការ ចំនួនខ្ទង់នាឡិកា" />
				                  	</td>	                  	  	
				                  	<td>អាំងតង់សីុតេ</td>
				                  	<td>
				                  		<input data-role="dropdownlist"
				                  				data-option-label="(--- Select ---)"
							                   	data-auto-bind="false"
							                   	data-value-primitive="true"
							                   	data-text-field="name"
							                   	data-value-field="id"
							                   	data-bind="value: meter.voltages.id, source: voltageList" />
				                  	</td>                                   
				                </tr>
				                <tr>
				                	<td>ស្ថានភាព <span style="color:red">*</span></td>
				                  	<td>
				                  		<input id="meterStatus" name="meterStatus"
				                  				data-role="dropdownlist"
												data-option-label="(--- Select ---)"
												required data-required-msg="ត្រូវការ ស្ថានភាព" 
				                  				data-text-field="name" 
				                  				data-value-field="id" 
				                  				data-value-primitive="true"			                  				
				                  				data-bind="source: statusList, value: meter.status" />
				                  	</td>
				               	  	<td>តំលៃលក់</td>
				                  	<td>
				                  		<input data-role="dropdownlist"
				                  			   data-option-label="(--- Select ---)"				                  			   
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: meter.tariffs.id, source: tariffList" />
				                  	</td>			                	
				                </tr>
				                <tr>
				                	<td>REACTIVE OF</td>
				                	<td>
				                		<input id="reactiveOf" name="reactiveOf"
				                			   data-role="dropdownlist"
				                  			   data-option-label="(--- Select ---)"			                  			   
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: meter.reactive_of, source: parentMeterList" />
				                	</td>                 	
				                  	<td>លើកលែង</td>
				                  	<td>
				                  		<input data-role="dropdownlist"
				                  			   data-option-label="(--- Select ---)"			                  			   
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: meter.exemptions.id, source: exemptionList" />
				                  	</td>	                  	                        
				                </tr>
				                <tr valign="top">
				                	<td>BACKUP OF</td>
				                	<td>
				                		<input id="backupOf" name="backupOf"
				                			   data-role="dropdownlist"
				                  			   data-option-label="(--- Select ---)"
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: meter.backup_of, source: parentMeterList" />
				                	</td>
				                	<td>Memo</td>
				                  	<td>
				                  		<textarea name="memo" id="memo" cols="" rows="2" 
				                  				data-bind="value: meter.memo"></textarea>
				                  	</td>
				                </tr>			                		                			                
				          	</table>				          
			          	
			          		<div id="status"></div>
			          		<button id="save" name="save" class="btn btn-primary"><i class="icon-hdd icon-white"></i> Save</button>                                  
			                <button class="btn" data-bind="click: closeMeterWindow"><i class="icon-off"></i> បិទ</button>			                
			          	</div>
				    </div>							
					
		        	<button class="btn btn-inverse" data-bind="click: openMeterWindow"><i class="icon-plus icon-white"></i></button>
					<br>
	            	<div data-role="grid" data-bind="source: dataSource"
				        data-auto-bind="false"								        			        
				        data-row-template="eMeter-row-template"				        			                        
				        data-columns='[
				        	{ title: "#Meter" },
				            { title: "Type" },								            
				            { title: "ប្រអប់" },
				            { title: "ពត័មាន" },				            
				            { title: "ថ្លៃលក់" },
				            { title: "តួនាទី" },								            
				            { title: "ស្ថានភាព" }	,
				            { title: "", width: 100 }                    	                    
				        ]'></div>				
											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div>		
	</div> <!-- // End div row-fluid-->	
</script>
<script id="eMeter-row-template" type="text/x-kendo-template">	
	<tr>		
		<td>#=number#</td>
		<td>#=item_name#</td>
		<td>#=electricity_box_number#</td>		
		<td>
			<div>#=amperes.name#</div>
			<div>#=phases.name#</div>
			<div>#=voltages.name#</div>
		</td>
		<td>			
			<div>#=tariffs.name!==undefined?tariffs.name:""#</div>
			<div>#=exemptions.name!==undefined?exemptions.name:""#</div>
			<div>#=maintenances.name!==undefined?maintenances.name:""#</div>
		</td>
		<td>
			#if(reactive_of>0){#
				REACTIVE
			#}else if(backup_of>0){#
				BACKUP
			#}else{#
				
			#}#
		</td>
		<td>#:status==1 ? "ប្រើប្រាស់" : "ឈប់ប្រើ"#</td>
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: delete"><i></i></span>
			<span class="glyphicons no-js edit" data-bind="click: edit"><i></i></span>						
		</td>		
	</tr>
</script>

<script id="eReading" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3>បញ្ចូលអំនានកុងទ័រ</h3>
					
					<div class="hidden-print">
						<div class="accordion" id="accordion">
						    <!-- //Accordion Item -->
						    <div class="accordion-group">
						        <div class="accordion-heading">
					            	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-1">
										បញ្ចូលអំនានដោយផ្ទាល់ដៃ
									</a>
						        </div>
						        <div id="collapse-1" class="accordion-body in collapse" style="height: auto;">
						            <div class="accordion-inner">
						            	<input data-role="datepicker" 
						            			data-bind="value: monthOfSearch" 
						            			data-start="year" data-depth="year" 
						            			data-format="MM-yyyy" placeHolder="Month Of" />						
										
										<input id="company" data-bind="value: company_id, events:{ change: companyChanges" />
						            	<input id="elocation" disabled="disabled" data-bind="value: location_id" />										
						            	|
						            	<input id="meters" data-bind="value: meter_id" />						            							            	
						          					          					          			          		
						          		<button type="button" class="btn btn-default" data-bind="click: search"><i class="icon-search"></i></button>
						          		<button type="button" class="btn btn-default" onclick="javascript:window.print()"><i class="icon-print"></i></button>					          			
						            </div>
						        </div>
						    </div>
						    <!-- // Accordion Item END -->

						    <!-- //Accordion Item -->
						    <div class="accordion-group">
						        <div class="accordion-heading">
					            	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-2">
							        	បញ្ចូលអំនានតាម IR Reader
							      	</a>
						        </div>
						        <div id="collapse-2" class="accordion-body collapse" style="height: 0px;">
						            <div class="accordion-inner">
						            	<input id="myFile" type="file" accept="text/csv">
						            	<button type="button" class="k-button btn-info" data-bind="click: readFile">ទាញយកទិន្នន័យ</button>
						            	<button type="button" class="btn btn-default" onclick="javascript:window.print()"><i class="icon-print"></i></button>
						            	<br>
										<span data-bind="text: uploadStatus"></span>
						            </div>
						        </div>
						    </div>
						    <!-- // Accordion Item END -->
						</div>					
					</div>

			        <div align="center">
			        	<h3 data-bind="text: strMonthOf"</h3>
			        	<h4 data-bind="text: strTransformer"></h4>
			        </div>
			        
			        <div class="demo-section">			        
					    <table class="table table-bordered table-striped table-white">
					        <thead>
					            <tr>
					                <th>Customer</th>
					                <th>ប្រអប់</th>						                
					                <th>Meter</th>
					                <th>មេគុណ</th>
					                <th>ជុំថ្មី</th>
					                <th>លេខចាស់</th>
					                <th>លេខថ្មី</th>					                
					                <th class="right">សរុប</th>
					            </tr>
					        </thead>
					        <tbody data-role="listview"
					        		data-auto-bind="false"					        		 
					        		data-template="eReading-row-template" 
					        		data-bind="source: dataSource"></tbody>
					        <tfoot data-template="eReading-footer-template" 
					        		data-bind="source: this"></tfoot>						        
					    </table>
					    <div id="pager" class="k-pager-wrap"></div>
				    </div>				       
			        
					<br>					

			        <div>
			        	Month Of
			        	<input id="monthOf" name="monthOf" data-role="datepicker" 
				            			data-bind="value: month_of" 
				            			data-start="year" data-depth="year" data-format="MM-yyyy"
				            			required data-required-msg="ត្រូវការ Month Of"
				            			placeholder="ខែ-ឆ្នាំ" />				    
				    	
				    	ថ្ងៃអានចាប់ពី
                        <input type="text" data-role='datepicker' 
                        		id="fromDate" name="fromDate"
                        		data-bind="value: from_date"	            				
                        		data-type="date" data-format="dd-MM-yyyy"
                        		placeholder="ថ្ងៃ-ខែ-ឆ្នាំ"
                        		required data-required-msg="ត្រូវការ ថ្ងៃអានចាប់ពី"  />                        	    				        
			            
			            To
                        <input type="text" data-role='datepicker' 
                        		id ="toDate" name="toDate"
                        		data-bind="value: to_date"	            				 
                        		data-type="date" data-format="dd-MM-yyyy"
                        		placeholder="ថ្ងៃ-ខែ-ឆ្នាំ"
                        		required data-required-msg="ដល់ថ្ងៃណា?" 
                        		data-greaterdate-field="fromDate" 
                        		data-greaterdate-msg='ត្រូវថ្មីជាង ថ្ងៃអានចាប់ពី' />                        
			            			        
			        	អ្នកអាន
			          	<input data-role="dropdownlist"
			                   data-option-label="(--- Select ---)"
			                   data-value-primitive="true"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: read_by, source: readerDS"
			                   required data-required-msg="ត្រូវការ អ្នកអាន" />            
			        </div>
			        
			        <br>

			        <div id="status"></div>            			        	
          			<button id="save" class="btn btn-primary"><i class="icon-hdd icon-white"></i> Save​</button>

				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="eReading-row-template" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=fullname#</td>	
		<td>#=electricity_box_number#</td>
		<td>#=number#</td>
		<td>#=multiplier#</td>
		<td align="center">
			<input type="checkbox" data-bind="checked: new_round, events:{ change: onChange }" />
		</td>		
		<td>
			<input data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: previous, events:{ change: onChange }"
                   style="width: 100px" #=previous>0?disabled='disabled':''# />
		</td>
		<td>
			<input class="txt#=index#" data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: current, events:{ change: onChange }"                   
                   style="width: 100px" />            
			<span class="label label-important" data-bind="invisible: isValid"><strong>កំហុស!</strong></span>			
		</td>		
		<td class="right" data-bind="text: usage"></td>	
    </tr>
</script>
<script id="eReading-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="8" style="font-size:30px;">
            Total: #:total()# kWh
        </td>
    </tr>
</script>

<script id="eInvoice" type="text/x-kendo-template">	
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3>រៀបចំវិក្កយបត្រ</h3>

					<br>
					
					<div class="hidden-print">
						<input data-role="datepicker" 
		            			data-bind="value: monthOfSearch" 
		            			data-start="year" data-depth="year" 
		            			data-format="MM-yyyy" placeHolder="Month Of" />						
										
						<input id="company" data-bind="value: company_id, events:{ change: companyChanges" />
		            	<input id="elocation" disabled="disabled" data-bind="value: location_id" />
		            	|
		            	<input id="meters" data-bind="value: meter_id" />		            	

		            	<button type="button" class="btn btn-default" data-bind="click: search"><i class="icon-search"></i></button>								
					</div>											

					<br>
					
					<table class="table table-bordered table-striped table-white">
				        <thead>
				            <tr>
				                <th><input type="checkbox" data-bind="checked: chkAll, events: {change : checkAll}" /></th>				                				                
				                <th>Customer</th>	                    
				                <th>ប្រអប់</th>
				                <th>Meter</th>
				                <th>មេគុណ</th>				                
				                <th>លេខចាស់</th>
				                <th>លេខថ្មី</th>
				                <th>សរុប</th>	                    
				            </tr>
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="eInvoice-row-template" 
				        		data-auto-bind="false" 
				        		data-bind="source: readingDS"></tbody>
				        <tfoot data-template="eInvoice-footer-template" 
					        		data-bind="source: this"></tfoot>	            
				    </table>
				    <div id="pager" class="k-pager-wrap"></div>

				    <br>
				    
				    <div>
						Month Of
						<input id="monthOf" name="monthOf" data-role="datepicker" 
		            			data-bind="value: month_of"	data-start="year" 
		            			data-depth="year" data-format="MM-yyyy"
		            			required data-required-msg="ត្រូវការ Month Of" />
				        ថ្ងៃចេញវិក្កយបត្រ
				        <input id="issuedDate" name="issuedDate" data-role="datepicker" 
		            			data-bind="value: issued_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="ត្រូវការ ថ្ងៃចេញវិក្កយបត្រ" />
				        ថ្ងៃចាប់ផ្ដើមទទួលប្រាក់
				        <input id="paymentDate" name="paymentDate" data-role="datepicker" 
		            			data-bind="value: payment_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="ត្រូវការ ថ្ងៃបង់ប្រាក់" />
				        Due Date
				        <input id="dueDate" name="dueDate" data-role="datepicker" 
		            			data-bind="value: due_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="ត្រូវការ Due Date" />			           	          	
				    </div>
				         
				    <br />
				    
				    <div>
				      	<div id="status"></div>				      	
				      	<button id="save" class="btn btn-primary"><i class="icon-list-alt icon-white"></i> រៀបចំវិក្កយបត្រ</button>     
				    </div>			   
				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->
	</div>	
</script>
<script id="eInvoice-row-template" type="text/x-kendo-tmpl">
	<tr>
		<td align="center">
		   <input type="checkbox" data-bind="checked: isCheck" />
		</td>						
		<td>#=customers.fullname#</td>		
		<td>#=meters.electricity_box_number#</td>
		<td>#=meters.number#</td>
		<td>#=meters.multiplier#</td>						
		<td class="right">#=previous#</td>
		<td class="right">#=current#</td>		
		<td class="right">#=usage# kWh</td>		
    </tr>
</script>
<script id="eInvoice-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="8" style="font-size:30px;">
            Total: #:total()# kWh
        </td>
    </tr>
</script>

<script id="eInvoicePrint" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3 class="hidden-print">Printវិក្កយបត្រ</h3>
					<br>					

					<div class="hidden-print">								
						<input data-role="datepicker" 
		            			data-bind="value: monthOfSearch" 
		            			data-start="year" data-depth="year" 
		            			data-format="MM-yyyy" placeHolder="Month Of" />						
										
						<input id="company" data-bind="value: company_id, events:{ change: companyChanges" />
		            	<input id="elocation" disabled="disabled" data-bind="value: location_id" />
		            	|
		            	<input id="invoices" />
						
						<button type="button" class="btn btn-default" data-bind="click: search"><i class="icon-search"></i></button>
						<button type="button" class="btn btn-default" onclick="javascript:window.print()"><i class="icon-print"></i></button>				
						<input id="chkVisible" type="checkbox" data-bind="events: {click: print}" /> ប្រើក្រដាសពុម្ព
						<br>
						<div id="pager" class="k-pager-wrap"></div>																			
					</div>					
					
					<div data-role="listview" data-bind="source: dataSource" 
						data-template="eInvoice-print-row-template" data-auto-bind="false"></div>
		
				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->
	</div>	
</script>
<script id="eInvoice-print-row-template" type="text/x-kendo-tmpl">	
  	<div class="print">
  		<table width="100%" style="margin-bottom: 8px;">
	    	<tr>
	    		<td align="center" >
	    			<img src="/banhji/#:companies.image_url#" height="90" width="60" style="float: left">
	    			<div>	    			
		    			<h4>#:companies.name#</h4>					
						#:companies.address# <br>
						#:companies.phone# /
						#:companies.mobile#
					</div>					
	    		</td>
	    	</tr>
	    </table>	        

	    <div class="hiddenPrint" style="border-bottom: 1px solid black;"></div>							
		
		<table width="100%" style="margin-bottom: 8px; font-size: xx-small;">
			<tr>
				<td valign="top" rowspan="6" width="50%" align="left">
					<span class="#=number#"></span>
					#:customers.number# #:customers.fullname# <br>
					#:customers.address# <br>
					ថ្ងៃចាប់ផ្ដើមទទួលប្រាក់: #=kendo.toString(new Date(payment_date), "dd-MM-yyyy")#
				</td>
				<td class="hiddenPrint" width="50%">Number INVOICE NO</td>
				<td>#:number#</td>							
			</tr>
			<tr>
				<td class="hiddenPrint">វិក្កយបត្រ INVOICE DATE</td>
				<td>#:kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>											
			</tr>
			<tr>
				<td class="hiddenPrint">Location AREA</td>
				<td>#:location_name#</td>							
			</tr>
			<tr>
				<td class="hiddenPrint">លេខប្រអប់ BOX NO</td>
				<td>#:invoiceLineList[0].meters.electricity_box_number#</td>				
			</tr>
			<tr>
				<td class="hiddenPrint">គិតចាប់ពីថ្ងៃទី FROM</td>
				<td>#:kendo.toString(new Date(invoiceLineList[0].meters.from_date), "dd-MM-yyyy")#</td>							
			</tr>
			<tr>
				<td class="hiddenPrint">ដល់ថ្ងៃទី TO</td>
				<td>#:kendo.toString(new Date(invoiceLineList[0].meters.to_date), "dd-MM-yyyy")#</td>
			</tr>
		</table>		
		
		<table width="100%" style="height: 260px;font-size: xx-small;">
			<thead class="hiddenPrint" style="border:1px solid black">
				<tr>
					<th align="center" width="10%">លេខកុងទ័រ <br> METER</th>
					<th align="center" width="15%">អំនានចាស់ <br> PREVIOUS</th>
					<th align="center" width="15%">អំនានថ្មី <br> CURRENT</th>
					<th align="center" width="10%">មេគុណ <br> <span style="font-size:5pt">MULTIPLICATION</span></th>
					<th align="center" width="15%">ប្រើប្រាស់ <br> <span style="font-size:5pt">CONSUMPTION</span></th>
					<th align="center" width="15%">តំលៃឯកត្តា <br> RATE</th>
					<th align="center" width="20%">តំលៃសរុប <br> AMOUNT</th>	
				</tr>
			</thead>			
			<tbody>
				<tr>					
					<td colspan="6" align="right" valign="top">
						ប្រាក់ជំពាក់ខែមុន						
						<br>
						ប្រាក់សងខែមុន						
						<br>
						ប្រាក់នៅជំពាក់						
					</td>
					<td align="right" valign="top">#:kendo.toString(kendo.parseFloat(balance_forward)/kendo.parseFloat(rate), 'c', locale)#</td>
				</tr>												
				#for(var i=0; i<invoiceLineList.length; i++) {#
					<tr>
						<td width="10%">
							#:invoiceLineList[i].meters.number#												
						</td>
						<td align="right">#:invoiceLineList[i].meters.previous#</td>
						<td align="right">#:invoiceLineList[i].meters.current#</td>
						<td align="center">#:invoiceLineList[i].meters.multiplier#</td>
						<td align="right">#:kendo.toString(kendo.parseInt(invoiceLineList[i].unit), 'n0')#</td>
						<td align="right">#:kendo.toString(kendo.parseFloat(invoiceLineList[i].price)/kendo.parseFloat(rate), 'c', locale)#</td>
						<td align="right">#:kendo.toString(kendo.parseFloat(invoiceLineList[i].amount)/kendo.parseFloat(rate), 'c', locale)#</td>
					</tr>
				#}#											
			</tbody>
			<tfoot>
				<tr>
					<td colspan="7">
						<p>#:memo#</p>
					</td>
				</tr>				
			</tfoot>			
		</table>				

        <table class="hiddenPrint" width="100%" border="1" cellpadding="2" cellspacing="2" style="font-size: xx-small;">
        	<tr>
        		<td rowspan="6" width="50%">
        			#=companies.term_of_condition#
        		</td>
        		<td width="30%">
        			<div style="float:left;text-align:left;">បំណុលខែនេះ</div>
  					<div style="float:right;text-align:right; font-size: 6pt;">TOTAL BALANCE</div>
        		</td>
        		<td width="20%" align="right" style="visibility:visible;">#:kendo.toString(kendo.parseFloat(total)/kendo.parseFloat(rate), 'c', locale)#</td>
        	</tr>
        	<tr>
        		<td>
        			<div style="float:left;text-align:left;">ទឹកប្រាក់ត្រូវបង់</div>
  					<div style="float:right;text-align:right;">TOTAL DUE</div>
        		</td>
        		<td align="right" style="visibility:visible;">#:kendo.toString(kendo.parseFloat(total)/kendo.parseFloat(rate), 'c', locale)#</td>        		
        	</tr>
        	<tr>
        		<td>
        			<div style="float:left;text-align:left;">Due Date</div>
  					<div style="float:right;text-align:right;">DUE DATE</div>
        		</td>
        		<td align="right" style="visibility:visible;">#:kendo.toString(new Date(due_date), 'dd-MM-yyyy')#</td>        		
        	</tr>
        	<tr>
        		<td>
        			<div style="float:left;text-align:left;">ថ្ងៃបង់ប្រាក់</div>
  					<div style="float:right;text-align:right;">PAY DATE</div>
        		</td>
        		<td></td>        		
        	</tr>
        	<tr>
        		<td>
        			<div style="float:left;text-align:left;">ប្រាក់បានបង់</div>
  					<div style="float:right;text-align:right;">PAY AMOUNT</div>
        		</td>
        		<td></td>        		
        	</tr>        	    	
        </table>			

		<div class="hiddenPrint" style="border: 1px dashed black; margin: 6px 6px;"></div>

		<table class="hiddenPrint" width="100%" border="1" cellpadding="2" cellspacing="2" style="font-size: xx-small;">
			<tr>
				<td colspan="2" rowspan="4" width="50%" style="visibility:visible;">
					<span class="#=number#"></span> <br>
					Customer: #=customers.number# #=customers.fullname# <br>
					ទីតាំងចរន្ត: #=location_name#, ប្រអប់: #=invoiceLineList[0].meters.electricity_box_number#
				</td>										
				<td width="30%">
					<div style="float:left;text-align:left;">ទឹកប្រាក់ត្រូវបង់</div>
  					<div style="float:right;text-align:right;">TOTAL DUE</div>
				</td>
				<td align="right" width="20%" style="visibility:visible;">#:kendo.toString(kendo.parseFloat(total)/kendo.parseFloat(rate), 'c', locale)#</td>
			</tr>
			<tr>							    
				<td>
					<div style="float:left;text-align:left;">Due Date</div>
  					<div style="float:right;text-align:right;">DUE DATE</div>
				</td>
				<td align="right" style="visibility:visible;">#:kendo.toString(new Date(due_date), 'dd-MM-yyyy')#</td>
			</tr>
			<tr>							    
				<td>
					<div style="float:left;text-align:left;">ថ្ងៃបង់ប្រាក់</div>
  					<div style="float:right;text-align:right;">PAY DATE</div>
				</td>
				<td></td>
			</tr>
			<tr>				
				<td>
					<div style="float:left;text-align:left;">អ្នកទទួលប្រាក់</div>
  					<div style="float:right;text-align:right;">CASHIER</div>
				</td>
				<td></td>
			</tr>
		</table>
	</div>
</script>


<!-- ***************************
 *	Water Section      	  *
**************************** -->
<script id="wDashBoard" type="text/x-kendo-template">
	<div class="container-fluid menu-hidden sidebar-hidden-phone fluid menu-left">
		<img src="uploads/pictures/Water_Bill.png" width="300" height="100" />	
		
		<div class="row row-merge">
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="#/wCustomer_balance" class="widget-stats widget-stats-primary widget-stats-4">
						<span class="txt"><span data-bind="text: lang.lang.balance"></span></span>
						<span class="count" style="font-size: 35px;" data-bind="text: balance"></span>
						<span class="glyphicons coins"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="#/wCustomer_deposit" class="widget-stats widget-stats-inverse widget-stats-4">
						<span class="txt"><span data-bind="text: lang.lang.deposit"></span></span>
						<span class="count" style="font-size: 35px;" data-bind="text: deposit"></span>
						<span class="glyphicons briefcase"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>			
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="#/wCustomer_list" class="widget-stats widget-stats-gray widget-stats-4">
						<span class="txt"><span data-bind="text: lang.lang.active_customer"></span></span>
						<span class="count"​><span data-bind="text: activeCustomer"></span></span> 
						<span class="glyphicons user"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>			
		</div>

		<div class="row">			
			<div class="span8">
				<div class="heading-buttons">
					<h2 class="heading pull-left"><i class="icon-bar-chart icon-fixed-width text-primary"></i> <span data-bind="text: lang.lang.monthly_sale"></span></h2>
					
					<div class="clearfix"></div>
				</div>

				<div class="innerLR innerT">			
					<div id="wsale-graph" style="height: 200px;"></div>
				</div>
			</div>

			<div class="span4">
				<div class="widget widget-body-white">
					<div class="widget-head"><h4 class="heading strong text-uppercase"><span data-bind="text: lang.lang.customer_status"></span></h4></div>
					<div class="widget-body padding-none">
						<table class="table table-striped table-vertical-center table-condensed margin-none">
							<tbody>
								<tr>									
									<td class="text-primary border-none"><span data-bind="text: lang.lang.inactive"></span></td>
									<td class="text-right strong">
										<span class="badge badge-warning" data-bind="text: voidCustomer"></span>										
									</td>
								</tr>
								<tr>									
									<td class="text-primary"><span data-bind="text: lang.lang.void"></span></td>
									<td class="text-right strong">
										<span class="badge badge-important" data-bind="text: inactiveCustomer"></span>										
									</td>
								</tr>
								<tr>									
									<td class="text-primary"><span data-bind="text: lang.lang.total"></span></td>
									<td class="text-right strong">
										<span class="badge badge-inverse" data-bind="text: totalCustomer"></span>										
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<div class="widget widget-heading-simple widget-body-white">
					<div class="widget-body padding-none">
						<div class="row-fluid row-merge">
							<div class="span6">
								<div class="innerAll center">
									<h5 class="strong muted text-uppercase"><i class="icon-money text-faded"></i> <span data-bind="text: lang.lang.open"></span></h5>
									<a href="#/wAging_summary" class="text-xlarge strong text-primary" data-bind="text: totalUnpaid"></a>									
								</div>
							</div>
							<div class="span6">
								<div class="innerAll center muted">
									<h5 class="strong muted text-uppercase"><i class="icon-dashboard text-faded"></i> <span data-bind="text: lang.lang.no_meter"></span></h5>
									<a href="#/wCustomer_no_meter" class="text-xlarge strong" data-bind="text: totalNoMeter"></a>									
								</div>
							</div>
						</div>
					</div>
				</div>								
			</div>			
		</div>	

		<div class="row-fluid">
	        <form id="employeeForm" data-role="validator" novalidate="novalidate">
                <div id="fieldlist">
                	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
                    <input type="text" data-role='datepicker' id="sdate" name="sdate" data-type="date" data-bind="value: sdate" />
                    <span data-for='sdate' class='k-invalid-msg'></span>

                    <input type="text" data-role='datepicker' id ="edate" data-type="date" name="edate" data-bind="value: edate" 
                    		data-greaterdate-field="sdate" data-greaterdate-msg='Invalid' />
                    <span data-for='edate' class='k-invalid-msg'></span>
               
                    <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>                           
                </div>
            </form>

            <table class="table table-bordered table-vertical-center table-pricing table-pricing-2">
        		<thead>
        			<tr>
        				<th width="45" class="center"><span data-bind="text: lang.lang.no"></span></th>
        				<th class="center"><span data-bind="text: lang.lang.license"></span></th>
        				<th class="center"><span data-bind="text: lang.lang.total_license"></span></th>
        				<th class="center"><span data-bind="text: lang.lang.active_customer"></span></th>
        				<th class="center"><span data-bind="text: lang.lang.void_customer"></span></th></th>	            				
        				<th class="center"><span data-bind="text: lang.lang.deposit"></span></th></th>	            				
        				<th class="center"><span data-bind="html: lang.lang.m"></span><sup>3</sup></th>
        				<th class="center"><span data-bind="text: lang.lang.amount"></span></th>        				
        				<th class="center"><span data-bind="text: lang.lang.balance"></span></th>	            					            				
        			</tr>
        		</thead>
        		<tbody data-role="listview"
        				data-auto-bind="false"	            					            			
		                data-template="wsale-by-branch-row-template"
		                data-bind="source: saleByBranchDS"></tbody>
        	</table>            

			<p class="separator text-center"><i class="icon-ellipsis-horizontal icon-3x"></i></p>

			<table class="table table-bordered table-striped table-white">
        		<thead>
        			<tr>
        				<th width="45"><span data-bind="text: lang.lang.no"></span></th>
        				<th><span data-bind="text: lang.lang.license"></span></th>
        				<th><span data-bind="text: lang.lang.location"></span></th>
        				<th><span data-bind="text: lang.lang.active_customer"></span></th>
        				<th><span data-bind="text: lang.lang.void_customer"></span></th>	            				
        				<th><span data-bind="text: lang.lang.deposit"></span></th>	            				
        				<th><span data-bind="html: lang.lang.m"></span><sup>3</sup></th>
        				<th><span data-bind="text: lang.lang.amount"></span></th>        				
        				<th><span data-bind="text: lang.lang.balance"></span></th>	            					            				
        			</tr>
        		</thead>
        		<tbody data-role="listview"
        				data-auto-bind="false"	            					            			
		                data-template="wsale-by-location-row-template"
		                data-bind="source: saleByLocationDS"></tbody>
        	</table> 

    	</div>
    </div>
</script>
<script id="wsale-by-branch-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td class="sno">1</td>
		<td>#=name#</td>
		<td>#=location#</td>		
		<td align="right">#=kendo.toString(active_customer, "n0")#</td>
		<td align="right">#=kendo.toString(inactive_customer, "n0")#​</td>				
		<td align="right">#=kendo.toString(deposit, "c0", banhji.institute.locale)#</td>
		<td align="right">#=kendo.toString(usage, "n0")# m<sup>3</sup></td>		
		<td align="right">#=kendo.toString(sale, "c0", banhji.institute.locale)#</td>
		<td align="right">#=kendo.toString(unpaid, "c0", banhji.institute.locale)#</td>					
    </tr>   
</script>
<script id="wsale-by-location-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td class="snoo">1</td>
		<td>#=branch_name#</td>
		<td>#=location_name#</td>		
		<td align="right">#=kendo.toString(active_customer, "n0")# </td>
		<td align="right">#=kendo.toString(inactive_customer, "n0")#​ </td>				
		<td align="right">#=kendo.toString(deposit, "c0", banhji.eDashBoard.locale)#</td>
		<td align="right">#=kendo.toString(usage, "n0")# m<sup>3</sup></td>		
		<td align="right">#=kendo.toString(sale, "c0", banhji.eDashBoard.locale)#</td>
		<td align="right">#=kendo.toString(unpaid, "c0", banhji.eDashBoard.locale)#</td>						
    </tr>   
</script>

<script id="wCustomerCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" style="height: 700px;">
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="customer ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>
							<div class="select2-container" style="width: 100%;">								
																
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: contactDS.total"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid" 
						 data-bind="source: contactDS"
						 data-auto-bind="false" 
						 data-row-template="wCustomerCenter-customer-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							            <li style="font-size: large; color: black; font-weight: bold;">							            	
							            	<span data-bind="text: obj.surname"></span>
							            	<span data-bind="text: obj.name"></span>
							            </li>
							            <li class="glyphicons stats active"><span data-toggle="tab" data-target="#tab1-8"><i></i></span>
							            </li>
							            <li class="glyphicons riflescope"><span data-toggle="tab" data-target="#tab2-8"><i></i></span>
							            </li>
							            <li class="glyphicons dashboard"><span data-toggle="tab" data-target="#tab3-8"><i></i></span>
							            </li>
							            <li class="glyphicons circle_info"><span data-toggle="tab" data-target="#tab4-8"><i></i></span>
							            </li>							            
							            <li class="glyphicons pen"><span data-toggle="tab" data-target="#tab5-8"><i></i></span>
							            </li>
							            <li class="glyphicons edit"><span data-bind="click: goEditContact"><i></i></span>
							            </li>
							            <li class="glyphicons user_add"><a href="#/customer"><i></i></a>
							            </li>
							            <li class="glyphicons circle_plus"><span data-toggle="tab" data-target="#tab8-8"><i></i></span>
							            </li>							            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- GRAPH Tab content -->
							            <div id="tab1-8" class="tab-pane active box-generic">
							            	<div id="wUsage-graph" style="height: 180px;"></div>
							            </div>
							            <!-- // GRAPH Tab content END -->

							            <!-- SEARCH Tab content -->
							            <div id="tab2-8" class="tab-pane box-generic">							            	
							                <input id="ddlBranch" data-bind="value: branch_id, events:{change:branchChanges}" style="width: 100%;" />							                
							                <input id="ddlLocation" data-bind="value: location_id" disabled="disabled" style="width: 100%;" />

							                <input data-role="dropdownlist"
							                	   data-auto-bind="false"
						            			   data-option-label="(--- Customer Type ---)"					            			   		                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: contact_type_id,
								                              source: contactTypeDS"
								                   style="width: 100%"/>

							                <input data-role="dropdownlist"
						            			   data-option-label="(--- Currency ---)"					            			   		                   
								                   data-value-primitive="true"
								                   data-text-field="code"
								                   data-value-field="id"
								                   data-bind="value: currency_id,
								                              source: currencyDS"
								                   style="width: 100%"/>

								            <br><br>
								            <span class="btn btn-primary btn-icon glyphicons search pull-right" data-bind="click: search"><i></i><span data-bind="text: lang.lang.search"></span></span>
								            <br>
							            </div>
							            <!-- // SEARCH Tab content END -->

							            <!-- METER Tab content -->
							            <div id="tab3-8" class="tab-pane box-generic">
							            	
							            	<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: goToNewWaterDeposit"><i></i> <span data-bind="text: lang.lang.new_meter"></span></span>

							            	<table class="table table-bordered table-striped table-white">
												<thead>
													<tr>
														<th><span data-bind="text: lang.lang.deposit"></span></th>
														<th><span data-bind="text: lang.lang.service"></span></th>														
														<th><span data-bind="text: lang.lang.meter_no."></span></th>																												
														<th></th>														
													</tr>
												</thead>	            		
							            		<tbody data-role="listview"
							            				data-auto-bind="false"	            					            					            					            			
										                data-template="wCustomerCenter-meter-tmpl"
										                data-bind="source: meterDS">
										        </tbody>
							            	</table>
							            </div>
							            <!-- // METER Tab content END -->

							            <!-- INFO Tab content -->
							            <div id="tab4-8" class="tab-pane box-generic">
							            	<div class="row-fluid">
								            	<div class="span6">
										
													<!-- Bio -->
													<div class="widget widget-heading-simple widget-body-gray margin-none">
														<div class="widget-head">
															<h4 class="heading glyphicons user"><i></i> <span data-bind="text: obj.wnumber"></span> <span data-bind="text: obj.fullname"></span></h4>
														</div>
														<div class="widget-body">
															<ul class="unstyled icons margin-none">
																<li class="glyphicons group"><i></i> <span data-bind="text: obj.contact_type[0].name"></span></li>
																<li class="glyphicons phone"><i></i> <span data-bind="text: obj.phone"></span></li>
																<li class="glyphicons envelope"><i></i> <span data-bind="text: obj.email"></li>
																<li class="glyphicons calendar"><i></i> <span data-bind="text: obj.registered_date"></li>
															</ul>
														</div>
													</div>
													<!-- // Bio END -->
													
												</div>
												<div class="span6">
													<!-- Bio -->
													<div class="widget widget-heading-simple widget-body-gray margin-none">
														<div class="widget-head">
															<h4 class="heading glyphicons edit" data-bind="click: goEditContact"><i></i> <span data-bind="text: lang.lang.edit"></span></h4>
														</div>
														<div class="widget-body">
															<p><i class="icon-home"></i> <span data-bind="text: obj.address"></span></p>
														</div>
													</div>
													<!-- // Bio END -->
												</div>
											</div>
							            </div>
							            <!-- // INFO Tab content END -->

							            <!-- NOTE Tab content -->
							            <div id="tab5-8" class="tab-pane box-generic">

										    <div class="chat-controls">															
												<form class="margin-none">
													<div class="row-fluid">
														<div class="span10">
															<input type="text" name="message" class="input-block-level margin-none" data-bind="value: note" placeholder="Add memo here ...">
														</div>
														<div class="span2">
															<span class="btn btn-block btn-primary" data-bind="click: saveNote"><span data-bind="text: lang.lang.save"></span></span>
														</div>
													</div>
												</form>															
											</div>

											<br>

									    	<div data-role="grid"
									    	 	 data-height="100"
					 							 data-scrollable="true"									                 
								                 data-row-template="wCustomerCenter-note-tmpl"
								                 data-bind="source: noteDS"
								                 data-columns="[{title: ''}]"></div>
											
							            </div>
							            <!-- // NOTE Tab content END -->

							            <!-- INVOICE Tab content -->
							            <div id="tab8-8" class="tab-pane box-generic">
							            	<table class="table table-borderless table-condensed cart_total">
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goEstimate"><span data-bind="text: lang.lang.estimate"></span></span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goInvoice"><span data-bind="text: lang.lang.invoice"></span></span>
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goSO"><span data-bind="text: lang.lang.sale_order"></span></span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goReceipt"><span data-bind="text: lang.lang.receipt"></span></span>								            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goGDN"><span data-bind="text: lang.lang.gdn"></span></span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goStatement"><span data-bind="text: lang.lang.statement"></span></span>
								            		</td>
								            	</tr>
							            	</table>
							            </div>
							            <!-- // INVOICE Tab content END -->								            

							        </div>
							    </div>
							</div>
						</div>

						<div class="span6">
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons coins"><i></i></span>
										<span class="txt"><span data-bind="text: lang.lang.balance"></span><span data-bind="text: balance" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-inverse widget-stats-5" data-bind="click: loadDeposit">
										<span class="glyphicons briefcase"><i></i></span>
										<span class="txt"><span data-bind="text: lang.lang.deposit"></span><span data-bind="text: deposit" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons circle_exclamation_mark"><i></i></span>
										<span class="txt"><span data-bind="text: outInvoice"></span> <span data-bind="text: lang.lang.open"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadOverInvoice">
										<span class="glyphicons turtle"><i></i></span>
										<span class="txt"><span data-bind="text: overInvoice"></span> <span data-bind="text: lang.lang.over_due"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>											          	
		          	</div>
					
					<div>
						<input data-role="dropdownlist"                   
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					                      events: { change: dateChanges }"
					           placeholder="ចាប់ពី" >

					    <input data-role="datepicker"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      events: { change: dateChanges }"
					           placeholder="To" >
					    
					    <button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.type"></span></th>								
								<th><span data-bind="text: lang.lang.reference_no"></span></th>
								<th><span data-bind="text: lang.lang.amount"></span></th>
								<th><span data-bind="text: lang.lang.status"></span></th>
								<th></th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="wCustomerCenter-transaction-tmpl"
				                data-bind="source: transactionDS">
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="wCustomerCenter-customer-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				<span class="strong">
					#=wnumber# #=fullname#				
				</span>
			</div>
		</td>
	</tr>
</script>
<script id="wCustomerCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <td>
        	#if(type==="Invoice"){#								
				<a href="\#/invoice/#=id#"><i></i> #=number#</a>	
			#}else if(type==="Receipt"){#
        		<a href="\#/receipt/#=id#"><i></i> #=number#</a>        	        		
			#}else if(type==="SO"){#
        		<a href="\#/so/#=id#"><i></i> #=number#</a>
        	#}else if(type==="Estimate"){#        		
        		<a href="\#/estimate/#=id#"><i></i> #=number#</a>
        	#}else if(type==="GDN"){#        		
        		<a href="\#/gdn/#=id#"><i></i> #=number#</a>
        	#}else if(type==="Notice"){#
        		#=number#
        	#}else if(type==="Payment"){#

        	#}else if(type==="wInvoice"){#        		
        		<a href="\#/wInvoice_print/#=id#"><i></i> #=number#</a>
        	#}else if(type==="edeposit"){#        		
        		<a href="\#/eDeposit/#=id#"><i></i> #=number#</a>
        	#}else if(type==="wdeposit"){#        		
        		<a href="\#/wDeposit/#=id#"><i></i> #=number#</a>
        	#}else{#
        		#=number#
        	#}#
        </td>
    	<td class="right">#=kendo.toString(amount/rate, locale=="km-KH"?"c0":"c", locale)#</td>
    	<td>        	
        	#if(type==="Invoice" || type==="eInvoice" || type==="wInvoice"){#
        		#if(status==="0" || status==="2") {#
        			# var date = new Date(), dueDate = new Date(due_date).getTime(), toDay = new Date(date).getTime(); #
					#if(dueDate < toDay) {#
						Over Due #:Math.floor((toDay - dueDate)/(1000*60*60*24))# days
					#} else {#
						#:Math.floor((dueDate - toDay)/(1000*60*60*24))# days to pay
					#}#
				#} else {#
					Paid
				#}#
        	#}else if(type==="SO" || type==="GDN"){#
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Done        			
        		#}#
        	#}else if(type==="Estimate"){#        		
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Approved        			
        		#}#
        	#}#			
		</td>    	
    	<td align="center">
			#if(type==="Invoice"){#
				#if(status==="0" || status==="2"){#					
					<a href="\#/cashier/#=id#"><i></i> ទទួលប្រាក់</a>					
				#}#
			#}else if(type==="wInvoice"){#
        		#if(status==="0" || status==="2"){#
        			<a href="\#/cashier/#=id#"><i></i> ទទួលប្រាក់</a>
        		#}#
        	#}else if(type==="Notice"){#
        		#if(status==="0" || status==="2"){#
        			<a href="\#/cashier/#=id#"><i></i> ទទួលប្រាក់</a>
        		#}#
			#}else if(type==="SO"){#
        		#if(status==="0"){#
        			
        		#}#
        	#}else if(type==="Estimate"){#        		
        		#if(status==="0"){#
        			
        		#}#
        	#}else if(type==="GDN"){#        		
        		#if(status==="0"){#
        			
        		#}#
        	#}#
		</td>     	
    </tr>
</script>
<script id="wCustomerCenter-meter-tmpl" type="text/x-kendo-template">		
	<tr>
		<td>
			<a href="\#/wDeposit/#=deposit_id#">#=deposit#</a>
			<br>
			#if(deposit_amount>0){#
				<span class="btn btn-danger btn-icon glyphicons circle_minus" data-bind="click: goToWaterDepositWitdraw"><i></i> #=kendo.toString(deposit_amount, locale=="km-KH"?"c0":"c", locale)#</span>				
			#}else{#
				<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: goToNewWaterDeposit"><i></i><span data-bind="text: lang.lang.deposit1"></span></span>
			#}#
		</td>
		<td>			
			#if(invoice_id>0){#
				<a href="\#/receipt/#=invoice_id#">#=invoice#</a>
				<br>
				#=kendo.toString(invoice_amount, locale=="km-KH"?"c0":"c", locale)#				
			#}else{#
				<a href="\#/receipt" class="btn btn-inverse btn-icon glyphicons circle_plus"><i></i><span data-bind="text: lang.lang.service1"></span></a>
			#}#		
		</td>				
		<td>
			#if(number!==""){#
				<a href="\#/wMeter/#=id#">#=number#</a>
			#}else{#
				#if(deposit_id>0){#
					<a href="\#/wMeter/#=id#" class="btn btn-success btn-icon glyphicons circle_plus"><i></i><span data-bind="text: lang.lang.meter1"></span></a>
				#}#
			#}#						
		</td>
		<td>
			#if(number!==""){#
				<a href="\#/wReading_center/#=id#"><span data-bind="text: lang.lang.reading"></span></a>				
			#}#			
		</td>								
	</tr>	
</script>
<script id="wCustomerCenter-note-tmpl" type="text/x-kendo-template">
	<tr>
		<td>			
			<blockquote>
				<small class="author">
					<span class="strong">#=creator#</span> :
					<cite>#=kendo.toString(new Date(noted_date), "g")#</cite>
				</small>					
				<p>#=note#</p>
			</blockquote>				
		</td>
	</tr>	
</script>

<script id="wNewCustomer" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">			

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons user_add"><i></i><span data-bind="text: lang.lang.new_water_customer"></span></h4>							        	
				    </div>
				    <div class="widget-body">												
												
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center"><span data-bind="text: lang.lang.no"></span></th>
									<th><span data-bind="text: lang.lang.number"></span></th>								
									<th><span data-bind="text: lang.lang.name"></span></th>
									<th></th>
								</tr>
							</thead>	            		
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="wNewCustomer-customer-list-tmpl"
					                data-bind="source: dataSource">
					        </tbody>
		            	</table>						

		            	<!-- Window Pop-Up -->
						<div id="window" data-role="window" data-visible="false" data-modal="true" data-resizable="false" data-iframe="true">				    	
							<div id="example" class="k-content">
								<br>
								<table class="table table-borderless table-condensed cart_total">						            	
				            		<tr>
						                <td><span data-bind="text: lang.lang.license"></span> <span style="color:red">*</span></td>
						              	<td>
						              		<input id="ddlBranch" name="ddlBranch"
												data-bind="value: obj.wbranch_id" 
												required data-required-msg="required" style="width: 100%;" />
						              	</td>							              	
						            	<td><span data-bind="text: lang.lang.location"></span> <span style="color:red">*</span></td>
						              	<td>
						              		<input id="ddlLocation" name="ddlLocation"
												data-bind="value: obj.wlocation_id, events:{change:locationChanges}" disabled="disabled"
												required data-required-msg="required" style="width: 100%;" />
						              	</td>
						            </tr>
						            <tr>
						                <td><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></td>
						              	<td>
						              		<input id="numberHead" name="numberHead" class="k-textbox"
						              				data-bind="value: obj.wnumber_head" 
						              				placeholder="e.g. ID" required data-required-msg="required"
						              				style="width: 30%;" />
						              		<input id="number" name="number" class="k-textbox"
						              				data-bind="value: obj.wnumber, events:{change:checkExistingNumber}" 
						              				placeholder="e.g. 0001" required data-required-msg="required"
						              				style="width: 68%;" />
						              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
						              	</td>							              	
						            	<td><span data-bind="text: lang.lang.id_card_number"></span></td>
						              	<td><input class="k-textbox" data-bind="value: obj.id_number" placeholder="e.g. 123456789" /></td>
						            </tr>					            
						            <tr>
						            	<td><span data-bind="text: lang.lang.family_member"></span></td>
						              	<td><input class="k-textbox" data-bind="value: obj.family_member" placeholder="e.g. 3" /></td>							            	
						            	<td><span data-bind="text: lang.lang.job"></span></td>
						              	<td><input class="k-textbox" data-bind="value: obj.job" placeholder="e.g. teacher" /></td>
						            </tr>					            						            							            								            								            			            
						        </table>							

								<div align="center">
									<span id="save" class="btn btn-success btn-icon glyphicons ok_2"><i></i>Save</span>
									<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindow"><i></i>Close</span> 
								</div>
							</div> 
						</div>

						<span id="notification"></span>								

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="wNewCustomer-customer-list-tmpl" type="text/x-kendo-template">
	<tr>
		<td>#:banhji.wNewCustomer.dataSource.indexOf(data)+1#</td>
		<td>#=number#</td>
		<td>#=fullname#</td>
		<td class="center">
			<span class="btn btn-icon btn-success glyphicons circle_plus" data-bind="click: openWindow"><i></i> Use Water</span>
		</td>
	</tr>	
</script>

<script id="wCustomer" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons circle_info"><i></i> Customer</h4>					        							        	
					    </div>
					    <div class="widget-body">
					    	<!-- Upper part -->
					    	<div class="row-fluid">
					    		<div class="span6 well">									
									<div class="row-fluid">
										<div class="span6">														
											<!-- Group -->
											<div class="control-group">										
												<label for="ddlContactType"><span data-bind="text: lang.lang.customer_type"></span> <span style="color:red">*</span></label>
												<input id="ddlContactType" name="ddlContactType"
													data-bind="value: obj.contact_type_id" 
													required data-required-msg="required" style="width: 100%;" />																					            
											</div>
											<!-- // Group END -->
										</div>
										
										<div class="span2">	
											<!-- Group -->
											<div class="control-group">							
												<label for="numberHead">អក្សរកូដ <span style="color:red">*</span></label>
						              			<input id="numberHead" name="numberHead" class="k-textbox"
							              				data-bind="value: obj.number_head" 
							              				placeholder="e.g. ID" required data-required-msg="required"
							              				style="width: 100%;" />
											</div>
											<!-- // Group END -->											
										</div>

										<div class="span4">	
											<!-- Group -->
											<div class="control-group">							
												<label for="number"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>
						              			<input id="number" name="number" class="k-textbox"
							              				data-bind="value: obj.number, events:{change: checkExistingNumber}" 
							              				placeholder="e.g. 0001" required data-required-msg="required"
							              				style="width: 75%;" />
							              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
							              		<button type="button" data-role="button" data-bind="click: setNumber"><i class="icon-refresh"></i></button>
											</div>
											<!-- // Group END -->											
										</div>
									</div>
									
									<div class="row-fluid">
										<div class="span6">						
											<!-- Group -->
											<div class="control-group">
												<label for="surname"><span data-bind="text: lang.lang.surname"></span> <span style="color:red">*</span></label>
							              		<input id="surname" name="surname" class="k-textbox" data-bind="value: obj.surname" 
									              		placeholder="surname ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">								
												<label for="name"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
									            <input id="name" name="name" class="k-textbox" data-bind="value: obj.name" 
									              		placeholder="name ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>																		
											<!-- // Group END -->
										</div>
									</div>
									
									<div class="row-fluid" data-bind="visible: isCompany">
										<div class="span6">
											<!-- Group -->
											<div class="control-group">
												<label for="companyName"><span data-bind="text: lang.lang.organization_name"></span> <span style="color:red">*</span></label>
												<input id="companyName" name="companyName" class="k-textbox" data-bind="enabled: isCompany, value: obj.company"									
														placeholder="e.g. PCG & Partner"
														style="width: 100%;" />	
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
												<label for="vatNo">VAT Number</label>								
							            		<input id="vatNo" name="vatNo" class="k-textbox" data-bind="enabled: isCompany, value: obj.vat_no" 
														placeholder="e.g. 01234567897"
														style="width: 100%;" />												
											</div>					
											<!-- // Group END -->
										</div>
									</div>
																
								</div>
								<div class="span6">
									<div class="row-fluid">	
										<!-- Map -->
										<div id="map" class="span12" style="height: 130px;"></div>
									</div>

									<div class="separator line bottom"></div>

									<div class="row-fluid">	
										<div class="span6">									
											<!-- Group -->
											<div class="control-group">
								    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
												<div class="input-prepend">
													<span class="add-on glyphicons direction"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>									
											<!-- // Group END -->
										</div>	
										
										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
								    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
								    			<div class="input-prepend">
													<span class="add-on glyphicons google_maps"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>										
											</div>
											<!-- // Group END -->
										</div>										
									</div>
								</div>
							</div>								
									
							<!-- // Inner Tabs -->
							<div class="row-fluid">								
								<div class="box-generic">
								    <!-- //Tabs Heading -->
								    <div class="tabsbar tabsbar-1">
								        <ul class="row-fluid row-merge">								            								            
								            <li class="span2 glyphicons tint active">
								            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.water"></span></span></a>
								            </li>
								            <li class="span2 glyphicons usd">
								            	<a href="#tab2" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.account"></span></span></a>
								            </li>
								            <li class="span2 glyphicons nameplate_alt">
								            	<a href="#tab3" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.info"></span></span></a>
								            </li>
								            <li class="span2 glyphicons parents">
								            	<a href="#tab4" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.agents"></span></span></a>
								            </li>						            					            
								        </ul>
								    </div>
								    <!-- // Tabs Heading END -->

								    <div class="tab-content">

								    	<!-- //WATER INFO -->
								        <div class="tab-pane active" id="tab1">
							            	<div class="row-fluid">

							            		<div class="span3">
								            		<!-- Group -->
													<div class="control-group">											
														<label for="ddlBranch"><span data-bind="text: lang.lang.license"></span> <span style="color:red">*</span></label>
														<input id="ddlBranch" name="ddlBranch"
															data-bind="value: obj.wbranch_id" 
															required data-required-msg="required" style="width: 100%;" />
													</div>
													<!-- // Group END -->
												</div>

												<div class="span3">
								            		<!-- Group -->
													<div class="control-group">											
														<label for="ddlLocation"><span data-bind="text: lang.lang.location"></span> <span style="color:red">*</span></label>
														<input id="ddlLocation" name="ddlLocation"
															data-bind="value: obj.wlocation_id, events:{change: locationChanges}" disabled="disabled" style="width: 100%;" />
													</div>
													<!-- // Group END -->
												</div>

												<div class="span3">
													<!-- Group -->
													<div class="control-group">							
														<label for="wnumberHead">អក្សរកូដ <span style="color:red">*</span></label>
								              			<input id="wnumberHead" name="wnumberHead" class="k-textbox"
									              				data-bind="value: obj.wnumber_head" 
									              				placeholder="e.g. ID" required data-required-msg="required"
									              				style="width: 100%;" />
													</div>
													<!-- // Group END -->
												</div>

												<div class="span3">
													<!-- Group -->
													<div class="control-group">							
														<label for="wnumber"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>
								              			<input id="wnumber" name="wnumber" class="k-textbox"
									              				data-bind="value: obj.wnumber, events:{change: checkExistingWNumber}" 
									              				placeholder="e.g. 0001" required data-required-msg="required"
									              				style="width: 100%;" />
									              		<span data-bind="visible: isDuplicateWNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
													</div>
													<!-- // Group END -->
												</div>

							            	</div>
							        	</div>
								        <!-- //WATER INFO END -->

								        <!-- //ACCOUNTING INFO -->
								        <div class="tab-pane" id="tab2">
								        	<div class="row-fluid">								        		
								            	<div class="span3">
													<label for="ddlAR"><span data-bind="text: lang.lang.account_receiveable"></span> <span style="color:red">*</span></label>
													<input id="ddlAR" name="ddlAR"
														data-bind="value: obj.contact_account_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlRA"><span data-bind="text: lang.lang.revenue_account"></span> <span style="color:red">*</span></label>
													<input id="ddlRA" name="ddlRA"
														data-bind="value: obj.ra_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlDepositAccount"><span data-bind="text: lang.lang.deposit_account"></span> <span style="color:red">*</span></label>
													<input id="ddlDepositAccount" name="ddlDepositAccount"
														data-bind="value: obj.deposit_account_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlDiscountAccount"><span data-bind="text: lang.lang.discount_account"></span> <span style="color:red">*</span></label>
													<input id="ddlDiscountAccount" name="ddlDiscountAccount"
														data-bind="value: obj.discount_account_id" 
														required data-required-msg="required" style="width: 100%;" />	
												</div>												
									        </div>

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">
								        		<div class="span3">						
										            <label for="currency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
										            <input id="currency" name="currency" 
										            	data-role="dropdownlist"
										            	data-value-primitive="true"
										                data-text-field="code"
										                data-value-field="id"
														data-bind="value: obj.currency_id, source: currencyDS"
														data-option-label="(--- Select ---)" 
														required data-required-msg="required" style="width: 100%;" />
										        </div>
								            	<div class="span3">
													<label for="ddlPaymentTerm"><span data-bind="text: lang.lang.payment_term"></span></label>
													<input id="ddlPaymentTerm" name="ddlPaymentTerm"
														data-role="dropdownlist"
														data-option-label="(--- Select ---)"
										            	data-value-primitive="true"
										                data-text-field="name"
										                data-value-field="id"
														data-bind="value: obj.payment_term_id, source: paymentTermDS"														
														style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlPaymentMethod"><span data-bind="text: lang.lang.payment_method"></span></label>
													<input id="ddlPaymentMethod" name="ddlPaymentMethod"
														data-role="dropdownlist"
														data-option-label="(--- Select ---)"
										            	data-value-primitive="true"
										                data-text-field="name"
										                data-value-field="id"
														data-bind="value: obj.payment_method_id, source: paymentMethodDS"														
														style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlTaxItem"><span data-bind="text: lang.lang.vat"></span> </label>
													<input id="ddlTaxItem" name="ddlTaxItem"
														   data-role="dropdownlist"
														   data-option-label="(--- Select ---)"
										                   data-auto-bind="false"
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.tax_item_id,
										                              source: taxDS"
										                   required data-required-msg="required"
										                   style="width: 100%;" />													
												</div>												
									        </div>

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">	
										        <div class="span3">
													<label for="txtCreditLimit"><span data-bind="text: lang.lang.credit_limit"></span> </label>								              		
										            <input data-role="numerictextbox"
										                   data-format="n"
										                   data-min="0"										                   
										                   data-bind="value: obj.credit_limit"										                  
										                   style="width: 100%;">
												</div>
											</div>
							        	</div>
								        <!-- //ACCOUNTING INFO END -->

								        <!-- //GENERAL INFO -->
								        <div class="tab-pane" id="tab3">
							            	<table class="table table-borderless table-condensed cart_total">						            	
							            		<tr>
									                <td><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="customerStatus" name="customerStatus" 
									              				data-role="dropdownlist"
											            		data-text-field="name"
								           						data-value-field="id"
								           						data-value-primitive="true" 
											            		data-bind="source: statusList, value: obj.status"
											            		data-option-label="(--- Select ---)"
											            		required data-required-msg="ត្រូវការ ស្ថានភាព" />
									              	</td>							              	
									            	<td><span data-bind="text: lang.lang.register_date"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="registered_date" name="registered_date" 
										            		data-role="datepicker"			            		
							            					data-bind="value: obj.registered_date" 
							            					data-format="dd-MM-yyyy"
							            					data-parse-formats="yyyy-MM-dd" 
							            					placeholder="dd-MM-yyyy" required data-required-msg="required" />
									              	</td>
									            </tr>
									            <tr>
									                <td><span data-bind="text: lang.lang.gender"></span></td>
									              	<td><select data-role="dropdownlist" data-bind="source: genders, value: obj.gender"></select></td>							              	
									            	<td><span data-bind="text: lang.lang.phone"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.phone" placeholder="e.g. 012 333 444" /></td>
									            </tr>
									            <tr>
									            	<td><span data-bind="text: lang.lang.family_member"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.family_member" placeholder="e.g. 3" /></td>							              	
									            	<td><span data-bind="text: lang.lang.email"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.email" placeholder="e.g. me@email.com" />
									            </tr>
									            <tr>
									            	<td><span data-bind="text: lang.lang.job"></span></td>
									                <td><input class="k-textbox" data-bind="value: obj.job" placeholder="e.g. teacher" /></td>							            	
									            	<td><span data-bind="text: lang.lang.id_card_number"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.id_number" placeholder="e.g. 123456789" /></td>
									            </tr>
									            <tr>
									            	<td><span data-bind="text: lang.lang.address"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.address" placeholder="where you live ..." />							              	
									            	<td><span data-bind="text: lang.lang.memo"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.memo" placeholder="memo ..." /></td>
									            </tr>
									            <tr>
									            	<td>
									            		<label for="txtBillTo" data-bind="click: copyBillTo"><span data-bind="text: lang.lang.bill_to"></span> <i class="icon-share"></i></label>											            
									            	</td>
									            	<td>
									            		<input class="k-textbox" data-bind="value: obj.bill_to" placeholder="bill to ..." />
									            	</td>
									            	<td>
									            		<span data-bind="text: lang.lang.ship_to"></span>										            
									            	</td>
									            	<td>
									            		<input class="k-textbox" data-bind="value: obj.ship_to" placeholder="ship to ..." />
									            	</td>
									            </tr>									            							            							            								            								            			            
									        </table>
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //CONTACT PERSON -->
								        <div class="tab-pane" id="tab4">
								        	<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyContactPerson"><i></i> <span data-bind="text: lang.lang.new_agent"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th><span data-bind="text: lang.lang.department"></span></th>						                
										                <th><span data-bind="text: lang.lang.phone"></span></th>
										                <th><span data-bind="text: lang.lang.email"></span></th>
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"										        						        		 
										        		data-template="contact-person-row-tmpl" 
										        		data-bind="source: contactPersonDS">
										        </tbody>										        						        
										    </table>
							        	</div>
								        <!-- //CONTACT PERSON END -->
								    </div>
								</div>
							</div>

							<br>											
							
							<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
							</div>
							<!-- // Form actions END -->

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="wCustomer-contact-person-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="name" name="name" 
					type="text" class="k-textbox" 
					data-bind="value: name"
					placeholder="eg: Mr. John" 
					required="required" validationMessage="required" style="width: 190px;" />
            <span data-for="name" class="k-invalid-msg"></span>
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: department" placeholder="eg: Accounting" style="width: 190px;" />
		</td>		
		<td>
			<input type="text" class="k-textbox" data-bind="value: phone" placeholder="eg: 012 333 444" style="width: 190px;" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: email" placeholder="eg: john@email.com" style="width: 190px;" />
		</td>		
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteContactPerson"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="wCustomerOrder" type="text/x-kendo-template">
	<div class="container-960">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">
					<div class="hidden-print">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back();"><i></i></span>

						<input id="ddlBranch" data-bind="value: branch_id" />						                
						<input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
						<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
					</div>
					
					<br>

					<h3 align="center"><span data-bind="text: lang.lang.reorder_customer"></span></h3>
					<p align="center"><span data-bind="text: lang.lang.note1"></span></p>
										
					<br>
				
					<div id="grid"></div>

					<br>

					<div class="hidden-print" align="center">
						<div data-role="notification" id="ntf1" data-width="300" data-height="50"></div>
						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok" data-bind="click: save"><i></i><span data-bind="text: lang.lang.save"></span></span>
					</div>					

				</div>
			</div>
		</div>
	</div>
</script>
<style>
    .k-grid tbody tr {
        cursor: move;
    }
</style>

<script id="wInstallment" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">					

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons dashboard"><i></i><span data-bind="text: lang.lang.deprisiation"></span></h4>							        	
					    </div>
					    <div class="widget-body">
						    
			    			<input id="cbbCustomer" name="cbbCustomer" 
			    				   data-role="combobox"
				                   data-placeholder="Customer..."
				                   data-auto-bind="false"
				                   data-value-primitive="true"
				                   data-filter="search"							                   
				                   data-min-length="3"							                   
				                   data-text-field="fullname"
				                   data-value-field="id"
				                   data-template="wInstallment-contact-combobox-template"
				                   data-bind="value: obj.contact_id,
				                              source: contactDS"
				                   required data-required-msg="ត្រូវការ Customer"
				                   style="width: 130px;" />						    			

							<br>

							<table class="table table-bordered table-condensed table-white">
								<thead>
									<tr>
										<th><span data-bind="text: lang.lang.month_of"></span></th>
										<th><span data-bind="text: lang.lang.reading"></span></th>								
										<th><span data-bind="text: lang.lang.usage"></span></th>
										<th><span data-bind="text: lang.lang.amount"></span></th>
										<th><span data-bind="text: lang.lang.reader"></span></th>
										<th><span data-bind="text: lang.lang.memo"></span></th>
										<th></th>
									</tr>
								</thead>	            		
			            		<tbody data-role="listview"
			            				data-auto-bind="false"	            					            					            					            			
						                data-template="wReading-center-tmpl"
						                data-bind="source: dataSource">
						        </tbody>
			            	</table>						   

							<div class="row-fluid">
					          	<!-- Form actions -->
								<div align="center">
									<span id="notification"></span>

									<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
									<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
									<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								</div>
								<!-- // Form actions END -->
							</div>

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="wInstallment-row-template" type="text/x-kendo-template">	
	<tr>		
		<td>#=kendo.toString("month", "MM-yyyy")#</td>
		<td>#=amount#</td>		
		<td>#=balance#</td>			
	</tr>
</script>
<script id="wInstallment-contact-combobox-template" type="text/x-kendo-template">	
	#=wnumber# #=fullname#
</script>

<script id="wDeposit" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i><span data-bind="text: lang.lang.deposit_receipt"></span></h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.customer"></span></td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='receipt-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.number"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>																	           
									<tr>
										<td colspan="2">
											<span data-bind="text: lang.lang.address"></span>
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width: 100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> <span data-bind="text: lang.lang.paid"></span></span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td>
											<input id="issuedDate" name="issuedDate" data-role="datepicker" 
													data-bind="value: obj.issued_date" data-format="dd-MM-yyyy" 
													required data-required-msg="required" />											
										</td>
									</tr>
									<tr>
						                <td><span data-bind="text: lang.lang.cheque"></span></td>						              	
						              	<td><input class="k-textbox" data-bind="value: obj.check_no" style="width:100%;" /></td>
						            </tr>
									<tr>
										<td><span data-bind="text: lang.lang.payment_method"></span></td>
										<td>
											<input id="ddlPaymentMethod" name="ddlPaymentMethod"
													data-bind="value: obj.payment_method_id"
													required data-required-msg="required"  
													style="width: 100%" />											
										</td>
									</tr>									
									<tr>
										<td><span data-bind="text: lang.lang.deposit_account"></span></td>
										<td>
											<input id="ddlDepositAccount" name="ddlDepositAccount"
													data-bind="value: obj.deposit_account_id"
													required data-required-msg="required"  
													style="width: 100%" />											
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.cash_account"></span></td>
										<td>
											<input id="ddlCashAccount" name="ddlCashAccount"
													data-bind="value: obj.account_id"
													required data-required-msg="required"  
													style="width: 100%" />										
										</td>
									</tr>						            								
								</table>           		          	
						    </div>
						</div>

						<br>

						<!-- Item List -->
						<table class="table table-bordered table-vertical-center table-pricing table-pricing-2">
							<thead>
								<tr>									
									<th class="center"><span data-bind="text: lang.lang.item"></span></th>								
									<th class="center"><span data-bind="text: lang.lang.description"></span></th>									
									<th class="center"><span data-bind="text: lang.lang.amount"></span></th>									
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="wDeposit-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						
						<!-- Lower Part -->
						<div class="row-fluid">							
							<span data-bind="text: lang.lang.memo"></span>:
							<br>
							<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:49%;" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
							<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:49%;" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>																									
						</div>

						<br>						

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center" class="hidden-print">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> <span data-bind="text: lang.lang.print"></span></span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="wDeposit-row-template" type="text/x-kendo-tmpl">		
	<tr>				
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>			
		<td class="right">
			<input id="amount" name="amount" 
					data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />						
		</td>				
    </tr>   
</script>
<script id="wDeposit-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="wDepositWitdraw" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>
						<span data-bind="text: lang.lang.witdraw_Deposit_Receipt"></span></h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.customer"></span></td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='receipt-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.number"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>																	           
									<tr>
										<td colspan="2">
											<span data-bind="text: lang.lang.address"></span>
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width: 100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> <span data-bind="text: lang.lang.paid"></span></span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td>
											<input id="issuedDate" name="issuedDate" data-role="datepicker" 
													data-bind="value: obj.issued_date" data-format="dd-MM-yyyy" 
													required data-required-msg="required" />											
										</td>
									</tr>																									
									<tr>
										<td><span data-bind="text: lang.lang.deposit_account"></span></td>
										<td>
											<input id="ddlDepositAccount" name="ddlDepositAccount"
													data-bind="value: obj.deposit_account_id"
													required data-required-msg="required"  
													style="width: 100%" />											
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.cash_account"></span></td>
										<td>
											<input id="ddlCashAccount" name="ddlCashAccount"
													data-bind="value: obj.account_id"
													required data-required-msg="required"  
													style="width: 100%" />										
										</td>
									</tr>						            								
								</table>           		          	
						    </div>
						</div>

						<br>

						<div class="row-fluid">
	
							<!-- Column -->
							<div class="span6">
							
								<!-- Widget -->
								<div class="widget widget-3">
								
									<!-- Widget heading -->
									<div class="widget-head">
										<h4 class="heading"><span class="glyphicons coins"><i></i></span>Witdraw Amount</h4>
									</div>
									<!-- // Widget heading END -->
									
									<div class="widget-body large">
										<span data-bind="text: total"></span>
									</div>
									
									<!-- Widget footer -->
									<div class="widget-footer align-right">
										
									</div>
									<!-- // Widget footer END -->
									
								</div>
								<!-- // Widget END -->
								
							</div>
							<!-- // Column END -->
							
							<!-- Column -->
							<div class="span6">
							
								<!-- Widget -->
								<div class="widget widget-3">
								
									<!-- Widget heading -->
									<div class="widget-head">
										<h4 class="heading"><span class="glyphicons pencil"><i></i></span><span data-bind="text: lang.lang.memo"></span></h4>
									</div>
									<!-- // Widget heading END -->
									
									<div class="widget-body">
										<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:95%;" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
										<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:95%;" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>	
									</div>
									
								</div>
								<!-- // Widget END -->
								
							</div>
							<!-- // Column -->							
							
						</div>						

						<br>						

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> <span data-bind="text: lang.lang.print"></span></span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="wDepositWitdraw-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="wMeter" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">					

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons dashboard"><i></i>
							<span data-bind="text: lang.lang.meter"></span></h4>							        	
					    </div>
					    <div class="widget-body">

						    <div class="row-fluid">
						    		<div class="span6">
						    			<h5 class="heading-arrow" style="font-size: small;"><span data-bind="text: lang.lang.number1"></span> <span data-bind="text: obj.number"></span> </h5>
						    			
						    			<input id="cbbCustomer" name="cbbCustomer" 
						    				   data-role="combobox"
							                   data-placeholder="customer ..."
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-filter="search"							                   
							                   data-min-length="3"							                   
							                   data-text-field="fullname"
							                   data-value-field="id"
							                   data-template="wMeter-contact-combobox-template"
							                   data-bind="value: obj.contact_id,
							                              source: contactDS, events:{change: contactChanges}"
							                   required data-required-msg="ត្រូវការ Customer"
							                   style="width: 100%" />
						    			
						    			<br><br>

						    			<div class="row-fluid">
						    				<div class="span6">
								    			<label><span data-bind="text: lang.lang.deposit"></span> </label>
												<a data-bind="attr:{ href: deposit_link }"><span data-bind="text: obj.deposit[0].number"></span></a>
								    			|
								    			<span data-bind="text: deposit_amount"></span>
											</div>
											<div class="span6">
								    			<label><span data-bind="text: lang.lang.service2"></span> </label>
								    			<a data-bind="attr:{ href: invoice_link }"><span data-bind="text: obj.invoice[0].number"></span></a>
								    			|
								    			<span data-bind="text: invoice_amount"></span>
											</div>
										</div>

										<br>

						    			<div class="row-fluid">
						    				<div class="span6">
								    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
												<div class="input-prepend">
													<span class="add-on glyphicons direction"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>
											<div class="span6">
								    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
								    			<div class="input-prepend">
													<span class="add-on glyphicons google_maps"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>
										</div>

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.memo"></span></label>
											<div class="controls">
												<input class="k-textbox" 
						                  				data-bind="value: obj.memo"
						                  				style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->
										
										<div id="map" style="width: 450px; height: 250px;"></div>
						    		</div>

							    	<!-- Right Span -->
							    	<div class="span6">

							    		<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.location"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="ddlLocation" name="ddlLocation"
													   data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"				                  			   
									                   data-auto-bind="true"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.location_id, source: locationDS"
									                   required data-required-msg="required"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.type1"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="meterType" name="meterType"
													   data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"				                  			   
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.item_id, source: itemDS"
									                   required data-required-msg="required"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->										

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.number2"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="meterNo" name="meterNo" class="k-textbox" 
						                  				data-bind="value: obj.number, events:{change:checkExistingNumber}" 
						                  				required data-required-msg="required"
						                  				style="width: 100%;" />
						                  		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.startup_reading"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="txtStarupReading" name="txtStarupReading" class="k-textbox" 
						                  				data-bind="value: obj.startup_reading" 
						                  				required data-required-msg="required"
						                  				style="width: 100%;" />						                  		
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.number_of_digits"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="maxNo" name="maxNo" 
						                  				data-role="numerictextbox" 
						                  				data-bind="value: obj.max_number" 
						                  				data-format="n0" min="0" 
						                  				placeholder="ឧ.10,000/100,000" 
						                  				required data-required-msg="required"
						                  				style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="meterStatus" name="meterStatus"
						                  				data-role="dropdownlist"
						                  				data-value-primitive="true"													
						                  				data-text-field="name" 
						                  				data-value-field="id"				                  						                  				
						                  				data-bind="source: statusList, value: obj.status"
						                  				data-option-label="(--- Select ---)"
														required data-required-msg="required"
														style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->									
										
										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.tariff"></span> </label>
											<div class="controls">
												<input data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"				                  			   
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.tariff_id, source: tariffList"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.exemption"></span> </label>
											<div class="controls">
												<input data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"			                  			   
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.exemption_id, source: exemptionList"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.maintenance"></span> </label>
											<div class="controls">
												<input data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"			                  			   
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.maintenance_id, source: maintenanceList"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

									</div>
									<!-- End Right Span -->

							</div>

							<br>

							<div class="row-fluid">
					          	<!-- Form actions -->
								<div align="center">
									<span id="notification"></span>

									<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
									<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
									<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								</div>
								<!-- // Form actions END -->
							</div>

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="wMeter-row-template" type="text/x-kendo-template">	
	<tr>		
		<td>#=number#</td>
		<td>#=item_name#</td>		
		<td>			
			<div>#=tariffs.name!==undefined?tariffs.name:""#</div>
			<div>#=exemptions.name!==undefined?exemptions.name:""#</div>
			<div>#=maintenances.name!==undefined?maintenances.name:""#</div>
		</td>
		<td>
			#if(reactive_of>0){#
				REACTIVE
			#}else if(backup_of>0){#
				BACKUP
			#}else{#
				
			#}#
		</td>
		<td>#:status==1 ? "Active" : "Inactive"#</td>
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: delete"><i></i></span>
			<span class="glyphicons no-js edit" data-bind="click: edit"><i></i></span>						
		</td>		
	</tr>
</script>
<script id="wMeter-contact-combobox-template" type="text/x-kendo-template">	
	#=wnumber# #=fullname#
</script>

<script id="wReadingCenter" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">				
				
				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons dashboard"><i></i><span data-bind="text: lang.lang.meter_reading"></span></h4>							        	
				    </div>
				    <div class="widget-body">					
				
			            <div class="hidden-print">	            							            	
			            	<input data-role="combobox"
				                   data-placeholder="number..."
				                   data-auto-bind="false"
				                   data-value-primitive="true"
				                   data-filter="contains"							                   
				                   data-min-length="3"							                   
				                   data-text-field="number"
				                   data-value-field="id"
				                   data-bind="value: meter_id,
				                              source: meterDS"
				                   style="width: 300px;" />

				            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
			            </div>

			            <br>

			            <table class="table table-bordered table-condensed table-white">
							<thead>
								<tr>
									<th><span data-bind="text: lang.lang.month"></span></th>
									<th><span data-bind="text: lang.lang.reading"></span></th>								
									<th><span data-bind="text: lang.lang.usage"></span></th>
									<th><span data-bind="text: lang.lang.amount"></span></th>
									<th><span data-bind="text: lang.lang.reader"></span></th>
									<th><span data-bind="text: lang.lang.memo"></span></th>
									<th></th>
								</tr>
							</thead>	            		
		            		<tbody data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="wReading-center-tmpl"
					                data-bind="source: dataSource">
					        </tbody>
		            	</table>			    

					    <div data-role="pager" 
					    	data-auto-bind="false"
				            data-bind="source: dataSource"></div>

				    </div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->			   		        
				          
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="wReading-center-tmpl" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=kendo.toString(new Date(month_of), "MM-yyyy")#</td>		
		<td class="right">#=current#</td>
		<td class="right">#=usage#</td>
		<td></td>		
		<td></td>		
		<td>#=memo#</td>
		<td class="center">
			#var i = banhji.wReadingCenter.dataSource.indexOf(data);#			
			#if(i==0){#														
				<a href="\#/wEdit_reading/#=id#" class="btn-action glyphicons pencil btn-success"><i></i></a>
			#}#			
		</td>	
    </tr>
</script>
<script id="wEditReading" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">					

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons dashboard"><i></i>Edit Reading</h4>							        	
					    </div>
					    <div class="widget-body">

					    	<div class="box-generic">					    	

						    	<div class="row-fluid">
									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="registered_date">Date <span style="color:red">*</span></label>
					              			<input id="registered_date" name="registered_date" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.month_of" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="required" style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="txtFromDate">From <span style="color:red">*</span></label>
					              			<input id="txtFromDate" name="txtFromDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.from_date" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="from ..." style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="txtToDate">To <span style="color:red">*</span></label>
					              			<input id="txtToDate" name="txtToDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.to_date" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="required" style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="strPrevious">Previouse</label>
					              			<span id="strPrevious" name="strPrevious" data-bind="text: obj.previous"></span>
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="txtCurrent">Current <span style="color:red">*</span></label>
					              			<input id="txtCurrent" name="txtCurrent" 
					              				   data-role="numerictextbox"
								                   data-format="n0"								                   
								                   data-bind="value: obj.current, events:{change: readingChanges}"
								                   required data-required-msg="required" style="width: 100%;">
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="strUsage">Usage</label>
					              			<span id="strUsage" name="strUsage" data-bind="text: obj.usage"></span>
										</div>
										<!-- // Group END -->											
									</div>
								</div>

								<div class="row-fluid">
									<div class="span4">	
										<!-- Group -->
										<div class="control-group">							
											<label for="ddlReader">Reader <span style="color:red">*</span></label>
					              			<input id="ddlReader" name="ddlReader"
					              				   data-role="dropdownlist"
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.read_by, source: readerDS"
								                   data-option-label="(--- Select ---)"	style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span8">	
										<!-- Group -->
										<div class="control-group">							
											<label for="txtMemo">Memo </label>
					              			<input id="txtMemo" class="k-textbox" data-bind="value: obj.memo" style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>
								</div>

					    	</div>

					    	<div class="well" data-bind="visible: hasInvoice">
								<table class="table table-invoice">
									<tbody>
										<tr>
											<td>Number</td>
											<td class="right">
												<input id="txtNumber" name="txtNumber"
												   type="text" class="k-textbox" 					              				  					                   
								                   data-bind="value: invoice.number, enabled: hasInvoice"
								                   required data-required-msg="required" style="width: 170px;" />
											</td>
											<td width="30%"></td>
											<td>Billing Date</td>
											<td class="right">												
												<input id="txtIssuedDate" name="txtIssuedDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: invoice.issued_date, enabled: hasInvoice" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" 
					            					required data-required-msg="required" />
											</td>											
										</tr>
										<tr>
											<td>Month Of</td>
											<td class="right">												
												<input id="txtMonthOf" name="txtMonthOf" 
								            		data-role="datepicker"			            		
					            					data-bind="value: invoice.month_of, enabled: hasInvoice" 
					            					data-format="MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="MM-yyyy" 
					            					required data-required-msg="required" />
											</td>
											<td width="30%"></td>
											<td>Payment Date</td>
											<td class="right">												
												<input id="txtPaymentDate" name="txtPaymentDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: invoice.payment_date, enabled: hasInvoice" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" 
					            					required data-required-msg="required" />
											</td>											
										</tr>
										<tr>
											<td></td>
											<td></td>
											<td width="30%"></td>
											<td>Due Date</td>
											<td class="right">												
												<input id="txtDueDate" name="txtDueDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: invoice.due_date, enabled: hasInvoice" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" 
					            					required data-required-msg="required" />
											</td>
										</tr>										
									</tbody>
								</table>

								<table class="table table-bordered table-condensed table-white">
									<thead>
										<tr>
											<th>Description</th>
											<th>Qty</th>								
											<th>Price</th>
											<th>Amount</th>											
										</tr>
									</thead>	            		
				            		<tbody data-role="listview"
				            				data-auto-bind="false"	            					            					            					            			
							                data-template="wInvoice-line-wEdit-reading-center-tmpl"
							                data-bind="source: invoiceLineDS">
							        </tbody>					        		
				            	</table>

							</div>

							<br>

							<div class="row-fluid">
					          	<!-- Form actions -->
								<div align="center">
									<span id="notification"></span>

									<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
									<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
									<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
								</div>
								<!-- // Form actions END -->
							</div>

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="wInvoice-line-wEdit-reading-center-tmpl" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=description#</td>				
		<td class="right">
			#if(type=="tariff"){#
				#=unit#
			#}#
		</td>
		<td class="right">
			#if(type=="tariff"){#
				#=kendo.toString(price, "c0", locale)#
			#}#
		</td>				
		<td class="right">
			#if(type=="tariff"){#
				#=kendo.toString(amount, "c0", locale)#
			#}#
		</td>			
    </tr>
</script>

<script id="wReading" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3><span data-bind="text: lang.lang.reading1"></span></h3>					
					
		            <div class="box-generic">
		            	<input data-role="datepicker" 
		            			data-bind="value: monthOfSearch" 
		            			data-start="year" data-depth="year" 
		            			data-format="MM-yyyy" placeHolder="MM-yyyy" />						
										
						<input id="ddlBranch" data-bind="value: branch_id" />						                
			            <input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
		            	|						            	
		            	<input data-role="combobox"
			                   data-placeholder="number ..."
			                   data-auto-bind="false"
			                   data-value-primitive="true"
			                   data-filter="contains"							                   
			                   data-min-length="3"							                   
			                   data-text-field="number"
			                   data-value-field="id"
			                   data-bind="value: meter_id,
			                              source: meterDS" />
		          		
		          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> 		          								          		
		            </div>						        

			        <div align="center">
			        	<h3 data-bind="text: strMonthOf"</h3>
			        	<h4 data-bind="text: strTransformer"></h4>
			        </div>
			        
			        <div class="demo-section">			        
					    <table class="table table-bordered table-striped table-white">
					        <thead>
					            <tr>
					                <th><span data-bind="text: lang.lang.customer"></span></th>					                						                
					                <th><span data-bind="text: lang.lang.meter2"></span></th>					                
					                <th><span data-bind="text: lang.lang.new_round"></span></th>
					                <th><span data-bind="text: lang.lang.previouse"></span></th>
					                <th><span data-bind="text: lang.lang.current"></span></th>					                
					                <th class="right"><span data-bind="text: lang.lang.total"></span></th>
					            </tr>
					        </thead>
					        <tbody data-role="listview"
					        		data-auto-bind="false"					        		 
					        		data-template="wReading-row-template" 
					        		data-bind="source: dataSource"></tbody>
					        <tfoot data-template="wReading-footer-template" 
					        		data-bind="source: this"></tfoot>						        
					    </table>

					    <div id="pager" class="k-pager-wrap"
					    	 data-auto-bind="false"
				             data-role="pager" data-bind="source: dataSource"></div>
					    
				    </div>				       
			        
					<br>					

			        <div>			        	
						<span data-bind="text: lang.lang.month"></span>
			        	<input id="monthOf" name="monthOf" data-role="datepicker" 
				            			data-bind="value: month_of" 
				            			data-start="year" data-depth="year" data-format="MM-yyyy"
				            			required data-required-msg="required"
				            			placeholder="MM-yyyy" />				    	
				    	
						<span data-bind="text: lang.lang.from"></span>
                        <input type="text" data-role='datepicker' 
                        		id="fromDate" name="fromDate"
                        		data-bind="value: from_date"	            				
                        		data-type="date" data-format="dd-MM-yyyy"
                        		placeholder="ថ្ងៃ-ខែ-ឆ្នាំ"
                        		required data-required-msg="required"  />			            
			            
						<span data-bind="text: lang.lang.to"></span>
                        <input type="text" data-role='datepicker' 
                        		id ="toDate" name="toDate"
                        		data-bind="value: to_date"	            				 
                        		data-type="date" data-format="dd-MM-yyyy"
                        		placeholder="ថ្ងៃ-ខែ-ឆ្នាំ"
                        		required data-required-msg="ដល់ថ្ងៃណា?" 
                        		data-greaterdate-field="fromDate" 
                        		data-greaterdate-msg='ត្រូវថ្មីជាង ថ្ងៃអានចាប់ពី' />                        
			            			        	
						<span data-bind="text: lang.lang.reader"></span>
			          	<input data-role="dropdownlist"
			                   data-option-label="(--- Select ---)"
			                   data-value-primitive="true"
			                   data-text-field="fullname"
			                   data-value-field="id"
			                   data-bind="value: read_by, source: readerDS"
			                   required data-required-msg="required" />            
			        </div>
			        
			        <br>

			        <!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>						
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
					</div>
					<!-- // Form actions END -->

				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="wReading-row-template" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=fullname#</td>		
		<td>#=number#</td>		
		<td align="center">
			<input type="checkbox" data-bind="checked: new_round, events:{ change: onChange }" />
		</td>		
		<td>
			<input data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: previous, events:{ change: onChange }"
                   style="width: 100px" #=previous>0?disabled='disabled':''# />
		</td>
		<td>
			<input class="txt#=index#" data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: current, events:{ change: onChange }"                   
                   style="width: 100px" />            
			<span class="label label-important" data-bind="invisible: isValid"><strong>Invalid!</strong></span>			
		</td>		
		<td class="right" data-bind="text: usage"></td>	
    </tr>
</script>
<script id="wReading-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="8" style="font-size:30px;">            
			<span data-bind="text: lang.lang.total"></span>: #:total()# m<sup>3</sup>
        </td>
    </tr>
</script>

<script id="wIRReader" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3><span data-bind="text: lang.lang.ir_reader"></span></h3>				    
				   
		            <div class="box-generic">
		            	<input id="myFile" type="file" accept="text/csv">
		            	<button type="button" class="k-button btn-info" data-bind="click: readFile">
						<span data-bind="text: lang.lang.upload"></span></button>		            	
		            	<br>
						<span data-bind="text: uploadStatus"></span>
		            </div>			        
			        
			        <div class="demo-section">			        
					    <table class="table table-bordered table-striped table-white">
					        <thead>
					            <tr>
					                <th><span data-bind="text: lang.lang.customer"></span></th>					                						                
					                <th><span data-bind="text: lang.lang.meter2"></span></th>					                
					                <th><span data-bind="text: lang.lang.new_round"></span></th>
					                <th><span data-bind="text: lang.lang.previouse"></span></th>
					                <th><span data-bind="text: lang.lang.current"></span></th>					                
					                <th class="right"><span data-bind="text: lang.lang.total"></span></th>
					            </tr>
					        </thead>
					        <tbody data-role="listview"
					        		data-auto-bind="false"					        		 
					        		data-template="wIRReader-row-template" 
					        		data-bind="source: dataSource"></tbody>
					        <tfoot data-template="wIRReader-footer-template" 
					        		data-bind="source: this"></tfoot>						        
					    </table>

					    <div id="pager" class="k-pager-wrap"
					    	 data-auto-bind="false"
				             data-role="pager" data-bind="source: dataSource"></div>
					    
				    </div>				       
			        
					<br>					

			        <div>			        	
						<span data-bind="text: lang.lang.month"></span>
			        	<input id="monthOf" name="monthOf" data-role="datepicker" 
		            			data-bind="value: month_of" 
		            			data-start="year" data-depth="year" data-format="MM-yyyy"
		            			required data-required-msg="ត្រូវការ Month Of"
		            			placeholder="ខែ-ឆ្នាំ" />					    	
				    	
						<span data-bind="text: lang.lang.from"></span>
                        <input type="text" data-role='datepicker' 
                        		id="fromDate" name="fromDate"
                        		data-bind="value: from_date"	            				
                        		data-type="date" data-format="dd-MM-yyyy"
                        		placeholder="ថ្ងៃ-ខែ-ឆ្នាំ"
                        		required data-required-msg="ត្រូវការ ថ្ងៃអានចាប់ពី"  />                        	    				        
			            
			            
						<span data-bind="text: lang.lang.to"></span>
                        <input type="text" data-role='datepicker' 
                        		id ="toDate" name="toDate"
                        		data-bind="value: to_date"	            				 
                        		data-type="date" data-format="dd-MM-yyyy"
                        		placeholder="dd-MM-yyyy"
                        		required data-required-msg="required" 
                        		data-greaterdate-field="fromDate" 
                        		data-greaterdate-msg="required" />			            			        
			        	
						<span data-bind="text: lang.lang.reader"></span>
			          	<input data-role="dropdownlist"
			                   data-option-label="(--- Select ---)"
			                   data-value-primitive="true"
			                   data-text-field="fullname"
			                   data-value-field="id"
			                   data-bind="value: read_by, source: readerDS"
			                   required data-required-msg="required" />            
			        </div>
			        
			        <br>

			        <!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>						
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
					</div>
					<!-- // Form actions END -->

				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="wIRReader-row-template" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=fullname#</td>		
		<td>#=number#</td>		
		<td align="center">
			<input type="checkbox" data-bind="checked: new_round, events:{ change: onChange }" />
		</td>		
		<td>
			<input data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: previous, events:{ change: onChange }"
                   style="width: 100px" #=previous>0?disabled='disabled':''# />
		</td>
		<td>
			<input class="txt#=index#" data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: current, events:{ change: onChange }"                   
                   style="width: 100px" />            
			<span class="label label-important" data-bind="invisible: isValid"><strong>invalid!</strong></span>			
		</td>		
		<td class="right" data-bind="text: usage"></td>	
    </tr>
</script>
<script id="wIRReader-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="8" style="font-size:30px;">            
			<span data-bind="text: lang.lang.total"></span>: #:total()# m<sup>3</sup>
        </td>
    </tr>
</script>

<script id="wReadingBook" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3><span data-bind="text: lang.lang.reading_book"></span></h3>					
					
		            <div class="box-generic">										
						<input id="ddlBranch" data-bind="value: branch_id" />						                
			            <input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />		            	
		          		
		          		<button id="search" type="button" data-role="button"><i class="icon-search"></i></button>						          		
		            </div>			        
			        
			        <div id="grid"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>

<script id="wInvoice" type="text/x-kendo-template">	
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3><span data-bind="text: lang.lang.invoice"></span></h3>

					<br>
					
					<div class="hidden-print">
						<input data-role="datepicker" 
		            			data-bind="value: monthOfSearch" 
		            			data-start="year" data-depth="year" 
		            			data-format="MM-yyyy" placeHolder="Month Of" />						
										
						<input id="ddlBranch" data-bind="value: branch_id" />						                
			            <input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
		            	|						            	
		            	<input data-role="combobox"
			                   data-placeholder="number ..."
			                   data-auto-bind="false"
			                   data-value-primitive="true"
			                   data-filter="contains"							                   
			                   data-min-length="3"							                   
			                   data-text-field="number"
			                   data-value-field="id"
			                   data-bind="value: meter_id,
			                              source: meterDS" />
		          					          					          			          		
		          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>								
					</div>											

					<br>
					
					<table class="table table-bordered table-striped table-white">
				        <thead>
				            <tr>
				                <th><input type="checkbox" data-bind="checked: chkAll, events: {change : checkAll}" /></th>				                				                
				                <th><span data-bind="text: lang.lang.customer"></span></th>					                
				                <th><span data-bind="text: lang.lang.meter"></span></th>				                			                
				                <th><span data-bind="text: lang.lang.previouse"></span></th>
				                <th><span data-bind="text: lang.lang.current"></span></th>
				                <th><span data-bind="text: lang.lang.total"></span></th>	                    
				            </tr>
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="wInvoice-row-template" 
				        		data-auto-bind="false" 
				        		data-bind="source: readingDS"></tbody>
				        <tfoot data-template="wInvoice-footer-template" 
					        		data-bind="source: this"></tfoot>	            
				    </table>
				    
				    <div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: readingDS"></div>

				    <br>
				    
				    <div>
						<span data-bind="text: lang.lang.month"></span>
						<input id="monthOf" name="monthOf" data-role="datepicker" 
		            			data-bind="value: month_of"	data-start="year" 
		            			data-depth="year" data-format="MM-yyyy"
		            			required data-required-msg="required" />
				        <span data-bind="text: lang.lang.billing_date"></span>
				        <input id="issuedDate" name="issuedDate" data-role="datepicker" 
		            			data-bind="value: issued_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="required" />
				        <span data-bind="text: lang.lang.payment_date"></span>
				        <input id="paymentDate" name="paymentDate" data-role="datepicker" 
		            			data-bind="value: payment_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="required" />
				        <span data-bind="text: lang.lang.due_date"></span>
				        <input id="dueDate" name="dueDate" data-role="datepicker" 
		            			data-bind="value: due_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="required" />			           	          	
				    </div>
				         
				    <br />				    
				    
		          	<!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>							
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
					</div>
					<!-- // Form actions END -->					

				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->
	</div>	
</script>
<script id="wInvoice-row-template" type="text/x-kendo-tmpl">
	<tr>
		<td align="center">
		   <input type="checkbox" data-bind="checked: isCheck" />
		</td>						
		<td>#=customer[0].surname# #=customer[0].name#</td>		
		<td><a href="\#/wReading_center/#=meter_id#"><i></i> #=meter[0].number#</a></td>								
		<td class="right">#=previous#</td>
		<td class="right">#=current#</td>		
		<td class="right">#=usage# m<sup>3</sup></td>		
    </tr>
</script>
<script id="wInvoice-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="8" style="font-size:30px;">
            <span data-bind="text: lang.lang.total"></span>: #:total()# m<sup>3</sup>
        </td>
    </tr>
</script>

<script id="wPrintCenter" type="text/x-kendo-template">
	<div class="container-960">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<span class="pull-right glyphicons no-js remove_2 hidden-print" 
							onclick="javascript:window.history.back()"><i></i></span>

						<h3 class="hidden-print"><span data-bind="text: lang.lang.print1"></span></h3>
						
						<br>
						
						<table>
							<tr>
								<td>								
									<input data-role="datepicker" 
				            			data-bind="value: monthOfSearch" 
				            			data-start="year" data-depth="year" 
				            			data-format="MM-yyyy" placeHolder="MM-yyyy" />						
									
									<input data-role="dropdownlist"
									   data-option-label="(--- License ---)"
					                   data-auto-bind="false"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: branch_id,
					                              source: branchDS,			                              
					                              events: {
					                                change: branchChanges
					                              }"/>
					            </td>
					            <td>
					                <select data-role="multiselect"
							           data-placeholder="Location..."
							           data-value-primitive="true"
							           data-text-field="name"
							           data-value-field="id"
							           data-bind="value: selectedLocations,
							                      source: locationDS,
							                      enabled: isBranchSelected"
							           style="width: 200px;" 
							    	></select>
							    </td>
							    <td>							
					            	|						            	
					            	<input data-role="combobox"
						                   data-placeholder="number ..."
						                   data-auto-bind="false"
						                   data-value-primitive="true"
						                   data-filter="startswith"							                   
						                   data-min-length="3"							                   
						                   data-text-field="number"
						                   data-value-field="id"
						                   data-bind="value: invoice_id,
						                              source: invoiceDS" />

						            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
									<button type="button" data-role="button" data-bind="click: print"><i class="icon-print"></i></button>
								</td>
							</tr>
						</table>

			            <br>

			            <div class="row-fluid">							
							<div class="span2">
							
								<!-- Stats Widget -->
								<span class="widget-stats widget-stats-gray widget-stats-2">
									<span class="count"><a data-bind="text: obj.totalInvoice"></a></span>
									<span class="txt"><span data-bind="text: lang.lang.total_invoice"></span></span>
								</span>
								<!-- // Stats Widget END -->
								
							</div>
							<div class="span2">
							
								<!-- Stats Widget -->
								<span class="widget-stats widget-stats-2">
									<span class="count"><a data-bind="text: obj.totalUnprint"></a></span>
									<span class="txt"><span data-bind="text: lang.lang.no_print"></span></span>
								</span>
								<!-- // Stats Widget END -->
								
							</div>
							<div class="span2">
							
								<!-- Stats Widget -->
								<span class="widget-stats widget-stats-gray widget-stats-2">
									<span class="count"><a data-bind="text: obj.totalUsage"></a></span>
									<span class="txt">m<sup>3</sup></span>
								</span>
								<!-- // Stats Widget END -->
								
							</div>
							<div class="span6">
							
								<!-- Stats Widget -->
								<span class="widget-stats widget-stats-2">
									<span class="count"><a data-format="c0" data-bind="text: obj.totalAmount"></a></span>
									<span class="txt"><span data-bind="text: lang.lang.amount1"></span></span>
								</span>
								<!-- // Stats Widget END -->
								
							</div>							
						</div>					

			            <br>

			            <table class="table table-bordered table-striped table-white">
					        <thead>
					            <tr>
					            	<th style="width: 5%;" class="center">
					            		<input type="checkbox" data-bind="checked: chkAll, events: {change : checkAll}" />
					            	</th>					                
					                <th><span data-bind="text: lang.lang.customer"></span></th>					                						                
					                <th><span data-bind="text: lang.lang.number"></span></th>					                
					                <th><span data-bind="text: lang.lang.amount"></span></th>
					                <th><span data-bind="text: lang.lang.status"></span></th>
					                <th><span data-bind="text: lang.lang.print_count"></span></th>					                					                
					            </tr>
					        </thead>
					        <tbody data-role="listview"
				        		data-auto-bind="false"					        		 
				        		data-template="wPrint-center-template" 
				        		data-bind="source: dataSource"></tbody>					        						        
					    </table>

			            <div data-role="pager" 
					    	data-auto-bind="false"
					    	data-page-sizes='[50, 100, 200, "All"]'					    	
				            data-bind="source: dataSource"></div>																	
			
					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wPrint-center-template" type="text/x-kendo-tmpl">
	<tr>
		<td class="center">
			<input type="checkbox" data-bind="checked: isCheck" />
		</td>		
		<td>
			#=contact[0].wnumber# 

			#if(contact[0].contact_type_id==6 || contact[0].contact_type_id==7 || contact[0].contact_type_id==8){#
				#=contact[0].company# 
			#}else{#
				#=contact[0].surname# #=contact[0].name#
			#}#
		</td>
		<td>
			<a href="\#/wInvoice_print/#=id#"><i></i> #=number#</a>
		</td>
		<td class="right">#=kendo.toString(amount, "c0", banhji.institute.locale)#</td>
		<td>
			#if(status==0){#
				Open
			#}else{#
				Paid
			#}#
		</td>
		<td class="center">#=print_count#</td>
	</tr>
</script>
<script id="wInvoicePrint" type="text/x-kendo-template">
	<div class="container-960">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="glyphicons no-js remove_2 pull-right" 
								onclick="javascript:window.history.back()"><i></i></span>

							<span class="btn btn-inverse btn-icon glyphicons print" data-bind="click: print"><i></i><span data-bind="text: lang.lang.print"></span></span>											          																
						</div>

						<br>					
						
						<div data-role="listview" 
							data-auto-bind="false"
							data-bind="source: dataSource" 
							data-template="wInvoice-print-row-template"></div>						
			
					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wInvoice-print-row-template" type="text/x-kendo-tmpl">	
  	<div class="container-960">
		<table width="100%">
			<tr>
				<td valign="top">
					<img src="/banhji/#:company[0].image_url#" height="90" width="60" style="float: left">
				</td>
				<td align="center">
					<h4>#:company[0].name#</h4>					
					<h5>#:company[0].address# 
					<br>
					#:company[0].phone#</h5>					
				</td>
			</tr>
		</table>		

		<table width="100%">
			<tr>
				<td align="center" rowspan="2" width="60%">
					<h4>វិក្កយបត្រទូទាត់ថ្លៃទឹក</h4>
					<h5><span data-bind="text: lang.lang.month_of"></span> #=kendo.toString(new Date(month_of), "MM-yyyy")#</h5>
				</td>
				<td>ថ្ងៃចេញវិក្កយបត្រ</td>
				<td align="right">
					#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#					
				</td>
			</tr>
			<tr>
				<td><span data-bind="text: lang.lang.invoice_number"></span></td>
				<td align="right">					
					#=number#
				</td>				
			</tr>			
		</table>

		<table width="100%">
			<tr>
				<td width="60%">
					<span data-bind="text: lang.lang.full_names"></span> 
					<span class="strong">
						#if(contact[0].contact_type_id==6 || contact[0].contact_type_id==7 || contact[0].contact_type_id==8){#
							#=contact[0].company#
						#}else{#
							#=contact[0].surname# #=contact[0].name#
						#}#
					</span>
				</td>
				<td><span data-bind="text: lang.lang.customer_number"></span>:</td>
				<td align="right">#=contact[0].number#</td>				
			</tr>
			<tr>
				<td><span data-bind="text: lang.lang.address"></span> #=contact[0].address#</td>				
				<td><span data-bind="text: lang.lang.location"></span></td>
				<td align="right">#=location[0].name#</td>				
			</tr>
		</table>

		<table class="table table-bordered table-condensed">
			<thead>
				<tr>
					<th><span data-bind="text: lang.lang.meter2"></span></th>					
					<th><span data-bind="text: lang.lang.previouse"></span></th>
					<th><span data-bind="text: lang.lang.current"></span></th>
					<th>បរិមាណ</th>
					<th>តំលៃឯកត្តា</th>
					<th><span data-bind="text: lang.lang.amount"></span></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td></td>
					#for(var j=0; j<invoiceLines.length; j++) {#
						#if(invoiceLines[j].type=="tariff"){#
							<td class="center">#=kendo.toString(new Date(invoiceLines[j].record[0].from_date), "dd-MM-yyyy")#</td>
							<td class="center">#=kendo.toString(new Date(invoiceLines[j].record[0].to_date), "dd-MM-yyyy")#</td>						
						#}#
					#}#	
					<td class="right">m<sup>3</sup></td>
					<td></td>
					<td></td>
				</tr>
				#for(var i=0; i<invoiceLines.length; i++) {#
					#if(invoiceLines[i].type=="tariff"){#
						<tr>
							<td>#:invoiceLines[i].meter[0].number#</td>
							<td class="right">#:invoiceLines[i].record[0].previous#</td>
							<td class="right">#:invoiceLines[i].record[0].current#</td>						
							<td class="right">#:kendo.toString(kendo.parseInt(invoiceLines[i].unit), 'n0')#</td>
							<td class="right"><span>#:kendo.toString(kendo.parseFloat(invoiceLines[i].price)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</span></td>
							<td class="right"><span>#:kendo.toString(kendo.parseFloat(invoiceLines[i].amount)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</span></td>
						</tr>
					#}else{#
						<tr>
							<td colspan="3"></td>							
							<td colspan="2" class="right">#:invoiceLines[i].description#</td>
							#if(invoiceLines[i].type=="exemptionUsage"){#
								<td class="right">#:invoiceLines[i].amount# ម<sup>៣</sup></td>							
							#}else{#
								<td class="right">#:kendo.toString(kendo.parseFloat(invoiceLines[i].amount)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
							#}#
						</tr>
					#}#
				#}#						
				<tr>
					<td colspan="3" rowspan="2" class="center strong" style="font-size: medium;">
						ថ្ងៃផុតកំណត់បង់ប្រាក់ 
						<br> 
						#=kendo.toString(new Date(due_date), "dd-MM-yyyy")#
					</td>									
					<td class="right" colspan="2">បំណុលខែមុន</td>					
					<td class="right">#:kendo.toString(balance_forward*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
				</tr>
				<tr>										
					<td class="right strong" colspan="2">ទឹកប្រាក់ត្រូវបង់សរុប</td>					
					<td class="right strong">#:kendo.toString(total*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
				</tr>
				<tr>
					<td class="center" colspan="2">ថ្ងៃដែលបានបង់</td>					
					<td></td>					
					<td class="right" colspan="2">ទឹកប្រាក់ដែលបានបង់</td>					
					<td></td>
				</tr>
				<tr>
					<td colspan="6" class="top" style="font-size: x-small;" height="100px">
						#=company[0].term_of_condition#
					</td>
				</tr>
			</tbody>
		</table>

		<hr>

		<table width="100%">
			<tr>
				<td rowspan="2" width="40%">
					<span id="#=contact[0].wnumber#"></span>
				</td>
				<td align="left" class="strong">
					#if(contact[0].contact_type_id==5 || contact[0].contact_type_id==6 || contact[0].contact_type_id==7){#
						#=contact[0].company#
					#}else{#
						#=contact[0].surname# #=contact[0].name#
					#}#
				</td>
				<td>ថ្ងៃចេញវិក្ក.</td>
				<td align="right">#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
			</tr>
			<tr>
				<td align="left">#=location[0].name#</td>
				<td>លេខវិក្ក.</td>
				<td align="right">#=number#</td>
			</tr>
		</table>

		<table class="table table-bordered table-condensed" style="page-break-after: always;">
			<thead>
				<tr>
					<td>បេឡាករ</td>
					<td>Date</td>
					<td>ទឹកប្រាក់ទទួលបាន</td>
					<td>ទឹកប្រាក់ត្រូវបង់</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td class="right">#=kendo.toString(total*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
				</tr>
			</tbody>
		</table>

	</div>
</script>

<script id="wInventoryItem" type="text/x-kendo-template">
	<div class="container-fluid">
		<br>
		<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back();"><i></i></span>

		<h3><span data-bind="text: lang.lang.inventory"></span></h3>

		<div class="box-generic">
		    <!-- //Tabs Heading -->
		    <div class="tabsbar">
		        <ul>
		            <li class="glyphicons star active"><a href="#tab1" data-toggle="tab" data-bind="click: searchFavorite"><i></i> <span data-bind="text: lang.lang.favorite"></span> </a>
		            </li>
		            <li class="glyphicons list"><a href="#tab2" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.category"></span> </a>
		            </li>		            	            		            	            
		        </ul>
		    </div>
		    <!-- // Tabs Heading END -->

		    <div class="tab-content">
		        <!-- // FavoriteTab content -->
		        <div class="tab-pane active" id="tab1">
		        		
		        </div>
		        <!-- // Favorite Tab content END -->

		        <!-- // Category Tab content -->
		        <div class="tab-pane" id="tab2">
		            <input id="categories" data-bind="value: category_id" />	                
	                <input id="itemGroups" data-bind="value: item_group_id" disabled="disabled" />
            	</div>
		        <!-- // Category Tab content END -->		                
		    </div>

		    <br>

		    <div class="input-append">
			    <input class="col-md-2" id="appendedInputButtons" 
			    	type="text" placeholder="មុខទំនិញ ..." 
			    	data-bind="value: searchField, events:{ change: search }">

			    <button class="btn btn-default" data-bind="click: search"><i class="icon-search"></i> <span data-bind="text: lang.lang.search"></span></button>				    
			</div>
		</div>
		
		<br>

		<table class="table table-bordered">
	        <thead>
	            <tr>
	                <th><span data-bind="text: lang.lang.sku"></span></th>
	                <th><span data-bind="text: lang.lang.item"></span></th>
	                <th><span data-bind="text: lang.lang.description"></span></th>
	                <th><span data-bind="text: lang.lang.on_hand"></span></th>	                
	                <th><span data-bind="text: lang.lang.price"></span></th>	                
	                <th></th>
	            </tr>
	        </thead>
	        <tbody data-template="wInventory-item-template"
	        	data-pageable="true" 
	        	data-bind="source: dataSource"></tbody>
	    </table>
	    <div id="pager" class="k-pager-wrap"
	    	 data-auto-bind="false"
             data-role="pager" data-bind="source: dataSource"></div>        

	</div>
</script>
<script id="wInventory-item-template" type="text/x-kendo-template">
    <tr>
    	<td>#=sku#</td>
    	<td>#=name#</td>
    	<td>#=description#</td>
    	<td>
    		#if(on_hand<=order_point){#    		
    			<span class="badge badge-danger">#=kendo.toString(on_hand, "n0")#</span>
    		#}else{#
    			<span class="badge badge-info">#=kendo.toString(on_hand, "n0")#</span>
    		#}#

    		#=measurement==null?"":measurement#
    	</td>    	
    	<td>
    		#for(var i=0; i<price_list.length; i++) {#
    			#if(price_list[i].price>0){#
    				<span class="badge badge-inverse"> #=kendo.toString(price_list[i].price, "c", price_list[i].locale)# </span> / #=price_list[i].measurement# 
    			#}else{#
    				<span class="badge badge-danger"> #=kendo.toString(price_list[i].price, "c", price_list[i].locale)# </span> / #=price_list[i].measurement#
    			#}#
    			<br>    			    						 
			#}#
    	</td>    	
    	<td>
    		<div class="btn-group">
    			<button class="btn btn-default">ធ្វើការ</button>		  	
			  	<button class="btn dropdown-toggle" data-toggle="dropdown">
			    	<span class="caret"></span>
			  	</button>
			  	<ul class="dropdown-menu">			   		
			   		#if(is_assemble=="1"){#
			   			<li><a href="\#/item_assembly/#=id#"><i class="icon-edit"></i> Edit</a></li>			   		
			   		#}else if(is_catalog=="1"){#
			   			<li><a href="\#/item_catalog/#=id#"><i class="icon-edit"></i> Edit</a></li>			   		
			   		#}else{#
			   			<li><a href="\#/price_list/#=id#"><i class="icon-usd"></i> Set Price</a></li>			   			
			   			<li><a href="\#/item/#=id#"><i class="icon-edit"></i> Edit</a></li>
			   		#}#
			  	</ul>
			</div>
    	</td>    		
    </tr>
</script>
<script id="wInventory-item-category-template" type="text/x-kendo-template">
	<span class="btn btn-success" data-bind="click: categoryChanges">#=name#</span>  
</script>
<script id="wInventory-item-vendor-template" type="text/x-kendo-template">
    <div class="product-tmpl" data-bind="click: vendorChanges">
        <img src="#=image_url#" alt="#: company # image" />
        <h3>#:company#</h3>        
    </div>    
</script>

<script id="wBranch" type="text/x-kendo-template">
	<div class="container-960">
		<div class="row">
			<div class="span12">
				<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

				<div id="example" class="k-content">
					<h3><span data-bind="text: lang.lang.license"></span></h3>
				
					<div class="box-generic">
									
						<!-- Row -->
						<div class="row-fluid">
						
							<!-- Column -->
							<div class="span6">
							
								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.license_number"></span></label>
									<div class="controls">
										<input id="number" name="number" 
											type="text" class="span10 k-textbox" 
											data-bind="value: obj.operation_license, events:{change:checkExisting}"
											required data-required-msg="ត្រូវការ លេខអាជ្ញាប័ណ្ណ">

										<div class="alert alert-error" data-bind="visible: isExisting" style="width: 260px;">										    
										    <i class="icon-warning-sign"></i> duplicate number !
										</div>
									</div>
								</div>
								<!-- // Group END -->
								
								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.license_name"></span></label>
									<div class="controls">
										<input id="name" name="name" 
												type="text" class="span10 k-textbox" 
												data-bind="value: obj.name" 
												required data-required-msg="ត្រូវការ ឈ្មោះអាជ្ញាប័ណ្ណ">									
									</div>
								</div>
								<!-- // Group END -->
							
								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.description"></span></label>
									<div class="controls">
										<input type="text" class="span10 k-textbox" data-bind="value: obj.description">									
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.max_customer"></span></label>
									<div class="controls">
										<input type="text" class="input-mini k-textbox" data-bind="value: obj.max_customer">									
									</div>
								</div>
								<!-- // Group END -->						

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.expire_date"></span></label>								
									<div class="controls">
										<input class="span10" data-role="datepicker"			            		
			            					data-bind="value: obj.expire_date" 
			            					data-format="dd-MM-yyyy"
			            					data-parse-formats="yyyy-MM-dd" 
			            					placeholder="dd-MM-yyyy" />		            				
									</div>								
								</div>
								<!-- // Group END -->

								<br><br>

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.address"></span></label>
									<div class="controls">
										<input type="text" class="span10 k-textbox" data-bind="value: obj.address">									
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.status"></span></label>
									<div class="controls">
										<input id="ddlStatus" name="ddlStatus"
											   data-role="dropdownlist"
					            			   data-option-label="(--- Select ---)"					            			   			                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.status,
							                              source: statusList"
							                   required data-required-msg="required"/>
									</div>
								</div>
								<!-- // Group END -->
								
							</div>
							<!-- // Column END -->
							
							<!-- Column -->
							<div class="span6">
							
								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.currency"></span></label>
									<div class="controls">
										<input id="currency" name="currency"
											   class="span12" data-role="dropdownlist"
					            			   data-option-label="(--- Select ---)"					            			   			                   
							                   data-value-primitive="true"
							                   data-text-field="code"
							                   data-value-field="id"
							                   data-bind="value: obj.currency_id,
							                              source: currencyDS"
							                   required data-required-msg="required"/>
									</div>
								</div>
								<!-- // Group END -->
								
								<br><br>

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.abbr"></span></label>
									<div class="controls">
										<input id="abbr" name="abbr"
											type="text" class="input-mini k-textbox" 
											data-bind="value: obj.abbr"
											required data-required-msg="required">
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.representative"></span></label>
									<div class="controls">
										<input type="text" class="span12 k-textbox" data-bind="value: obj.representative">
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.tel"></span></label>
									<div class="input-prepend">
										<span class="add-on glyphicons phone"><i></i></span>
										<input type="text" class="input-large" data-bind="value: obj.phone" placeholder="01234567897">
									</div>								
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.phone"></span></label>
									<div class="input-prepend">
										<span class="add-on glyphicons iphone"><i></i></span>
										<input type="text" class="input-large" data-bind="value: obj.mobile" placeholder="01234567897">
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.email"></span></label>
									<div class="input-prepend">
										<span class="add-on glyphicons envelope"><i></i></span>
										<input type="text" class="input-large" data-bind="value: obj.email" placeholder="name@email.com">
									</div>
								</div>
								<!-- // Group END -->
								
							</div>
							<!-- // Column END -->
							
						</div>
						<!-- // Row END -->
						
						<div class="separator line bottom"></div>
						
						<!-- Group -->
						<div class="control-group row-fluid">
							<label class="control-label"><span data-bind="text: lang.lang.term_of_condition"></span></label>
							<div class="controls">
								<textarea data-role="editor"
				                      data-tools="['bold',
				                                   'italic',
				                                   'underline',
				                                   'strikethrough',
				                                   'justifyLeft',
				                                   'justifyCenter',
				                                   'justifyRight',
				                                   'justifyFull']"
				                      data-bind="value: obj.term_of_condition"
				                      style="height: 200px;"></textarea>
	                      	</div>
						</div>
						<!-- // Group END -->
						
						<!-- Form actions -->
						<div align="center">
							<span id="notification"></span>

							<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
							<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
							<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
						</div>
						<!-- // Form actions END -->
						
					</div>
				</div>
			</div>
		</div>
	</div>
</script>

<script id="wSettings" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2><span data-bind="text: lang.lang.general_setting_water"></span></h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons building" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.license"></span></span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons group" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.cutomer_type"></span></span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons google_maps" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.location1"></span></span></a>
	            </li>
	            <li><a href="#tab4-1" class="glyphicons calculator" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.tariff"></span></span></a>
	            </li>
	            <li><a href="#tab5-1" class="glyphicons gift" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.exemption"></span></span></a>
	            </li>
	            <li><a href="#tab6-1" class="glyphicons circle_ok" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.maintenance"></span></span></a>
	            </li>	           
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">

	            <!-- Tab Branch content -->
	            <div class="tab-pane active" id="tab1-1">
	            	<a href="#/wBranch" class="btn btn-primary btn-icon glyphicons circle_plus"><i></i> <span data-bind="text: lang.lang.new_license"></span></a>

	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.number"></span></th>
	            				<th><span data-bind="text: lang.lang.license"></span></th>	            				
	            				<th><span data-bind="text: lang.lang.abbr"></span></th>
	            				<th><span data-bind="text: lang.lang.representive"></span></th>	            				
	            				<th width="70px"><span data-bind="text: lang.lang.phone"></span></th>	            				
	            				<th width="100px"><span data-bind="text: lang.lang.address"></span></th>
	            				<th><span data-bind="text: lang.lang.expire_date"></span></th>
	            				<th><span data-bind="text: lang.lang.max_connections"></span></th>
	            				<th><span data-bind="text: lang.lang.status"></span></th>	            					            				
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            					            			
				                data-template="branch-wSettings-template"
				                data-bind="source: branchDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Branch content END -->

	            <!-- Tab Contact Type content -->
	            <div class="tab-pane" id="tab2-1">
	            	<div class="input-append">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="type name ..." data-bind="value: contactTypeName">
					    <button class="btn btn-default" type="button" data-bind="click: addContactType"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.type2"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="edit-contact-type-wSetting-template"
				                data-template="contact-type-wSettings-template"
				                data-bind="source: contactTypeDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Contact Type content END -->

	            <!-- Tab Block content -->
	            <div class="tab-pane" id="tab3-1">
            		<input data-role="dropdownlist"
            			   data-option-label="(--- Select ---)"
            			   data-auto-bind="false"			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: blockCompanyId,
		                              source: branchDS"/>

                	<div class="input-append">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="location name ..." data-bind="value: blockName">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="abbr ..." data-bind="value: blockAbbr">
					    <button class="btn btn-default" type="button" data-bind="click: addBlock"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.license"></span></th>
	            				<th><span data-bind="text: lang.lang.location1"></span></td>
	            				<th><span data-bind="text: lang.lang.abbr"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="edit-block-wSetting-template"
				                data-template="block-wSettings-template"
				                data-bind="source: blockDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Block content END -->

	            <!-- Tab Tariff content -->
	            <div class="tab-pane" id="tab4-1">
	                <div class="row-fluid">
		                <div class="span6">
			                <input data-role="dropdownlist"
		            			   data-option-label="(--- Select ---)"
		            			   data-auto-bind="false"			                   
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: tariffCompanyId,
				                              source: branchDS"/>

		                	<div class="input-append">
							    <input class="span6" id="appendedInputButtons" type="text" placeholder="tariff name ..." data-bind="value: tariffName">					    
							    <button class="btn btn-default" type="button" data-bind="click: addTariff"><i class="icon-plus"></i></button>					  
							</div>							
			            	<table class="table table-bordered table-white">
			            		<thead>
			            			<tr>
			            				<th><span data-bind="text: lang.lang.license"></span></th>
			            				<th><span data-bind="text: lang.lang.tariff_name"></span></th>	            				
			            				<th></th>
			            			</tr>
			            		</thead>
			            		<tbody data-role="listview"
			            				data-auto-bind="false"
				            			data-edit-template="edit-tariff-wSetting-template"
						                data-template="tariff-wSettings-template"
						                data-bind="source: tariffDS"></tbody>
			            	</table>
		            	</div>
		            	<div class="span6">		                	
						    <input class="span3" type="text" placeholder="usage ..." data-bind="value: tariffUsage">
						    <input class="span3" type="text" placeholder="price ..." data-bind="value: tariffPrice">							    					    
						    <input class="span2" data-role="dropdownlist"		            			   
	            			   data-auto-bind="false"			                   
			                   data-value-primitive="true"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: tariffFlat,
		                              source: flatList"/>
						    <button class="btn btn-default" type="button" data-bind="click: addTariffItem, enabled: selectedTariff"><i class="icon-plus"></i></button>					  
						
							<span data-bind="text: selectedTariffName"></span>							

			            	<table class="table table-bordered table-white">
			            		<thead>
			            			<tr>
			            				<th><span data-bind="text: lang.lang.usage"></span></th>
			            				<th><span data-bind="text: lang.lang.p"></span></th>
			            				<th><span data-bind="text: lang.lang.flat"></span></th>	            				
			            				<th></th>
			            			</tr>
			            		</thead>
			            		<tbody data-role="listview"
			            				data-auto-bind="false"
				            			data-edit-template="edit-tariff-item-wSetting-template"
						                data-template="tariff-item-wSettings-template"
						                data-bind="source: tariffItemDS"></tbody>
			            	</table>
		            	</div>
	            	</div>
	            </div>
	            <!-- // Tab Tariff content END -->

	            <!-- Tab Exemption content -->
	            <div class="tab-pane" id="tab5-1">
	            	<input data-role="dropdownlist"
            			   data-option-label="(--- License ---)"
            			   data-auto-bind="false"			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: exemptionCompanyId,
		                              source: branchDS"/>

	                <input data-role="dropdownlist"
            			   data-option-label="(--- Type ---)"
            			   data-auto-bind="false"			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: exemptionType,
		                              source: exemptionTypeList"/>

                	<div class="input-append">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="exemption name ..." data-bind="value: exemptionName">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="price ..." data-bind="value: exemptionAmount">					    
					    <button class="btn btn-default" type="button" data-bind="click: addExemption"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.license"></span></th>	            				
	            				<th><span data-bind="text: lang.lang.exemption_name"></span></th>
	            				<th><span data-bind="text: lang.lang.p"></span></th>
	            				<th><span data-bind="text: lang.lang.type2"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="edit-exemption-wSetting-template"
				                data-template="exemption-wSettings-template"
				                data-bind="source: exemptionDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Exemption content END -->

	            <!-- Tab content -->
	            <div class="tab-pane" id="tab6-1">
	            	<input data-role="dropdownlist"
            			   data-option-label="(--- Select ---)"
            			   data-auto-bind="false"			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: maintenanceCompanyId,
		                              source: branchDS"/>

	                <div class="input-append">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="maintenance name ..." data-bind="value: maintenanceName">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="price ..." data-bind="value: maintenanceAmount">
					    <button class="btn btn-default" type="button" data-bind="click: addMaintenance"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.license"></span></th>	            				
	            				<th><span data-bind="text: lang.lang.maintenance_name"></span></th>
	            				<th><span data-bind="text: lang.lang.p"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="edit-maintenance-wSetting-template"
				                data-template="maintenance-wSettings-template"
				                data-bind="source: maintenanceDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab content END -->

	        </div>
	    </div>

	</div>
</script>
<script id="branch-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>#=operation_license#</td>
   		<td>
   			<a href="\#/wBranch/#=id#"><i></i>#=name#</a>
   		</td>   		
   		<td>#=abbr#</td>
   		<td>#=representative#</td>   		
   		<td>#=phone# #=mobile#</td>   		
   		<td>#=address#</td>
   		<td>#=expire_date#</td>
   		<td>#=max_customer#</td>
   		<td>
   			#if(status==1){#
				<span class="glyphicons no-js ok"><i></i></span>
			#}else{#
				<span class="glyphicons no-js ban"><i></i></span>
			#}#
   		</td>		 		
   	</tr>
</script>
<script id="contact-type-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			#if(is_system=="0"){#
	   			<div class="edit-buttons">       
			        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
			        <a class="k-button" data-bind="click: deleteContactType"><span class="k-icon k-delete"></span></a>
			   	</div>
		   	#}#
   		</td>
   	</tr>
</script>
<script id="edit-contact-type-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="block-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#if(company[0]) {#
    			#=company[0].name#
    		#}#
    	</td>
    	<td>
    		#:name#
   		</td>
   		<td>
    		#:abbr#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
   		</td>
   	</tr>
</script>
<script id="edit-block-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: company_id,
	                              source: branchDS"/>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" />                
            </dd>                
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="tariff-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#if(company[0]) {#
    			#=company[0].name#
    		#}#
    	</td>
    	<td>
    		#:name#
   		</td>   		
		<td>
			<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
            <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
            <span class="k-button" data-bind="click: loadTariffItem"><i class="icon-hand-right"></i></span>             
		</td>
   	</tr>
</script>
<script id="edit-tariff-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: company_id,
	                              source: branchDS"/>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>                         
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="tariff-item-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>#=usage#</td>
    	<td>#=price#</td>
    	<td>
    		#if(is_flat){#
    			ថេរ
    		#}else{#
    			អត់ថេរ
    		#}#
    	</td>   		
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#" onclick="return confirm('Are you sure you want to delete this item?');"><span class="k-icon k-delete"></span></a>
		   	</div>
   		</td>
   	</tr>
</script>
<script id="edit-tariff-item-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>
        	<dd>
        		<input data-role="dropdownlist"		            			   
        			   data-auto-bind="false"			                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: is_flat,
                              source: flatList"/>
        	</dd>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:usage" name="usage" required="required" validationMessage="required" />
                <span data-for="usage" class="k-invalid-msg"></span>
            </dd> 
            <dd>
                <input type="text" class="k-textbox" data-bind="value:price" name="price" required="required" validationMessage="required" />
                <span data-for="price" class="k-invalid-msg"></span>
            </dd>                         
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="exemption-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#if(company[0]) {#
    			#=company[0].name#
    		#}#
    	</td>    	
   		<td>
    		#:name#
   		</td>
   		<td>
    		#:amount#
   		</td>
   		<td>
    		#:unit#
   		</td>    		
		<td>
			<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
            <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>                        
		</td>
   	</tr>
</script>
<script id="edit-exemption-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: company_id,
	                              source: branchDS"/>
            </dd>
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Type ---)"
        			   data-auto-bind="false"			                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: unit,
	                              source: exemptionTypeList"/>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd> 
            <dd>
                <input type="text" class="k-textbox" data-bind="value:amount" name="amount" required="required" validationMessage="required" />
                <span data-for="amount" class="k-invalid-msg"></span>
            </dd>                        
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="maintenance-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#if(company[0]) {#
    			#=company[0].name#
    		#}#
    	</td>    	
   		<td>
    		#:name#
   		</td>
   		<td>
    		#:amount#
   		</td>    		
		<td>
			<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
            <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>                        
		</td>
   	</tr>
</script>
<script id="edit-maintenance-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: company_id,
	                              source: branchDS"/>
            </dd>           
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd> 
            <dd>
                <input type="text" class="k-textbox" data-bind="value:amount" name="amount" required="required" validationMessage="required" />
                <span data-for="amount" class="k-invalid-msg"></span>
            </dd>                        
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>


<!-- Water Reports -->
<!-- Water Customers -->
<script id="wReportCenter" type="text/x-kendo-template">
	<div>
		<span class="pull-right glyphicons no-js remove_2" 
				onclick="javascript:window.history.back()"><i></i></span>

		<table>
			<tr>
				<td>
					<h2><span data-bind="text: lang.lang.key_performance_indicators"></span></h2>
				</td>
				<td>
					<input data-role="dropdownlist"
					   data-option-label="(--- Select ---)"
	                   data-auto-bind="false"
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: branch_id,
	                              source: branchDS,
	                              events: {
	                                change: branchChanges
	                              }"
	                   style="width: 400px;" /> 
				</td>
			</tr>
		</table>
	</div>
	
	<br>	

	<div class="box-generic">
		<div class="row-fluid">							
			<div class="span2">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-gray widget-stats-2">
					<span class="count"><a data-bind="text: obj.totalCustomer"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.total_no_of_customers"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span2">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-2">
					<span class="count"><a data-format="p" data-bind="text: obj.totalAllowCustomer" style="font-size: 50px;"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.total_customers_ratio"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span3">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-gray widget-stats-2">
					<span class="count"><a data-format="p" data-bind="text: obj.totalActiveCustomer"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.active_customers_ratio"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span5">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-2">
					<span class="count"><a data-format="c0" data-bind="text: obj.totalIncome"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.total_water_revenue"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>							
		</div>

		<div class="row-fluid">		
			<div class="span2">
			
				<!-- Stats Widget -->			
				<span class="widget-stats widget-stats-default widget-stats-2">
					<span class="count"><a data-bind="text: obj.totalUsage"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.water_sold"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span2">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-2">
					<span class="count"><a data-format="n2" data-bind="text: obj.avgUsage"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.average_water_usage_per_connection"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span3">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-default widget-stats-2">
					<span class="count"><a data-format="c0" data-bind="text: obj.avgIncome"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.avarage_reveune_per_connection"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span5">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-2">
					<span class="count"><a data-format="c0" data-bind="text: obj.totalDeposit"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.total_deposit"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>							
		</div>
	</div>

	<br>

	<h2><span data-bind="text: lang.lang.water_related_reports"></span></h2>
	<br>

	<div class="row-fluid">
		<div class="span3">
			<h4><span data-bind="text: lang.lang.customer_management_report"></span></h4>
			<div class="well margin-none" style="height: 250px;">
				<span data-bind="text: lang.lang.these_reports_are_useful_for_customer_information_management_meter_connections_and_usage_managements"></span>
				<br><br>
				<ul>
					<li><a href='#/wCustomer_list'><span data-bind="text: lang.lang.customer_list1"></span></a></li>
	  				<li><a href='#/wBrand_new_customer'><span data-bind="text: lang.lang.new_customer_list"></span></a></li>  				
	  				<li><a href='#/wCustomer_no_meter'><span data-bind="text: lang.lang.no_connection"></span></a></li>
	  				<br>
	  				<li><a href='#/wLow_consumption'><span data-bind="text: lang.lang.minimum_water_usage_list"></span></a></li>
	  				<li><a href='#/wDisconnect_list'><span data-bind="text: lang.lang.disconnected_list"></span></a></li>
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4><span data-bind="text: lang.lang.receiveable_and_deposits"></span></h4>
			<div class="well margin-none" style="height: 250px;">
				<span data-bind="text: lang.lang.these_would_be_the_most_common_reports_that_you_will_be_using"></span>  
				<br><br>
				<ul>
					<li><a href='#/wCustomer_balance'><span data-bind="text: lang.lang.accounts_receivable_listing"></span></a></li>
	  				<li><a href='#/wCustomer_deposit'><span data-bind="text: lang.lang.customer_deposit"></span></a></li>  				  					  				  
	  				<li><a href='#/wAging_summary'><span data-bind="text: lang.lang.customer_aging_summary_list"></span></a></li> 
	  				<li><a href='#/wAging_detail'><span data-bind="text: lang.lang.customer_aging_detail_list"></span></a></li>
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4><span data-bind="text: lang.lang.sale_report"></span></h4>
			<div class="well margin-none" style="height: 250px;">
				<span data-bind="text: lang.lang.summary_and_detail_sale_report_broken_down_by_Licenses_bloc_and_types_of_reveneues"></span>				
				<br><br>
				<ul>
					<li><a href='#/wSale_summary'><span data-bind="text: lang.lang.sale_summary_report"></span></a></li>
	  				<li><a href='#/wSale_detail'><span data-bind="text: lang.lang.sale_detail_report"></span></a></li>  				  					  				  
	  				<li><a ><span data-bind="text: lang.lang.connection_service"></span></a></li> 
	  				<li><a ><span data-bind="text: lang.lang.other_revenues"></span></a></li>
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4><span data-bind="text: lang.lang.cash_receipt_report"></span></h4>
			<div class="well margin-none" style="height: 250px;">
				<span data-bind="text: lang.lang.summary_and_detail_cash_receipt_reports_grouped_by_sources_methods_of_receipts"></span>
				<br><br>
				<ul>
					<li><a href='#/wPayment_summary'><span data-bind="text: lang.lang.cash_receipt_by_summary"></span></a></li> 
  					<li><a href='#/wPayment_detail'><span data-bind="text: lang.lang.cash_receipt_by_detail"></span></a></li>  
	  				<li><a href='#/wPayment_by_source_summary'><span data-bind="text: lang.lang.cash_receipt_by_sources"></span></a></li>
	  				<li><a href='#/wPayment_by_source_detail'><span data-bind="text: lang.lang.cash_receipt_by_sources_detail"></span></a></li> 
				</ul>
			</div>
		</div>
	</div>

	<p class="separator text-center"><i class="icon-ellipsis-horizontal icon-3x"></i></p>
</script>
<script id="wCustomerList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input id="ddlBranch" />						                
							<input id="ddlLocation" disabled="disabled" />
							<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						
						</div>

						<h3 align="center">Customer List</h3>	

						<div id="grid"></div>
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wCustomerNoMeter" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">						
						
		                <!-- <div class="hidden-print">
		                	<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back();"><i></i></span>

		                	<input data-role="dropdownlist"
				                   data-auto-bind="false"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: branch_id,
				                              source: branchDS"
				                   data-option-label="(--- License ---)" />

				            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>   
		                </div>			           

						<br> -->
						
						<h4 align="center">Un-connected Customer List</h4>							

						<br>						

						<table class="table table-bordered table-striped table-white">
			        		<thead>
			        			<tr>			        				
			        				<th>Code</th>	
			        				<th>Name</th>			        					            				
			        				<th>Type</th>
			        				<th>Block</th>
			        				<th>License</th>			        				
			        				<th>Deposit</th>
			        				<th></th>		        				            					            				
			        			</tr>
			        		</thead>
			        		<tbody data-role="listview"
			        				data-auto-bind="true"	            					            			
					                data-template="wCustomer-no-meter-row-template"
					                data-bind="source: dataSource"></tbody>
			        	</table>

			        	<div data-role="pager" 
						    	data-auto-bind="true"
					            data-bind="source: dataSource"></div>						

					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wCustomer-no-meter-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>#=wnumber#</td>
		<td>
			<a data-bind="click: goToNewMeter">#=fullname#</a>
		</td>
		<td>#=contact_type_name#</td>
		<td>#=wlocation_name#</td>
		<td>#=wbranch_name#</td>							
		<td align="right">#=kendo.toString(wdeposit, "c0", banhji.userManagement.getLogin().institute[0].locale)#</td>
		<td>
			<span class="btn btn-success btn-icon glyphicons circle_plus" data-bind="click: goToNewMeter"><i></i>New Connected</span>			
		</td>							
    </tr>   
</script>
<script id="wBrandNewCustomer" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">						
						
		                <form id="employeeForm" data-role="validator" novalidate="novalidate">
			                <div id="fieldlist" class="hidden-print">
			                	<span class="pull-right glyphicons no-js remove_2" 
									onclick="javascript:window.history.back();"><i></i></span>

			                	<input data-role="dropdownlist"                   
				                   data-value-primitive="true"
				                   data-text-field="text"
				                   data-value-field="value"
				                   data-bind="value: sorter,
				                              source: sortList,                              
				                              events: { change: sorterChanges }" />
				                                           
			                    <input type="text" data-role='datepicker' id="sdate" name="sdate" data-type="date" data-bind="value: sdate" />
			                    <span data-for='sdate' class='k-invalid-msg'></span>

			                    <input type="text" data-role='datepicker' id ="edate" data-type="date" name="edate" data-bind="value: edate" 
			                    		data-greaterdate-field="sdate" data-greaterdate-msg='Check Date' />
			                    <span data-for='edate' class='k-invalid-msg'></span>

			                    <input data-role="dropdownlist"
				                   data-auto-bind="false"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: branch_id,
				                              source: branchDS"
				                   data-option-label="(--- License ---)" />
			               
			                    <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
								<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>     
			                </div>
			            </form>
					
						<div align="center">
							<h4>New Customer List</h4>
							
							<span data-bind="text: strDate()"></span>														
						</div>											

						<br>						

						<table class="table table-bordered table-striped table-white">
			        		<thead>
			        			<tr>			        				
			        				<th>Register Date</th>
			        				<th>Code</th>	
			        				<th>Name</th>			        					            				
			        				<th>Type</th>			        				
			        				<th>Block</th>
			        				<th>License</th>
			        				<th>Deposit</th>
			        				<th>Meter</th>		        				            					            				
			        			</tr>
			        		</thead>
			        		<tbody data-role="listview"
			        				data-auto-bind="false"	            					            			
					                data-template="wBranch-new-customer-row-template"
					                data-bind="source: dataSource"></tbody>
			        	</table>

			        	<div data-role="pager" 
						    	data-auto-bind="false"
					            data-bind="source: dataSource"></div>						

					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wBranch-new-customer-row-template" type="text/x-kendo-tmpl">		
	<tr>
		<td>#=kendo.toString(new Date(registered_date), "dd-MM-yyyy")#</td>		
		<td>#=wnumber#</td>
		<td>#=fullname#</td>
		<td>#=contact_type_name#</td>		
		<td>#=wlocation_name#</td>
		<td>#=wbranch_name#</td>						
		<td align="right">#=kendo.toString(wdeposit, "c0", banhji.userManagement.getLogin().institute[0].locale)#</td>
		<td>
			#for(var i=0; i<meters.length; i++) {#
				#:meters[i].number# <br>
			#}#
		</td>							
    </tr>   
</script>
<script id="wLowConsumption" type="text/x-kendo-template">
	<div class="row-fluid">
		<div class="span12">
			<div id="example" class="k-content">
				<div class="hidden-print">
					<a href="javascript:void()" 
						class="pull-right glyphicons no-js remove_2" 
						onclick="javascript: window.history.back()"><i></i></a>

					<input id="ddlBranch" />						                
					<input id="ddlLocation" disabled="disabled" />
					<input id="monthpicker" placeholder="Monthly" />
					<input id="usage" placeHolder="Minimux Usage" />	
					<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
				</div>

				<br>
				
				<div align="center">
					<h3>Minimux Usage List</h3>					
					<span id="strDate"></span>
				</div>
				
				<div id="grid"></div>					
								
			</div><!-- //End div example-->
		</div><!-- //End div span12-->
	</div><!-- //End div row-fluid-->	
</script>
<script id="wDisconnectList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<a href="javascript:void()" 
								class="pull-right glyphicons no-js remove_2" 
								onclick="javascript: window.history.back()"><i></i></a>

							<input id="ddlBranch" />						                
							<input id="ddlLocation" disabled="disabled" />							
							<input id="days" placeHolder="Due Date" />	
							<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>											
						</div>

						<br>

						<div align="center">
							<h3>Disconnected List</h3>		
						</div>
						
						<div id="grid"></div>
					</div>
				</div>
			</div>
		</div>
	</div>	
</script>

<!-- Customer Accounting -->
<script id="wCustomerBalance" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input id="ddlBranch" />						                
							<input id="ddlLocation" disabled="disabled" />
							<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						
						</div>

						<h3 align="center">បញ្ជីសមតុល្យអតិថិជន</h3>	

						<div id="grid"></div>					
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wCustomerDeposit" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input id="ddlBranch" />						                
							<input id="ddlLocation" disabled="disabled" />
							<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						
						</div>

						<h3 align="center">បញ្ជីប្រាក់កក់អតិថិជន</h3>	

						<div id="grid"></div>					
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wAgingSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">

					<div class="hidden-print">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back();"><i></i></span>

						<input id="ddlBranch" data-bind="value: branch_id" />						                
						<input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
						<input data-role="datepicker" data-bind="value: search_date" data-format="dd-MM-yyyy" placeHolder="Date" />
						<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>				
					</div>

					<br>
					
					<div align="center">
						<h3>បញ្ជីបំណុលអតិថិជនសង្ខេប</h3>
						គិតត្រឹម
						<span data-bind="text: strDate"></span>
					</div>

					<table class="table table-bordered table-striped table-white">
		        		<thead>
		        			<tr>
		        				<th>ឈ្មោះ</th>
		        				<th>បច្ចុប្បន្ន</th>
		        				<th>១-៣០ថ្ងៃ</th>			        				
		        				<th>៣១-៦០ថ្ងៃ</th>
		        				<th>៦១-៩០ថ្ងៃ</th>        				
		        				<th>លើសពី ៩០ថ្ងៃ</th>
		        				<th>សរុប</th>	            					            				
		        			</tr>
		        		</thead>
		        		<tbody data-role="listview"
		        				data-auto-bind="false"	            					            			
				                data-template="wAging-summary-row-template"
				                data-bind="source: dataSource"></tbody>
		        	</table>

		        	<div data-role="pager"
				    	 data-auto-bind="false"
			             data-bind="source: dataSource"></div>					
										
				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->	
	</div>	
</script>
<script id="wAging-summary-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>#=fullIdName#</td>		
		<td class="right">#:kendo.toString(current, 'c0', banhji.institute.locale)#</td>		
		<td class="right">#:kendo.toString(oneMonth, 'c0', banhji.institute.locale)#</td>
		<td class="right">#:kendo.toString(twoMonth, 'c0', banhji.institute.locale)#</td>
		<td class="right">#:kendo.toString(threeMonth, 'c0', banhji.institute.locale)#</td>
		<td class="right">#:kendo.toString(overMonth, 'c0', banhji.institute.locale)#</td>
		<td class="right">#:kendo.toString(amount, 'c0', banhji.institute.locale)#</td>					
    </tr>   
</script>
<script id="wAgingDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">
					
					<div class="hidden-print">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back();"><i></i></span>

						<input id="ddlBranch" data-bind="value: branch_id" />						                
						<input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
						<input data-role="datepicker" data-bind="value: search_date" data-format="dd-MM-yyyy" placeHolder="Date" />
						<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>				
					</div>

					
					<div align="center">
						<h3>Account Received By Detail List</h3>
						To
						<span data-bind="text: strDate"></span>
					</div>

					<div id="grid"></div>		        	

				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->	
	</div>	
</script>

<!-- Sale -->
<script id="wSaleSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					
		            <div class="box-generic hidden-print">
		            	<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

		            	<input data-role="dropdownlist"                   
		                   data-value-primitive="true"
		                   data-text-field="text"
		                   data-value-field="value"
		                   data-bind="value: sorter,
		                              source: sortList,                              
		                              events: { change: sorterChanges }" />
		                                           
	                    <input data-role="datepicker"	                       
	                       data-format="dd-MM-yyyy"
	                       data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: sdate"
		                   placeholder="From" />
	                    
	                   	<input data-role="datepicker"
	                       data-format="dd-MM-yyyy"
	                       data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: edate"
		                   placeholder="To" />	                    	            	
		          		
		          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
		          		|
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
		            </div>

		            <br><br>

		            <div align="center">
						<h3>Sale By Summary</h3>
						
						<span data-bind="text: strDate"></span>														
					</div>

					<br>			        
			        
			        <div id="grid"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="wSaleDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					
		            <div class="box-generic hidden-print">
		            	<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

						<table>
							<tr>
								<td>
					            	<input data-role="dropdownlist"                   
					                   data-value-primitive="true"
					                   data-text-field="text"
					                   data-value-field="value"
					                   data-bind="value: sorter,
					                              source: sortList,                              
					                              events: { change: sorterChanges }" />
					                                           
				                    <input data-role="datepicker"
				                       data-format="dd-MM-yyyy"
				                       data-parse-formats="yyyy-MM-dd"
					                   data-bind="value: sdate" />
				                    
				                   	<input data-role="datepicker"
				                       data-format="dd-MM-yyyy"
				                       data-parse-formats="yyyy-MM-dd"
					                   data-bind="value: edate" />

					                <input data-role="dropdownlist"
									   data-option-label="(--- រើស អាជ្ញាប័ណ្ណ ---)"
					                   data-auto-bind="false"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: branch_id,
					                              source: branchDS,			                              
					                              events: {
					                                change: branchChanges
					                              }"/>
					            </td>
					            <td>
					            	<select data-role="multiselect"
							           data-placeholder="Block..."
							           data-value-primitive="true"
							           data-text-field="name"
							           data-value-field="id"
							           data-bind="value: selectedLocations,
							                      source: locationDS,
							                      enabled: isBranchSelected"
							           style="width: 200px;" 
							    	></select>
					            </td>	                    	            	
					          	<td>	
					          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
					          		|
									<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
								</td>
							</tr>
						</table>						          		
		            </div>

		            <br><br>

		            <div align="center">
						<h3>Sale By Detail</h3>
						
						<span data-bind="text: strDate"></span>														
					</div>

					<br>			        
			        
			        <div id="grid"></div>

			        <div data-role="pager" 
					    	data-auto-bind="false"
					    	data-page-sizes='[50, 100, 200, "All"]'					    	
				            data-bind="source: dataSource"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>

<!-- Payment -->
<script id="wPaymentSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						
						<form id="employeeForm" data-role="validator" novalidate="novalidate">
			                <div id="fieldlist" class="hidden-print">
			                	<span class="pull-right glyphicons no-js remove_2" 
									onclick="javascript:window.history.back();"><i></i></span>

			                	<input data-role="dropdownlist"                   
				                   data-value-primitive="true"
				                   data-text-field="text"
				                   data-value-field="value"
				                   data-bind="value: sorter,
				                              source: sortList,                              
				                              events: { change: sorterChanges }" />
				                                           
			                    <input type="text" data-role='datepicker' id="sdate" name="sdate" data-type="date" data-bind="value: sdate" />
			                    <span data-for='sdate' class='k-invalid-msg'></span>

			                    <input type="text" data-role='datepicker' id ="edate" data-type="date" name="edate" data-bind="value: edate" 
			                    		data-greaterdate-field="sdate" data-greaterdate-msg='សូមពិនិត្យមើលកាលបរិច្ឆទឡើងវិញ' />
			                    <span data-for='edate' class='k-invalid-msg'></span>
			               
			                    <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> 
			                    |
								<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>      
			                </div>
			            </form>

						<br>

						<div align="center">
							<h4>របាយការណ៍ទទួលប្រាក់សង្ខេប</h4>
							
							<span data-bind="text: strDate"></span>														
						</div>

						<br>						

						<table class="table table-bordered table-striped table-white">
			        		<thead>
			        			<tr>
			        				<th width="45">No.</th>
			        				<th>អាជ្ញាប័ណ្ណ</th>
			        				<th>តំបន់</th>			        				
			        				<th>ទឹកប្រាក់លក់</th>
			        				<th>ទទួលប្រាក់</th>        				
			        				<th>សមតុល្យ</th>	            					            				
			        			</tr>
			        		</thead>
			        		<tbody data-role="listview"
			        				data-auto-bind="false"	            					            			
					                data-template="wPayment-summary-row-template"
					                data-bind="source: dataSource"></tbody>
			        	</table>						

					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wPayment-summary-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>#=banhji.wPaymentSummary.dataSource.indexOf(data)+1#</td>
		<td>#=branch_name#</td>
		<td>#=location_name#</td>		
		<td class="right">#=kendo.toString(sale, "c0", banhji.eDashBoard.locale)#</td>
		<td class="right">#=kendo.toString(paid, "c0", banhji.eDashBoard.locale)#</td>
		<td class="right">#=kendo.toString(paid, "c0", banhji.eDashBoard.locale)#</td>						
    </tr>   
</script>
<script id="wPaymentDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">

						<form id="employeeForm" data-role="validator" novalidate="novalidate">
			                <div id="fieldlist" class="hidden-print">
			                	<span class="pull-right glyphicons no-js remove_2" 
									onclick="javascript:window.history.back();"><i></i></span>

			                	<input data-role="dropdownlist"                   
				                   data-value-primitive="true"
				                   data-text-field="text"
				                   data-value-field="value"
				                   data-bind="value: sorter,
				                              source: sortList,                              
				                              events: { change: sorterChanges }" />
				                                           
			                    <input type="text" data-role='datepicker' id="sdate" name="sdate" data-type="date" data-bind="value: sdate" />
			                    <span data-for='sdate' class='k-invalid-msg'></span>

			                    <input type="text" data-role='datepicker' id ="edate" data-type="date" name="edate" data-bind="value: edate" 
			                    		data-greaterdate-field="sdate" data-greaterdate-msg='សូមពិនិត្យមើលកាលបរិច្ឆទឡើងវិញ' />
			                    <span data-for='edate' class='k-invalid-msg'></span>
			               
			                    <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
								<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>      
			                </div>
			            </form>

						<br>

						<div align="center">
							<h4>របាយការណ៍ទទួលប្រាក់លំអិត</h4>
							
							<span data-bind="text: strDate"></span>														
						</div>

						<br>            			

						<table class="table table-bordered table-striped table-white">
			        		<thead>
			        			<tr>			        				
			        				<th>Date</th>
			        				<th>បេឡាករ</th>
			        				<th>លេខកូដ</th>	
			        				<th>ឈ្មោះ</th>			        					            				
			        				<th>វិក្កយបត្រ</th>
			        				<th>បង់ប្រាក់</th>			        							        					        				            					            				
			        			</tr>
			        		</thead>
			        		<tbody data-role="listview"
			        				data-auto-bind="false"	            					            			
					                data-template="wPayment-detail-row-template"
					                data-bind="source: dataSource"></tbody>
			        	</table>

			        	<div data-role="pager" 
						    	data-auto-bind="false"
					            data-bind="source: dataSource"></div>
						
					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wPayment-detail-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>#=kendo.toString(new Date(payment_date), "dd-MM-yyyy")#</td>
		<td>#=employee#</td>
		<td>#=contact[0].wnumber#</td>
		<td>
			#if(contact[0].contact_type_id==6 || contact[0].contact_type_id==7 || contact[0].contact_type_id==8){#
				#=contact[0].company#
			#}else{#
				#=contact[0].surname# #=contact[0].name# 
			#}#
		</td>		
		<td>#=invoice#</td>		
		<td class="right">#=kendo.toString(amount, "c0", banhji.eDashBoard.locale)#</td>										
    </tr>   
</script>

<script id="wPaymentBySourceSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					
		            <div class="box-generic hidden-print">
		            	<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

		            	<input data-role="dropdownlist"                   
		                   data-value-primitive="true"
		                   data-text-field="text"
		                   data-value-field="value"
		                   data-bind="value: sorter,
		                              source: sortList,                              
		                              events: { change: sorterChanges }" />
		                                           
	                    <input data-role="datepicker"	                       
	                       data-format="dd-MM-yyyy"
	                       data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: sdate"
		                   placeholder="ចាប់ពីថ្ងៃទី" />
	                    
	                   	<input data-role="datepicker"
	                       data-format="dd-MM-yyyy"
	                       data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: edate"
		                   placeholder="ដល់ថ្ងៃទី" />	                    	            	
		          		
		          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
		          		|
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
		            </div>

		            <br><br>

		            <div align="center">
						<h3>របាយការណ៍ទទួលប្រាក់តាមប្រភពសង្ខេប</h3>
						
						<span data-bind="text: strDate"></span>														
					</div>

					<br>			        
			        
			        <div id="grid"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="wPaymentBySourceDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					
		            <div class="box-generic hidden-print">
		            	<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

						<table>
							<tr>
								<td>
					            	<input data-role="dropdownlist"                   
					                   data-value-primitive="true"
					                   data-text-field="text"
					                   data-value-field="value"
					                   data-bind="value: sorter,
					                              source: sortList,                              
					                              events: { change: sorterChanges }" />
					                                           
				                    <input data-role="datepicker"	                       
				                       data-format="dd-MM-yyyy"
				                       data-parse-formats="yyyy-MM-dd"
					                   data-bind="value: sdate"
					                   placeholder="ចាប់ពីថ្ងៃទី" />
				                    
				                   	<input data-role="datepicker"
				                       data-format="dd-MM-yyyy"
				                       data-parse-formats="yyyy-MM-dd"
					                   data-bind="value: edate"
					                   placeholder="ដល់ថ្ងៃទី" />

					                <input data-role="dropdownlist"
									   data-option-label="(--- រើស អាជ្ញាប័ណ្ណ ---)"
					                   data-auto-bind="false"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: branch_id,
					                              source: branchDS,			                              
					                              events: {
					                                change: branchChanges
					                              }"/>
					            </td>
					            <td>
					            	<select data-role="multiselect"
							           data-placeholder="តំបន់..."
							           data-value-primitive="true"
							           data-text-field="name"
							           data-value-field="id"
							           data-bind="value: selectedLocations,
							                      source: locationDS,
							                      enabled: isBranchSelected"
							           style="width: 200px;" 
							    	></select>
					            </td>	                    	            	
					          	<td>	
					          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
					          		|
									<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
								</td>
							</tr>
						</table>						          		
		            </div>

		            <br><br>

		            <div align="center">
						<h3>របាយការណ៍ទទួលប្រាក់តាមប្រភពលំអិត</h3>
						
						<span data-bind="text: strDate"></span>														
					</div>

					<br>			        
			        
			        <div id="grid"></div>

			        <div data-role="pager" 
					    	data-auto-bind="false"
					    	data-page-sizes='[50, 100, 200, "All"]'					    	
				            data-bind="source: dataSource"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>


<!-- ***************************
 *	Menu Section         	  *
**************************** -->
<script id="vendorMenu" type="text/x-kendo-template">
	<ul class="topnav">
	  	<li><a href='#/vendors' class='glyphicons home'><i></i></a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.vendor"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				
  				<li><a href='#/vendor_center'>Vendor Center</a></li>
  				<li><a href='#/vendor'>New Vendor</a></li>  				  				
  			</ul>
	  	</li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.activities"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				
  				<li><a href='#/po'>Purchase Order</a></li>
  				<li><a href='#/vendor_deposit'>Deposit</a></li>
  				<li><a href='#/grn'>GRN</a></li> 
  				<li><a href='#/purchase'>Purchase</a></li>  				 				
  				<li><a href='#/expense'>Expense</a></li>
  				<li><a href='#/debit_note'>Debit Note</a></li>  				
  				<li><a href='#/cash_payment'>Pay Bill</a></li>				  				 				
  			</ul>
	  	</li>	  	  	
	  	<li><a href='#/vendor_report_center'><span data-bind="text: lang.reports"></span></a></li>	  	
	  	<li><a href='#/vendor_setting' class='glyphicons settings'><i></i></a></li>
	</ul>
</script>
<script id="customerMenu" type="text/x-kendo-template">
	<ul class="topnav">
	  	<li><a href='#/customers' class='glyphicons home'><i></i></a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.customer"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				
  				<li><a href='#/customers'><span data-bind="text: lang.customer_center"></span></a></li>
  				<li><a href='#/customer'><span data-bind="text: lang.new_customer"></span></a></li>  				  				
  			</ul>
	  	</li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.activities"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				
  				<li><a href='#/estimate'><span data-bind="text: lang.estimate"></span></a></li>
  				<li><a href='#/so'><span data-bind="text: lang.so"></span></a></li>
  				<li><a href='#/gdn'><span data-bind="text: lang.gdn"></span></a></li>  				
  				<li><a href='#/invoice'><span data-bind="text: lang.invoice"></span></a></li>
  				<li><a href='#/receipt'><span data-bind="text: lang.receipt"></span></a></li> 				  				 				
  			</ul>
	  	</li>
	  	<li>
	  		<a href="#/customerInvoiceSent">Invoice Sent To</a>
	  	</li>	  	
	  	<li><a href='#/customer_report_center'><span data-bind="text: lang.reports"></span></a></li>	  	
	  	<li><a href='#/customer_setting' class='glyphicons settings'><i></i></a></li>
	</ul>
</script>
<script id="waterMenu" type="text/x-kendo-template">
	<ul class="topnav">
	  	<li><a href='#/water' class='glyphicons home'><i></i></a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.customer"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				
  				<li><a href='#/wCustomer_center'><span data-bind="text: lang.lang.customer_center"></span></a></li>
  				<li><a href='#/wNew_customer'><span data-bind="text: lang.lang.new_customer"></span></a></li>
  				<li><a href='#/wCustomer_order'><span data-bind="text: lang.lang.reorder_customer"></span></a></li>  				
  			</ul>
	  	</li>	  	
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.reading"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'> 
  				<li><a href='#/wReading'><span data-bind="text: lang.lang.take_reading"></span></a></li>
  				<li><a href='#/wIR_reader'><span data-bind="text: lang.lang.ir_reader"></span></a></li>  				
  				<li><a href='#/wReading_book'><span data-bind="text: lang.lang.reading_book"></span></a></li>
  				<li><a href='#/wReading_center'><span data-bind="text: lang.lang.edit_reading"></span></a></li>  				 
  			</ul>
	  	</li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.invoice"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'> 
  				<li><a href='#/wInvoice'><span data-bind="text: lang.lang.invoice"></span></a></li>
  				<li><a href='#/wPrint_center'><span data-bind="text: lang.lang.print"></span></a></li>  				  								 
  			</ul>
	  	</li>	  	
	  	<li><a href='#/cashier'><span data-bind="text: lang.lang.cashier"></span></a></li>	  	
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.inventory"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				
  				<li><a href='#/wInventory_item'><span data-bind="text: lang.lang.inventory_center"></span></a></li>
  				<li><a href='#/item'><span data-bind="text: lang.lang.new_item"></span></a></li>
  				<li><a href='#/item_catalog'><span data-bind="text: lang.lang.new_catalog"></span></a></li>
  				<li><a href='#/item_assembly'><span data-bind="text: lang.lang.new_assembly"></span></a></li>  				 				 				
  			</ul>
	  	</li>
	  	<li><a href='#/wReport_center'><span data-bind="text: lang.lang.report"></span></a></li>	  	
	  	<li><a href='#/wSettings' class='glyphicons settings'><i></i></a></li>
	</ul>
</script>
<script id="inventoryMenu" type="text/x-kendo-template">
	<ul class="topnav">
	  	<li><a href='#/inventories' class='glyphicons home'><i></i></a></li>
	  	<li><a href='#/item_center'><span data-bind="text: lang.lang.inventory"></span></a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.activities"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>
  				<li><a href='#/item'><span data-bind="text: lang.lang.new_item"></span></a></li>
  				<li><a href='#/item_catalog'><span data-bind="text: lang.lang.new_catalog"></span></a></li>
  				<li><a href='#/item_assembly'><span data-bind="text: lang.lang.new_assembly"></span></a></li>
  				<li><a href='#/item_adjustment'>Item Adjustment</a></li>  								 				
  			</ul>
	  	</li>	  	
	  	<li><a href='#/item_report_center'><span data-bind="text: lang.lang.report"></span></a></li>
	  	<li><a href='#/item_setting' class='glyphicons settings'><i></i></a></li>			
	</ul>
</script>
<!-- END OF DAWINE ==================================================================================================== -->

<!-- mockup portal -->
<script id="vendorReceiveBill" type="text/x-kendo-template">
	<button data-bind="click: close" class="btn btn-primary pull-right">X</button>
	<table class="table table-striped table-primary">
		<thead>
			<tr>
				<th>Type</th>
				<th>Vendor</th>
				<th>Invoice</th>
				<th>Amount</th>
				<th>Action</th>
			</tr>
		</thead>
		<tbody data-role="listview" data-bind="source: dataStore" data-template="vendorRecieveBill-list"></tbody>
	</table>
	<div data-role="notification" id="notification" 
			 data-width="250px" 
			 data-position="{top: 25, right: 10}"></div>
</script>
<script id="vendorRecieveBill-list" type="text/x-kendo-template">
	<tr data-bind="invisible: status">
		<td>#=type#</td>
		<td>#=sentFrom.name#</td>
		<td>#=invoice_number#</td>
		<td>
			# var amount = 0; #
			#for(var i = 0; i < data.length; i++) {#
				# amount += data[i].amount; #
			#}#
			#=amount#
		</td>
		<td><buttion data-bind="click: receive" class="btn btn-primary">Receive</buttion></td>
	</tr>
</script>
<script id="customerInvoiceSent" type="text/x-kendo-template">
	<button data-bind="click: close" class="btn btn-primary pull-right">X</button>
	<table class="table table-striped table-primary">
		<thead>
			<tr>
				<th>Type</th>
				<th>Customer</th>
				<th>Invoice</th>
				<th>Amount</th>
			</tr>
		</thead>
		<tbody data-role="listview" data-bind="source: dataStore" data-template="customerInvoiceSent-list"></tbody>
	</table>
</script>
<script id="customerInvoiceSent-list" type="text/x-kendo-template">
	<tr data-bind="invisible: status">
		<td>#=type#</td>
		<td>#=sentTo.name#</td>
		<td>#=invoice_number#</td>
		<td>
			# var amount = 0; #
			#for(var i = 0; i < data.length; i++) {#
				# amount += data[i].amount; #
			#}#
			#=amount#
		</td>
	</tr>
</script>

<script src="<?php echo base_url(); ?>resources/js/libs/localforage.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.js"></script>
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>	
	var banhji = banhji || {};
	var baseUrl = "<?php echo base_url(); ?>"+'api/';
	banhji.token = null;
	banhji.pageLoaded = {};		
	localforage.config({
		driver: localforage.LOCALSTORAGE,
		name: 'userData'
	});
	var langVM = kendo.observable({
		lang 		: null,		
		localeCode 	: null,		
		changeToEn 	: function() {
			localforage.setItem("lang", "EN").then(function(value){
				location.reload(false);
			});
		},
		changeToKh 	: function() {
			localforage.setItem("lang", "KH").then(function(value){
				location.reload(false);
			});
		}
	});
	var dataStore = function(url) {
		var o = new kendo.data.DataSource({
				transport: {
					read 	: {
						url: url,
						type: "GET",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					create 	: {
						url: url,
						type: "POST",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					update 	: {
						url: url,
						type: "PUT",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					destroy : {
						url: url,
						type: "DELETE",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					parameterMap: function(options, operation) {
						if(operation === 'read') {
							return {
								limit: options.take,
								page: options.page,
								filter: options.filter,
								sort: options.sort
							};
						} else {
							return {models: kendo.stringify(options.models)};
						}
					}
				},
				schema 	: {
					model: {
						id: 'id'
					},
					data: 'results',
					total: 'count'
				},
				batch: true,
				serverFiltering: true,
				serverSorting: true,
				serverPaging: true,
				pageSize: 100
			});
		return o;
	};	
	banhji.userManagement = kendo.observable({
		lang : langVM,		
		auth : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'authentication',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'authentication',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'authentication',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'authentication',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),		
		inst 	 : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'banhji/company',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'banhji/company',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'banhji/company',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'banhji/company',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		industry : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'banhji/industry',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		countries: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'banhji/countries',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		provinces: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'banhji/provinces',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		types 	 : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'banhji/types',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		instMod 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'admin/modules_institute',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'admin/modules_institute',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'admin/modules_institute',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'admin/modules_institute',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			filter: {field: 'id', value: 1}
			// pageSize: 100
		}),
		onSuccessUpload: function(e){
			var logo = e.response.results.url;
			this.get('newInst').set('logo', logo);
			this.saveIntitute();
			// console.log(logo);
		},	 
		close 		: function() {
			window.history.back(-1);
			if(this.inst.hasChanges()) {
				this.inst.cancelChanges();
			}
			if(this.auth.hasChanges()) {
				this.auth.cancelChanges();
			}
		},
		taxRegimes: [
			{ code: 'small', type: 'ខ្នាតតូច'},
			{ code: 'medium', type: 'ខ្នាតមធ្យម'},
			{ code: 'large', type: 'ខ្នាតធំ'}
		],
		currency : [
			{ code: 'KHR', locale: 'km-KH'},
			{ code: 'USD', locale: 'us-US'},
			{ code: 'VND', locale: 'vn-VN'}
		],
		username : null,
		password : null,
		_password: null,
		pwdDS 	 : new kendo.data.DataSource({
			transport: {
				create 	: {
					url: baseUrl + 'banhji/password',
					type: "POST",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		validateEmail: function() {
			var sQtext = '[^\\x0d\\x22\\x5c\\x80-\\xff]';
		  	var sDtext = '[^\\x0d\\x5b-\\x5d\\x80-\\xff]';
		  	var sAtom = '[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+';
		  	var sQuotedPair = '\\x5c[\\x00-\\x7f]';
		  	var sDomainLiteral = '\\x5b(' + sDtext + '|' + sQuotedPair + ')*\\x5d';
		  	var sQuotedString = '\\x22(' + sQtext + '|' + sQuotedPair + ')*\\x22';
		  	var sDomain_ref = sAtom;
		  	var sSubDomain = '(' + sDomain_ref + '|' + sDomainLiteral + ')';
		  	var sWord = '(' + sAtom + '|' + sQuotedString + ')';
		  	var sDomain = sSubDomain + '(\\x2e' + sSubDomain + ')*';
		  	var sLocalPart = sWord + '(\\x2e' + sWord + ')*';
		  	var sAddrSpec = sLocalPart + '\\x40' + sDomain; // complete RFC822 email address spec
		  	var sValidEmail = '^' + sAddrSpec + '$'; // as whole string

		  	var reValidEmail = new RegExp(sValidEmail);

		  	if(!reValidEmail.test(this.get('username'))){
		  		alert("Please enter valid address");
				this.set('passed', false);
		  	}
		  	this.set('passed', false);
		},
		loginBtn : function() {
			banhji.view.layout.showIn('#content', banhji.view.loginView);
		},
		login  	 : function() {
			this.auth.query({
				filter: [
					{field: 'username', value: banhji.userManagement.get('username')},
					{field: 'password', value: banhji.userManagement.get('password')}
				]
			}).done(function(e){
				var data = banhji.userManagement.auth.data();
				if(data.length > 0) {
					var user = banhji.userManagement.auth.data()[0];
					localforage.setItem('user', user);
					if(user.institute.length === 0) {
						banhji.router.navigate('/no-page');
					} else {
						banhji.router.navigate('/');
					}
				} else {
					console.log('bad');
				}
			});
		},
		registerBtn: function() {
			banhji.view.layout.showIn('#content', banhji.view.signupView);	
		},
		logout 		: function() {
			localforage.removeItem('user', function(err){
				window.location.assign("<?php echo base_url(); ?>home");
			});
		},
		setCurrent : function(current) {
			this.set('current', current);
		},
		changePwd  : function() {
			if(this.get('password') !== this.get('_password')) {
				alert("Password does not match");
			} else {
				this.pwdDS.sync();
			}
		},
		getLogin 	: function() {
			return JSON.parse(localStorage.getItem('userData/user'));
		},
		page 	 : function() {
			if(banhji.userManagement.getLogin()) {
				if(banhji.userManagement.getLogin().perm === 1) {
					return 'admin';
				}
			} else {
				return 'home';
			}
			// if(this.getLogin()) {
			// 	return '\#/page';
			// } else {
			// 	return '\#/page/';
			// }
			
		},
		createComp : function() {
			banhji.router.navigate('/create_company');
		},
		setInstitute: function(newIns) {
			this.set('newInst', newIns);
		},
		addInst    : function() {
			this.inst.insert(0, {
				name: "",
				email: "",
				address: "",
				description: "",
				industry: {id: null, name: null},
				type: {id: null, name: null},
				country: {id: null, code: null, name: null},
				province: {id: null, local: null, english: null},
				vat_no: null,
				fiscal_date: null,
				tax_regime: null,
				locale : null,
				legal_name: null,
				date_founded: null,
				logo: ""
			});
			this.setInstitute(this.inst.at(0));
		},
		cancelInst : function() {
			this.inst.cancelChanges();
		},
		saveIntitute: function() {
			if(this.get('newInst').industry.id !== null || this.get('newInst').province.id || this.get('newInst').country.id) {
				this.inst.sync();
				this.inst.bind('requestEnd', function(e){
					var type = e.type, res = e.response.results;
					if(e.response.error === false) {
						if(e.type === 'create') {
							$('#createComMessage').text("created. Please wait till site admin created database for you.");
						} else {
							localforage.removeItem('company', function(err){
								//
							});
							localforage.setItem('company', res);
							$('#createComMessage').text("Updated");
						}
					} else {
						$('#createComMessage').text("error creating company.");
					}
				});
			} else {
				alert('filling all fields');
			}
		},
		signup 	   : function() {
			this.auth.add({username: this.get('username'), password: this.get('password')});
			this.sync();
			this.auth.bind('requestEnd', function(e){
				if(e.type === 'create' && e.response.error === false) {
					alert("អ្នកបានចុះឈ្មោះរួច");
					banhji.router.route('')
				}
			});
		},
		onFileSelect: function(e) {
			console.log(e.files[0]);
		},
		sync: function() {
			this.auth.sync();
			this.auth.bind('requestEnd', function(e){
				var type = e.type;
				var result = e.response.results;
				if(type === "read" && e.error !== true) {
					// get login info
					console.log('true');
				} else if(type === "create") {
					if(e.response.error === true) {
						banhji.userManagement.auth.cancelChanges();
						alert('មានរួចហើយ');
					} else {
						var user = banhji.userManagement.auth.data()[0];
						localforage.setItem('user', user);
						if(!user.institute) {
							banhji.router.navigate('/page', false);
						} else {
							banhji.router.navigate('/app', false);
						}
					}
				}
			});
		}
	});
	banhji.institute = banhji.userManagement.getLogin()!==null?banhji.userManagement.getLogin().institute[0]:"";
	function getDB() {
		var entity = null;
		if(banhji.userManagement.getLogin()) {
			if(banhji.userManagement.getLogin().institute) {
				if(banhji.userManagement.getLogin().institute.length > 0) {
					entity = banhji.userManagement.getLogin().institute[0].name
				}
				
			} else {
				entity = false
			}
		}		
		return entity;
	}
	banhji.currency = kendo.observable({
		dataSource: dataStore(baseUrl + 'currencies'),
		getEnabled: function() {
			this.dataSource.filter({field: "enabled", operator: '', value: 'true'});
		},
		getAmount : function(currency) {
			var amount = 0;
			for(var i =0; i < this.dataSource.data().length; i++) {
				if(currency === this.dataSource.data()[i].locale) {
					amount = kendo.parseFloat(this.dataSource.data()[i].rate);
					break;
				}
			}
			return amount;
		},
		addNew 	  : function() {
			banhji.currency.dataSource.add({code: '', rate: 0.0, country: '', locale: '', update_method: 'manual', updated_at: null});
			var len = banhji.currency.dataSource.data().length;
			banhji.currency.setCurrent(banhji.currency.dataSource.at(len-1));
			banhji.currency.set('formVisible', true);
		},
		edit 	  : function(e) {
			e.data.set("update_method", 'manual');
			banhji.currency.setCurrent(e.data);
			banhji.currency.set('formVisible', true);	
		},
		del 	  : function(e) {},
		update 	  : function(e) {},
		cancel 	  : function() {
			banhji.currency.set('formVisible', false);
			if(banhji.currency.dataSource.hasChanges()) {
				banhji.currency.dataSource.cancelChanges();
			}
		},
		getRate   : function(from, to) {
			return from/to;
		},
		setCurrent : function(current) {
			this.set('current', current);
		},
		formVisible: false,
		saveClose	: function() {
			banhji.currency.dataSource.sync();
			banhji.currency.dataSource.bind('requestEnd', function(e){
				banhji.currency.set('formVisible', false);
			});
		},
		save: function() {}
	});
	banhji.users = kendo.observable({
		dataStore	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'banhji/users',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'banhji/users',
					type: "POST",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'banhji/users',
					type: "PUT",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'banhji/users',
					type: "DELETE",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		roleDS 		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'banhji/roles',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		add 		: function() {
			banhji.view.pageAdmin.showIn('#col2', banhji.view.addUserView);
			this.dataStore.insert(0, {username: '', password: null, permission: {id: null, name: null}});
			this.setCurrent(this.dataStore.at(0));
		},
		remove 		: function(e) {
			var user = confirm('Are you sure you want to remove this user?');
			if(user === true) {
				this.dataStore.remove(e.data);
				this.sync();
			}
		},
		editRight 	: function(e) {
			banhji.view.pageAdmin.showIn('#col2', banhji.view.editRoleView);
			this.setCurrent(e.data);
		},
		cancelAdd 	: function() {
			banhji.view.pageAdmin.showIn('#col2', banhji.view.userListView);
			this.dataStore.cancelChanges();
		},
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		sync 		: function() {
			this.dataStore.sync();
			this.dataStore.bind('requestEnd', function(e){
				var type = e.type;
				var data = e.response.results;
				if(type !== 'read') {
					console.log('data recorded');
				}
			});
		}
	});
	banhji.people = kendo.observable({
		dataSource : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "people",
					type: "GET",
					headers: {
						"Entity": banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institute[0].name:""
					},
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + "people",
					type: "POST",
					headers: {
						"Entity": banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institute[0].name:""
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + "people",
					type: "PUT",
					headers: {
						"Entity": banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institute[0].name:""
					},
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + "people",
					type: "DELETE",
					headers: {
						"Entity": banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institute[0].name:""
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							offset: options.skip,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count',
				errors: 'error'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 20
		}),
		filterBy   : function() {},
		save 	   : function() {}
	});
	// end TEst offline
	var obj = function(url) {
		var o = kendo.observable({
			dataStore: new kendo.data.DataSource({
				transport: {
					read 	: {
						url: url,
						type: "GET",
						headers: {
							"Entity": getDB()
						},
						dataType: 'json'
					},
					create 	: {
						url: url,
						type: "POST",
						headers: {
							"Entity": getDB()
						},
						dataType: 'json'
					},
					update 	: {
						url: url,
						type: "PUT",
						headers: {
							"Entity": getDB()
						},
						dataType: 'json'
					},
					destroy : {
						url: url,
						type: "DELETE",
						headers: {
							"Entity": getDB()
						},
						dataType: 'json'
					},
					parameterMap: function(options, operation) {
						if(operation === 'read') {
							return {
								limit: options.take,
								offset: options.skip,
								filter: options.filter
							};
						} else {
							return {models: kendo.stringify(options.models)};
						}
					}
				},
				schema 	: {
					model: {
						id: 'id'
					},
					data: 'results',
					total: 'count',
					errors: 'error'
				},
				batch: true,
				serverFiltering: true,
				serverPaging: true,
				pageSize: 20
			}),
			findById: function(id) {},
			findBy 	: function(arr) {},
			insert 	: function(data) {},
			remove 	: function(model) {
				this.dataStore.remove(model);
				this.save();
			},
			save 	: function() {
				this.dataStore.sync();
				this.dataStore.bind('requestEnd', function(e){
					var type = e.type, res = e.response.results;
					console.log(type + " operation is successful.");
				});
			}
		});
		return o;
	}
	banhji.payment_option = kendo.observable({
		data : [
			{type: "cash", description: "សាច់ប្រាក់សុទ្ធ", selected: false},
			{type: "bank", description: "តាមធនាគារ", selected: false},
			{type: "check", description: "ចេញជាសែក", selected: false}
		]
	});
	banhji.Layout = kendo.observable({
		locale: "km-KH",
		menu 	: [],
		// isShown : true,
		// isAdmin : auth.isAdmin(),
		// logout 	: function(e) {
		// 	e.preventDefault();
		// 	auth.logout();
		// },
		// isLogin : function(){
		// 	if(banhji.userManagement.getLogin()) {
		// 		return true;
		// 	} else {
		// 		return false;
		// 	}
		// },
		// init: function() {
		// 	// initialize when the whole page load
		// },
		// ui: function() {
		// 	// get UI information from source base on locale
		// }
	});
	banhji.company= kendo.observable({
		dataStore: dataStore(baseUrl + 'companies'),
		apDS 	 : [],
		arDS 	 : [],
		cashDS 	 : [],
		currency : banhji.currency.dataSource,
		accountDS: dataStore(baseUrl + 'accounts'),
		closed 	 : function() {
			this.dataStore.cancelChanges();
			window.history.back(-1);
		},
		findById : function(id) {
			if(this.dataStore.data().length > 0) {
				this.setCurrent(this.dataStore.get(id));
			} else {
				this.dataStore.query({
					filter: {field: 'id', operator: '', value: id}
				}).done(function(e){
					var data = banhji.company.dataStore.data()[0];
					banhji.company.setCurrent(data);
				});
			}
		},
		init 	 : function() {
			var that = this;
			if(this.get('apDS').length === 0 || this.get('arDS').length === 0 || this.get('cashDS').length === 0) {
				this.accountDS.fetch(function(e){
					var data = that.accountDS.data();
					$.each(data, function(index, value){
						if(value.type.id === 6) {
							that.cashDS.push(value);
						} else if(value.type.id === 11) {
							that.apDS.push(value);
						} else if(value.type.id === 7) {
							that.arDS.push(value);
						}
					});
				});
			}		
		},
		info 	 : function() {},
		edit 	 : function() {},
		setCurrent:function(current) {
			this.set('current', current);
		},
		add 	 : function() {
			this.dataStore.insert(0,{
				name: null,
				logo: null,
				legal_name: null,
				currency: {id: null, code: null},
				email: null,
				phone: null,
				address: null,
				year_founded: null,
				vat_no: null,
				ap_account: null,
				ar_account: null,
				cash_account: null,
				image: null,
				operation_license: null,
				main: 'false'
			});
			var data = this.dataStore.at(0)
			
			console.log(data);
			banhji.router.navigate('/admin/company/new');
			banhji.company.set('current', data);
		},
		cancel 	 : function() {
			this.dataStore.cancelChanges();
			banhji.router.navigate('/admin/company-settings');
		},
		save 	 : function() {
			this.dataStore.sync();
		}
	});
	banhji.bank = kendo.observable({
		ds 			: dataStore(baseUrl + "banks"),
		find 		: function(arg) {
			var c = typeof arg;
			if(c === 'object') {
				this.ds.filter(arg);
			} else if(c === 'string') {
				this.ds.filter(
					{field: 'name', operator: 'like', value: arg}
				);
			} else if(c === 'number') {
				this.ds.filter(
					{field: 'id', operator: '', value: arg}
				);
			} else {
				console.log('no field provided for search!');
			}
		},
		getAll 		: function() {
			this.ds.filter(
				{field: 'deleted', operator: '', value: 'false'}
			);
		},
		getAllDelete: function() {
			this.ds.query([
				{field: 'deleted', operator: '', value: 'false'},
				{field: 'deleted', operator: 'or', value: 'true'}
			]);
		},
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		add 		: function(data) {
			this.ds.add(data);
		},
		insert 		: function(index, data) {
			this.ds.insert(index, data);
		},
		remove 		: function(data) {
			this.ds.remove(data);
		},
		save 		: function() {
			var that = this,
				dfd  = $.Deferred();
			this.ds.sync();
			this.ds.bind('requestEnd', function(e) {
				var type = e.type;
				if(type === 'create') {
					dfd.resolve(e.response.results);
				} else if(type==="update") {
					dfd.resolve(e.response.results);
				} else if(type== 'destroy') {
					dfd.resolve(e.response.results);
				} else {
					dfd.reject({error:'not know issue'});
				}
			});
			return dfd.promise();
		}
	});
	banhji.my = kendo.observable({
		dataStore: dataStore(baseUrl + 'users'),
		findMyInfo: function() {},
		changePWD: function(){},
		addInfo  : function(){},
		addEmail : function(){},
		addPhone : function(){},
		delPhone : function(){},
		delEmail : function(){},
		save 	 : function(){
			this.dataStore.sync();
		}
	});
	var user = kendo.observable({
		data: null,
		password: "",
		confirmedPWD: "",
		pass: false,
		dataStore: new kendo.data.DataSource({
			transport: {
				create: {
					url: baseUrl + "users",
					headers: {
						"Entity": getDB()
					},
					type: "POST",
					dataType: "json"
				},
				read: {
					url: baseUrl + "users",
					headers: {
						"Entity": getDB()
					},
					type: "GET",
					dataType: "json"
				},
				update: {
					url: baseUrl + "users",
					headers: {
						"Entity": getDB()
					},
					type: "PUT",
					dataType: "json"
				},
				destroy: {
					url: baseUrl + "users",
					headers: {
						"Entity": getDB()
					},
					type: "DELETE",
					dataType: "json"
				},
				parameterMap: function(data, operation) {
					if(operation === 'read') {
						return {
							limit: data.take,
							offset: data.skip,
							filter: data.filter
						};
					}
					return {models: kendo.stringify(data.models)};
				}
			},
			schema: {
	        	model: {
	        		id: "id"
	        	},
	        	data: "results"
	        },
			pageSize: 20,
			serverPaging: true,
			serverFiltering: true,
			filter: [
				{field: 'status', value: true }
			],
			batch: true
		}),
		userRoleDS: new kendo.data.DataSource({
			transport: {
				create: {
					url: baseUrl + "users/roles",
					headers: {
						"Entity": getDB()
					},
					type: "POST",
					dataType: "json"
				},
				read: {
					url: baseUrl + "users/roles",
					headers: {
						"Entity": getDB()
					},
					type: "GET",
					dataType: "json"
				},
				update: {
					url: baseUrl + "users/roles",
					headers: {
						"Entity": getDB()
					},
					type: "PUT",
					dataType: "json"
				},
				destroy: {
					url: baseUrl + "users/roles",
					headers: {
						"Entity": getDB()
					},
					type: "DELETE",
					dataType: "json"
				},
				parameterMap: function(data, operation) {
					if(operation === 'read') {
						return {
							limit: data.take,
							offset: data.skip,
							filter: data.filter
						};
					}
					return {models: kendo.stringify(data.models)};
				}
			},
			schema: {
	        	model: {
	        		id: "id"
	        	},
	        	data: "results"
	        },
			pageSize: 20,
			serverPaging: true,
			serverFiltering: true,
			batch: true
		}),
		setCurrent: function(current) {
			this.set('current', current);
		},
		validatePWD	: function() {
			if(this.get('password').length < 7) {
				alert("password must be atleast 7-character long");
				this.set('passed', false);
			} else {
				this.set('passed', true);
			}
		},
		passwordMatch: function() {
			if(this.get('password') !== this.get('confirmedPWD')) {
				console.log("password do not match.");
			} else {
				console.log("Good to go.");
			}
		},
		validateEmail: function() {
			var sQtext = '[^\\x0d\\x22\\x5c\\x80-\\xff]';
		  	var sDtext = '[^\\x0d\\x5b-\\x5d\\x80-\\xff]';
		  	var sAtom = '[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+';
		  	var sQuotedPair = '\\x5c[\\x00-\\x7f]';
		  	var sDomainLiteral = '\\x5b(' + sDtext + '|' + sQuotedPair + ')*\\x5d';
		  	var sQuotedString = '\\x22(' + sQtext + '|' + sQuotedPair + ')*\\x22';
		  	var sDomain_ref = sAtom;
		  	var sSubDomain = '(' + sDomain_ref + '|' + sDomainLiteral + ')';
		  	var sWord = '(' + sAtom + '|' + sQuotedString + ')';
		  	var sDomain = sSubDomain + '(\\x2e' + sSubDomain + ')*';
		  	var sLocalPart = sWord + '(\\x2e' + sWord + ')*';
		  	var sAddrSpec = sLocalPart + '\\x40' + sDomain; // complete RFC822 email address spec
		  	var sValidEmail = '^' + sAddrSpec + '$'; // as whole string

		  	var reValidEmail = new RegExp(sValidEmail);

		  	if(!reValidEmail.test(this.get('current').email)){
		  		alert("Please enter valid address");
				this.set('passed', false);
		  	}
		  	this.set('passed', false);
		},
		savePassword : function() {
			if(this.get('password') === this.get('confirmedPWD') && this.get('password').length > 6) {
				this.get('current').set('password', this.get('password'));
				this.save();
			} else {
				alert("សូមពិនិត្យឡើងវិញ");
			}
		},
		save: function() {	
			this.dataStore.sync();
			this.dataStore.bind('requestEnd', function(e){
				var type = e.type;
				var res  = e.response.results;
				if(type !== 'read') {
					alert('កត់ត្រាបានសំរេច');
				}	
			});	
		}
	});
	banhji.entity = kendo.observable({
		dataStore 	: '',
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		save 		: function() {
			this.dataStore.sync();
		}
	});
	banhji.segment = kendo.observable({
		dataStore: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "segments",
					type: "GET",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + "segments",
					type: "POST",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + "segments",
					type: "PUT",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + "segments",
					type: "DELETE",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							offset: options.skip,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count',
				errors: 'error'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 20
		}),
		setCurrent	: function(current) {
			this.set('current', current);
		},
		close 		: function() {
			this.dataStore.cancelChanges();
			window.history.back(-1);
		},
		addItems : function() {},
		addNew 	 : function() {},
		find 	 : function() {
			//find segment and its items
		},
		save 	 : function() {
			this.dataStore.sync();
			this.dataStore.bind('requestEnd', function(e){
				var res = e.response;
				if(res.error) {
					alert(res.error);
				} else if(e.type !== 'read'){
					alert("Data successfully recorded.");
				}
			});
		}
	});
	banhji.segmentItem = kendo.observable({
		ds 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'segments/items',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'segments/items',
					type: "POST",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'segments/items',
					type: "PUT",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'segments/items',
					type: "DELETE",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			group: { field: "segment.name"},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		segmentDS 	: banhji.segment.dataStore,
		editable 	: false,
		closedX 	: function() {
			window.history.back(-1);
		},
		sort 		: function(e) {
			var selected = e.sender.selectedIndex;
			var id = this.segmentDS.at(selected).id;
			this.bySegment(id);
		},
		bySegment 	: function(segment) {
			var type = typeof segment;

			return this.ds.query({
				filter: {field: 'segment_id', value: segment},
				page: this.ds.page(),
				take: this.ds.pageSize()
			});
		},
		edit 		: function(e){
			this.setCurrent(e.data);
			this.set('editable', false);
			banhji.view.mainView.showIn("#segment-list-container", banhji.view.actionView);
		},
		remove 		: function(e){
			this.ds.remove(e.data);
		},
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		add 		: function(){
			this.ds.insert(0, {
				segment: this.get('segment'),
				code: null,
				name: null
			});
			this.setCurrent(this.ds.at(0));
			this.set('editable', true);
			banhji.view.mainView.showIn("#segment-list-container", banhji.view.actionView);
		},
		segment 	: null,
		cancel 		: function() {
			banhji.view.mainView.showIn("#segment-list-container", banhji.view.listView);
			this.ds.cancelChanges();
		},
		save 		: function() {
			if(this.get('current').code.length > this.get('segment').code_length) {
				//
			} else {
				this.ds.sync();
				this.ds.bind('requestEnd', function(e){
					// if(e.response) {
						banhji.view.mainView.showIn("#segment-list-container", banhji.view.listView);
					// }
				});
			}
			
		}
	});
	banhji.structure = kendo.observable({
		close 		: function() {
			window.history.back(-1);
			if(this.dataStore.hasChanges()) {
				this.dataStore.cancelChanges();
			}
		},
		dataStore 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "structures",
					type: "GET",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + "structures",
					type: "POST",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + "structures",
					type: "PUT",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + "structures",
					type: "DELETE",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							offset: options.skip,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count',
				errors: 'error'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 20
		}),
		segments 	: banhji.segment,
		segSelected : function(e) {
			if($(e.target).text() === "រើសមួយ") {
				$(e.target).text('រើសរួច');
				banhji.structure.get('current').segments.push({id: e.data.id, code_length: e.data.code_length, name: e.data.name});
			} else {
				$(e.target).text('រើសមួយ');
				$.each(this.get('current').segments, function(i, v){
					if(v.id === e.data.id) {
						banhji.structure.get('current').segments.splice(i, 1);
						return false;
					}
				});
			}
			
			console.log(this.get('current').segments.length);
			
		},
		setCurrent	: function(current) {
			this.set('current', current);
		},
		find 	 	: function(arg) {
			this.dataStore.query({
				filter: arg
			}).then(function(e){
				banhji.structure.setCurrent(banhji.structure.dataStore.data()[0]);
			});
		},
		save 		: function() {
			this.dataStore.sync();
			this.dataStore.bind('requestEnd', function(e){
				if(e.type !== 'read') {
					console.log('operation type ' + e.type + ' done successfully.');
					console.log(e.response);
				}
			});
		}
	});
	var role = kendo.observable({
		dataStore 	: new kendo.data.DataSource({
			transport: {
				read: {
					url: baseUrl + 'roles',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				create: {
					url: baseUrl + 'roles',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				update: {
					url: baseUrl + 'roles',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				destroy: {
					url: baseUrl + 'roles',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				parameterMap: function(data, operation) {
					if(operation === 'read') {
						return {
							limit: data.take,
							offset: data.skip,
							filter: data.filter
						};
					}
					return {models: kendo.stringify(data.models)};
				}
			},
			schema: {
	        	model: {
	        		id: "id"
	        	},
	        	data: "results"
	        },
			pageSize: 20,
			serverPaging: true,
			serverFiltering: true,
			batch: true
		}),
		roleUserDs 	: new kendo.data.DataSource({
			transport: {
				read: {
					url: baseUrl + 'roles/user',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				create: {
					url: baseUrl + 'roles/user',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'POST'
				},
				update: {
					url: baseUrl + 'roles/user',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'PUT'
				},
				destroy: {
					url: baseUrl + 'roles/user',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'DELETE'
				},
				parameterMap: function(data, operation) {
					if(operation === 'read') {
						return {
							limit: data.take,
							offset: data.skip,
							filter: data.filter
						};
					}
					return {models: kendo.stringify(data.models)};
				}
			},
			schema: {
	        	model: {
	        		id: "id"
	        	},
	        	data: "results"
	        },
			pageSize: 20,
			serverPaging: true,
			serverFiltering: true,
			batch: true
		}),
		find 		: function(arg) {},
		setCurrent 	: function(currentRole) {},
		save 		: function() {}
	});
	banhji.index = kendo.observable({
		lang 	: langVM,
		salesData : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'sales',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		// customers : banhji.customer.dataSource,
		expenseDS : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'sales/expense',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		expense   : 0,
		customer  : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'sales/top',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		equation  : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'sales/equation',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					}
				}
			},
			schema 	: {
				data: 'results'
			}
		}),
		cash 	  : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'sales/cash',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					}
				}
			},
			schema 	: {
				data: 'results'
			}
		}),
		modules 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'admin/modules',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'admin/modules',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'admin/modules',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'admin/modules',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		companyInf: function() {
			var company = JSON.parse(localStorage.getItem('userData/user'));
			return company;
		},
		curDate   : function() {
			return Date();
		},
		getLogo   : function() {
			return "<?php echo base_url(); ?>" + this.companyInf().institute[0].logo;
		},
		cashBal   : 0,
		asset 	  : 0,
		liability : 0,
		equity 	  : 0,

		dataSource 			: dataStore(baseUrl + "invoices/home_dashboard"),

		selectedDate 		: new Date(),
		totalSale 			: 0,
		totalOpenInvoice 	: 0,
		totalUnbill 		: 0,
		totalCustomer 		: 0,
		totalOrder 			: 0,

		dateChanges			: function(){
			var self = this, selectedDate = this.get("selectedDate");

			if(selectedDate){
				var today = new Date(),
				searchDate = new Date(selectedDate),
				firstDayOfYear = new Date(today.getFullYear(), 0, 1);

				if(firstDayOfYear){
					this.dataSource.query({
						filter: [
							{ field:"issued_date", operatoin:">=", value:kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
							{ field:"issued_date", operatoin:"<=", value:kendo.toString(searchDate, "yyyy-MM-dd") }
						]
					}).then(function(){
						var view = self.dataSource.view();

						self.set("totalSale", kendo.toString(view[0].totalSale, "c", banhji.institute.locale));
						self.set("totalOpenInvoice", view[0].totalOpenInvoice);
						self.set("totalUnbill", view[0].totalUnbill);
						self.set("totalCustomer", view[0].totalCustomer);
						self.set("totalOrder", view[0].totalOrder);
					});
				}
			}
		} 		
	});
	/*********************
	* Accounting Section *
	**********************/
	banhji.account = kendo.observable({
		dataStore 	: dataStore(baseUrl + "accounts"),
		types 		: dataStore(baseUrl + 'accounts/types'),
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		addNew 		: function() {
			this.dataStore.insert(0, {
				type: null,
				parentAccount: null,
				code: null,
				name: null,
				name_en: null,
				description: null
			});
			this.setCurrent(this.dataStore.at(0));
		},
		save 		: function() {
			this.dataStore.sync();
		}
	});
	banhji.trialBalance = kendo.observable({
		dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounts/tb',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			change: function(e) {
				var data = this.data();
				var dr = 0.00;
				var cr = 0.00;
				for(var i = 0; i < data.length; i++) {
					if(data[i].dr !== '') {
						dr += kendo.parseFloat(data[i].dr);
					}
					if(data[i].cr !== '') {
						cr += kendo.parseFloat(data[i].cr);
					}
				}

				banhji.trialBalance.set('tbDebit', dr);
				banhji.trialBalance.set('tbCredit', cr);
			}
			// pageSize: 100
		}),
		tbDebit 			: 0.00,
		tbCredit 			: 0.00,
		dateFrom 			: new Date(),
		dateTo 				: new Date(),
		back 				: function() {
			window.history.back(-1);
		},
		searchDate 			: function() {
			banhji.trialBalance.dataSource.filter({
				field: 'created_at',
				value: kendo.toString(banhji.trialBalance.dateTo, 'yyyy-MM-dd')
			});
		}
	});
	banhji.recurring = kendo.observable({
		dataSource 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'recurrings',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'recurrings',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'recurrings',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'recurrings',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true
			// pageSize: 100
		}),
		recurringDS : [
			{id: 'daily', name: 'Daily'},
			{id: 'weekly', name: 'Weekly'},
			{id: 'monthly', name: 'Monthly'},
		],
		count 		: 0,
		getCount 	: function() {
			banhji.recurring.dataSource.fetch(function(){
				var data = banhji.recurring.dataSource.data();
				banhji.recurring.set('count', data.length);
			});
		},
		addNew 		: function() {
			banhji.recurring.dataSource.insert(0, {
				name 	: null,
				type 	: null,
				recurring_number: null,
				date 	: null,
				items 	: null
			});
			banhji.recurring.set("current", banhji.recurring.dataSource.at(0));
		},
		remove 		: function(e) {
			banhji.recurring.dataSource.remove(e.data);
		},
		cancel 		: function() {
			if(banhji.recurring.dataSource.hasChanges()) {
				banhji.recurring.set('current', null);
				banhji.recurring.dataSource.cancelChanges();
			}			
		},
		save 		: function() {
			var dfd = $.Deferred();
			banhji.recurring.dataSource.sync();
			banhji.recurring.dataSource.bind('requestEnd', function(e){
				if(e.response.error === false) {
					dfd.resolve({type: e.type, results: e.response.results, success: 'done'});
				} else {
					dfd.reject({type: e.type, results: e.response.results, error: 'operation failed'});
				}
			});
			return dfd.promise();
		}
	});
	banhji.balanceSheet = kendo.observable({
		assetDS 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounts/asset',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			change: function(e) {
				var data = this.data();
				var amount = 0.00;
				var currentAsset = 0.00;
				var inventory = 0.00;
				var receivable = 0.00;
				for(var i = 0; i < data.length; i++) {
					for(var x = 0; x < data[i].accounts.length; x++) {
						amount += kendo.parseFloat(data[i].accounts[x].amount);
					}
					if(data[i].id !==10) {
						for(var x = 0; x < data[i].accounts.length; x++) {
							currentAsset += kendo.parseFloat(data[i].accounts[x].amount);
						}
					}
					if(data[i].id ===8) {
						for(var x = 0; x < data[i].accounts.length; x++) {
							inventory += kendo.parseFloat(data[i].accounts[x].amount);
						}
					}
					if(data[i].id === 7) {
						if(data[i].accounts.length > 0) {
							for(var x = 0; x < data[i].accounts.length; x++) {
								receivable += kendo.parseFloat(data[i].accounts[x].amount);
							}
						} else {
							receivable = 0.00;
						}
							
					}

				}

				banhji.balanceSheet.set('totalAsset', amount);
				banhji.balanceSheet.set('xAssetAmt', currentAsset);
				banhji.balanceSheet.set('inventoryAmt', inventory);
				banhji.balanceSheet.set('receivableAmt', receivable);
			}
			// pageSize: 100
		}),
		liabilityDS : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounts/liability',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			change: function(e) {
				var data = this.data();
				var amount = 0.00;
				var currentLiability = 0.00;
				var payable = 0.00;
				for(var i = 0; i < data.length; i++) {
					for(var x = 0; x < data[i].accounts.length; x++) {
						amount += kendo.parseFloat(data[i].accounts[x].amount);
					}
					if(data[i].id !==16 && data[i].parent_id === 2) {
						for(var x = 0; x < data[i].accounts.length; x++) {
							currentLiablity += kendo.parseFloat(data[i].accounts[x].amount);
						}
					}
					if(data[i].id === 13) {
						for(var x = 0; x < data[i].accounts.length; x++) {
							payable += kendo.parseFloat(data[i].accounts[x].amount);
						}
					}
				}

				banhji.balanceSheet.set('totalLiabEq', amount);
				banhji.balanceSheet.set('xLiabilityAmt', currentLiability);
				banhji.balanceSheet.set('payableAmt', payable);
			}
			// pageSize: 100
		}),
		equityDS 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounts/equity',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			change: function(e) {
				var data = this.data();
				var dr = 0.00;
				var cr = 0.00;
				for(var i = 0; i < data.length; i++) {
					if(data[i].dr !== '') {
						dr += kendo.parseFloat(data[i].dr);
					}
					if(data[i].cr !== '') {
						cr += kendo.parseFloat(data[i].cr);
					}
				}

				banhji.trialBalance.set('tbDebit', dr);
				banhji.trialBalance.set('tbCredit', cr);
			}
			// pageSize: 100
		}),
		toDate 		: new Date(),
		back 				: function() {
			window.history.back(-1);
		},
		totalAsset 	: 0.00,
		totalLiabEq : 0.00,
		inventoryAmt: 0.00,
		payableAmt 	: 0.00,
		expenseAmt 	: 0.00,
		cosAmt 		: 0.00,
		saleAmt 	: 0.00,
		xLiabilityAmt: 0.00,
		xAssetAmt 	: 0.00,
		receivableAmt: 0.00,
		getXRatio 	: function() {
			if(banhji.balanceSheet.get('xLiabilityAmt') > 0) {
				return banhji.balanceSheet.get('xAssetAmt')/banhji.balanceSheet.get('xLiabilityAmt');
			} else {
				return 	0;
			}		
		},
		getQRatio 	: function() {
			if(banhji.balanceSheet.get('xLiabilityAmt') > 0) {
				return (banhji.balanceSheet.get('xAssetAmt') - banhji.balanceSheet.get('inventoryAmt'))/banhji.balanceSheet.get('xLiabilityAmt');
			} else {
				return 	0;
			}		
		},
		searchByDate: function() {
			banhji.balanceSheet.assetDS.filter({
				field: 'created_at',
				value: kendo.toString(banhji.balanceSheet.toDate, 'yyyy-MM-dd')
			});
			banhji.balanceSheet.liabilityDS.filter({
				field: 'created_at',
				value: kendo.toString(banhji.balanceSheet.toDate, 'yyyy-MM-dd')
			});
		}
	});
	banhji.incomeVM 	= kendo.observable({
		dataSource 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounts/income',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			change: function(e) {
				var data = this.data();
				var amount = 0.00;
				var currentAsset = 0.00;
				var inventory = 0.00;
				for(var i = 0; i < data.length; i++) {
					for(var x = 0; x < data[i].accounts.length; x++) {
						amount += kendo.parseFloat(data[i].accounts[x].amount);
					}
					// if(data[i].id !==10) {
					// 	for(var x = 0; x < data[i].accounts.length; x++) {
					// 		currentAsset += kendo.parseFloat(data[i].accounts[x].amount);
					// 	}
					// }
					// if(data[i].id ===8) {
					// 	for(var x = 0; x < data[i].accounts.length; x++) {
					// 		inventory += kendo.parseFloat(data[i].accounts[x].amount);
					// 	}
					// }

				}

				banhji.balanceSheet.set('amount', amount);
				// banhji.balanceSheet.set('xAssetAmt', currentAsset);
				// banhji.balanceSheet.set('inventoryAmt', inventory);
			}
		}),
		amount 		: 0.00
	});
	banhji.expenseVM	= kendo.observable({
		dataSource 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounts/expense',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			change: function(e) {
				var data = this.data();
				var amount = 0.00;
				var cogs = 0.00;
				var operatingExp = 0.00;
				for(var i = 0; i < data.length; i++) {
					for(var x = 0; x < data[i].accounts.length; x++) {
						amount += kendo.parseFloat(data[i].accounts[x].amount);
					}
					if(data[i].id ===21) {
						if(data[i].accounts.length >0) {
							for(var x = 0; x < data[i].accounts.length; x++) {
								cogs += kendo.parseFloat(data[i].accounts[x].amount);
							}
						} else {
							cogs = 0.00;
						}
							
					}
					if(data[i].id ===22) {
						for(var x = 0; x < data[i].accounts.length; x++) {
							operatingExp += kendo.parseFloat(data[i].accounts[x].amount);
						}
					}
				}

				banhji.balanceSheet.set('cogsAmt', cogs);
				banhji.balanceSheet.set('amount', amount);
				banhji.balanceSheet.set('operatingExp', operatingExp);
			}
		}),
		amount  	: 0.00,
		operatingExp: 0.00,
		cogsAmt 	: 0.00
	});
	banhji.journalEntry = kendo.observable({
		dataStore 	: dataStore(baseUrl + "entries"),
		contactDS 	: dataStore(baseUrl + "entries/contacts"),
		setCurrent 	: function(entryModel) {
			this.set("current", entryModel);
		},
		addContact 	: function(contact) {
			this.contactDS.add(contact);
		},
		addNew 		: function(entry) {
			this.dataStore.add(entry);
		},
		remove 		: function(entry) {
			this.dataStore.remove(entry);
		},
		delContact	: function(contact){
			this.contactDS.remove(contact);
		},
		getById 	: function(id) {
			var that = this;
			this.dataStore.query({
				filter 	: {field: 'id', value: id},
				take 	: 1
			}).then(function(e){
				that.set('current', that.dataStore.at(0));
			});
		},
		getAll 		: function(){
			this.dataStore.filter({
				field: 'deleted', value: false
			});
		},
		getDeleted 	: function() {
			this.dataStore.filter({
				field: 'deleted', value: true
			});
		},
		saveContact : function() {
			this.contactDS.sync();
		},
		save 		: function() {
			var that = this, dfd = $.Deferred();
			this.dataStore.sync();
			this.dataStore.bind('requestEnd', function(e){
				var res = e.response.results;
				if(res) {
					dfd.resolve({type: e.type, error: false, result: res});
				} else {
					dfd.reject({type: e.type, error: true, msg:"problem with api called."});
				}
			});
			return dfd.promise();
		}
	});
	banhji.journal = kendo.observable({
		dataStore 	: dataStore(baseUrl + "journals"),
		entries 	: dataStore(baseUrl + "journals/entries"),
		contactStore: dataStore(baseUrl + "journals/contacts"),
		setCurrent 	: function(journal) {
			this.set('current', journal);
		},
		insert 		: function() {
			this.dataStore.insert(0,{
				reference: null,
				type: 'GL',
				memo: null
			});
			this.setCurrent(this.dataStore.data()[0]);
		},
		addEntry 	: function(entry) {
			this.entries.addNew(entry);
		},
		removeEntry : function(e) {
			this.entries.remove(e.data);
		},
		find 		: function(id) {
			this.dataStore.query({
				filter: { field: 'id', value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var data = banhji.journal.dataStore.data()[0];
				var id = 0;
				if(typeof data === 'undefined') {
					banhji.journal.entries.query({
						filter: {field: 'id', operator: '', value: 0},
						page: 1,
						pageSize: 100
					}).then(function(e){
						//
					});
				} else {
					banhji.journal.entries.query({
						filter: {field: 'id', operator: '', value: data.id},
						page: 1,
						pageSize: 100
					}).then(function(e){
						//
					});
				}	
			});
		},
		findAll 	: function() {
			this.dataStore.filter({field: 'deleted', value: 'false'});
		},
		findBy 		: function(arr) {
			this.dataStore.filter(arr);
		},
		getData 	: function() {
			return this.dataStore.data();
		},
		remove 		: function(model) {
			this.dataStore.remove(model);
			this.dataStore.sync();
			this.dataStore.bind('requestEnd', function(e){
				console.log(e.type);
			});
		},
		getAccount 	: function(id) {
			this.dataStore.query({
				filter: {field: 'id', value: id}
			}).then(function(e){
				banhji.acccount.set('current', banhji.dataStore.at(0));
			});
		},
		save 		: function() {
			var self = this, dfd = $.Deferred();
			this.dataStore.sync();
			this.dataStore.bind('requestEnd', function(e){
				var type = e.type;
				var results  = e.response.results;
				if(results) {
					dfd.resolve(results);
					if(type === 'create') {
						$.each(results, function(i, v){
							self.contactStore.add(
								{
									journal: v.id,
									contacts: [{ 
										id: banhji.userManagement.getLogin().id,
										action: 'creator'
									}]
								}
							);
						});						
						self.contactStore.sync();
					}
					if(type === 'update') {
						$.each(results, function(i, v){
							self.contactStore.add(
								{
									journal: v.id,
									contacts: [{ 
										id: banhji.userManagement.getLogin().id,
										action: 'updator'
									}]
								}
							);
						});		
						self.contactStore.sync();
					}
				} else {
					dfd.reject({error: true, msg:"problem with api call."});
				}
			});
			return dfd.promise();
		}
	});
	banhji.accounting = kendo.observable({
		accounts 	: banhji.account,
		types 		: dataStore(baseUrl + 'accounts/types'),
		entries 	: banhji.journalEntry,
		journal 	: banhji.journal,
		accountKeyId: null,
		balanceSheet: banhji.balanceSheet,
		recurring 	: banhji.recurring,
		transactionOccurred : 0,
		todayBalance: 0.00,
		totalAsset 	: 0.00,
		totalAntiAsset: 0.00,
		dateType: [
			'---',
			'ថ្អៃនេះ',
			'សប្ដាស៍នេះ',
			'ខែនេះ',
			'ឆ្នាំនេះ',
		],
		startDate: new Date(),
		endDate : new Date(),
		getTransaction: function() {
			var todayDate = new Date();
			var month = kendo.toString(todayDate, 'MM');
			var year = kendo.toString(todayDate, 'yyyy');
			banhji.journalEntry.dataStore.query({
				filter: [
					{field: 'created_at >=', operator: '', value: year + '-' + month + '-01'},
					{field: 'created_at <=', operator: '', value: kendo.toString(todayDate, 'yyyy-MM-dd')}
				],
				page: 1,
				pageSize: 100
			}).done(function(e) {
				banhji.accounting.set('transactionOccurred', banhji.journalEntry.dataStore.total());
			});
		},
		dateTypeSelect: function(e){
			var index = e.sender._oldIndex;
			var today = new Date();
			switch(index){
			case 0:
				break;
			case 1:
				this.set('startDate', today);
				this.set('endDate', today);				
			  	break;
			case 2:
				var first = today.getDate() - today.getDay(); 
				var last = first + 6;
				var firstDayOfWeek = new Date(today.setDate(first));
				var lastDayOfWeek = new Date(today.setDate(last));
				this.set('startDate', firstDayOfWeek);
				this.set('endDate', lastDayOfWeek);
			  	break;
			case 3:			  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
				var lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
				this.set('startDate', firstDayOfMonth);
				this.set('endDate', lastDayOfMonth);
			  	break;
			case 4:
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(today.getFullYear(), 11, 31);
				this.set('startDate', firstDayOfYear);
				this.set('endDate', lastDayOfYear);
			  	break;
			default:
				this.set('startDate',today);
				this.set('endDate', today);					  
			}
		},
		init 	 	: function() {
			var amount = 0.00;
			if(this.get('startDate') >= this.get('endDate')) {
				banhji.balanceSheet.assetDS.query({
					filter: {
						field: 'created_at',
						value: kendo.toString(banhji.accounting.get('endDate'), 'yyyy-MM-dd')
					},
					page: 1,
					pageSize:200
				}).then(function(){
					var data = banhji.balanceSheet.assetDS.data();
					var amount = 0.00;
					$.each(data, function(index, value) {
						$.each(value.accounts, function(i, v){
							amount += kendo.parseFloat(v.amount);
						});						
					});
					banhji.accounting.set('totalAsset', amount);
					banhji.balanceSheet.liabilityDS.query({
						filter:{
							field: 'created_at',
							value: kendo.toString(banhji.accounting.get('endDate'), 'yyyy-MM-dd')
						},
						page: 1,
						pageSize: 200
					}).then(function(){
						var data = banhji.balanceSheet.liabilityDS.data();
						var amount = 0.00;
						$.each(data, function(index, value) {
							$.each(value.accounts, function(i, v){
								amount += kendo.parseFloat(v.amount);
							});						
						});
						var asset = banhji.accounting.get('totalAsset');
						banhji.accounting.set('todayBalance', kendo.toString((asset - amount), 'c2'));
					});
				});
				this.recurring.getCount();
				this.getTransaction();
			} else {
				this.set('startDate', this.get('endDate'));
			}	
		},
		getBalance 	: function() {
			var asset = banhji.accounting.get('totalAsset');
			var liability = banhji.accounting.get('totalAntiAsset');
			console.log(kendo.parseFloat(asset));
		},
		dateChange: function(e) {
			// var dateSel = $('.dateSelect').kendoDropDownList().data('kendoDropDownList');
			// dateSel.select(0);	
			if(this.get('startDate') > this.get('endDate')) {
				this.set('startDate', new Date);
			}
		},
		find 		: function(){
			if(this.get('accountKeyId')) {
				this.accounts.dataStore.filter([
		 			{field: 'code', operator: '', value: this.get('accountKeyId')},
		 			{field: 'active', operator: '', value: 'true'}
		 		]);
			} else {
				this.accounts.dataStore.query({
					filter: [
			 			{field: 'id', operator: 'like', value: this.get('accountKeyId')},
			 			{field: 'active', operator: '', value: 'true'}
			 		],
			 		page: 1,
			 		pageSize: 100
		 		});
			}	
		},
		filter 		: function() {
			if(this.get('current')) {
				this.journal.entries.query({
					filter: [
						{field: 'account_id', operator: '', value: this.get('current').id},
						{field: 'created_at >=', operator: '', value: kendo.toString(this.get('startDate'), 'yyyy-MM-dd')},
						{field: 'created_at <=', operator: '', value: kendo.toString(this.get('endDate'), 'yyyy-MM-dd')}
					],
					page: 1,
					pageSize: 100
				});
			} else {
				this.journal.entries.query({
					filter: [
						{field: 'created_at >=', operator: '', value: kendo.toString(this.get('startDate'), 'yyyy-MM-dd')},
						{field: 'created_at <=', operator: '', value: kendo.toString(this.get('endDate'), 'yyyy-MM-dd')}
					],
					page: 1,
					pageSize: 100
				});
			}		
		},
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		edit 		: function() {
			banhji.router.navigate('/accounts/u/edit');
		},
		newAccount 	: function() {
			this.accounts.add();
		},
		createAcct 	: function() {
			// this.accounts.save();
			banhji.account.dataStore.sync();
		},
		selected 	: function(e) {
			var selected = e.data;
			this.setCurrent(selected);
			this.journal.entries.query({
				filter: [
					{field: 'account_id', operator: '', value: selected.id},
					{field: 'created_at >=', operator: '', value: kendo.toString(this.get('startDate'), 'yyyy-MM-dd')},
					{field: 'created_at <=', operator: '', value: kendo.toString(this.get('endDate'), 'yyyy-MM-dd')}
				],
				page: 1,
				pageSize: 100
			}).done(function(e) {
				var data = banhji.accounting.journal.entries.data();
				banhji.accounting.set('transactionOccurred', banhji.accounting.journal.entries.total());
				var amount = data.length > 0 ? data[data.length - 1].balance : 0;
				banhji.accounting.set('todayBalance', kendo.toString(amount, 'c2'));
			});
		},
		findTxByAcct: function(keyword) {
		 	var keyType = typeof keyword;
		 	if(keyType === 'number') {
		 		banhji.journalEntry.dataStore.query({
		 			filter: {
		 				logic: 'account',
		 				filters: [{field: 'id', operator: '', value: keyword}]
		 			},
		 			page: 1,
		 			pageSize: 20
		 		});
		 	} else if(keyType === 'string') {
		 		// banhji.journalEntry.dataStore.filter([
		 		// 	{field: 'code', operator: '', value: keyword},
		 		// 	{field: 'name', operator: 'or', value: keyword},
		 		// 	{field: 'active', operator: '', value: 'true'}
		 		// ]);
		 	} else {
		 		throw "keyword must be either number or string";
		 	}
		}
	});
	banhji.accountingItem = kendo.observable({
		dataSource 		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/item",
					type: "GET",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + "items/item",
					type: "POST",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + "items/item",
					type: "PUT",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + "items/item",
					type: "DELETE",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							offset: options.skip,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count',
				errors: 'error'
			},
			batch: true,
			serverFiltering: true,
			filter: {field: 'item_type_id', operator: '', value: 8},
			serverPaging: true,
			pageSize: 20
		}),
    	itemTypeDS 		: dataStore(baseUrl + "item_types"),
    	accounts 		: dataStore(baseUrl + "accounts"),
    	close 		: function() {
			window.history.back(-1);
			if(banhji.accountingItem.dataSource.hasChanges()) {
				banhji.accountingItem.dataSource.cancelChanges();
			}
		},
    	setCurrent 		: function(current) {
    		banhji.accountingItem.set('current', current);
    	},
    	back 			: function() {
    		var view = new kendo.View('#accountingItem-template', {model: banhji.accountingItem});
    		banhji.view.layout.showIn('#content', view);
    		banhji.accountingItem.dataSource.query({
				filter: {field: 'item_type_id', operator: '', value: 5},
				page: 1,
				pageSize: 100
			});
    	},
    	add 			: function() {
    		banhji.accountingItem.dataSource.insert(0, {
    			name: null,
    			company_id: null,
    			category_id: null,
    			measurement_id: null,
    			brand_id: null,
    			main_id: null,
    			supplier_code: null,
    			color_code: null,
    			cost: null,
    			on_hand: null,
    			order_point: null,
    			income_account_id: 0,
    			cogs_account_id: 0,
    			preferred_vendor_id: 0,
    			image_url: null,
    			favorite: null,
    			deleted: 'false',	
    			description: null,
    			item_type_id: 8,
    			inventory_account_id: null,
    			status: 1
    		});
    		banhji.accountingItem.setCurrent(banhji.accountingItem.dataSource.at(0));
    		var newView = new kendo.View('#accountingItem-new-template', {model: banhji.accountingItem});
			banhji.view.layout.showIn('#content', newView);
    	},
    	getItem 	: function(e) {
			this.setCurrent(e.data);
			if(e.data.status === '1') {
				e.data.set('status', true);
			} else {
				e.data.set('status', false);
			}
			var newView = new kendo.View('#accountingItem-new-template', {model: banhji.accountingItem});
			banhji.view.layout.showIn('#content', newView);
		},
		remove 		: function (e){
			bootbox.confirm("តើអ្នកពិតជាចង់លុបបញ្ជីន \'"+e.data.name+"\' មែនទេ?", function(result) 
			{
				if(result === true) {
					banhji.accountingItem.dataSource.remove(e.data);
					banhji.accountingItem.save();
				}
			});
		},
		cancel 		: function() {
			banhji.accountingItem.dataSource.cancelChanges();
			banhji.accountingItem.dataSource.query({
				filter: {field: 'item_type_id', operator: '', value: 5},
				page: 1,
				pageSize: 100
			});
			var view = new kendo.View('#accountingItem-template', {model: banhji.accountingItem});
    		banhji.view.layout.showIn('#content', view);
		},
    	save 		: function() {  		
    		banhji.accountingItem.dataSource.sync();
    		banhji.accountingItem.dataSource.bind('requestEnd', function(e){
    			if(e.type === 'destroy') {
    				bootbox.alert("កត់ត្រាបានសំរេច", function(result){});
    			} else if(e.type === 'create') {
    				bootbox.alert("បង្កើតបានសំរេច", function(result){});
    			}
    		});
    	}
	});
	banhji.gl 	= kendo.observable({
		entry 		: banhji.journalEntry,
		segments  	: banhji.segmentItem.ds,
		journalDS 	: dataStore(baseUrl + 'journals'),
		entries 	: [],
		classDS		: [],
		accountList : [],
		debit 		: 0.00,
		credit 		: 0.00,
		recurringVM : banhji.recurring,
		people 		: banhji.people,
		isRecurred 	: false,
		createRecurring: function() {
			if(this.get('isRecurred')) {
				this.recurringVM.addNew();
			} else {
				this.recurringVM.cancel();
			}			
		},
		types 		: [
			{id: 'adj', name: 'Adjustment'},
			{id: 'opening_balance', name: 'Opening Balance'},
			{id: 'closing_entry', name: 'Closing Entry'},
			{id: 'reclassification', name: 'Reclassification'},
			{id: 'accrual', name: 'Accrual'},
			{id: 'depreciation_amortization', name: 'Depreciation/Amortization'},
			{id: 'others', name: 'Others'}
		],
		close 		: function() {
			window.history.back(-1);
			this.entry.dataStore.cancelChanges();
			this.get('entries').splice(0, this.get('entries').length);
		},
		init 		: function() {
			if(banhji.gl.get('accountList').length === 0) {
				banhji.account.dataStore.query({
					filter: {field: 'active', operator: '', value: true},
					page: 1,
					pageSize: 500
				}).done(function(e){
					banhji.gl.set('accountList', banhji.account.dataStore.data());
				});
				console.log("check 2");
			}
			if(banhji.gl.get('classDS').length === 0) {
				this.segments.query({
					page 	: 1,
					pageSize: 500
				}).done(function(e){
					// $.each(banhji.gl.segments.data(), function(i, v) {
						banhji.gl.set('classDS', banhji.gl.segments.data());
					// });
				}).fail(function(e){
					console.log(e);
				});
			}
		},
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		check 		: function(e) {
			if(e.data.debit > 0 && e.data.credit > 0) {
				alert("Debit and credit cannot be on the same line");
			}
		},
		findGL 		: function(id) {
			this.entry.dataSource.query({
				filter: {}
			})
		},
		add 		: function() {
			this.entry.dataStore.insert(0,{
				reference: null,
				type: 'GL',
				voucher: '',
				issuedDate: kendo.toString(new Date(), 'yyyy-MM-dd'),
				memo: null,
				contact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
				entries: null
			});
			this.setCurrent(this.entry.dataStore.at(0));
		},
		addEntry 	: function() {
			this.entries.push({
				memo 	: null,
				debit 	: 0.00,
				credit 	: 0.00,
				account : null,
				rate 	: 1,
				locale 	: 'km-KH',
				segment : null,
				contact : banhji.vendors.get('current')
			});
		},
		totalDebit 	: function() {
			var amount = 0;
			$.each(this.entries, function(i, v){
				if(v.debit > 0.00) {
					amount += kendo.parseFloat(v.debit);
				}
			});
			this.set('debit', amount);
			
			return amount;
		},
		totalCredit : function() {
			var amount = 0;
			$.each(this.entries, function(i, v){
				if(v.credit > 0.00) {
					amount += kendo.parseFloat(v.credit);
				}
			});
			this.set('credit', amount);
			
			return amount;
		},
		removeEntry : function(e){
			$.each(this.entries, function(i, v){
				if(v === e.data) {
					banhji.gl.entries.splice(i, 1);
					return false;
				}
			});
		},
		changeValue : function(e) {			
			var dataArr = e.data.segment;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = dataArr[i];
					if(current.segment.id === dataArr[lastIndex].segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		save 		: function() {
			if(this.entries.length === 0 || this.entries.length ===1) {
				alert("Please review");
			} else if(this.debit !== this.credit){
				alert("Please review");
			} else {
				var entries = [];
				$.each(this.entries, function(i, v){
					if(v.debit > 0) {
						entries.push({
							memo 	: v.memo,
							account : v.account,
							amount 	: v.debit,
							is_debit: true,
							rate 	: banhji.currency.getRate(banhji.index.companyInf().institute[0].locale),
							locale 	: banhji.index.companyInf().institute[0].locale,
							segment : v.segment,
							contact : v.contact,
							issuedDate: kendo.toString(banhji.gl.get('current').issuedDate, 'yyyy-MM-dd')
						});
					} else {
						entries.push({
							memo 	: v.memo,
							account : v.account,
							amount 	: v.credit,
							is_debit: false,
							rate 	: banhji.currency.getRate(banhji.index.companyInf().institute[0].locale),
							locale 	: banhji.index.companyInf().institute[0].locale,
							segment : v.segment,
							contact : v.contact,
							issuedDate: kendo.toString(banhji.gl.get('current').issuedDate, 'yyyy-MM-dd')
						});
					}
						
				});
				this.get('current').set('entries', entries);
				this.get('current').set('issuedDate', kendo.toString(banhji.gl.get('current').issuedDate, 'yyyy-MM-dd'));
				this.entry.save()
				.then(function(data){
					if(data.error === false) {
						if(data.type === 'create') {
							banhji.gl.get('entries').splice(0, banhji.gl.get('entries').length);
							banhji.gl.add();
							banhji.gl.addEntry();
							banhji.gl.addEntry();
							alert("Successfully recorded");
						} else if(data.type === 'update'  || res.results[0]) {
							alert("Successfully recorded");
						} else {
							alert("Save failed");
						}

						// if recurring
						if(banhji.gl.get('isRecurred')) {
							banhji.gl.recurringVM.get('current').set('name', 'gl');
							banhji.gl.recurringVM.get('current').set('type', data.result[0].type);
							var items = [];
							var res = data.result[0].entries;
							$.each(res, function(i, v){
								items.push({
									recurring_id: null,
									item: v.account,
									contact: v.contact,
									dr: v.is_debit === true ? v.amount : 0.00,
									cr: v.is_debit === false ? v.amount : 0.00
								});
							});
							banhji.gl.recurringVM.get('current').set('items', items);
							banhji.gl.recurringVM.save()
							.then(
								function(success){
									banhji.gl.recurringVM.set('current', null);
								},
								function(failure){});
						}
						banhji.gl.set('credit', 0);
						banhji.gl.set('debit', 0);
					} else {
						alert("Save failed");
					}
				});
			}
		},
		saveNClosed : function() {
			if(this.entries.length === 0 || this.entries.length ===1) {
				alert("Please review");
			} else if(this.debit !== this.credit){
				alert("Please review");
			} else {
				var entries = [];
				$.each(this.entries, function(i, v){
					if(v.debit > 0) {
						entries.push({
							memo 	: v.memo,
							account : v.account,
							amount 	: v.debit,
							is_debit: true,
							rate 	: banhji.currency.getRate(banhji.index.companyInf().institute[0].locale),
							locale 	: banhji.index.companyInf().institute[0].locale,
							segment : v.segment,
							contact : v.contact,
							issuedDate: kendo.toString(banhji.gl.get('current').issuedDate, 'yyyy-MM-dd')
						});
					} else {
						entries.push({
							memo 	: v.memo,
							account : v.account,
							amount 	: v.credit,
							is_debit: false,
							rate 	: banhji.currency.getRate(banhji.index.companyInf().institute[0].locale),
							locale 	: banhji.index.companyInf().institute[0].locale,
							segment : v.segment,
							contact : v.contact,
							issuedDate: kendo.toString(banhji.gl.get('current').issuedDate, 'yyyy-MM-dd')
						});
					}
						
				});
				this.get('current').set('entries', entries);
				this.get('current').set('issuedDate', kendo.toString(banhji.gl.get('current').issuedDate, 'yyyy-MM-dd'));
				this.entry.save()
				.then(function(data){
					if(data.error === false) {
						if(data.type === 'create') {
							banhji.gl.get('entries').splice(0, banhji.gl.get('entries').length);
							banhji.gl.add();
							banhji.gl.addEntry();
							banhji.gl.addEntry();
							alert("Successfully recorded");
						} else if(data.type === 'update'  || res.results[0]) {
							alert("Successfully recorded");
						} else {
							alert("Save failed");
						}

						// if recurring
						if(banhji.gl.get('isRecurred')) {
							banhji.gl.recurringVM.get('current').set('name', 'gl');
							banhji.gl.recurringVM.get('current').set('type', data.result[0].type);
							var items = [];
							var res = data.result[0].entries;
							$.each(res, function(i, v){
								items.push({
									recurring_id: null,
									item: v.account,
									contact: v.contact,
									dr: v.is_debit === true ? v.amount : 0.00,
									cr: v.is_debit === false ? v.amount : 0.00
								});
							});
							banhji.gl.recurringVM.get('current').set('items', items);
							banhji.gl.recurringVM.save()
							.then(
								function(success){
									banhji.gl.recurringVM.set('current', null);
								},
								function(failure){});
						}
						banhji.gl.close();
						banhji.gl.set('credit', 0);
						banhji.gl.set('debit', 0);
					} else {
						alert("Save failed");
					}
				});
			}
		}
	});
	banhji.billDS = new kendo.data.DataSource({
		transport: {
			read: {
				url: baseUrl + 'bills',
				type: "GET",
				dataType: "json"
			},
			create: {
				url: baseUrl + 'bills',
				type: "POST",
				dataType: "json"
			},
			update: {
				url: baseUrl + 'bills',
				type: "PUT",
				dataType: "json"
			},
			destroy: {
				url: baseUrl + 'bills',
				type: "DELETE",
				dataType: "json"
			},
			parameterMap: function(options, operation) {
				if(operation === 'read') {
					return {
						limit: options.take,
						page: options.page,
						filter: options.filter
					};
				} else {
					return {models: kendo.stringify(options.models)};
				}
			}
		},
		schema 	: {
			model: {
				id: 'id'
			},
			data: 'results',
			total: 'count'
		},
		batch: true,
		serverFiltering: true,
		serverPaging: true,
		pageSize: 100
	});
	banhji.vendorPmt = kendo.observable({
		close 	: function() {
			window.history.back(-1);
		},
		classDS : banhji.segmentItem.ds,
		pmtDS 	: dataStore(baseUrl+'payments'),
		ptmData : [],
		payments: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'payments/payment',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'payments/payment',
					type: "POST",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'payments/payment',
					type: "PUT",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'payments/payment',
					type: "DELETE",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: function(response) {
					return [{meta: response.meta, results: response.results}];
				},
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		changeValue : function(e) {			
			var dataArr = e.data.segment;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = dataArr[i];
					if(current.segment.id === dataArr[lastIndex].segment.id) {
						dataArr.splice(lastIndex, 1);
						$('#status').addClass('alert');
						$('#status').html("<strong>Cannot select same segment in the group.</strong");
						break;
					} else {
						$('#status').removeClass('alert');
						$('#status').html("");
					}
				}
			}
		},
		dateType: [
			'---',
			'Today',
			'This Week',
			'This Month',
			'This Year',
		],
		startDate: new Date(),
		endDate : new Date(),
		dateChange: function(e) {
			// var dateSel = $('.dateSelect').kendoDropDownList().data('kendoDropDownList');
			// dateSel.select(0);	
			// if(this.get('startDate') > this.get('endDate')) {
			// 	this.set('startDate', new Date);
			// }
			console.log(e);
		},
		dateTypeSelect: function(e){
			var index = e.sender._oldIndex;
			var today = new Date();
			switch(index){
			case 0:
				break;
			case 1:
				banhji.vendorPmt.set('startDate', today);
				banhji.vendorPmt.set('endDate', today);				
			  	break;
			case 2:
				var first = today.getDate() - today.getDay(); 
				var last = first + 6;
				var firstDayOfWeek = new Date(today.setDate(first));
				var lastDayOfWeek = new Date(today.setDate(last));
				banhji.vendorPmt.set('startDate', firstDayOfWeek);
				banhji.vendorPmt.set('endDate', lastDayOfWeek);
			  	break;
			case 3:			  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
				var lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
				banhji.vendorPmt.set('startDate', firstDayOfMonth);
				banhji.vendorPmt.set('endDate', lastDayOfMonth);
			  	break;
			case 4:
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(today.getFullYear(), 11, 31);
				banhji.vendorPmt.set('startDate', firstDayOfYear);
				banhji.vendorPmt.set('endDate', lastDayOfYear);
			  	break;
			default:
				banhji.vendorPmt.set('startDate',today);
				banhji.vendorPmt.set('endDate', today);					  
			}
		},
		findPmt : function() {
			banhji.vendorPmt.pmtDS.query({
				filter: [
					{field: 'created_at >=', operator: '', value: kendo.toString(banhji.vendorPmt.get('startDate'), 'yyyy-MM-dd')},
					{field: 'created_at <=', operator: '', value: kendo.toString(banhji.vendorPmt.get('endDate'), 'yyyy-MM-dd')},
					{field: 'type', operator: '', value: 'purchase'},
					{field: 'type', operator: 'or', value: 'expense'}
				],
				page: 1,
				pageSize: 200
			});
		},
		show 	: false,
		vendor 	: dataStore(baseUrl + "vendors"),
		cashAccount: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "accounts",
					type: "GET",
					headers: {
						"Entity": getDB()
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							offset: options.skip,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count',
				errors: 'error'
			},
			batch: true,
			serverFiltering: true,
			filter: {
				field: 'account_type_id', operator: 'where_in', value: [6]
			},
			serverPaging: true,
			pageSize: 20
		}),
		account : '',
		segment : null,
		currentV: '',
		voucher : '',
		tmp 	: [],
		billDS 	: banhji.billDS,
		vendorID: null,
		total 	: 0.00,
		findVendor : function() {
			banhji.vendorPmt.vendor.query({
				filter: {field: 'id', operator: '', value: banhji.vendorPmt.get('vendorID')},
				page: 1, 
				pageSize: 1
			}).then(function(e){
				if(banhji.vendorPmt.vendor.data().length > 0) {
					banhji.vendorPmt.set('show', true);
					banhji.vendorPmt.set('currentV', banhji.vendorPmt.vendor.data()[0]);
					banhji.vendorPmt.billDS.query({
						filter: [
							{field: 'type <>', operator: '', value: 'po'},
							{field: 'type <>', operator: '', value: 'grn'},
							{field: 'vendor_id', operator: '', value: banhji.vendorPmt.vendor.data()[0].id},
							{field: 'status <>', operator: '', value: 'closed'}
						],
						page: 1,
						pageSize: 100
					}).then(function(e){
						banhji.vendorPmt.set('tmp', []);
						var data = banhji.vendorPmt.billDS.data();
						$.each(data, function(i, v){
							banhji.vendorPmt.get('tmp').push({
								isPaid: false,
								due : v.due_date,
								vendor: {id: v.vendor.id, company: v.vendor.company},
								invoice: v.invoice_number,
								amountBilled: v.amount,
								paid: v.paid,
								amount: v.amount - v.paid,
								bill: {id: v.id},
								type: v.type
							});
						});
						banhji.vendorPmt.calcTotal();
						var today = new Date();
						banhji.vendorPmt.payments.query({
							filter: [
								{field: 'type', value: 'bill'},
								{field: 'contact_id', value: banhji.vendorPmt.vendor.data()[0].id}
							],
							page: 1,
							pageSize: 100
						}).then(function(e){
							// console.log(banhji.vendorPmt.payments.data());
							var data = banhji.vendorPmt.payments.data();
							var invNumber = 0, invAmount = 0;
							banhji.vendorPmt.set('tInvToday', data[0].meta.num);
							banhji.vendorPmt.set('tAmtToday', data[0].meta.todayAmount);
						});				
					});
				} else {
					banhji.vendorPmt.set('show', false);
				}				
			});	
		},
		tInvToday: 0,
		tAmtToday: 0,
		memo 	 : '',
		paymentDate : new Date(),
		todayPmt: function() {},
		calcTotal: function() {
			var amount = 0;
			$.each(banhji.vendorPmt.get('tmp'), function(i, v){
				if(v.isPaid === true) {
					amount += kendo.parseFloat(v.amount);
				}					
			});
			banhji.vendorPmt.set('total', amount);
		},
		refesh 	: function() {

		},
		tick 	: function(e) {
			banhji.vendorPmt.calcTotal();
		},
		makePayment: function() {
			$.each(banhji.vendorPmt.get('tmp'), function(i, v){
				if(v.isPaid === true) {
					banhji.vendorPmt.pmtDS.add({
						contact: v.vendor,
						cashier: {id: banhji.userManagement.getLogin().id, username: banhji.userManagement.getLogin().username},
						reference: {id: v.bill.id},
						type: v.type,
						amount: v.amount,
						discount: 0,
						fine: 0,
						rate 	: banhji.currency.getRate(banhji.index.companyInf().institute.locale),
						locale 	: banhji.index.companyInf().institute.locale,
						payment_date: banhji.vendorPmt.get('paymentDate')
					});
				}
			});
			banhji.vendorPmt.pmtDS.sync();
			banhji.vendorPmt.pmtDS.bind('requestEnd', function(e){
				// save to journal
				var today = new Date();
				var data  = banhji.vendorPmt.pmtDS.data();
				var entries = [];
				var amount = 0;

				for(var x = 0; x < data.length; x++) {
					amount += kendo.parseFloat(data[x].amount);
					entries.push({
						amount  : data[x].amount,
						memo 	: 'pmt-bill '+data[x].reference.id,
						is_debit: true,
						account : banhji.vendorPmt.get('currentV').ap,
						rate 	: banhji.currency.getRate(banhji.index.companyInf().institute.locale),
						locale 	: banhji.index.companyInf().institute.locale,
						contact : {
							id: banhji.vendorPmt.get('currentV').id,
							company: banhji.vendorPmt.get('currentV').company
						},
						segment : banhji.vendorPmt.get('segment'),
						issued_Date: banhji.vendorPmt.get('paymentDate')
					});
				}
					
				entries.push({
					amount  :  amount,
					memo 	: 'pmt',
					is_debit: false,
					account : {id: banhji.vendorPmt.get('account')},
					rate 	: banhji.currency.getRate(banhji.index.companyInf().institute.locale),
					locale 	: banhji.index.companyInf().institute.locale,
					contact : {
						id: banhji.vendorPmt.get('currentV').id,
						company: banhji.vendorPmt.get('currentV').company
					},
					segment : banhji.vendorPmt.get('segment'),
					issued_Date: banhji.vendorPmt.get('paymentDate')
				});
				banhji.journalEntry.addNew({
					reference: '',
					voucher: banhji.vendorPmt.get('voucher'),
					type: 'pmt',
					memo: banhji.vendorPmt.get('memo'),
					contact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
					entries: entries,
					issued_Date: banhji.vendorPmt.get('paymentDate')
				});
				banhji.journalEntry.save().then(function(entry){
					banhji.vendorPmt.payments.query({
						filter: [
							{field: 'type', value: 'bill'},
							{field: 'contact_id', value: banhji.vendorPmt.vendor.data()[0].id}
						],
						page: 1,
						pageSize: 100
					}).then(function(e){
						// console.log(banhji.vendorPmt.payments.data());
						var data = banhji.vendorPmt.payments.data();
						var invNumber = 0, invAmount = 0;
						banhji.vendorPmt.set('tInvToday', data[0].meta.num);
						banhji.vendorPmt.set('tAmtToday', data[0].meta.todayAmount);
						$('#status').addClass('alert');
						$('#status').html("<strong>កត់ត្រាបានសំរេច។</strong>");
						setTimeout(function(){
							$('#status').removeClass('alert');
							$('#status').html("");
						}, 5000);
						banhji.vendorPmt.get('tmp').splice(0, banhji.vendorPmt.get('tmp').length);
					});	
				});
			});
		}
	});
	banhji.cashiers = {};
	// dawine section
	banhji.cashier = kendo.observable({
		dataSource 			: dataStore(baseUrl + "invoices/payment"),
		paymentByCashierDS	: dataStore(baseUrl + "payments/by_cashier"),		
		contactDS 			: dataStore(baseUrl + "contacts"),				
		invoiceDS 			: dataStore(baseUrl + "invoices"),
		updateInvoiceDS 	: dataStore(baseUrl + "invoices"),
		transactionDS 		: dataStore(baseUrl + "invoices"),
		paymentMethodDS 	: dataStore(baseUrl + "payment_methods"),

		invoiceList 		: [],	

		customer 			: null,		
		total_customer 		: 0,
		total_payment 		: kendo.toString(0,"c0", "km-KH"),

		//Payment		
		payment_date		: new Date(),
		payment_method_id	: 1,
		account_id 			: 2,
		check_no			: "",		
		cashier				: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,
		discount 			: 0,
		fine 				: 0,							
		pay_amount  		: kendo.toString(0,"c0", "km-KH"),
		receive_amount  	: kendo.toString(0,"c0", "km-KH"),
		remain				: kendo.toString(0,"c0", "km-KH"),						
		
		pageLoad 			: function(id){
			var self = this;

			if(id){
				this.set("invoiceList", []);

				this.invoiceDS.query({
					filter: { field:"id", value: id },
					page: 1,
					take: 100
				}).then(function(){
					var view = self.invoiceDS.view(),
					fullIdName = view[0].contact[0].number +" "+ view[0].contact[0].surname +" "+ view[0].contact[0].name;

					if(view[0].contact[0].contact_type_id==5 && view[0].contact[0].contact_type_id==6 && view[0].contact[0].contact_type_id==7){
						fullIdName = view[0].contact[0].number +" "+ view[0].contact[0].company;
					}

					self.loadInvoice(view[0].contact_id, fullIdName);
				});
			}else{
				this.loadPaymentByCashier();
			}			
		},
		total 				: function() {      		
	        var sum = 0;

	        $.each(this.invoiceList, function(index, value) {	        		            
	        	sum += kendo.parseInt(value.amount);		        	          
	        });

	        return kendo.toString(sum, "c0", "km-KH");
	    },		
		loadPaymentByCashier: function(){
			var self = this;

			this.paymentByCashierDS.query({
				filter: [
					{ field:"cashier_id", value: this.get("cashier") },
					{ field:"payment_date", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				]
			}).then(function(e){
				var view = self.paymentByCashierDS.view();
						    	
		    	self.set("total_customer", view[0].total_customer);
		    	self.set("total_payment", kendo.toString(view[0].amount, "c0", "km-KH"));
			});
		},		
		loadInvoice 		: function(contact_id, fullIdName){
			var self = this;

			this.invoiceDS.query({
				filter: [
					{ field:"contact_id", value: contact_id },
		    		{ field:"status", operator:"where_in", value: [0,2] },
		    		{ field:"type", operator:"where_in", value:["Invoice", "eInvoice", "wInvoice"] }
				],
				page: 1,
				take: 50	  	
			}).then(function(e) {
			    var view = self.invoiceDS.view();
			    
			    $.each(view, function(index, value){
		    		var result = $.grep(self.get("invoiceList"), function(e){ return e.id == value.id; });

		    		if (result.length == 0) {
					  	// not found
					  	var remainAmount = kendo.parseFloat(value.amount) - kendo.parseFloat(value.amount_paid);
					  	
					  	self.get("invoiceList").push({				
							id 				: value.id,
							isPay 			: true,				
							issued_date 	: value.issued_date,
							fullname 		: fullIdName,							
							number			: value.number,										
							amount 			: remainAmount,
							pay_amount 		: remainAmount,
							rate 			: value.rate,
							locale 			: value.locale,
							contact_id 		: value.contact_id,
							company_id 		: value.company_id
 						});
						self.change();
						self.autoIncreaseNo();
					} else if (result.length == 1) {
					  	// access the foo property using result[0].foo					  
					} else {
					  	// multiple items found					  
					}		    					    		
		    	});		    	
			});			
		},						
		autoIncreaseNo 		: function(){
			$(".sno").each(function(index,element){                 
			   $(element).text(index + 1); 
			});
		},
		change				: function(){		
			var total = 0;		
		    var tpay = 0;
		    $.each(this.get("invoiceList"), function(index, value){
		    	total += kendo.parseFloat(value.amount)*kendo.parseFloat(value.rate);
		    	tpay += kendo.parseFloat(value.pay_amount)*kendo.parseFloat(value.rate);
		    });

		    this.set("pay_amount", kendo.toString(tpay, "c0", "km-KH"));		  	   	    	
	    	
	    	var receive_amount = tpay + kendo.parseFloat(this.get("fine"));
			this.set("receive_amount", kendo.toString(receive_amount, "c0", "km-KH"));
	    	
	    	var remain = (total + kendo.parseFloat(this.get("fine"))) - (tpay + kendo.parseFloat(this.get("discount")));
	    	this.set("remain", kendo.toString(remain, "c0", "km-KH"));	    	   	
		},	
		remove 				: function(e){
			if (confirm("តើលោកអ្នកពិតជាចង់លុបមែនឬទេ?")) {        
		        var item = e.data,
		        index = this.get("invoiceList").indexOf(item);
		        this.get("invoiceList").splice(index, 1);
		        this.change();
		        this.autoIncreaseNo();
	    	}	    	
	    },
	    checkPay 			: function(e){
	    	e.preventDefault();

	    	var d = e.data;
	    	var target = e.currentTarget;

	    	if(target.checked){
	    		d.set("pay_amount", d.amount);
	    	}else{
	    		d.set("pay_amount", 0);
	    	}
	    	this.change();
	    },
		save 		 		: function(){
			var self = this, data = this.get("invoiceList");
			
			if(data.length>0){
				$.each(data, function(index, value){
					if(kendo.parseFloat(value.pay_amount)>0){
						var status = 2; //Partialy Paid
						if(value.pay_amount>=value.amount){							
							 status = 1; //Paid
						}

						self.dataSource.add({
							company_id 			: value.company_id,
							contact_id 			: value.contact_id,
							cashier_id 			: self.get("cashier"),
							meter_id 			: 0,							
							reference_id		: value.id,														
							payment_method_id	: this.get("payment_method_id"),
							account_id			: this.get("account_id"),
							check_no			: this.get("check_no"),							
							type 				: "invoice",
							amount 				: value.pay_amount,
							fine 				: self.get("fine"),
							discount 			: self.get("discount"),
							rate 				: value.rate,
							locale 				: value.locale,
							payment_date		: kendo.toString(self.get("payment_date"), "yyyy-MM-dd"),

							status 				: status
						});
					}
				});

				this.updateInvoiceDS.sync();
				this.dataSource.sync();
				var saved = false;
				this.dataSource.bind("requestEnd", function(e){
					if(saved==false){
						saved = true;

						self.clear();
						self.loadPaymentByCashier();
					}
				});
			}
		},					
		clear 				: function() {
			this.set("check_no", "");			
			this.set("discount", 0);
			this.set("fine", 0);		
			this.set("pay_amount", kendo.toString(0,"c0", "km-KH"));
			this.set("receive_amount", kendo.toString(0,"c0", "km-KH"));
			this.set("remain", kendo.toString(0,"c0", "km-KH"));

			this.set("invoiceList", []);

			this.updateInvoiceDS.data([]);
			this.dataSource.data([]);							
		}
	});
	// dawine section end
	banhji.cashiers.deposit = kendo.observable({
		accounts 	: [],
		entry 		: banhji.journalEntry,
		segments  	: banhji.segmentItem.ds,
		entries 	: [],
		from 		: {
				memo 	: null,
				amount 	: 0.00,
				is_debit: true,
				account : null,
				rate 	: 1,
				locale 	: 'km-KH',
				segment : null,
				contact : null
		},
		changeValue : function(e) {			
			var dataArr = e.data.segment;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = dataArr[i];
					if(current.segment.id === dataArr[lastIndex].segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}		
		},
		init 		: function() {
			if(banhji.account.dataStore.data().length > 0) {
				// for(var i=0; i > banhji.account.dataStore.data().length; i++) {
				// 	if(banhji.account.dataStore.data()[i].type.id === 6) {
						banhji.cashiers.deposit.set('accounts', banhji.account.dataStore.data());
				// 	}
				// }
			} else {
				banhji.account.dataStore.query({
					filter: {field: 'active', operator: '', value: true},
					page: 1,
					pageSize: 500
				}).then(function(e){
					// for(var i=0; i < banhji.account.dataStore.data().length; i++) {
					// 	if(banhji.account.dataStore.data()[i].type.id === 6) {
							banhji.cashiers.deposit.set('accounts', banhji.account.dataStore.data());
					// 	}
					// }
				});
			}
		},
		close     : function() {
			window.history.back(-1);
			banhji.cashiers.deposit.entry.dataStore.cancelChanges();
			banhji.cashiers.deposit.set('entries', []);
		},
		setCurrent 	: function(current) {
			banhji.cashiers.deposit.set('current', current);
		},
		addJournal 	: function() {
			banhji.cashiers.deposit.entry.dataStore.insert(0,{
				reference: null,
				type: 'deposit',
				voucher: null,
				memo: null,
				contact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
				entries: null
			});
			banhji.cashiers.deposit.setCurrent(this.entry.dataStore.at(0));
		},
		addEntry 	: function() {
			banhji.cashiers.deposit.entries.push({
				memo 	: null,
				amount 	: 0.00,
				is_debit: false,
				account : null,
				rate 	: banhji.currency.getRate(banhji.index.companyInf().institute.locale),
				locale 	: banhji.index.companyInf().institute.locale,
				segment : null,
				contact : banhji.vendors.get('current') !== null ? banhji.vendors.get('current'): null
			});
		},
		removeEntry : function(e) {
			for(var i = 0; i < banhji.cashiers.deposit.entries.length; i++) {
				if(banhji.cashiers.deposit.entries[i] === e.data) {
					banhji.cashiers.deposit.entries.splice(i,1);
					break;
				}
			}
		},
		save 		: function() {
			var entries = [];
			var amount = 0;
			for(var i = 0; i<this.entries.length; i++) {
				amount += kendo.parseFloat(this.entries[i].amount);
			}
			banhji.cashiers.deposit.get('from').set('memo', banhji.cashiers.deposit.get('current').memo);
			banhji.cashiers.deposit.get('from').set('amount', amount);
			entries.push(this.get('from'));
			entries.push(this.entries);
			banhji.cashiers.deposit.get('current').set('entries', entries);
			if(entries.length > 1) {
				banhji.cashiers.deposit.entry.save()
				.then(function(data){
					banhji.cashier.deposit.addJournal();
					banhji.cashier.deposit.set('entries', []);
				});
			}
		}
	});
	banhji.cashiers.transfer= kendo.observable({
		accounts 	: [],
		entry 		: banhji.journalEntry,
		segments  	: banhji.segmentItem.ds,
		entries 	: [],
		from 		: {
				memo 	: null,
				amount 	: 0.00,
				is_debit: false,
				account : null,
				rate 	: 1,
				locale 	: 'km-KH',
				segment : null,
				contact : null
		},
		changeValue : function(e) {			
			var dataArr = e.data.segment;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = dataArr[i];
					if(current.segment.id === dataArr[lastIndex].segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}		
		},
		init 		: function() {
			if(banhji.account.dataStore.data().length > 0) {
				// for(var i=0; i > banhji.account.dataStore.data().length; i++) {
				// 	if(banhji.account.dataStore.data()[i].type.id === 6) {
						banhji.cashiers.transfer.set('accounts',banhji.account.dataStore.data());
				// 	}
				// }
			} else {
				banhji.account.dataStore.query({
					filter: {field: 'active', operator: '', value: true},
					page: 1,
					pageSize: 500
				}).then(function(e){
					// for(var i=0; i < banhji.account.dataStore.data().length; i++) {
					// 	if(banhji.account.dataStore.data()[i].type.id === 6) {
							banhji.cashiers.transfer.set('accounts',banhji.account.dataStore.data());
					// 	}
					// }
				});
			}
		},
		close     : function() {
			window.history.back(-1);
			banhji.cashiers.transfer.entry.dataStore.cancelChanges();
			banhji.cashiers.transfer.set('entries', []);
		},
		setCurrent 	: function(current) {
			banhji.cashiers.transfer.set('current', current);
		},
		addJournal 	: function() {
			banhji.cashiers.transfer.entry.dataStore.insert(0,{
				reference: null,
				type: 'transfer',
				voucher: null,
				memo: null,
				contact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
				entries: null
			});
			banhji.cashiers.transfer.setCurrent(this.entry.dataStore.at(0));
		},
		addEntry 	: function() {
			banhji.cashiers.transfer.entries.push({
				memo 	: null,
				amount 	: 0.00,
				is_debit: true,
				account : null,
				rate 	: banhji.currency.getRate(banhji.index.companyInf().institute.locale),
				locale 	: banhji.index.companyInf().institute.locale,
				segment : null,
				contact : banhji.vendors.get('current') !== null ? banhji.vendors.get('current'): null
			});
		},
		removeEntry : function(e) {
			for(var i = 0; i < banhji.cashiers.transfer.entries.length; i++) {
				if(banhji.cashiers.transfer.entries[i] === e.data) {
					banhji.cashiers.transfer.entries.splice(i,1);
					break;
				}
			}
		},
		save 		: function() {
			var entries = [];
			var amount = 0;
			for(var i = 0; i<banhji.cashiers.transfer.entries.length; i++) {
				amount += kendo.parseFloat(banhji.cashiers.transfer.entries[i].amount);
			}
			banhji.cashiers.transfer.get('from').set('memo', banhji.cashiers.transfer.get('current').memo);
			banhji.cashiers.transfer.get('from').set('amount', amount);
			entries.push(banhji.cashiers.transfer.get('from'));
			entries.push(banhji.cashiers.transfer.entries);
			banhji.cashiers.transfer.get('current').set('entries', entries);
			if(entries.length > 1) {
				banhji.cashiers.transfer.entry.save()
				.then(function(data){
					banhji.cashier.transfer.addJournal();
					banhji.cashier.transfer.set('entries', []);
				});
			}
		}
	});
	banhji.cashiers.page = kendo.observable({
		people 		: banhji.people,
		key 		: "",
		deposit 	: banhji.cashiers.deposit,
		transfer 	: banhji.cashiers.transfer,
		vendors 	: banhji.vendorPmt,
		customers 	: banhji.cashier,
		show 		: function() {
			if(this.get('current')) {
				return true;
			} else {
				return false;
			}
		},
		// deposit 	: function() {
		// 	banhji.router.navigate('/cashier/u/deposit');
		// },
		// transfer 	: function() {
		// 	banhji.router.navigate('/cashier/u/transfer');
		// },
		vendor  	: function() {
			banhji.router.navigate('/payment/vendor');
		},
		customer 	: function() {
			banhji.router.navigate('/cashiers');
			//location.href = 'https://rith.local/banhji/app/?entity=db_banhji#/cashiers';
		},
		onSelected 	: function(e) {
			this.set('current', e.data);
			// console.log(e.data.type.parent_type);
			if(this.get('current').type.parent_type === "2") {
				$("#cashier-payment-id").siblings().removeClass('active');
				$("#cashier-payment-id").addClass('active');
				$("#tab1-2").siblings().removeClass('active');
				$("#tab1-2").addClass('active');
				this.vendors.vendor.query({
					filter: {field: 'id', operator: '', value: e.data.id},
					page: 1, 
					pageSize: 1
				}).then(function(e){
					if(banhji.vendorPmt.vendor.data().length > 0) {
						banhji.cashiers.page.set('show', true);
						// banhji.vendorPmt.set('currentV', banhji.vendorPmt.vendor.data()[0]);
						banhji.vendorPmt.billDS.query({
							filter: [
								{field: 'type', operator: 'where_not_in', value: 'po, grn'},
								{field: 'vendor_id', operator: '', value: banhji.cashiers.page.get('current').id},
								{field: 'status <>', operator: '', value: 'closed'}
							],
							page: 1,
							pageSize: 100
						}).then(function(e){
							banhji.vendorPmt.set('tmp', []);
							var data = banhji.vendorPmt.billDS.data();
							$.each(data, function(i, v){
								banhji.vendorPmt.get('tmp').push({
									isPaid: false,
									due : v.due_date,
									vendor: {id: v.vendor.id, company: v.vendor.company},
									invoice: v.invoice_number,
									amountBilled: v.amount,
									paid: v.paid,
									amount: v.amount - v.paid,
									bill: {id: v.id},
									type: v.type
								});
							});
							banhji.vendorPmt.calcTotal();
							var today = new Date();
							banhji.vendorPmt.payments.query({
								filter: 
									{field: 'contact_id', value: banhji.vendorPmt.vendor.data()[0].id}
								,
								page: 1,
								pageSize: 100
							}).then(function(e){
								// console.log(banhji.vendorPmt.payments.data());
								var data = banhji.vendorPmt.payments.data();
								var invNumber = 0, invAmount = 0;
								banhji.vendorPmt.set('tInvToday', data[0].meta.num);
								banhji.vendorPmt.set('tAmtToday', data[0].meta.todayAmount);
							});				
						});
					} else {
						banhji.cashiers.page.set('show', false);
					}				
				});
			} else {
				$("#cashier-receipt-id").siblings().removeClass('active');
				$("#cashier-receipt-id").addClass('active');
				$("#tab2-2").siblings().removeClass('active');
				$("#tab2-2").addClass('active');
				var vm = banhji.cashier;
				//vm.pageLoad(this.get('current').id);
				vm.loadInvoice(this.get('current').id, this.get('current').name);
				
				if(banhji.pageLoaded["cashier_rith"]==undefined){
					banhji.pageLoaded["cashier_rith"] = true;					          

			        $("#ddlCashAccount").kendoDropDownList({
			            optionLabel: "(--- ជ្រើសរើស ---)",
			            valuePrimitive: true,
			            dataTextField: "name",
			            dataValueField: "id",
			            dataSource: {
			                transport: {
								read: {
									url: baseUrl + "accounts",
									headers: {
										"Entity": getDB()
									},
									type: "GET",
									dataType: "json"
								}
							},
							schema 	: {
								model: {
									id: 'id'
								},
								data: 'results',
								total: 'count'
							},
							serverFiltering: true,
							filter: { field:"account_type_id", value: 6 }
						},
						template: '#=code# #=name#'             
			        }).data("kendoDropDownList");

			        var validator = $("#saveCashierCustomerValidate").kendoValidator().data("kendoValidator");
					var notification = $("#notification").kendoNotification({				    
					    autoHideAfter: 5000,
					    width: 300,				    
					    height: 50
					}).data('kendoNotification');

			        $("#saveCashierCustomer").click(function(e){				
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();

			            	notification.success("Data is successfully recorded.");			  
				        }else{
				        	notification.error("Please check your input again. Make sure you fill the required field(s)");			           
				        }	            
					});       		
				}
			}
		},
		findVendor  : function() {
			if(this.get('key') !== "") {
				this.people.dataSource.filter({field: 'id', operator: '', value: this.get('key')});	
			} else {
				this.people.dataSource.filter({field: 'id <>', operator: '', value: ''});
			}
		}
	});
	banhji.accountingSetting = kendo.observable({
		transactionItem 	: banhji.accountingItem,
		segments 			: banhji.segment,
		currencies 			: banhji.currency,
		entries 			: banhji.journalEntry,
		incomeGraphDS 		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounts/netIncome',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count',
				parse: function(response) {
					for(var i =0; i < response.results.length; i++) {
						switch(response.results[i].month) {
							case "January":
								response.results[i].month = 'January';
							break;
							case "February":
								response.results[i].month = 'February';
							break;
							case "March":
								response.results[i].month = 'March';
							break;
							case "April":
								response.results[i].month = 'April';
							break;
							case "May":
								response.results[i].month = 'May';
							break;
							case "June":
								response.results[i].month = 'June';
							break;
							case "July":
								response.results[i].month = 'July';
							break;
							case "August":
								response.results[i].month = 'August';
							break;
							case "September":
								response.results[i].month = 'September';
							break;
							case "October":
								response.results[i].month = 'October';
							break;
							case "November":
								response.results[i].month = 'November';
							break;
							default:
								response.results[i].month = 'December';
						}
					}
					return response;
				}
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true
		}),
		creditSaleDS 		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounts/creditSale',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			change: function(e) {
				var data = this.data();
				var amount = 0.00;
				if(data.length > 0) {
					amount = data[0].amount;
				}
				banhji.accountingSetting.set('creditSaleAmount', amount);
			}
		}),
		inst 	 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'banhji/company',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + 'banhji/company',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'banhji/company',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + 'banhji/company',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			filter: {field: 'id', operator: '', value: banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institute[0].id:""}
			// pageSize: 100
		}),
		dateFrom 			: new Date(),
		dateTo 				: new Date(),
		onDateChange 		: function() {
			if(this.get('dateTo') < this.get('dateFrom')) {
				this.set('dateTo', this.get('dateFrom'));
			}
		},
		recurring 			: banhji.recurring,
		back 				: function() {
			window.history.back(-1);
		},
		trialBalance 		: banhji.trialBalance,
		balanceSheet 		: banhji.balanceSheet,
		income 				: banhji.incomeVM,
		expense 			: banhji.expenseVM,
		currentInstitute 	: null,
		creditSaleAmount 	: 0.00,
		getGraph 			: function() {
			var data = {income: this.income.get('amount'), expense: this.expense.get('amount'), net: this.income.get('amount') - this.expense.get('amount')};
			$("#account-dash-graph").kendoChart({
                autoBind: false,
                dataSource: this.incomeGraphDS,
                title: {
                    text: "របាយការណ៍លទ្ធផល"
                },
                legend: {
                    position: "top"
                },
                series: [{
                    type: "column",
                    field: "income",
                    name: "ចំណូល",
                    color: "#00008e"
                }, {
                    type: "column",
                    field: "expense",
                    name: "ចំណាយ",
                    color: "#c00000"
                }, {
                    type: "line",
                    field: "net",
                    name: "ចំណេញ",
                    color: "#ff7f00"
                }],
                valueAxis: {
                    label: {
                    	format: "N0"
                    },
                    majorUnit: 100
                },
                categoryAxis: {
                    field: "month",
                    crosshair: {
                    	visible: true
                    }
                },
                tooltip: {
                	visible: true,
                	shared: false,
                	format: "N0"
                }
            });
		},
		searchByDate: function() {
			if(this.get('dateTo') >= this.get('dateFrom')) {
				banhji.balanceSheet.assetDS.filter({
					field: 'created_at',
					value: kendo.toString(banhji.accountingSetting.dateTo, 'yyyy-MM-dd')
				});
				banhji.balanceSheet.liabilityDS.filter({
					field: 'created_at',
					value: kendo.toString(banhji.accountingSetting.dateTo, 'yyyy-MM-dd')
				});
				banhji.incomeVM.dataSource.filter([
					{field: 'created_at >=',
					value: kendo.toString(banhji.accountingSetting.dateFrom, 'yyyy-MM-dd')},
					{field: 'created_at <=',
					value: kendo.toString(banhji.accountingSetting.dateTo, 'yyyy-MM-dd')}
				]);
				banhji.expenseVM.dataSource.filter([
					{field: 'created_at >=',
					value: kendo.toString(banhji.accountingSetting.dateFrom, 'yyyy-MM-dd')},
					{field: 'created_at <=',
					value: kendo.toString(banhji.accountingSetting.dateTo, 'yyyy-MM-dd')}
				]);
				banhji.accountingSetting.creditSaleDS.filter([
					{field: 'created_at >=',
					value: kendo.toString(banhji.accountingSetting.dateFrom, 'yyyy-MM-dd')},
					{field: 'created_at <=',
					value: kendo.toString(banhji.accountingSetting.dateTo, 'yyyy-MM-dd')}
				]);
				this.incomeGraphDS.filter([
					{field: 'created_at >=',
					value: kendo.toString(banhji.accountingSetting.dateFrom, 'yyyy-MM-dd')},
					{field: 'created_at <=',
					value: kendo.toString(banhji.accountingSetting.dateTo, 'yyyy-MM-dd')}
				]);
				this.getGraph();
				this.getROCE();
				this.getGPM();
				this.getNPM();
				this.getAssetTurnOver();
				this.getARCP();
				this.getInventoryTurnOver();
				this.getNumberSeven();
			} else {
				this.set('dateTo', this.get('dateFrom'));
			}				
		},
		getROCE 			: function() {
			var amount = 0.00;
			var PBIT = this.balanceSheet.get('receivableAmt') - this.expense.get('operatingExp');
			var x = this.balanceSheet.get('totalAsset') - this.balanceSheet.get('xLiabilityAmt');
			if(x > 0) {
				amount = PBIT/x;
			}
			return amount;
		},
		getARCP 			: function() {
			var amount = 0;
			var numberOfDays = (this.get('dateTo')-this.get('dateFrom'))/1000/60/60/24;
			if(this.get('creditSaleAmount') > 0) {
				amount = Math.floor((this.balanceSheet.get('receivableAmt')/this.get('creditSaleAmount'))*(numberOfDays+1));
			}
			return amount;
		},
		getInventoryTurnOver: function() {
			var amount = 0;
			var numberOfDays = (this.get('dateTo')-this.get('dateFrom'))/1000/60/60/24;
			if(this.expense.get('cogsAmt') > 0) {
				amount = math.floor((this.balanceSheet.get('inventoryAmt')/this.expense.get('cogsAmt'))*(numberOfDays+1));
			}
			return amount;
		},
		getNumberSeven 		: function() {
			var amount = 0;
			var numberOfDays = (this.get('dateTo')-this.get('dateFrom'))/1000/60/60/24;
			if(this.expense.get('cogsAmt') > 0) {
				amount = math.floor((this.balanceSheet.get('payableAmt')/this.expense.get('amount'))*(numberOfDays+1));
			}
			return amount;
		},
		getGPM 				: function() {
			var amount = 0;
			var grossProfit = this.expense.get('receivableAmt')-this.expense.get('cogsAmt');

			if(this.balanceSheet.get('receivableAmt') > 0) {
				amount = grossProfit/this.expense.get('receivableAmt');
			}
			return amount;
		},
		getAssetTurnOver 	: function() {
			var amount = 0.00;
			var x = this.balanceSheet.get('totalAsset') - this.balanceSheet.get('xLiabilityAmt');
			if(x > 0) {
				amount = this.balanceSheet.get('receivableAmt')/x;
			}
			return amount;
		},
		getNPM 				: function() {
			var amount = 0;
			var netProfit = this.income.get('amount') - this.expense.get('amount');

			if(this.expense.get('receivableAmt') > 0) {
				amount = netProfit/this.expense.get('receivableAmt');
			}
			return amount;
		},
		editable 			: function() {
			var status = false;
			if(this.get('currentInstitute').financial_year === null) {
				status = true;
			}
			return status;
		},
		transactionOccurred : 0.00,
		getJournalCount 	: function() {
			var todayDate = new Date();
			var month = kendo.toString(todayDate, 'MM');
			var year = kendo.toString(todayDate, 'yyyy');
			banhji.journalEntry.dataStore.query({
				filter: [
					{field: 'created_at >=', operator: '', value: year+'-' + month + '-01'},
					{field: 'created_at <=', operator: '', value: kendo.toString(todayDate, 'yyyy-MM-dd')}
				],
				page: 1,
				pageSize: 100
			}).done(function(e){
				banhji.accountingSetting.set('transactionOccurred', banhji.journalEntry.dataStore.total());
			});
		},
		saveFinacialDate 	: function() {
			this.inst.sync();
		}
	});	

	// dataSource
	banhji.item = {};
	banhji.itemDS = new kendo.data.DataSource({
		transport: {
			read: {
				url: baseUrl + 'items/item',
				type: "GET",
				dataType: "json"
			},
			create: {
				url: baseUrl + 'items/item',
				type: "POST",
				dataType: "json"
			},
			update: {
				url: baseUrl + 'items/item',
				type: "PUT",
				dataType: "json"
			},
			destroy: {
				url: baseUrl + 'items/item',
				type: "DELETE",
				dataType: "json"
			},
			parameterMap: function(options, operation) {
				if(operation === 'read') {
					return {
						limit: options.take,
						page: options.page,
						filter: options.filter
					};
				} else {
					return {models: kendo.stringify(options.models)};
				}
			}
		},
		schema 	: {
			model: {
				id: 'id'
			},
			data: 'results',
			total: 'count'
		},
		batch: true,
		serverFiltering: true,
		serverPaging: true,
		pageSize: 100
	});
	// ------ end of dataSource
	banhji.item.record = kendo.observable({
		ds 		: dataStore(baseUrl + "records"),
		takeIn 	: function(data) {
			banhji.item.record.ds.add(data);
		},
		takeOut : function() {
			banhji.item.record.ds.add(data);
		},
		save 	: function() {
			var dfd = $.Deferred();
			banhji.item.record.ds.sync();
			banhji.item.record.ds.bind('requestEnd', function(e) {
				var res = e.response.results;
				if( res ) {
					dfd.resolve({error: false, data: res});
				} else {
					dfd.reject({error: true, data: [], msg: 'error: could not record item to stock.'});
				}
			});
			dfd.promise();
		}
	});
	banhji.payment 	= kendo.observable({
		DS 	: dataStore(baseUrl+'payments/payment'),
		findByBill 	: function(billId) {
			this.DS.filter([
				{field: 'reference_id', operator: '', value: billId },
				{field: 'type', operator: '', value: 'bill' }
			]);
		},
		remove 		: function(data) {
			this.DS.remove(data);
		},
		addNew 		: function(data) {
			this.DS.add({
					amount: data.amount, 
					discount: data.discount, 
					cashier: data.cashier,
					contact: data.contact,
					fine: 0.00, 
					payment_date: new Date(), 
					reference: data.reference, 
					type:'bill', 
					locale: 'km-KH',
					rate: 1,
				});	
		},
		memo 		: "",
		cashAccount : 1,
		close 		: function() {
			this.DS.cancelChanges();
			this.DS.data([]);
			banhji.bill.get('bllToPayList').splice(0, banhji.bill.get('bllToPayList').length);
			var billPlaceholder = new kendo.View("#bill-list-container-tmpl", {model:banhji.bill});
			banhji.view.vendorDash.showIn("#dashboard-container", billPlaceholder);
		},
		save 		: function() {
			var that = this, dfd = $.Deferred();
			this.DS.sync();
			this.DS.bind("requestEnd", function(e){
				var type = e.type;
				var res  = e.response.results;
				if(res) {
					dfd.resolve({type: type, data: res});
				} else {
					dfd.reject({error: true, msg: "problem with api call"});
				}
				return dfd.promise();
			});
		}
	});
	banhji.bill = kendo.observable({
		dataSource 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "bills",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				create 	: {
					url: baseUrl + "bills",
					type: "POST",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + "bills",
					type: "PUT",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				destroy : {
					url: baseUrl + "bills",
					type: "DELETE",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			page: 1,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		payment 	: banhji.payment,
		vendor 		: function() {
			var vendor = null;
			if(banhji.vendors.get('current')){
				vendor = banhji.vendors.get('current');
			} else {
				//
			}
			return vendor;
		},
		addNew 		: function() {

		},
		paymentArr 	: [],
		cashAccount : 1,
		accountVM 	: banhji.account,
		from 		: new Date(),
		to 			: new Date(),
		paidByCash 	: true,
		dateSort 	: function(e) {
			var selected = e.sender.selectedIndex;
			if(selected === 1) {
				this.set('from', new Date());
				this.set('to', new Date());
			} else if(selected === 2) {
				var date = new Date();
				var first= date.getDate() - date.getDay();
				var last = first + 6;
				var firstDayOfTheWeek = new Date(date.setDate(first));
				var lastDayOfTheWeek = new Date(date.setDate(last));
				this.set('from', firstDayOfTheWeek);
				this.set('to', lastDayOfTheWeek);
			} else if(selected === 3) {
				var date = new Date();
				var firstDayOfMonth = new Date(date.getFullYear(), date.getMonth(), 1);
				var lastDayOfMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0);
				this.set('from', firstDayOfMonth);
				this.set('to', lastDayOfMonth);
			} else if(selected === 4) {
				var date = new Date();
			  	var firstDayOfYear = new Date(date.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(date.getFullYear(), 11, 31);
				this.set('from', firstDayOfYear);
				this.set('to', lastDayOfYear);
			}
		},
		dateList 	: [
			{id: 1, name: 'Today'},
			{id: 2, name: 'This Week'},
			{id: 3, name: 'This Month'},
			{id: 4, name: 'This Year'}
		],
		all 		: function() {
			this.dataSource.filter(
				{field: "deleted", operator: "", value: 'false'}
			);
		},
		closed 		: function() {
			this.dataSource.filter([
				{field: "deleted", operator: "", value: 'false'},
				{field: "status =", operator: "and", value: 'closed'}
			]);
		},
		open 		: function() {
			this.dataSource.filter([
				{field: "deleted", operator: "", value: 'false'},
				{field: "status !=", operator: "and", value: 'closed'}
			]);
		},
		getCashAccount: function() {
			this.accountVM.dataStore.filter({field: 'account_type_id', operator:'', value: '6'});
		},
		close 		: function() {
			window.history.back(-1);
		},
		setCurrent 	: function(currentBill) {
			this.set('current', currentBill);
		},
		getDetail: function(e) {
			this.setCurrent(e.data);
			banhji.payment.DS.filter([
				{field: 'reference_id', value: e.data.id},
				{field: 'type', value: 'bill'}
			]);
			
		},
		removePmt 	: function(e) {
			this.payment.remove(e.data);
			// console.log("remove payment");
		},
		selectBill	: function(e) {
			var checked = $(e.target).is(':checked');
			if(checked === true) {
				$('.billCheckbox').prop('checked', true);
				for(var i = 0; i < $('.billCheckbox').length; i++) {
					banhji.payment.addNew(e.data.dataSource.data()[i]);						
				}
			} else {
				$('.billCheckbox').prop('checked', false);
				for(var i = 0; i < $('.billCheckbox').length; i++) {
					// banhji.payment.DS.remove(e.data.dataSource.data()[i]);
					var model = banhji.payment.DS.at(i);
					banhji.payment.DS.remove(model);
					console.log(model);
				}	
			}
		},
		singleBillSelect: function(e) {
			if(e.data.makePayment === true) {
				e.data.set('amount', e.data.reference.amount - e.data.reference.paid);
			}
			
		},
		payCommute 	: function(e) {
			// $(e.target).prop('checked', false);
			if(e.data.amount === 0) {
				e.data.set("makePayment", false);
			} else {
				e.data.set("makePayment", true);
			}
		},
		payThoseBills:function() {
			var that = this;
			if(this.get('paymentArr').length > 0) {
				$.each(this.get('paymentArr'), function(i, v){
					if(v.makePayment === true) {
						that.payment.addNew(v);
					}					
				});
				$("#payBillBtn").html("Recording...");
			} else {
				$("#payBillBtn").html("Done");
			}
			that.payment.DS.sync();
			that.payment.DS.bind('requestEnd', function(e){
				var res = e.response.results;
				if(res) {
					
					$.each(res, function(i, v){
						var ap = null, discount = null;
						var entries= [];
						var contact = banhji.vendors.dataSource.get(v.contact.id);
						if(!banhji.vendors.dataSource.get(v.contact.id)) {
							banhji.vendors.dataSource.filter({field: 'id', value: v.contact.id});
						}
						var contact = banhji.vendors.dataSource.get(v.contact.id);
						entries.push(
							{
								account : contact.ap.id,
								contact : v.contact,
								amount 	: v.amount,
								memo   	: that.payment.get('memo'),
								rate 	: banhji.currency.getRate(banhji.index.companyInf().institute.locale),
								locale 	: banhji.index.companyInf().institute.locale,
								is_debit: true
							},
							{
								account : that.get('cashAccount'),
								contact : v.contact,
								amount 	: v.amount - v.discount,
								memo   	: that.payment.get('memo'),
								rate 	: banhji.currency.getRate(banhji.index.companyInf().institute.locale),
								locale 	: banhji.index.companyInf().institute.locale,
								is_debit: false
							}
						);
						if(v.discount > 0) {
							entries.push({
								account : contact.purchaseDiscount.id,
								contact : v.contact,
								amount 	: v.discount,
								memo   	: that.payment.get('memo'),
								rate 	: 1.0000000,
								locale 	: 'km-KH',
								is_debit: false
							});
						}
						banhji.journalEntry.dataStore.add({
							reference 	: v.reference,
							memo 		: that.payment.get('memo'),
							type 		: "pmt",
							deleted 	: false,
							entries 	: entries
						});
					});
					banhji.journalEntry.save().then(
						function(res){
							banhji.vendors.getBills();
							$("#payBillBtn").html("Recording...");
						},
						function(error) {
							$("#payBillBtn").html("Paid");
						}
					);	
				} else {
					$("#payBillBtn").html("Paid");
				}
			});	
		}, 
		billItemDS 	: dataStore(baseUrl + 'bills/items'),
		NumOfPO 	: 0,
		NumOfBill	: 0,
		NumOfBillO	: 0,
		amount 		: 0,
		amountOwed 	: 0,
		addItemToBill: function() {
			this.billItemDS.add({item:{id:null, name:null}, bill:{id: null, amount: null}});
		},
		getOpenBills: function(){
			var that = this;
			this.dataSource.filter([
					{field: 'status !=', operator:'', value: 'closed'},
					{field: 'type !=', operator:'', value: 'grn'},
					{field: 'deleted', operator: '', value: 'false'}
			]);
			this.dataSource.bind('requestEnd', function(e){
				if(e.response.meta) {
					that.set('NumOfPO', e.response.meta.po);
					that.set('NumOfBillO', e.response.meta.invO);
					that.set('NumOfBill', e.response.meta.inv);
					that.set('amountOwed', e.response.meta.balance);
				}
			});
		},
		getOpenPO 	: function(e){
			// console.log(e.data.current.id);
			if(banhji.vendors.get('current')) {
				e.data.billVM.dataSource.filter([
					{field: 'type', operator: '', value: 'po'},
					{field: 'status !=', operator: '', value: 'closed'},
					{field: 'deleted', operator: '', value: 'false'},
					{field: 'vendor', operator: '', value: banhji.vendors.get('current').id}
				]);
			} else {
				e.data.billVM.dataSource.filter([
					{field: 'type', operator: '', value: 'po'},
					{field: 'status !=', operator: '', value: 'closed'},
					{field: 'deleted', operator: '', value: 'false'}
				]);
			}
		},
		getOpenInv	: function(e) {
			if(e.data.current.id) {
				e.data.billVM.dataSource.filter([
					{field: 'type', value: 'purchase'},
					{field: 'type', operator: '', value: 'expense'},
					{field: 'status !=', value: 'closed'},
					{field: 'deleted', value: 'false'},
					{field: 'vendor', value: e.data.current.id}
				]);
			} else {
				e.data.billVM.dataSource.filter([
					{field: 'type', value: 'purchase'},
					{field: 'type', operator: '', value: 'expense'},
					{field: 'status !=', value: 'closed'},
					{field: 'deleted', value: 'false'}
				]);
			}
		},
		getOpenInvO	: function(e) {
			var today = new Date();
			var month = today.getMonth() + 1;
			var day = today.getDate() + 1;
			var d = today.getFullYear()+'-'+month+'-'+day;
			if(banhji.vendors.get('current')) {
				e.data.billVM.dataSource.filter([
					{field: 'type !=', operator: '', value: 'po'},
					{field: 'type !=', operator: '', value: 'grn'},
					{field: 'status !=', operator: '', value: 'closed'},
					{field: 'deleted', operator: '', value: 'false'},
					{field: 'due_date <=', operator: '', value: d},
					{field: 'vendor', operator: '', value: banhji.vendors.get('current').id}
				]);
			} else {
				e.data.billVM.dataSource.filter([
					{field: 'type !=', operator: '', value: 'po'},
					{field: 'type !=', operator: '', value: 'grn'},
					{field: 'status !=', operator: '', value: 'closed'},
					{field: 'deleted', operator: '', value: 'false'},
					{field: 'due_date <=', operator: '', value: d},
				]);
			}
		},
		unPaidByVendorId: function(id) {
			var that = this;
			this.dataSource.filter([
					{field: 'status !=', operator: '', value: 'closed'},
					{field: 'type !=', operator: '', value: 'grn'},
					{field: 'deleted', operator: '', value: 'false'},
					{field: 'vendor_id', operator: '', value: id}
			]);
			this.dataSource.bind('requestEnd', function(e){
				var data = e.response.results;
				var po = 0;
				var inv= 0;
				var invO=0;
				var amount = 0;
				var today = new Date();
				// if(data){
				// 	$.each(data, function(i, v){
				// 		if(v.type === 'po') {
				// 			po++;
				// 		} else if(v.type === 'expense' || v.type === 'purchase') {
				// 			var due = new Date(v.due_date);
				// 			if(today.getTime() >= due.getTime()) {
				// 				invO++;
				// 			} 
				// 			inv++;							
				// 		}
				// 		amount = amount + v.balance;
				// 	});
				// } else {
				// 	that.dataSource.data([]);
				// }
				if(e.response.meta) {
					po = e.response.meta.po;
					invO = e.response.meta.invO;
					inv = e.response.meta.inv;
					amount = e.response.meta.balance;
				}
				that.set('NumOfPO', po);
				that.set('NumOfBillO', invO);
				that.set('NumOfBill', inv);
				that.set('amountOwed', amount);
			});
		},
		searchBill 	: function() {
			this.dataSource.filter([
				{field: 'created_at >=', value: kendo.toString(this.get('from'), 'dd-MM-yyyy')},
				{field: 'created_at <=', value: kendo.toString(this.get('to'), 'dd-MM-yyyy')}
			]);
			banhji.bill.get('paymentArr').splice(0,banhji.bill.get('paymentArr').length);
			banhji.bill.dataSource.query({
				filter:[
					{field: 'created_at >=', value: kendo.toString(this.get('from'), 'dd-MM-yyyy')},
					{field: 'created_at <=', value: kendo.toString(this.get('to'), 'dd-MM-yyyy')}
				],
				page: 1,
				skip: 0
			}).then(function(e){
				var data = banhji.vendors.billVM.dataSource.data();
				var date = new Date();
				var today = new Date(date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate());
				$.each(data, function(i, v){
					var discount = 0;
					var due = new Date(v.due_date);
					var overdue = new Date(due.getFullYear()+"-"+due.getMonth()+"-"+due.getDate());
					if(overdue.getTime() >= today.getTime()) {
						discount = (v.amount - v.paid)*(v.payment_term.discount_percentage/100);
					}
					banhji.bill.get('paymentArr').push({
						makePayment: false,
						amount: v.amount - v.paid, 
						discount: discount, 
						cashier: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
						vendor: v.vendor,
						fine: 0.00, 
						payment_date: new Date(), 
						reference: v, 
						type:'bill', 
						locale: 'km-KH',
						rate: 1,
					});
				});

			});
		},
		save 		: function() {
			var dfd = $.Deferred();
			this.dataSource.sync();
			this.dataSource.bind('requestEnd', function(e){
				var results = e.response.results;
				if(results) {
					dfd.resolve(results);
				} else {
					dfd.reject({error: "Error recording", msg: "Please review"});
				}
			});
			return dfd.promise();
		}
	});
	banhji.vendors = kendo.observable({
		dataSource 	: dataStore(baseUrl + "vendors"),
		billVM 		: banhji.bill,
		billDS 		: dataStore(baseUrl + 'bills'),
		vendorBills : dataStore(baseUrl + "vendors/bills"),
		vendorPhones: dataStore(baseUrl + "vendors/phones"),
		accountDS 	: banhji.account,
		currencyDS 	: banhji.currency,
		bankModel 	: banhji.bank,
		apAccount 	: [],
		discountAC 	: [],
		prepaidAC 	: [],
		contactTypes: dataStore(baseUrl + "vendors/types"),
		businessType: dataStore(baseUrl + "businesstypes"),
		paymentTerm : dataStore(baseUrl + "paymentterm"),
		key 		: '',
		phoneTypes	: [
			{type: 'phone', description: 'Mobile'},
			{type: 'mobile', description: 'Phone'}
		],
		poNum 		: 0,
		invNum 		: 0,
		invONum 	: 0,
		dateType: [
			'---',
			'ថ្អៃនេះ',
			'សប្ដាស៍នេះ',
			'ខែនេះ',
			'ឆ្នាំនេះ',
		],
		startDate: new Date(),
		endDate : new Date(),
		loadMap : function(){
			var obj = this.get("current");
			// console.log(obj);
			lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);
			
			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map
					// title: obj.company
				});
			} 
		},
		dateChange: function(e) {
			// var dateSel = $('.dateSelect').kendoDropDownList().data('kendoDropDownList');
			// dateSel.select(0);	
			if(this.get('startDate') > this.get('endDate')) {
				this.set('startDate', new Date);
			}
		},
		dateTypeSelect: function(e){
			var index = e.sender._oldIndex;
			var today = new Date();
			switch(index){
			case 0:
				break;
			case 1:
				this.set('startDate', today);
				this.set('endDate', today);				
			  	break;
			case 2:
				var first = today.getDate() - today.getDay(); 
				var last = first + 6;
				var firstDayOfWeek = new Date(today.setDate(first));
				var lastDayOfWeek = new Date(today.setDate(last));
				this.set('startDate', firstDayOfWeek);
				this.set('endDate', lastDayOfWeek);
			  	break;
			case 3:			  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
				var lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
				this.set('startDate', firstDayOfMonth);
				this.set('endDate', lastDayOfMonth);
			  	break;
			case 4:
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(today.getFullYear(), 11, 31);
				this.set('startDate', firstDayOfYear);
				this.set('endDate', lastDayOfYear);
			  	break;
			default:
				this.set('startDate',today);
				this.set('endDate', today);					  
			}
		},
		filterBill 	: function() {
			if(this.get('current')) {
				this.billDS.filter([
					{field: 'vendor_id', operator: '', value: this.get('current').id},
					{field: 'created_at >=', operator: '', value: kendo.toString(this.get('startDate'), 'yyyy-MM-dd')},
					{field: 'created_at <=', operator: '', value: kendo.toString(this.get('endDate'), 'yyyy-MM-dd')}
				]);
			} else {
				this.billDS.filter([
					{field: 'created_at >=', operator: '', value: kendo.toString(this.get('startDate'), 'yyyy-MM-dd')},
					{field: 'created_at <=', operator: '', value: kendo.toString(this.get('endDate'), 'yyyy-MM-dd')}
				]);
			}
			
			banhji.vendors.billDS.bind('requestEnd', function(e){
				banhji.vendors.set('poNum', e.response.meta.po);
				banhji.vendors.set('invNum', e.response.meta.inv);
				banhji.vendors.set('invONum', e.response.meta.invO);
				// console.log(e.response.meta);
			});
		},
		findVendor 	: function() {
			if(this.get('key') !== '') {
				this.dataSource.query({
					filter: { field: 'id', operator: 'like', value: this.get('key')},
					page: 1,
					pageSize: 1
				}).done(function(e){
					var vendor = banhji.vendors.dataSource.data()[0];
					if(vendor) {
						banhji.vendors.setCurrent(vendor);
					}
				});
			} else {
				this.dataSource.query({
					filter: { field: 'id', operator: 'like', value: this.get('key')},
					page: 1,
					pageSize: 100
				}).done(function(e){
				});
			}
			// console.log(typeof this.get('key'));
		},
		monthlyExpense: 0,
		doNothing 	: function() {
			return false;
		},
		getMonthlyExp: function(contact) {
			if(contact !== undefined) {
				banhji.payment.DS.query({
					filter: [
						{field: 'contact_id', operator: '', value: contact},
						{field: 'created_at >= ', operator: '', value: kendo.toString(this.get('startDate'),'yyyy-MM-dd')},
						{field: 'created_at <= ', operator: '', value: kendo.toString(this.get('endDate'),'yyyy-MM-dd')},
					],
					page: 1,
					pageSize: 600
				}).done(function(e){
					var amount = 0.00;
					var data = banhji.payment.DS.data();
					$.each(data, function(i, v){
						amount += kendo.parseFloat(v.amount);
					});
					banhji.vendors.set('monthlyExpense', kendo.toString(amount, 'c2'));
				});
			} else {
				banhji.payment.DS.query({
					filter: [
						{field: 'created_at >= ', operator: '', value: kendo.toString(this.get('startDate'),'yyyy-MM-dd')},
						{field: 'created_at <= ', operator: '', value: kendo.toString(this.get('endDate'),'yyyy-MM-dd')},
					],
					page: 1,
					pageSize: 600
				}).done(function(e){
					var amount = 0.00;
					var data = banhji.payment.DS.data();
					$.each(data, function(i, v){
						amount += kendo.parseFloat(v.amount);
					});
					banhji.vendors.set('monthlyExpense', kendo.toString(amount, 'c2'));
				});
			}
			// banhji.index.expenseDS.fetch(function(e){
			// 	var data = banhji.index.expenseDS.data();
			// 	var amount = 0;
			// 	banhji.index.set('expense', 0);
			// 	$.each(data, function(index, value) {
			// 		amount += kendo.parseFloat(value.amount);
			// 	});	
			// 	banhji.vendors.set('monthlyExpense', kendo.toString(amount, 'c2'));
			// });
		},
		show 		: false,
		selectModal : function() {
			var dfd = $.Deferred();
			$('body').append("<div id='vendorModal'><div id='vendorModalInner'></div></div>");
			var modal = $("#vendorModal").kendoWindow({
				title: "បញ្ជីអ្នកផ្គត់ផ្គង់",
				modal: true,
				width: 300,
				height: 400,
				// visible: false,
				open: function(e) {
					var grid = $("#vendorModalInner").kendoGrid({
						dataSource: banhji.vendors.dataSource,
						columns: [{field: 'company', title: 'Company'}],
						selectable: true,
						scrollable: true,
						height: "380px"
					}).data("kendoGrid");
					grid.bind('change', function(e){
						var selected = this.select();
						var model = this.dataItem(selected);
						banhji.vendors.setCurrent(model);
						banhji.vm.get('current').set('vendor', model);
						dfd.resolve(true);
					});
				}
			}).data('kendoWindow');
			modal.center();
			modal.bind('close', function(e){
				modal.destroy();
			});
			return dfd.promise();
		},
		isEdit 		: false,
		close 		: function() {
			this.dataSource.cancelChanges();
			this.vendorPhones.cancelChanges();
			window.history.back(-1);
		},
		paymentOptions: dataStore(baseUrl + "vendors/paymentMethods"),
		paidByBank 	: false,
		paidByCheck : false,
		getBills 	: function() {
			banhji.bill.get('paymentArr').splice(0,banhji.bill.get('paymentArr').length);
			var filter;
			if(this.get('current')) {
				filter = [
					{field: 'type !=', operator: '', value: 'po'},
					{field: 'type !=', operator: '', value: 'grn'},
					{field: 'deleted', operator: 'and', value: 'false'},
					{field: 'status !=', operator: '', value: 'closed'},
					{field: 'vendor', operator: '', value: this.get('current').id}
				];
			} else {
				filter = [
					{field: 'type !=', operator: '', value: 'po'},
					{field: 'type !=', operator: '', value: 'grn'},
					{field: 'deleted', operator: 'and', value: 'false'},
					{field: 'status !=', operator: '', value: 'closed'}
				];
			}
			this.billVM.dataSource.query({
				filter:filter,
				page: 1,
				skip: 0
			}).then(function(e){
				var data = banhji.vendors.billVM.dataSource.data();
				var date = new Date();
				var today = new Date(date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate());
				$.each(data, function(i, v){
					var discount = 0;
					var due = new Date(v.due_date);
					var overdue = new Date(due.getFullYear()+"-"+due.getMonth()+"-"+due.getDate());
					if(overdue.getTime() >= today.getTime()) {
						discount = (v.amount - v.paid)*(v.payment_term.discount_percentage/100);
					}
					banhji.bill.get('paymentArr').push({
						makePayment: false,
						amount: v.amount - v.paid, 
						discount: discount, 
						cashier: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
						vendor: v.vendor,
						fine: 0.00, 
						payment_date: new Date(), 
						reference: v, 
						type:'bill', 
						locale: 'km-KH',
						rate: 1,
					});
				});
			});
			// var billPlaceholder = new kendo.View("#bill-list-container-tmpl", {model:banhji.bill});

			// if(banhji.vendors.get('current')){
				// banhji.view.vendor.showIn("#vendor-container-tmpl", billPlaceholder);
			// } //else {	
			// 	banhji.view.vendorDash.showIn("#dashboard-container", billPlaceholder);
			// }
		},
		selectBill	: function() {
			alert("select All");
		},
		pays 		: function(e) {
			// var bal = e.data.balance;
			// e.data.set('balance', bal - );
			console.log(e.data);
		},
		departments  : [{department: "sales", description: "Sale"},{department: "finance", description: "Cashier"}],
		selectPaymentOption: function(e) {
			if(this.get('current').payment_main === null && this.get('current').payment_second === null) {
				this.set('paidByBank', false);
				this.set('paidByCheck', false);
			} else if(this.get('current').payment_main !== null && this.get('current').payment_second === null) {
				if(this.get('current').payment_main.id ===3) {
					this.set('paidByBank', true);
					this.set('paidByCheck', false);
				} else if(this.get('current').payment_main.id ===2) {
					this.set('paidByBank', false);
					this.set('paidByCheck', true);
				} else {
					this.set('paidByBank', false);
					this.set('paidByCheck', false);
				}
			} else if(this.get('current').payment_main === null && this.get('current').payment_second !== null) {
				if(this.get('current').payment_second.id ===3) {
					this.set('paidByBank', true);
					this.set('paidByCheck', false);
				} else if(this.get('current').payment_second.id ===2) {
					this.set('paidByBank', false);
					this.set('paidByCheck', true);
				} else {
					this.set('paidByBank', false);
					this.set('paidByCheck', false);
				}
			} else if(this.get('current').payment_main !== null && this.get('current').payment_second !== null) {
				if(this.get('current').payment_main.id ===3 && this.get('current').payment_second.id ===1) {
					this.set('paidByBank', true);
					this.set('paidByCheck', false);
				} else if(this.get('current').payment_main.id ===3 && this.get('current').payment_second.id ===2) {
					this.set('paidByBank', true);
					this.set('paidByCheck', true);
				} else if(this.get('current').payment_main.id ===2 && this.get('current').payment_second.id ===3) {
					this.set('paidByBank', true);
					this.set('paidByCheck', true);
				} else if(this.get('current').payment_main.id ===1 && this.get('current').payment_second.id ===2) {
					this.set('paidByBank', false);
					this.set('paidByCheck', true);
				}  else if(this.get('current').payment_main.id ===1 && this.get('current').payment_second.id ===3) {
					this.set('paidByBank', true);
					this.set('paidByCheck', false);
				} else if(this.get('current').payment_main.id ===2 && this.get('current').payment_second.id ===1) {
					this.set('paidByBank', false);
					this.set('paidByCheck', true);
				} else if(this.get('current').payment_main.id ===2 && this.get('current').payment_second.id ===3) {
					this.set('paidByBank', true);
					this.set('paidByCheck', true);
				}
				console.log('all is not null');
			}
			// console.log(this.get('current').payment_main);
		},
		addPhone 	: function() {
			if(this.get('current').id) {
				this.get('vendorPhones').add({
					contact_id: this.get('current').id, phone: null, type: "phone", department: 'sales'
				});
			} else {
				this.get('vendorPhones').add({contact_id: null, phone: null, type: "phone", department: 'sales'});
			}	
		},
		addNew 		: function() {
			this.get('dataSource').insert(0,{ 
				currency: {id: 1, code: 'USD'},
				company: null,
				company_en: null,
				type: null,
				bank: null,
				bank_account_number: null,
				bank_account_name: null,
				phone: null,
				email: null,
				website: null,
				is_local: true,
				name_on_cheque: null,
				address: null,
				business_type: null,
				vat_no: null,
				bank_address: null,
				ap: null,
				prepaid: null,
				purchaseDiscount: null,
				latitute: 0.00000,
				longtitute: 0.0000000,
				credit_limit: null,
				payment_term: null,
				payment_main: null,
				payment_second: null
			});
		},
		remove 		: function() {
			if(this.get('current')) {
				this.dataSource.remove(this.get('current'));
				this.save();
			}
		},
		removePmt 	: function() {
			console.log('sdkjflds');
		},
		removePhone : function(e) {
			var data = e.data;
			this.get('vendorPhones').remove(data);
		},
		search 		: function() {
			if(this.get('key')) {
				this.get('dataSource').filter([
					{field: 'id', operator: '', value: this.get('key')},
					{field: 'company', operator: 'or', value: this.get('key')}
				]);
			} else {
				this.get('dataSource').read();
			}
		},
		onVendorFocus: function() {
			banhji.router.navigate('/vendors/u/list');
		},
		onAccountFocus: function () {
			banhji.router.navigate('/accounts/u/list');
		},
		onCurrencyFocus: function() {
			banhji.router.navigate('/currencies/u/list');
		},
		
		backToVendor: function() {
			if(this.get('current')) {
				return '#/vendors/' + this.get('current').id;
			} else {
				return false;
			}
		},
		getPhone	: function() {
			// get phones for current vendor
			this.vendorPhones.filter({
				field: 'contact_id', value: this.get('current').id
			});
		},
		toDashboard : function() {
			banhji.router.navigate('/vendors', false);
			this.set('show', false);
		},
		findBillByVendor: function(vendorId) {
			this.billDS.filter([
				{field: 'vendor_id', operator: '', value: vendorId},
				{field: 'created_at >=', operator: '', value: this.get('startDate')},
				{field: 'created_at <=', operator: '', value: this.get('startDate')}
			]);
		},
		current 	: null,
		setCurrent 	: function(data) {
			this.set('current', data);
		},
		selected 	: function(e) {
			// banhji.router.navigate('/vendors/' + e.data.id);
			banhji.vendors.setCurrent(e.data);
			banhji.vendors.loadMap();
			banhji.vendors.vendorPhones.query({
				filter: {field: 'contact_id', operator: '', value: e.data.id},
				page: 1,
				pageSize: 10
			});
			this.filterBill();
			// this.billVM.unPaidByVendorId(e.data.id);
			this.getMonthlyExp(e.data.id);	
			// console.log(e.data);
			// this.set('show', true);
		},
		edit 		: function()  {
			banhji.router.navigate('/vendors/'+this.current.id+'/edit', false);
		},
		saveClose 		: function() {
			var validated = $(".vendor-form").kendoValidator().data("kendoValidator");
			var that = this;
			if(validated.validate()) {
				if(this.dataSource.hasChanges()){
					this.dataSource.sync();
					this.dataSource.bind('requestEnd', function(e){
						var type = e.type;
						if(e.response.error === false) {
							if(type === 'create') {
								var id = e.response.results[0].id;
								$.each(that.vendorPhones.data(), function(index, value) {
									value.set('contact_id', id);
								});
								that.vendorPhones.sync();
								that.vendorPhones.bind('requestEnd', function(e) {
									if(e.type==='create') {
										that.vendorPhones.filter({field: 'contact_id', value: 0});
									}								
								});
								that.close();
							} else if(type==='update') {
								that.vendorPhones.sync();
							}
						}
					});
				} else {
					that.vendorPhones.sync();
					that.close();
				}
				$("#notification").data('kendoNotification').info("Data is successfully recorded");
			} else {
				$("#notification").data('kendoNotification').info("Please check your input.");
			}		
		},
		save 		: function() {
			var validated = $(".vendor-form").kendoValidator().data("kendoValidator");
			var that = this;
			if(validated.validate()) {
				if(this.dataSource.hasChanges()){
					this.dataSource.sync();
					this.dataSource.bind('requestEnd', function(e){
						var type = e.type;
						if(e.response.error === false) {
							if(type === 'create') {
								var id = e.response.results[0].id;
								$.each(that.vendorPhones.data(), function(index, value) {
									value.set('contact_id', id);
								});
								that.vendorPhones.sync();
								that.vendorPhones.bind('requestEnd', function(e) {
									if(e.type==='create') {
										that.vendorPhones.filter({field: 'contact_id', value: 0});
									}								
								});
								that.addNew();
								banhji.vendors.setCurrent(banhji.vendors.get('dataSource').at(0));
							} else if(type==='update') {
								that.vendorPhones.sync();
							}
						}
					});
				} else {
					that.vendorPhones.sync();
				}
				$("#notification").data('kendoNotification').info("Data is successfully recorded.");
			} else {
				$("#notification").data('kendoNotification').info("Please check your input");
			}		
		}
	});
	banhji.itemVM = kendo.observable({
		ds   		: dataStore(baseUrl + "billitems"),
		itemRecord 	: dataStore(baseUrl + "items/records"),
		save 		: function() {
			var dfd = $.Deferred();
			this.ds.sync();
			this.ds.bind("requestEnd", function(e){
				if(e.response.results) {
					dfd.resolve({type: e.type, data: e.response.results});
				} else {
					dfd.reject({error: e.type + " can not be processed."});
				}
			});
			return dfd.promise();
		}
	});
	banhji.vm = kendo.observable({
		ds        : banhji.billDS,
		tax 	  : 0.1,
		classDS   : banhji.segmentItem.ds,
		itemArrayList  : [],
		close     : function() {
			window.history.back(-1);
			this.ds.cancelChanges();
			this.itemDS.ds.cancelChanges();
			console.log('vm');
		},
		changeValue : function(e) {			
			var dataArr = e.data.current.segment;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = dataArr[i];
					if(current.segment.id === dataArr[lastIndex].segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}	
		},
		init 	  : function() {
			if(this.get('itemArrayList').length === 0) {
				if(banhji.itemDS.data().length === 0) {
					banhji.itemDS.query({
						filter: {field: 'category_id', operator: '', value: 1},
						page: 1,
						pageSize: 150
					}).then(function(e){
						$.each(banhji.itemDS.data(), function(i, v){
							banhji.vm.get('itemArrayList').push(v);
						});
						
					});	
				} else {
					$.each(banhji.itemDS.data(), function(i, v){
						banhji.vm.get('itemArrayList').push(v);
					});
				}
			}
		},
		subTotal  : 0,
		taxAmount : 0,
		grandTotal: 0,
		getVendor : function() {
			banhji.vendors.selectModal().done(function(value){
				// if(value) {
					console.log(banhji.vendors.get('current'));
				// }
			});
		},
		computeAmount: function(e) {
			e.data.set('amount', e.data.unit * e.data.rate);
			this.getSubTotal();
			this.total();
		},
		itemDS 	  : banhji.itemVM,
		setCurrent: function(currentModel) {
			this.set("current", currentModel);
		},
		addNew 	  : function() {
			this.ds.insert(0,{
				type 			: "po",
				invoice_number 	: null,
				amount 			: 0.00,
				taxAmount		: 0.00,
				paid 			: 0.00,
				status 			: 'open',
				notice 			: null,
				comment 		: null,
				internal_notice	: null,
				due_date 		: new Date(),
				expected_date 	: new Date(),
				payment_term 	: 0,
				segment 		: null,
				delivery_address: null,
				vendor 			: banhji.vendors.get('current') ? banhji.vendors.get('current') : null
			});
			this.setCurrent(this.ds.at(0));
		},
		ribbon 	  : function() {
			var status = "";
			if(this.get('current').status === 'partial') {
				status = "បង់បានខ្លះ";
			} else if(this.get('current').status === 'closed') {
				status = "បង់ប្រាក់រួច";
			} else {
				status = "ទទួល";
			}
			return status;
		},
		addItem   : function() {
			var number = this.itemDS.ds.data().length + 1;
			this.itemDS.ds.add({
				number: number,
				amount: 0.00,
				rate: 0.00,
				unit: 0.00,
				item: null,
				isTaxed: false,
				bill: null
			});
		},
		removeItem: function(e) {
			this.itemDS.ds.remove(e);
		},
		sync 	  : function() {
			var dfd = $.Deferred();
			this.ds.sync();
			this.ds.bind("requestEnd", function(e){
				if(e.response.results) {
					dfd.resolve({type: e.type, data: e.response.results});
				} else {
					dfd.reject({error: e.type + ' can not process.'});
				}
			});
			return dfd.promise();
		},
		getSubTotal: function() {
			var data = this.itemDS.ds.data();
			var amount = 0;
			$.each(data, function(index, value){
				amount += kendo.parseFloat(value.amount);
			});
			this.get('current').set('amount', amount);
		},
		getTax 	  : function() {
			var amount = 0;
			$.each(this.itemDS.ds.data(), function(i, v){
				if(v.isTaxed === true) {
					amount += kendo.parseFloat(v.amount);
				}
			});
			this.get("current").set("taxAmount", amount * this.get('tax'));
			this.set('grandTotal', amount * this.get('tax') + kendo.parseFloat(this.get('current').amount));
		},
		total 	  : function() {
			var price = 0;
			$.each(this.itemDS.ds.data(), function(i, v){
				price = price + v.amount;
			});
			this.set('grandTotal', price + this.get('taxAmount'));
			this.get('current').set('amount', price);
		},
		save 	  : function() {
			var that = this;
			var validator = $(".bill-form").kendoValidator().data('kendoValidator');
			if(validator.validate()) {
				this.get('current').set('amount', kendo.parseFloat(this.get('subTotal')));
				this.sync()
				.then(function(res){
					if(res.type === 'create') {
						$.each(that.itemDS.ds.data(), function(i, v) {
							v.set('bill', res.data[0]);
						});
					} else if(res.type === 'update') {
						$.each(that.itemDS.ds.data(), function(i, v) {
							v.set('bill', res.data[0]);
						});
					}
					that.itemDS.save();
					that.itemDS.bind("requestEnd", function(e){
						if(e.response.code === 201) {
							// banhji.vm.addNew();
						}						
					});
					banhji.vm.addNew();
					banhji.vm.itemDS.ds.filter({field: 'id', operator: '', value: 0});
					banhji.vm.total();
					// banhji.vm.setCurrent(res.data[0]);
				});
				$(".notification").data('kendoNotification').info("Data is successfully recorded");
			} else {
				$(".notification").data('kendoNotification').info("Please fill the field with *");
			}	
		},
		saveClose : function() {
			var that = this;
			var validator = $(".bill-form").kendoValidator().data('kendoValidator');
			if(validator.validate()) {
				this.get('current').set('amount', kendo.parseFloat(this.get('subTotal')));
				this.sync()
				.then(function(res){
					if(res.type === 'create') {
						$.each(that.itemDS.ds.data(), function(i, v) {
							v.set('bill', res.data[0]);
						});
					} else if(res.type === 'update') {
						$.each(that.itemDS.ds.data(), function(i, v) {
							v.set('bill', res.data[0]);
						});
					}
					that.itemDS.save();
					that.itemDS.bind("requestEnd", function(e){
						if(e.response.code === 201) {
							// banhji.vm.addNew();
						}						
					});
					banhji.vm.close();
					// banhji.vm.setCurrent(res.data[0]);
				});
				$(".notification").data('kendoNotification').info("Data is successfully recorded");
			} else {
				$(".notification").data('kendoNotification').info("Please fill the fields with *");
			}
		}
	});
	banhji.billItem = kendo.observable({
		ds   	: dataStore(baseUrl + "billitems"),
		add 		: function() {
			var number = this.ds.data().length + 1;
			this.ds.add({
				number: number,
				amount: 0.00,
				rate: 0.00,
				unit: 0.00,
				item: null,
				isTaxed: false,
				bill: banhji.vm.get('current') ? banhji.vm.get('current') : null
			});
		},
		remove 		: function(e) {
			this.ds.remove(e.data);
		},
		computeAmount: function(e) {
			e.data.set('amount', kendo.parseFloat(e.data.unit) * kendo.parseFloat(e.data.rate));
			banhji.vm.total();
		},
		save 		: function() {
			var dfd = $.Deferred();
			this.ds.sync();
			this.ds.bind("requestEnd", function(e){
				if(e.response.results) {
					dfd.resolve({type: e.type, data: e.response.results});
				} else {
					dfd.reject({error: e.type + " can not be processed."});
				}
			});
			return dfd.promise();
		}
	});
	banhji.billForm = kendo.observable({
		ds        : banhji.billDS,
		itemDS 	  : banhji.itemVM,
		tax 	  : 0.1,
		classDS   : banhji.segmentItem.ds,
		subTotal  : 0,
		taxAmount : 0,
		grandTotal: 0,
		account   : [],
		disable   : false,
		getDue 	  : function() {
			var vendor = banhji.billForm.get('current');
			if(vendor) {
				var numberOfDays = parseInt(banhji.billForm.get('current').vendor.payment_term.term);
				var date = new Date(banhji.billForm.get('current').expected_date);
				date.setDate(date.getDate() + numberOfDays);
				banhji.billForm.get('current').set('due_date', date);
			}			
		},
		getAllBill: function(){
			this.ds.query({
				filter: [
					{field: 'deleted', operator: '', value: 'false'},
					{field: 'vendor', operator: '', value: banhji.vendors.get('current').id}
				],
				pageSize: 100,
				page: 1
			});
		},
		getById   : function(id) {
			var dfd = $.Deferred();
			banhji.billForm.ds.query({
				filter 	: [
					{ field: 'id', operator: '', value: id },
					{ field: 'deleted', operator: '', value: false }
				],
				pageSize: 1,
				page 	: 1
			}).then(function(e){
				var model = banhji.billForm.ds.data()[0];
				if(model) {
					banhji.itemVM.ds.query({
						filter: {field:'bill_id', operator: '', value: model.id}
					}).then(function(e){
						banhji.billForm.total();
					});
					// banhji.billForm.setCurrent(model);

					if(model.status === 'partial') {
						banhji.billForm.set('ribbon', "បង់បានខ្លះ");
					} else if(model.status === 'closed') {
						banhji.billForm.set('ribbon', "បង់ប្រាក់រួច");
						$('#expense-ribbon').removeClass('default');
						$('#expense-ribbon').addClass('primary');
					} else if (model.status){
						banhji.billForm.set('ribbon', "មិនទានបង់");
						$('#expense-ribbon').removeClass('default');
						$('#expense-ribbon').removeClass('primary');
						$('#expense-ribbon').addClass('warning');
					} else {
						banhji.billForm.set('ribbon', "ទទួល");
						$('#expense-ribbon').removeClass('default');
						$('#expense-ribbon').removeClass('primary');
						$('#expense-ribbon').addClass('warning');
					}
					dfd.resolve(model);
				}
			});
			return dfd.promise();
		},
		getAccount: function() {
			var dfd = $.Deferred();
			banhji.billForm.account.splice(0,banhji.billForm.account.length);
			if(banhji.account.dataStore.data().length > 0) {
				if(banhji.billForm.get('current').paidCash) {
					$.each(banhji.account.dataStore.data(), function(i, v){
						if(v.type.id === 6) {
							banhji.billForm.account.push({
								id: v.id,
								code: v.code,
								name: v.name
							});
						}
					});
				} else {
					$.each(banhji.account.dataStore.data(), function(i, v){
						if(v.type.id === 13) {
							banhji.billForm.get('account').push({
								id: v.id,
								code: v.code,
								name: v.name
							});
						}
					});
				}
				dfd.resolve(true);
			} else {
				banhji.account.dataStore.query({
					filter: {field: 'active', operator: '', value: 'true'},
					page: 1,
					pageSize: 100
				}).then(function(e){
					if(banhji.billForm.get('current').paidCash) {
						$.each(banhji.account.dataStore.data(), function(i, v){
							if(v.type.id === 6) {
								banhji.billForm.account.push({
								id: v.id,
								code: v.code,
								name: v.name
							});
							}
						});
					} else {
						$.each(banhji.account.dataStore.data(), function(i, v){
							if(v.type.id === 11) {
								banhji.billForm.account.push({
								id: v.id,
								code: v.code,
								name: v.name
							});
							}
						});
					}
				});
				dfd.resolve(true);
			}
			return dfd.promise();
		},
		fromPO 	  : function() {
			// cancel current data
			// add new based on SO data to current
		},
		getVendor : function() {
			var that = this;
			$('body').append("<div id='vendorModal'><div id='vendorModalInner'></div></div>");
			var modal = $("#vendorModal").kendoWindow({
				title: "Vendor List",
				modal: true,
				width: 300,
				height: 400,
				// visible: false,
				open: function(e) {
					var grid = $("#vendorModalInner").kendoGrid({
						dataSource: banhji.vendors.dataSource,
						columns: [{field: 'company', title: 'Company'}],
						selectable: true,
						scrollable: true,
						height: "380px"
					}).data("kendoGrid");
					grid.bind('change', function(e){
						var selected = this.select();
						var model = this.dataItem(selected);
						banhji.vendors.setCurrent(model);
						banhji.billForm.get('current').set('vendor', model);
						// dfd.resolve(true);
					});
				}
			}).data('kendoWindow');
			modal.center();
			modal.bind('close', function(e){
				banhji.billForm.get('current').set('vendor', banhji.vendors.get('current'));
				banhji.billForm.getDue();
				modal.destroy();
			});
		},
		setCurrent: function(currentModel) {
			banhji.billForm.set("current", currentModel);
		},
		ribbon 	  : '',
		addNew 	  : function() {
			banhji.billForm.ds.insert(0,{
				type 			: "po",
				invoice_number 	: null,
				account 		: null,
				amount 			: 0.00,
				taxAmount		: 0.00,
				paid 			: 0.00,
				status 			: 'open',
				notice 			: null,
				comment 		: null,
				internal_notice	: null,
				due_date 		: new Date(),
				expected_date 	: new Date(),
				payment_term 	: 0,
				segment 		: null,
				address 		: null,
				delivery_address: null,
				voucher  		: null,
				paidCash 		: true,
				vendor 			: banhji.vendors.get('current') ? banhji.vendors.get('current') : null
			});
			banhji.billForm.setCurrent(this.ds.at(0));
		},
		getTax 	  : function() {
			var amount = 0;
			$.each(banhji.billForm.itemDS.ds.data(), function(i, v){
				if(v.isTaxed === true) {
					amount += kendo.parseFloat(v.amount) * banhji.billForm.get('tax');
				}
			});
			banhji.billForm.get("current").set("taxAmount", kendo.toString(amount, 'c2'));
			banhji.billForm.set('grandTotal', kendo.toString(amount + kendo.parseFloat(banhji.billForm.get('current').amount), 'c2'));
		},
		total 	  : function() {
			var price = 0, grandTotal = 0;
			$.each(banhji.itemVM.ds.data(), function(i, v){
				price = price + v.amount;
			});
			kendo.culture(banhji.billForm.get('current').vendor.locale);
			grandTotal += price + banhji.billForm.get('taxAmount');
			banhji.billForm.set('grandTotal', kendo.toString(grandTotal, 'c2'));
			banhji.billForm.get('current').set('amount', kendo.toString(price, 'c2'));
		},
		save 	  : function() {
			var dfd = $.Deferred();
			banhji.billForm.ds.sync();
			banhji.billForm.ds.bind("requestEnd", function(e){
				if(e.response.results) {
					dfd.resolve({type: e.type, data: e.response.results});
				} else {
					dfd.reject({error: e.type + ' can not process.'});
				}
			});
			return dfd.promise();
		}
	});
	banhji.expense = kendo.observable({
		form 	  : banhji.billForm,
		isCash 	  : true,
		itemDS 	  : banhji.itemVM.ds,
		taxItems  : new kendo.data.DataSource({
			transport: {
				read: {
					url: baseUrl + 'items/tax',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: "json"
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		onTaxSelected: function(e) {
			console.log(e);
		},
		pmtMethod : dataStore(baseUrl + 'payment_methods'),
		changeValue : function(e) {			
			var dataArr = e.data.form.current.segment;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = dataArr[i];
					if(current.segment.id === dataArr[lastIndex].segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}
		},
		total 	  : function() {
			var price = 0;
			$.each(banhji.expense.itemDS.ds.data(), function(i, v){
				price = price + v.amount;
			});
			console.log(price);
			// kendo.culture(banhji.billForm.get('current').vendor.locale);
			banhji.billForm.set('grandTotal', kendo.toString(price + banhji.billForm.get('taxAmount'), 'c2'));
			banhji.billForm.get('current').set('amount', kendo.toString(price, 'c2'));
		},
		getTax 	  : function(e) {
			var amount = 0;
			$.each(this.itemDS.data(), function(i, v){
				if(v.isTaxed === true) {
					amount += kendo.parseFloat(v.amount);
				}
			});
			this.form.get("current").set("taxAmount", amount * this.form.get('tax'));
			this.set('grandTotal', amount * this.form.get('tax') + kendo.parseFloat(this.get('current').amount));
		},
		close     : function() {
			window.history.back(-1);
			this.form.ds.cancelChanges();
			this.itemDS.cancelChanges();
		},
		accountList  : [],
		getAccount: function() {
			this.get('accountList').splice(0, this.get('accountList').length);
			if(banhji.account.dataStore.data().length > 0) {
				this.set('accountList', banhji.account.dataStore.data());
			} else {
				banhji.account.dataStore.query({
					filter: {field: 'active', operator: '', value: 'true'},
					pageSize: 1000,
					page: 1
				}).then(function(e){
					banhji.expense.set('accountList', banhji.account.dataStore.data());
				});
			}
			console.log('expense');
		},
		addItem   : function() {
			var number = this.itemDS.data().length + 1;
			this.itemDS.add({
				number: number,
				amount: 0.00,
				unit_received: 0,
				rate: 0.00,
				unit: 1,
				item: null,
				account: null,
				isTaxed: false,
				bill: banhji.vm.get('current') ? banhji.vm.get('current') : null
			});
		},
		removeItem: function(e) {
			this.itemDS.remove(e.data);
		},
		computeAmount: function(e) {
			e.data.set('amount', kendo.parseFloat(e.data.unit) * kendo.parseFloat(e.data.rate));
			this.form.getTax();
			this.form.total();
		},
		save 	  : function() {
			var that = this;
			var validator = $(".bill-form").kendoValidator().data('kendoValidator');
			if(validator.validate()) {
				kendo.culture(banhji.billForm.get('current').vendor.locale);
				// save to bills
				if(this.form.get('current').account === null) {
					this.form.get('current').set('account', banhji.vendors.get('current').ap);
				}
				var amount = kendo.parseFloat(this.form.get('current').amount);
				var tax = kendo.parseFloat(this.form.get('current').taxAmount);
				this.form.get('current').set('amount', amount);
				this.form.get('current').set('taxAmount', tax);
				this.form.save()
				.then(function(res){	
					return res;
				}).then(function(res){
					if(res.type === 'create') {
						$.each(that.itemDS.data(), function(i, v) {
							v.set('bill', res.data[0]);
						});
					} else if(res.type === 'update') {
						$.each(that.itemDS.data(), function(i, v) {
							v.set('bill', res.data[0]);
						});
					}
					return banhji.itemVM.save()
					.then(function(billItems){
						var entries = [];
						companyRate = banhji.currency.getAmount(banhji.index.companyInf().institute[0].locale),
						vendorRate  = banhji.currency.getAmount(banhji.vendors.get('current').currency.locale);
						for(var x = 0; x < billItems.data.length; x++) {
							entries.push({
								amount  : billItems.data[x].amount,
								memo 	: 'expense-'+res.data[0].id,
								is_debit: true,
								account : {
									id 		: billItems.data[x].account.id,
									code 	: billItems.data[x].account.code,
									name 	: billItems.data[x].account.name
								},
								rate 	: banhji.currency.getRate(vendorRate, companyRate),
								locale 	: banhji.index.companyInf().institute[0].locale,
								issuedDate: banhji.billForm.get('current').expected_date,
								segment : banhji.billForm.get('current').segment,
								contact : {
									id: banhji.vendors.get('current').id,
									company: banhji.vendors.get('current').company
								}
							});
						}
						if(banhji.billForm.get('current').account === null) {
							entries.push({
								amount  : banhji.billForm.get('current').amount,
								memo 	: 'expense-'+ banhji.billForm.get('current').id,
								is_debit: false,
								account : {id: banhji.billForm.get('current').ap.id, name: banhji.billForm.get('current').ap.name},
								rate 	: banhji.currency.getRate(vendorRate, companyRate),
								locale 	: banhji.index.companyInf().institute[0].locale,
								issuedDate: banhji.billForm.get('current').expected_date,
								segment : banhji.billForm.get('current').segment,
								contact : {
									id: banhji.vendors.get('current').id,
									company: banhji.vendors.get('current').company
								}
							});
						} else {
							entries.push({
								amount  : banhji.billForm.get('current').amount,
								memo 	: 'bill-'+ banhji.billForm.get('current').id,
								is_debit: false,
								account : {id: banhji.billForm.get('current').account.id, name: banhji.billForm.get('current').name},
								rate 	: banhji.currency.getRate(vendorRate, companyRate),
								locale 	: banhji.index.companyInf().institute[0].locale,
								issuedDate: banhji.billForm.get('current').expected_date,
								segment : banhji.billForm.get('current').segment,
								contact : {
									id: banhji.vendors.get('current').id,
									company: banhji.vendors.get('current').company
								}
							});
						}
						
						banhji.journalEntry.addNew({
							reference: {id:res.data[0].id},
							type: 'expense',
							memo: 'bill id-' + banhji.billForm.get('current').id,
							voucher: banhji.billForm.get('current').voucher,
							issuedDate: banhji.billForm.get('current').expected_date,
							contact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
							entries: entries
						});
						return banhji.journalEntry.save();
					})
					.then(function(data){
						$(".notification").data('kendoNotification').info("Data is successfully recorded");
						banhji.purchase.itemDS.data([]);
						banhji.purchase.form.addNew();
						banhji.purchase.form.set('grandTotal', 0);
					}, function(error){
						$(".notification").data('kendoNotification').info("សូមបំពេញផ្នែកដែលមានសញ្ញា *");
					});
				});
				$(".notification").data('kendoNotification').info("Data is successfully recorded");
			} else {
				$(".notification").data('kendoNotification').info("Please fill the fields with *");
			}		
		}
	});
	banhji.purchase = kendo.observable({
		form 	  : banhji.billForm,
		isCash 	  : true,
		itemDS 	  : banhji.itemVM.ds,
		pmtMethod : dataStore(baseUrl + 'payment_methods'),
		purchaseItem: dataStore(baseUrl + "billitems"),
		po 		  : null,
		itemArrayList: [],
		changeValue : function(e) {			
			var dataArr = e.data.form.current.segment;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = dataArr[i];
					if(current.segment.id === dataArr[lastIndex].segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}
		},
		poDS 	  : new kendo.data.DataSource({
				transport: {
					read 	: {
						url: baseUrl + 'bills',
						type: "GET",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					create 	: {
						url: baseUrl + 'bills',
						type: "POST",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					update 	: {
						url: baseUrl + 'bills',
						type: "PUT",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					destroy : {
						url: baseUrl + 'bills',
						type: "DELETE",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					parameterMap: function(options, operation) {
						if(operation === 'read') {
							return {
								limit: options.take,
								page: options.page,
								filter: options.filter
							};
						} else {
							return {models: kendo.stringify(options.models)};
						}
					}
				},
				schema 	: {
					model: {
						id: 'id'
					},
					data: 'results',
					total: 'count'
				},
				batch: true,
				serverFiltering: true,
				filter: [
					{field: 'type', operator: '', value: "po"},
					{field: 'status !=', operator: '', value: "closed"}
				],
				serverPaging: true,
				pageSize: 100
			}),
		total 	  : function() {
			var price = 0;
			$.each(banhji.purchase.itemDS.ds.data(), function(i, v){
				price = price + v.amount;
			});
			console.log(price);
			banhji.billForm.set('grandTotal', price + banhji.billForm.get('taxAmount'));
			banhji.billForm.get('current').set('amount', kendo.toString(price, 'c2'));
		},
		close     : function() {
			window.history.back(-1);
			this.form.ds.cancelChanges();
			this.itemDS.cancelChanges();
		},
		getTax 	  : function(e) {
			var amount = 0;
			for(var i = 0; i < this.itemDS.total(); i++) {
				if(this.itemDS.data()[i].isTaxed=== true) {
					amount += kendo.parseFloat(this.itemDS.data()[i].amount)*0.1;
				}
			}
			this.form.total();
			this.form.get("current").set("taxAmount", amount);
			this.form.set('grandTotal', amount + kendo.parseFloat(this.form.get('current').amount));
		},
		init 	  : function() {
			if(this.get('itemArrayList').length === 0) {
				if(banhji.itemDS.data().length === 0) {
					banhji.itemDS.query({
						filter: {field: 'item_type_id', operator: '', value: 1},
						page: 1,
						pageSize: 150
					}).then(function(e){
						$.each(banhji.itemDS.data(), function(i, v){
							banhji.purchase.get('itemArrayList').push(v);
						});
						
					});	
				} else {
					$.each(banhji.itemDS.data(), function(i, v){
						banhji.purchase.get('itemArrayList').push(v);
					});
				}
			}
		},
		addItem   : function() {
			var number = this.itemDS.data().length + 1;
			banhji.purchase.itemDS.add({
				number: number,
				amount: 0.00,
				rate: 0.00,
				unit: 0.00,
				unit_received: 0,
				item: null,
				isTaxed: false,
				bill: null
			});
		},
		removeItem: function(e) {
			this.itemDS.remove(e.data);
		},
		computeAmount: function(e) {
			e.data.set('amount', kendo.parseFloat(e.data.unit) * kendo.parseFloat(e.data.rate));
			this.form.getTax();
			this.form.total();
		},
		save 	  : function() {
			// add to items too
			var that = this;
			var validator = $(".bill-form").kendoValidator().data('kendoValidator');
			if(validator.validate()) {
				kendo.culture(banhji.billForm.get('current').vendor.locale);
				// save to bills
				var tax = kendo.parseFloat(this.form.get('current').taxAmount);
				this.form.get('current').set('amount', kendo.parseFloat(this.form.get('current').amount));
				this.form.get('current').set('taxAmount', tax);
				if(this.form.get('current').account === null) {
					this.form.get('current').set('account', banhji.vendors.get('current').ap);
				}
				this.form.save()
				.then(function(res){
					if(banhji.purchase.get('po') !== null) {
						banhji.purchase.get('po').set('status', 'closed');
						banhji.purchase.poDS.sync();
					} // issue here fix this afternoon
					return res;
				}).then(function(res){
					if(res.type === 'create') {
						$.each(that.itemDS.data(), function(i, v) {
							v.set('bill', res.data[0]);
						});
					} else if(res.type === 'update') {
						$.each(that.itemDS.data(), function(i, v) {
							v.set('bill', res.data[0]);
						});
					}
					banhji.itemVM.save()
					.then(function(billItems){
						var dfd = $.Deferred();
						for(var i = 0; i < billItems.data.length; i++) {
							// models = {id: null, amount: 0.00, unit: 1, is_in: true, item:{id: 1, sku: 'ewew', name: 'dfsfds'}}
							banhji.itemVM.itemRecord.add({
								amount 	: billItems.data[i].amount,
								unit 	: billItems.data[i].unit,
								is_in 	: true,
								item 	: {
									id 	: billItems.data[i].item.id,
									sku : billItems.data[i].item.sku,
									name: billItems.data[i].item.name
								}
							});
						}
						banhji.itemVM.itemRecord.sync();
						banhji.itemVM.itemRecord.bind('requestEnd', function(e){
							var r = e.response.results;
							if(r) {
								dfd.resolve(r);
							} else {
								reject('error');
							}
						});
						return dfd.promise();
					})
					.then(function(records){
						var entries = [];
						companyRate = banhji.currency.getAmount(banhji.index.companyInf().institute[0].locale),
						vendorRate  = banhji.currency.getAmount(banhji.vendors.get('current').currency.locale);
						for(var x = 0; x < records.length; x++) {
							var itemAccounts= banhji.itemDS.get(records[x].item.id);
							var inventoryAC = null;
							for(var y = 0; y < itemAccounts.accounts.length; y++) {
								if(itemAccounts.accounts[y].type === 'inventory') {
									inventoryAC = itemAccounts.accounts[y];
									break;
								}
							}
							entries.push({
								amount  : res.data[0].amount,
								memo 	: 'purchase-'+res.data[0].id,
								is_debit: true,
								account : inventoryAC,
								rate 	: banhji.currency.getRate(vendorRate, companyRate),
								locale 	: banhji.index.companyInf().institute[0].locale,
								issuedDate: banhji.billForm.get('current').expected_date,
								segment : banhji.billForm.get('current').segment,
								contact : banhji.vendors.get('current')
							});
						}
						entries.push({
							amount  : res.data[0].amount,
							memo 	: 'purchase-'+res.data[0].id,
							is_debit: false,
							account : banhji.billForm.get('current').account !== null ? banhji.billForm.get('current').account : banhji.vendors.get('current').ap,
							rate 	: banhji.currency.getRate(vendorRate, companyRate),
							locale 	: banhji.index.companyInf().institute[0].locale,
							issuedDate: banhji.billForm.get('current').expected_date,
							segment : banhji.billForm.get('current').segment,
							contact : banhji.vendors.get('current')
						});
						banhji.journalEntry.addNew({
							reference: res.data[0],
							type: 'purchase',
							memo: 'purchase id-' + res.data[0].id,
							conatact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
							issuedDate: banhji.billForm.get('current').expected_date,
							entries: entries
						});
						return banhji.journalEntry.save();
					})
					.then(function(data){
						$(".notification").data('kendoNotification').info("Data is successfully recorded");
						banhji.billForm.set('grandTotal', 0.00);
						banhji.purchase.form.addNew();
						banhji.purchase.itemDS.data([]);
					}, function(error){
						$(".notification").data('kendoNotification').info("Please fill the fields with *");
					});
				});
				$(".notification").data('kendoNotification').info("Data is successfully recorded");
			} else {
				$(".notification").data('kendoNotification').info("Please fill the fields with *");
			}	
		}
	}); 	
	banhji.grn = kendo.observable({
		ds 			: dataStore(baseUrl + 'bills'),
		poDS 		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'bills',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				update 	: {
					url: baseUrl + 'bills',
					type: "PUT",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			filter: [
				{field: 'type', operator: '', value: 'po'},
				{field: 'status', operator: '', value: 'open'}
			],
			serverPaging: true,
			pageSize: 100
		}),
		itemDS 	  	: banhji.itemVM.ds,
		classDS 	: banhji.segmentItem.ds,
		items 		: [],
		itemList 	: [],
		totalQty 	: 0,
		disablePO   : false,
		changeValue : function(e) {			
			var dataArr = e.data.current.segment;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = dataArr[i];
					if(current.segment.id === dataArr[lastIndex].segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}	
		},
		init 		: function() {
			var data = banhji.itemDS.data();
			if(data.length > 0) {
				$.each(data, function(i,v){
					banhji.grn.items.push(v);
				});
			} else {
				banhji.itemDS.fetch(function(e){
					var data = banhji.itemDS.data();
					$.each(data, function(i,v){
						banhji.grn.items.push(v);
					});
				});
			}
		},
		selectedPO 	: function(e) {
			var selected = e.sender.dataSource.at(e.sender.selectedIndex);
			this.get('current').set('vendor', selected.vendor);
			this.get('current').set('segment', selected.segment);
			selected.set('status', 'partial');
			this.itemDS.query({
				filter: {field: 'bill_id', operator:'', value: selected.id}
			}).done(function(e){
				var data = banhji.grn.itemDS.data();
				banhji.grn.itemDS.data([]);
				$.each(data, function(index, value){
					banhji.grn.itemDS.add({
						number: value.number,
						amount: value.amount,
						rate: value.rate,
						unit: value.unit,
						unitReceipt: value.unit,
						item: value.item,
						isTaxed: value.isTaxed,
						balance: 0,
						bill: value.bill
					})
				});
				banhji.grn.total();
			});
		},
		ribbon 	  : function() {
			var status = "";
			if(this.get('current').status === 'partial') {
				status = "បង់បានខ្លះ";
			} else if(this.get('current').status === 'closed') {
				status = "ទទួលរួច";
			} else {
				status = "ទទួល";
			}
			return status;
		},
		close 		: function() {
			window.history.back(-1);
			this.ds.cancelChanges();
			this.itemDS.cancelChanges();
		},
		getPOById 	: function(poId) {
			// banhji.billForm.getById(poId);
		},
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		qtyChange 	: function(e) {
			this.set('totalQty', this.getTotal());
			console.log('lkdfs');
		},
		addItem 	: function() {
			var number = this.itemDS.length + 1;
			this.itemDS.add({
				number: number,
				amount: 0.00,
				rate: 1,
				unit: 0,
				unitReceipt: 0,
				item: null,
				isTaxed: false,
				balance: 0,
				bill: null
			});
		},
		removeItem 	: function(e) {
			this.itemDS.remove(e.data);
			
		},
		lineTotal 	: function(e) {
			if(e.data.unit > 0) {
				e.data.set('balance', e.data.unit - e.data.unitReceipt);
			}
		},
		total 		: function(e) {
			var total = 0;
			$.each(this.itemDS.data(), function(i, v){
				total += kendo.parseInt(v.unitReceipt);
			});
			this.set('totalQty', total);
		},
		addNew 		: function() {
			this.ds.insert(0,{
				type 			: "grn",
				invoice_number 	: null,
				account 		: {id: null},
				reference 		: null,
				amount 			: 0.00,
				taxAmount		: 0.00,
				paid 			: 0.00,
				status 			: 'open',
				notice 			: null,
				comment 		: null,
				internal_notice	: null,
				due_date 		: new Date(),
				expected_date 	: new Date(),
				payment_term 	: 0,
				segment 		: null,
				address 		: null,
				delivery_address: null,
				voucher  		: null,
				paidCash 		: true,
				vendor 			: null
			});
			this.setCurrent(this.ds.at(0));
		},
		save 		: function() {
			this.ds.sync();
			this.ds.bind('requestEnd', function(e){
				var res = e.response.results;
				var type = e.type;
				if(type === 'create') {
					$.each(banhji.grn.itemDS.data(), function(i,v) {
						var data = banhji.grn.itemDS.at(i);
						data.set('unit', v.unitReceipt);
						data.set('bill', res[0]);
					});
				}
				banhji.grn.poDS.sync();
				banhji.grn.itemDS.sync();
			});
		}
	});
	banhji.report = kendo.observable({
		journal :  new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounting_reports/journal',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		gl 		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + 'accounting_reports/generalledger',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter
						};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		companyInf: function() {
			return JSON.parse(localStorage.getItem('userData/company'));
		},
		dateType: [
			'---',
			'ថ្អៃនេះ',
			'សប្ដាស៍នេះ',
			'ខែនេះ',
			'ឆ្នាំនេះ',
		],
		startDate: new Date(),
		endDate : new Date(),
		dateTypeSelect: function(e){
			var index = e.sender._oldIndex;
			var today = new Date();
			switch(index){
			case 0:
				break;
			case 1:
				this.set('startDate', today);
				this.set('endDate', today);				
			  	break;
			case 2:
				var first = today.getDate() - today.getDay(); 
				var last = first + 6;
				var firstDayOfWeek = new Date(today.setDate(first));
				var lastDayOfWeek = new Date(today.setDate(last));
				this.set('startDate', firstDayOfWeek);
				this.set('endDate', lastDayOfWeek);
			  	break;
			case 3:			  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
				var lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
				this.set('startDate', firstDayOfMonth);
				this.set('endDate', lastDayOfMonth);
			  	break;
			case 4:
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(today.getFullYear(), 11, 31);
				this.set('startDate', firstDayOfYear);
				this.set('endDate', lastDayOfYear);
			  	break;
			default:
				this.set('startDate',today);
				this.set('endDate', today);					  
			}
		},
		dateChange: function(e) {
			// var dateSel = $('.dateSelect').kendoDropDownList().data('kendoDropDownList');
			// dateSel.select(0);	
			if(this.get('startDate') > this.get('endDate')) {
				this.set('startDate', new Date);
			}
		},
		filter: function() {
			this.journal.query({
				filter: [
					{field: 'created_at >=', operator: '', value: kendo.toString(this.get('startDate'), 'yyyy-MM-dd')},
					{field: 'created_at <=', operator: '', value: kendo.toString(this.get('endDate'), 'yyyy-MM-dd')}
				],
				page: 1,
				pageSize: 200
			}).done(function(e){
				var damount = 0, camount = 0;
				if(banhji.report.journal.data().length > 0) {
					for( var i = 0; i < banhji.report.journal.data().length; i++) {
						if(banhji.report.journal.data()[i].entries.length> 0) {
							for( var x = 0; x < banhji.report.journal.data()[i].entries.length; x++) {
								// console.log(banhji.report.journal.data()[i].entries[x].amount);
								if(banhji.report.journal.data()[i].entries[x].is_debit === 'false') {
									camount += kendo.parseFloat(banhji.report.journal.data()[i].entries[x].amount);
								} else {
									damount += kendo.parseFloat(banhji.report.journal.data()[i].entries[x].amount);
								}
							}
						}
					}
				}
				banhji.report.set('jDebit', kendo.toString(damount, 'c3'));
				banhji.report.set('jCredit', kendo.toString(camount, 'c3'));
			});
		},
		filterGL : function() {
			this.gl.query({
				filter: [
					{field: 'created_at >=', operator: '', value: kendo.toString(this.get('startDate'), 'yyyy-MM-dd')},
					{field: 'created_at <=', operator: '', value: kendo.toString(this.get('endDate'), 'yyyy-MM-dd')}
				],
				page: 1,
				pageSize: 200
			}).done(function(e){
				var damount = 0, camount = 0;
				if(banhji.report.gl.data().length > 0) {
					for( var i = 0; i < banhji.report.gl.data().length; i++) {
						if(banhji.report.gl.data()[i].entries.length> 0) {
							for( var x = 0; x < banhji.report.gl.data()[i].entries.length; x++) {
								// console.log(banhji.report.journal.data()[i].entries[x].amount);
								if(banhji.report.gl.data()[i].entries[x].is_debit === 'false') {
									camount += kendo.parseFloat(banhji.report.gl.data()[i].entries[x].amount);
								} else {
									damount += kendo.parseFloat(banhji.report.gl.data()[i].entries[x].amount);
								}
							}
						}
					}
				}
				banhji.report.set('jDebit', kendo.toString(damount, 'c3'));
				banhji.report.set('jCredit', kendo.toString(camount, 'c3'));
			});
		},
		jDebit 	: 0,
		jCredit : 0
	});
	/*************************
	*   Vendor Section End   *
	**************************/


	//DAWINE -----------------------------------------------------------------------------------------

	/*********************
	*  Accounting Section  *
	**********************/
	banhji.currencyRate =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "currencies/rate"),
		currencyDS 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "currencies",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				}				
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			group: { field: "group" },
			page: 1,
			pageSize: 100
		}),		
		
		sortList			: [ 
	 		{ text:"All", 	value: "all" }, 
	 		{ text:"Today", 	value: "today" }, 
	 		{ text:"This Week",value: "week" }, 
	 		{ text:"This Month", 		value: "month" }, 
	 		{ text:"This Year", 	value: "year" } 
		],
		sorter 				: "all",		
		sdate 				: "",
		edate 				: "",

		obj 				: null,
		isEdit 				: false,
		user_id				: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,				
								
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}
		},
		openWindow		: function(){
      		this.addEmpty();

         	var window = $("#window").data("kendoWindow");
          	window.title("Exchange Rate");          	
          	window.center().open();         	
      	},
      	closeWindow 	: function(){	      		
      		this.dataSource.cancelChanges();

      		var window = $("#window").data("kendoWindow");          	         	
          	window.close();          	
      	},	   								
		addEmpty 		 	: function(){			
			this.dataSource.add({				
				currency_id : "",				
				user_id 	: this.get("user_id"),
 	    		rate 		: 1,
			   	source		: "",
			   	method 		: "Manual",			   		   	
			   	date 		: new Date(),

			   	currency 	: []			   				
	    	});		    		
			
			var data = this.dataSource.data();
			var obj = data[data.length-1];			
			this.set("obj", obj);					
		},			
		remove 				: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		save 			: function(){
      		this.dataSource.sync();
      		
      		var window = $("#window").data("kendoWindow");          	         	
          	window.close(); 		
      	},
      	edit 			: function(e){
      		var data = e.data;
      		
      		this.set("obj", data);

      		var window = $("#window").data("kendoWindow");
          	window.title("Exchange Rate");          	
          	window.center().open();       		
      	},      	
      	delete 			: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data;
		        this.dataSource.remove(data);
		        this.dataSource.sync();		        
	    	}	    	
	    }			         		
	});

	/*********************
	*   Vendor Section   *
	**********************/
	banhji.vendorCenter = kendo.observable({
		lang 				: langVM,
		transactionDS  		: dataStore(baseUrl + 'invoices'),
		contactDS 			: dataStore(baseUrl + 'contacts'),
		contactTypeDS		: dataStore(baseUrl + 'contacts/type'),
		noteDS 				: dataStore(baseUrl + 'notes'),		
		currencyDS 			: dataStore(baseUrl + 'currencies'),
		monthlyDS 			: dataStore(baseUrl + 'invoices/monthly_expense'),
		summaryDS 			: dataStore(baseUrl + "invoices"),		

		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "year",
		sdate 				: "",
		edate 				: "",
				
		obj 				: null,
		note 				: "",		
		searchText 			: "",		
		contact_type_id 	: 0,
		currency_id 		: 0,
		user_id 			: banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id,

		balance 			: 0,
		po 					: 0,
		openInvoice 		: 0,
		overInvoice 		: 0,
		
		pageLoad 			: function(){		
												
		},				
		loadSummary 		: function(id){
			var self = this, obj = this.get("obj");

			this.summaryDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Purchase","Expense", "PO"] },
			  		{ field:"status", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			}).then(function(){
				var view = self.summaryDS.view(),
				balance = 0, open = 0, over = 0, po = 0, today = new Date();

				$.each(view, function(index, value){
					if(value.type=="PO"){
						po++;
					}else{
						balance += kendo.parseFloat(value.amount)/kendo.parseFloat(value.rate);
						open++;

						if(new Date(value.due_date)<today){						
							over++;
						}
					}									
				});
				
				self.set("balance", kendo.toString(balance, "c", obj.currency[0].locale));
				self.set("po", kendo.toString(po, "n0"));
				self.set("openInvoice", kendo.toString(open, "n0"));
				self.set("overInvoice", kendo.toString(over, "n0"));
			});
		},
		loadTransaction 	: function(id){
			this.transactionDS.query({
			  	filter: { field:"contact_id", value: id },
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadBalance 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value:["Purchase","Expense"] },			  		
			  		{ field:"status", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadPO 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value:"PO" },			  		
			  		{ field:"status", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadOverInvoice 	: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Purchase","Expense"] },
			  		{ field:"due_date <", value: new Date() },
			  		{ field:"status", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},		
		loadNote 			: function(id){
			this.noteDS.query({
				filter: { field:"contact_id", value: id },
				sort: { field:"noted_date", dir:"desc" },
				page: 1,
				take: 100
			});
		},
		loadGraph 			: function(id){
			var self = this;

			this.monthlyDS.query({
				filter: { field: "contact_id", value: id },
				page: 1,
				take: 100
			}).then(function(e) {
			    var view = self.monthlyDS.view();
			    
				$('#sale-graph').kendoChart({
					dataSource: {data: view},												
					series: [
						{field: 'amount', categoryField:'month', type: 'line', axis: 'sale'}
					],
					valueAxes: [
						{
		                    name: "sale",
		                    color: "#007eff",
		                    min: 0,
		                    majorUnit: 10000,
		                    max: 100000
		                }
	                ],
	                categoryAxis: {
	                    //categories: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],		                    
	                    axisCrossingValues: [0, 13],
	                    justified: true
	                },
	                tooltip: {
	                    visible: true,
	                    format: "{0}",
	                    template: "#= series.field #: #= value #"
	                }
				});
			});		
		},		
		selectedRow			: function(e){
			var id = e.data.id,
			data = e.data;			
			
			this.set("obj", data);
			this.loadGraph(id);
			this.loadOutStandingInvoice(id);
			this.loadTransaction(id);			
			this.loadNote(id);
		},
		sorterChanges 		: function(){
			var value = this.get("sorter");

			switch(value){
			case "today":
				var today = new Date();
				
				this.set("sdate", today);
				this.set("edate", today);
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this, 
			para = [],
      		txtSearch = this.get("searchText"),       		
      		contact_type_id = this.get("contact_type_id"),
      		currency_id = this.get("currency_id");      		
      		
      		if(txtSearch){
      			para.push(      				
      				{ field: "number", operator: "like", value: txtSearch },
      				{ field: "surname", operator: "or_like", value: txtSearch },
					{ field: "name", operator: "or_like", value: txtSearch },
					{ field: "company", operator: "or_like", value: txtSearch }
      			);
      		}      		

      		if(contact_type_id){
      			para.push({ field: "contact_type_id", value: contact_type_id });
      		}else{
      			para.push({ field: "parent_id", model:"contact_type", operator:"where_related", value: 2 });
      		}

      		if(currency_id){
      			para.push({ field: "currency_id", value: currency_id });
      		}      		

      		this.contactDS.filter(para);
      		var loaded = false;
      		this.contactDS.bind("requestEnd", function(){
      			if(loaded==false){
      				loaded = true;

      				//Clear search filters
		      		self.set("searchText", "");		      		
		      		self.set("contact_type_id", 0);
		      		self.set("currency_id", 0);
      			}
      		});      			
		},
		searchTransaction	: function(){
			var self = this,
				para = [],
				obj = this.get("obj"),
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){
            	para.push({ field:"issued_date >=", value: kendo.toString(start, "yyyy-MM-dd") });
            	para.push({ field:"issued_date <=", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
            }else if(start){
            	para.push({ field:"issued_date", value: kendo.toString(start, "yyyy-MM-dd") });
            }else if(end){
            	para.push({ field:"issued_date <=", value: kendo.toString(end, "yyyy-MM-dd") });
            }else{
            	
            }

            para.push({ field:"contact_id", value: obj.id });            

            this.transactionDS.query({
            	filter: para,
            	sort: { field: "issued_date", dir: "desc" },
            	page: 1,
            	take: 100
            });            
		},	
		goEditContact 		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/vendor/'+obj.id);
		},
		goPO				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/po');
			banhji.po.loadContact(obj.id);			
		},
		goPurchase			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/purchase');
			banhji.purchase.loadContact(obj.id);
		},
		goGRN				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/grn');
			banhji.grn.loadContact(obj.id);
		},
		goExpense			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/expense');
			banhji.expense.loadContact(obj.id);					
		},
		goPayBill			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/cashier');
			banhji.cahier.loadContact(obj.id);
		},		
		saveNote 			: function(){
			var self = this;

			if(this.get("note")!==""){
				this.noteDS.insert(0, {
					contact_id 	: this.get("obj").id,
					note 		: this.get("note"),
					noted_date	: new Date(),
					created_by 	: this.get("user_id"),

					creator 	: ""
				});
				var saved = false;
				this.noteDS.sync();
				this.noteDS.bind("requestEnd", function(){
					if(saved==false){
						saved = true;

						self.set("note", "");
					}
				});
			}else{
				alert("memo is required");
			}
		}		
	});
	banhji.vendor = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(baseUrl + "contacts"),
		patternDS 				: dataStore(baseUrl + "contacts"),
		deleteDS 				: dataStore(baseUrl + "invoices"),		
		existingDS 				: dataStore(baseUrl + "contacts"),
		businessTypeDS			: dataStore(baseUrl + "businesstypes"),		
		contactTypeDS			: dataStore(baseUrl + "contacts/type"),		
		contactPersonDS			: dataStore(baseUrl + "contact_persons"),
		currencyDS 				: dataStore(baseUrl + "currencies"),
		apDS 					: dataStore(baseUrl + "accounts"),
		discountDS				: dataStore(baseUrl + "accounts"),
		prepaymentDS			: dataStore(baseUrl + "accounts"),
		paymentTermDS			: dataStore(baseUrl + "payment_terms"),
		paymentMethodDS			: dataStore(baseUrl + "payment_methods"),
		genders					: ["M", "F"],
		statusList 				: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],
        obj 					: null,       
		originalNo				: null,		
		isDuplicateNumber 		: false,		
		isCompany 				: false,
		isEdit 					: false,
		pageLoad 				: function(id){
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
				this.loadContactPerson(id);				
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
										
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}else{
					var obj = this.get("obj");

					obj.set("is_pattern", false);	
				}								
			}			
		},
		setPattern 				: function(id){
			var obj = this.get("obj");

			obj.set("contact_type_id", id);
			obj.set("is_pattern", true);
		},
		loadPattern 			: function(id){
			var self = this;

			this.patternDS.query({
				filter: [
					{ field:"contact_type_id", value: id },
					{ field:"is_pattern", value: true }
				],
				page: 1,
				take: 1
			}).then(function(data){
				var view = self.patternDS.view(),
				obj = self.get("obj");

				if(view.length>0){
					obj.set("contact_account_id", view[0].contact_account_id);
					obj.set("discount_account_id", view[0].discount_account_id);
					obj.set("deposit_account_id", view[0].deposit_account_id);
					obj.set("tax_item_id", view[0].tax_item_id);
					obj.set("currency_id", view[0].currency_id);
					obj.set("credit_limit", view[0].credit_limit);

					obj.set("payment_term_id", view[0].payment_term_id);
					obj.set("payment_method_id", view[0].payment_method_id);
					obj.set("business_type_id", view[0].business_type_id);
				}else{
					obj.set("contact_account_id", 0);
					obj.set("discount_account_id", 0);
					obj.set("deposit_account_id", 0);
					obj.set("tax_item_id", 0);
					obj.set("currency_id", 0);
					obj.set("credit_limit", 0);

					obj.set("payment_term_id", 0);
					obj.set("payment_method_id", 0);
					obj.set("business_type_id", 0);
				}
			});
		},			
		loadObj 				: function(id){
			var self = this;

			this.dataSource.query({
				filter:{ "field":"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();

				if(view[0].contact_type_id=="6" || view[0].contact_type_id=="7" || view[0].contact_type_id=="8"){
					self.set("isCompany", true);
				}else{
					self.set("isCompany", false);
				}

				self.set("obj", view[0]);
				self.loadMap();
				self.set("originalNo", view[0].number);											
			});
		},
		loadPatternEdit			: function(id){
			var self = this;

			this.dataSource.query({
				filter:[
					{ "field":"id", value: id },
					{ "field":"is_pattern", value: 1 }
				],
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();				

				self.set("obj", view[0]);														
			});
		},		
		loadContactPerson		: function(id){
			this.contactPersonDS.query({
				filter: { "field":"contact_id", value: id },
				page: 1,
				pageSize: 100
			});
		},
		loadMap 				: function(){
			var obj = this.get("obj"), lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);
			
			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map,
					title: obj.number
				});
			} 
		},
		copyBillTo 				: function(){
			var obj = this.get("obj");

			obj.set("ship_to", obj.bill_to);
		},
		contactTypeChanges 		: function(){
			var obj = this.get("obj");

			if(obj.contact_type_id>0){
				this.loadPattern(obj.contact_type_id);
			}
		},      	
		checkExistingNumber 	: function(){
			var self = this;	
			
			var number = this.get("obj").number;
			var originalNo = this.get("originalNo");
			
			if(number.length>0 && number!==originalNo){
				this.existingDS.query({
					filter: { field:"number", value: number },
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},		
		addEmptyContactPerson 	: function(){
			var contact_id = 0;
			if(this.get("isEdit")){
				contact_id = this.get("obj").id;
			}

			this.contactPersonDS.add({					 			
				contact_id 			: contact_id,
      			prefix 				: "",      			
				name 				: "",
				department			: "",
				phone				: "",
				email				: ""
			});								
		},
		deleteContactPerson 	: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.contactPersonDS.getByUid(d.uid);

				this.contactPersonDS.remove(obj);
			}
		},
      	addEmpty 				: function(){
      		this.dataSource.data([]);
      		this.set("obj", null);

			this.dataSource.add({
				"company_id" 			: 0,
				"ebranch_id" 			: 0,
				"elocation_id"			: 0,
				"wbranch_id" 			: 0,
				"wlocation_id" 			: 0,			
				"currency_id" 			: 0,
				"user_id" 				: 0,
				"contact_type_id" 		: 0,							
				"number"				: "",
				"enumber"				: "",
				"wnumber"				: "",
				"surname"				: "",
				"name"					: "",
				"gender"				: "M",
				"dob"					: "",
				"pob"					: "",
				"latitute" 				: "",
				"longtitute" 			: "",
				"credit_limit"			: 0,				
				"id_number"				: "",
				"phone" 				: "",
				"email" 				: "",
				"website" 				: "",			
				"job"					: "",				
				"vat_no"				: "",
				"family_member"			: "",
				"address" 				: "",
				"bill_to" 				: "",
				"ship_to" 				: "",
				"memo"					: "",				
				"image_url"				: "",
				"company"				: "",
				"company_en"			: "",		
				"bank_name"				: "",
				"bank_address"			: "",
				"bank_account_name"		: "",
				"bank_account_number"	: "",
				"name_on_cheque"		: "",				
				"business_type_id"		: 0,
				"payment_term_id"		: 0,
				"payment_method_id"		: 0,
				"deposit_account_id"	: 0,
				"discount_account_id"	: 0,				
				"contact_account_id"	: 0,
				"ra_id"					: 0,
				"tax_item_id"			: 0,				
				"phase_id"				: 0,
				"voltage_id"			: 0,
				"ampere_id"				: 0,
				"registered_date" 		: new Date(),			
				"use_electricity"		: 0,
				"use_water"				: 0,
				"is_local" 				: 0,
				"is_pattern" 			: 0,				
				"status"				: 1							
			});			

			var data = this.dataSource.data();			
			var obj = data[data.length - 1];			
			this.set("obj", obj);	
		},
		contactSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, saved = false;

			if(this.get("isEdit")){
				this.dataSource.sync();
				this.contactPersonDS.sync();
			}else{
				this.contactSync().then(function(data){
					self.saveContactPerson(data[0].id);

					if(data[0].is_pattern){
						self.savePattern(data[0].contact_type_id, data[0].id);
					}
				}).then(function(){					
					self.contactPersonDS.data([]);

					self.addEmpty();
				});
			}						
		},
		delete 					: function(){
			var self = this,
			obj = this.get("obj"),
			id = obj.id;

			if (confirm("Are you sure, you want to delete it?")) {				
				this.deleteDS.query({
				  	filter: { field: "contact_id", value: id },
				  	page: 1,
				  	take: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						var data = self.dataSource.get(id);
				        self.dataSource.remove(data);
				        self.save();
					}
				});
	    	}
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.contactPersonDS.cancelChanges();

			window.history.back();
		},
		saveContactPerson 		: function(id){
			$.each(this.contactPersonDS.data(), function(index, value) {
				value.set("contact_id", id);
			});

			this.contactPersonDS.sync();
		},
		savePattern 			: function(contact_type_id, contact_id){
			var data = this.contactTypeDS.get(contact_type_id);
			data.set("contact_id", contact_id);
			this.contactTypeDS.sync();

			banhji.vendorSetting.contactTypeDS.fetch();
			window.history.back();
		}
	});
	banhji.po =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		accountDS 			: dataStore(baseUrl + "accounts"),
		lineDS  			: dataStore(baseUrl + "invoices/line"),			
		contactDS  			: dataStore(baseUrl + "contacts"),						
		itemDS 				: dataStore(baseUrl + "items"),
		catalogDS			: dataStore(baseUrl + "items"),
		assemblyDS			: dataStore(baseUrl + "items/assembly"),
		vatDS 				: dataStore(baseUrl + "items"),			
		segmentItemDS		: banhji.segmentItem.ds,
		itemList 			: [],
		obj 				: null,
		isEdit 				: false,
		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,			
		paid 				: false,
		sub_total 			: 0,
		vat 				: 0,
		total 				: 0,
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					this.set("paid", false);
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}
		},	    
	    loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_term_id", view[0].payment_term_id);
		    	obj.set("vat_id", view[0].tax_item_id);		    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);

				self.lineDS.data([]);
				self.addRow();			
			});				
		},	
		loadObj 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];								    	
				
				//Status
				if(obj.status==1){
					self.set("paid", true);
				}else{
					self.set("paid", false);
				}

				self.set("sub_total", kendo.toString(obj.sub_total, "c", obj.locale));
		        self.set("vat", kendo.toString(obj.vat, "c", obj.locale));
		        self.set("total", kendo.toString(obj.amount, "c", obj.locale));	  			
								
				self.contactDS.filter({ field: "id", value: obj.contact_id });				
				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.set("obj", obj);
			});				
		},
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", operator:"where_not_in", value: 6 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},			
		addEmpty 		 	: function(){			
			var duedate = new Date();
			duedate.setDate(duedate.getDate()+7);
			this.set("obj", null);				

			this.dataSource.add({
				company_id 			: 0,
				location_id 		: 0,
				contact_id 			: "",
				payment_term_id		: 0,
				payment_method_id 	: 0,
				reference_id 		: 0,
				account_id 			: 0,
				vat_id 				: 0,
				biller_id 			: this.get("biller_id"),
 	    		number 				: "",
			   	type				: "PO",
			   	sub_total 			: 0,				   		   					   				   	
			   	amount				: 0,
			   	vat 				: 0,
			   	rate				: 1,			   	
			   	locale 				: "km-KH",			   	
			   	issued_date 		: new Date(),
			   	due_date 			: duedate,
			   	check_no 			: "",
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,

			   	segments 			: []				
	    	});		    		
			
			var data = this.dataSource.data();
			var obj = data[data.length-1];			
			this.set("obj", obj);

			this.addRow();			
		},
		addRow 				: function(){				
			var invoice_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				invoice_id = obj.id;
			}
						
			this.lineDS.add({					
				invoice_id 			: invoice_id,
				item_id 			: "",				
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				type 				: obj.type,

				priceList 			: []
			});																	
		},		
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		changes				: function(){
			var obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, vat = 0, vatAmt = 0;
								
				if(kendo.parseInt(obj.vat_id)>0){
					var selectedVat = this.vatDS.get(obj.vat_id);					
					vatAmt = kendo.parseFloat(selectedVat.price_list[0].price);
				}								

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.unit * value.price;
					subTotal += amt;

					value.set("amount", amt);

					if(value.has_vat){
						vat += amt * vatAmt;						
					}
		        });

		        total = subTotal + vat;			

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("vat", kendo.toString(vat, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("vat", vat);			
				obj.set("amount", total);									    	
	    	}else{
	    		this.set("sub_total", kendo.toString(0, "c", obj.locale));
		        this.set("vat", kendo.toString(0, "c", obj.locale));
		        this.set("total", kendo.toString(0, "c", obj.locale));

		        obj.set("sub_total", 0);
		        obj.set("vat", 0);			
				obj.set("amount", 0);				
	    	}   	
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"), company_id = 0,		    	
		    	contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("payment_term_id", contact.payment_term_id);
		    	obj.set("vat_id", contact.tax_item_id);
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    		    			
				
		    	this.lineDS.data([]);
		    	this.addRow();		    	
		    	this.changes();
	    	}
	    },
	    segmentChanges 		 : function(e) {
			var obj = this.get("obj"),
			dataArr = obj.segments,
			lastIndex = dataArr.length - 1,
			last = banhji.segmentItem.ds.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = banhji.segmentItem.ds.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			invoice_id = 0, 
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id),
			contact = this.contactDS.get(obj.contact_id);

			if(data.item_id>0 && obj.contact_id>0){		        
		        if(item.is_catalog=="1"){
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:item.catalogs }
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.price_list[0].currency[0].rate);
		        			
					        if(self.get("isEdit")){
								invoice_id = obj.id;
							}
										
							self.lineDS.add({					
								invoice_id 			: invoice_id,
								item_id 			: value.id,
								measurement_id 		: value.price_list[0].measurement_id,
								meter_record_id	 	: 0,
								description 		: value.name,				
								unit 	 			: 1,
								price 				: value.price_list[0].price*rate,												
								amount 				: value.price_list[0].price*rate,
								rate				: rate,
								locale				: obj.locale,
								has_vat 			: false,
								type 				: "",

								priceList 			: value.price_list
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assemble=="1"){
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price*rate);
			        data.set("measurement_id", 0);
			        data.set("rate", rate);		        	        
			        data.set("priceList", []);

			        this.changes();		     
		        }else{
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price_list[0].price*rate);
			        data.set("measurement_id", item.price_list[0].measurement_id);
			        data.set("rate", rate);		        	        
			        data.set("priceList", item.price_list);

			        this.changes();
		    	}		        
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		measurementChanges 	: function(e){								
			var self = this, data = e.data, obj = this.get("obj");

			if(data.measurement_id>0){				
				var contact = this.contactDS.get(obj.contact_id);				

				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.currency[0].rate);
				        data.set("price", kendo.parseFloat(value.price)*rate);				       			       
				        data.set("rate", rate);

						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},		
		save 				: function(){				
	    	var self = this, obj = this.get("obj"), rate = this.getRate();

	    	obj.set("sub_total", kendo.parseFloat(obj.sub_total)*rate);
	    	obj.set("vat", kendo.parseFloat(obj.vat)*rate);
	        obj.set("amount", kendo.parseFloat(obj.amount)*rate);
	        obj.set("rate", rate);       
			
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);
						value.set("rate", rate);
					});
					self.lineDS.sync();												
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);
										
					self.set("sub_total", 0);
					self.set("vat", 0);
					self.set("total", 0);
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	    
	    //Create
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },	    
	    clear 				: function(){	   	    	
	    	this.set("isEdit", false);
	    	this.set("paid", false);
	    	
			this.set("sub_total", 0);
			this.set("vat", 0);	
			this.set("total", 0);				
	    }		
	});
	banhji.grn =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		lineDS  			: dataStore(baseUrl + "invoices/line"),			
		contactDS  			: dataStore(baseUrl + "contacts"),
		referenceDS			: dataStore(baseUrl + "invoices"),
		referenceLineDS		: dataStore(baseUrl + "invoices/line"),					
		itemDS 				: dataStore(baseUrl + "items"),
		catalogDS			: dataStore(baseUrl + "items"),
		assemblyDS			: dataStore(baseUrl + "items/assembly"),
		itemList 			: [],
		referenceTypes 		: [			
			{ id:"PO", name:"Purchase Order" }
		],
		obj 				: null,
		isEdit 				: false,
		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,			
		paid 				: false,		
		bolReference 		: false,
		total 				: 0,
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					this.set("paid", false);
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}
		},	    
	    loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);		    			    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);

				self.lineDS.data([]);
				self.addRow();				
			});				
		},					
		loadReference 		: function(e){			
			var obj = this.get("obj");

			if(obj.reference_type!==""){
				this.set("bolReference", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: obj.reference_type }
				]);				
			}else{
				this.set("bolReference", false);
			}							
		},			
		loadInvoice 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];								    	
				
				//Status
				if(obj.status==1){
					self.set("paid", true);
				}else{
					self.set("paid", false);
				}
				
		        self.set("total", kendo.toString(obj.amount, "n"));	  			
								
				self.contactDS.filter({ field: "id", value: obj.contact_id });				
				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.set("obj", obj);
			});				
		},
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", operator:"where_not_in", value: 6 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},			
		addEmpty 		 	: function(){
			this.dataSource.data([]);						
			this.set("obj", null);				

			this.dataSource.add({
				company_id 			: 0,
				location_id 		: 0,
				contact_id 			: "",
				payment_term_id		: 0,
				payment_method_id 	: 0,
				reference_id 		: 0,
				account_id 	 		: 0,
				vat_id 				: 0,
				biller_id 			: this.get("biller_id"),
 	    		number 				: "",
			   	type				: "GRN",
			   	sub_total 			: 0,				   		   					   				   	
			   	amount				: 0,
			   	vat 				: 0,
			   	rate				: 1,			   	
			   	locale 				: "km-KH",			   	
			   	issued_date 		: new Date(),
			   	due_date 			: "",
			   	check_no 			: "",
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,

			   	segments 			: []				
	    	});		    		
			
			var data = this.dataSource.data();
			var obj = data[data.length-1];			
			this.set("obj", obj);

			this.addRow();
		},
		addRow 				: function(){				
			var invoice_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				invoice_id = obj.id;
			}
						
			this.lineDS.add({					
				invoice_id 			: invoice_id,
				item_id 			: "",
				currency_id 		: 0,
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				
				priceList 			: []
			});																	
		},
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		changes				: function(){
			var obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0;											

				$.each(this.lineDS.data(), function(index, value) {				
					total += kendo.parseInt(value.unit);					
		        });
		        
		        this.set("total", kendo.toString(total, "n"));
		        		
				obj.set("amount", total);									    	
	    	}else{    		
		        this.set("total", 0);

		        obj.set("sub_total", 0);
		        obj.set("vat", 0);			
				obj.set("amount", 0);				
	    	}   	
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"), company_id = 0,		    	
		    	contact = this.contactDS.get(obj.contact_id);	    	
		    	
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    		    			
				
		    	this.lineDS.data([]);
		    	this.addRow();		    	
		    	this.changes();
	    	}
	    },	    
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			invoice_id = 0, 
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id),
			contact = this.contactDS.get(obj.contact_id);

			if(data.item_id>0 && obj.contact_id>0){		        
		        if(item.is_catalog=="1"){
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:item.catalogs }
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.price_list[0].currency[0].rate);
		        			
					        if(self.get("isEdit")){
								invoice_id = obj.id;
							}
										
							self.lineDS.add({					
								invoice_id 			: invoice_id,
								item_id 			: value.id,
								measurement_id 		: value.price_list[0].measurement_id,
								meter_record_id	 	: 0,
								description 		: value.name,				
								unit 	 			: 1,
								price 				: value.price_list[0].price*rate,												
								amount 				: value.price_list[0].price*rate,
								rate				: rate,
								locale				: obj.locale,
								has_vat 			: false,
								type 				: "",

								priceList 			: value.price_list
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assemble=="1"){
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price*rate);
			        data.set("measurement_id", 0);
			        data.set("rate", rate);		        	        
			        data.set("priceList", []);

			        this.changes();		     
		        }else{
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price_list[0].price*rate);
			        data.set("measurement_id", item.price_list[0].measurement_id);
			        data.set("rate", rate);		        	        
			        data.set("priceList", item.price_list);

			        this.changes();
		    	}		        
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		measurementChanges 	: function(e){								
			var self = this, data = e.data, obj = this.get("obj");

			if(data.measurement_id>0){				
				var contact = this.contactDS.get(obj.contact_id);				

				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.currency[0].rate);
				        data.set("price", kendo.parseFloat(value.price)*rate);				       			       
				        data.set("rate", rate);

						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		referenceChange 	: function(e){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				obj.set("vat_id", ref.vat_id);

			 	this.referenceLineDS.query({
			 		filter: { field:"invoice_id", value: obj.reference_id },
			 		page: 1,
			 		take: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							invoice_id 			: obj.invoice_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,
							meter_record_id	 	: value.meter_record_id,
							description 		: value.description,				
							unit 	 			: value.unit,
							price 				: value.price,												
							amount 				: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							has_vat 			: value.has_vat,
							type 				: value.type,

							priceList 			: value.priceList
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}								
		},
		save 				: function(){				
	    	var self = this, obj = this.get("obj"), rate = this.getRate();
	    	
	        obj.set("rate", rate);	        
	       
			//Update references
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("status", 1);
				this.referenceDS.sync();
			}
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);
						value.set("rate", rate);
					});
					self.lineDS.sync();													
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);
					
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	    
	    //Create
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },	    
	    clear 				: function(){	   	    	
	    	this.set("isEdit", false);
	    	this.set("paid", false);	    	
			
			this.set("total", 0);				
	    } 		
	});
	banhji.purchase =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		lineDS  			: dataStore(baseUrl + "invoices/line"),			
		contactDS  			: dataStore(baseUrl + "contacts"),
		referenceDS			: dataStore(baseUrl + "invoices"),
		referenceLineDS		: dataStore(baseUrl + "invoices/line"),					
		itemDS 				: dataStore(baseUrl + "items"),
		catalogDS			: dataStore(baseUrl + "items"),
		assemblyDS			: dataStore(baseUrl + "items/assembly"),
		vatDS 				: dataStore(baseUrl + "items"),		
		paymentMethodDS 	: dataStore(baseUrl + "payment_methods"),
		cashAccountDS		: dataStore(baseUrl + "accounts"),
		paymentDS 			: dataStore(baseUrl + "payments"),		
		segmentItemDS		: banhji.segmentItem.ds,
		itemList 			: [],
		referenceTypes 		: [
			{ id:"Estimate", name:"Estimate" },
			{ id:"SO", name:"Sale Order" },
			{ id:"GDN", name:"GDN" },
			{ id:"Invoice", name:"Invoice" }
		],		
		obj 				: null,
		isEdit 				: false,
		isCash 				: true,
		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,			
		paid 				: false,		
		bolReference 		: false,
		sub_total 			: 0,
		vat 				: 0,
		total 				: 0,
		pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadInvoice(id);
			}else{				
				this.set("isEdit", false);
				this.set("paid", false);
				this.addEmpty();								
			}  																							
		},	    
	    loadContact 		: function(id){
			var self = this;			
			console.log(id);
			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_method_id", view[0].payment_method_id);
		    	obj.set("vat_id", view[0].tax_item_id);		    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);

				self.lineDS.data([]);
				self.addRow();				
			});				
		},					
		loadReference 		: function(e){			
			var obj = this.get("obj");

			if(obj.reference_type!==""){
				this.set("bolReference", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: obj.reference_type }
				]);				
			}else{
				this.set("bolReference", false);
			}							
		},			
		loadInvoice 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];								    	
				
				//Status
				if(obj.status==1){
					self.set("paid", true);
				}else{
					self.set("paid", false);
				}

				self.set("sub_total", kendo.toString(obj.sub_total, "c", obj.locale));
		        self.set("vat", kendo.toString(obj.vat, "c", obj.locale));
		        self.set("total", kendo.toString(obj.amount, "c", obj.locale));	  			
								
				self.contactDS.filter({ field: "id", value: obj.contact_id });				
				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.set("obj", obj);
			});				
		},
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", operator:"where_not_in", value: 6 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},			
		addEmpty 		 	: function(){
			if(this.dataSource.total()==0){
				var duedate = new Date();
				duedate.setDate(duedate.getDate()+7);
				this.set("obj", null);				

				this.dataSource.add({
					company_id 			: 0,
					location_id 		: 0,
					contact_id 			: "",
					payment_term_id		: 0,
					payment_method_id 	: 0,
					reference_id 		: 0,
					account_id 	 		: 2,
					vat_id 				: 0,
					biller_id 			: this.get("biller_id"),
	 	    		number 				: "",
				   	type				: "Purchase",
				   	sub_total 			: 0,				   		   					   				   	
				   	amount				: 0,
				   	vat 				: 0,
				   	rate				: 1,			   	
				   	locale 				: "km-KH",			   	
				   	issued_date 		: new Date(),
				   	due_date 			: duedate,
				   	check_no 			: "",
				   	bill_to 			: "",
				   	ship_to 			: "",
				   	memo 				: "",
				   	memo2 				: "",
				   	status 				: 0,

				   	segments 			: []				
		    	});		    		
				
				var data = this.dataSource.data();
				var obj = data[data.length-1];			
				this.set("obj", obj);

				this.addRow();  
			}
		},
		addRow 				: function(){				
			var invoice_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				invoice_id = obj.id;
			}
						
			this.lineDS.add({					
				invoice_id 			: invoice_id,
				item_id 			: "",
				currency_id 		: 0,
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				movement 			: "-1",

				priceList 			: []
			});																	
		},
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		changes				: function(){
			var obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, vat = 0, vatAmt = 0;
								
				if(kendo.parseInt(obj.vat_id)>0){
					var selectedVat = this.vatDS.get(obj.vat_id);					
					vatAmt = kendo.parseFloat(selectedVat.price_list[0].price);
				}								

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.unit * value.price;
					subTotal += amt;

					value.set("amount", amt);

					if(value.has_vat){
						vat += amt * vatAmt;						
					}
		        });

		        total = subTotal + vat;			

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("vat", kendo.toString(vat, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("vat", vat);			
				obj.set("amount", total);									    	
	    	}else{
	    		this.set("sub_total", kendo.toString(0, "c", obj.locale));
		        this.set("vat", kendo.toString(0, "c", obj.locale));
		        this.set("total", kendo.toString(0, "c", obj.locale));

		        obj.set("sub_total", 0);
		        obj.set("vat", 0);			
				obj.set("amount", 0);				
	    	}   	
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"), company_id = 0,		    	
		    	contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("payment_method_id", contact.payment_method_id);
		    	obj.set("vat_id", contact.tax_item_id);
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    		    			
				
		    	this.lineDS.data([]);
		    	this.addRow();		    	
		    	this.changes();
	    	}
	    },
	    radioChanges 		: function(){
	    	var obj = this.get("obj");

	    	if(obj.type=="Purchase"){
	    		this.set("isCash", true);
	    	}else{
	    		this.set("isCash", false);
	    	}	    	
	    },
	    segmentChanges 		: function(e) {
			var obj = this.get("obj"),
			dataArr = obj.segments,
			lastIndex = dataArr.length - 1,
			last = banhji.segmentItem.ds.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = banhji.segmentItem.ds.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			invoice_id = 0, 
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id),
			contact = this.contactDS.get(obj.contact_id);

			if(data.item_id>0 && obj.contact_id>0){		        
		        if(item.is_catalog=="1"){
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:item.catalogs }
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.price_list[0].currency[0].rate);
		        			
					        if(self.get("isEdit")){
								invoice_id = obj.id;
							}
										
							self.lineDS.add({					
								invoice_id 			: invoice_id,
								item_id 			: value.id,
								measurement_id 		: value.price_list[0].measurement_id,
								meter_record_id	 	: 0,
								description 		: value.name,				
								unit 	 			: 1,
								price 				: value.price_list[0].price*rate,												
								amount 				: value.price_list[0].price*rate,
								rate				: rate,
								locale				: obj.locale,
								has_vat 			: false,
								type 				: "",

								priceList 			: value.price_list
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assemble=="1"){
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price*rate);
			        data.set("measurement_id", 0);
			        data.set("rate", rate);		        	        
			        data.set("priceList", []);

			        this.changes();		     
		        }else{
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price_list[0].price*rate);
			        data.set("measurement_id", item.price_list[0].measurement_id);
			        data.set("rate", rate);		        	        
			        data.set("priceList", item.price_list);

			        this.changes();
		    	}		        
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		measurementChanges 	: function(e){								
			var self = this, data = e.data, obj = this.get("obj");

			if(data.measurement_id>0){				
				var contact = this.contactDS.get(obj.contact_id);				

				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.currency[0].rate);
				        data.set("price", kendo.parseFloat(value.price)*rate);				       			       
				        data.set("rate", rate);

						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		referenceChange 	: function(e){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				obj.set("vat_id", ref.vat_id);

			 	this.referenceLineDS.query({
			 		filter: { field:"invoice_id", value: obj.reference_id },
			 		page: 1,
			 		take: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							invoice_id 			: obj.invoice_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,
							meter_record_id	 	: value.meter_record_id,
							description 		: value.description,				
							unit 	 			: value.unit,
							price 				: value.price,												
							amount 				: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							has_vat 			: value.has_vat,
							type 				: value.type,

							priceList 			: value.priceList
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}								
		},
		addPayment 			: function(invoice_id){
			var obj = this.get("obj"), rate = this.getRate();

			this.paymentDS.add({
				company_id 			: obj.company_id,
				contact_id 			: obj.contact_id,
				cashier_id 			: this.get("biller_id"),
				meter_id 			: 0,							
				reference_id		: invoice_id,														
				payment_method_id	: obj.payment_method_id,
				account_id			: obj.account_id,
				check_no			: obj.check_no,							
				type 				: obj.type,
				amount 				: obj.amount,
				fine 				: 0,
				discount 			: 0,
				rate 				: obj.rate,
				locale 				: obj.locale,
				payment_date		: kendo.toString(new Date(obj.issued_date), "yyyy-MM-dd")
			});

			this.paymentDS.sync();					
		},
		save 				: function(){				
	    	var self = this, obj = this.get("obj"), rate = this.getRate();

	    	obj.set("sub_total", kendo.parseFloat(obj.sub_total)*rate);
	    	obj.set("vat", kendo.parseFloat(obj.vat)*rate);
	        obj.set("amount", kendo.parseFloat(obj.amount)*rate);
	        obj.set("rate", rate);				        
	       
			//Update references
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("status", 1);
				this.referenceDS.sync();
			}
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);
						value.set("rate", rate);
					});
					self.lineDS.sync();

					if(invoice[0].type=="Purchase"){
						self.addPayment(invoice[0].id);
					}
					
					self.addJournal(invoice[0].id);								
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);
					self.paymentDS.data([]);

					self.set("sub_total", 0);
					self.set("vat", 0);
					self.set("total", 0);
					
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	    
	    //Create
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },	    
	    clear 				: function(){	   	    	
	    	this.set("isEdit", false);
	    	this.set("paid", false);
	    	
			this.set("sub_total", 0);
			this.set("vat", 0);	
			this.set("total", 0);				
	    },
	    //Journal
	    getItemAccount 		: function(type, item_id){
	    	var self = this,	    	
	    	id = 0,
	    	item = this.itemDS.get(item_id);	    	
	    	
	    	if(item.accounts){
		    	$.each(item.accounts, function(index, value){
		    		if(value.type==type){
		    			id = value.id;

		    			return false;
		    		}
		    	});
	    	}	    	

	    	return kendo.parseInt(id);	    	
	    },	    
	    addJournal 			: function(invoice_id){
	    	var self = this,
	    	invoice = this.get("obj"),
	    	customer = this.contactDS.get(invoice.contact_id),
			rate = invoice.rate,
	    	entries = [],
	    	segments = [],
	    	saleList = {},
	    	inventoryList = {},
			cogsList = {},
			witdrawList = {},
			depositAmount = 0;

			//Segments
			$.each(invoice.segments, function(index, value){
				segments.push({ id:value });
			});
			
			//Arrange sale, cogs, inventory, customer deposit or widraw
			$.each(this.lineDS.data(), function(index, value){										
				var item = self.itemDS.get(value.item_id),
				amt = value.unit*value.price;

				//Add sale list
				var incomeID = self.itemDS.get(value.item_id).income_account_id;																				
				if(incomeID>0){
					if(saleList[incomeID]===undefined){
						saleList[incomeID]={"id": incomeID, "amt": amt};						
					}else{											
						if(saleList[incomeID].id===incomeID){
							saleList[incomeID].amt += amt;
						}else{
							saleList[incomeID]={"id": incomeID, "amt": amt};
						}
					}
				}								

				switch(kendo.parseInt(item.item_type_id)){		        
					case 1: //Inventory
					
						//Add cogs list
						var itemCost = value.unit*item.cost;
						var cogsID = self.itemDS.get(value.item_id).cogs_account_id;
						if(cogsList[cogsID]===undefined){
							cogsList[cogsID]={"id": cogsID, "amt": itemCost};						
						}else{											
							if(cogsList[cogsID].id===cogsID){
								cogsList[cogsID].amt += itemCost;
							}else{
								cogsList[cogsID]={"id": cogsID, "amt": itemCost};
							}
						}						

						//Add inventory list
						var inventoryID = self.itemDS.get(value.item_id).inventory_account_id;
						if(inventoryList[inventoryID]===undefined){
							inventoryList[inventoryID]={"id": inventoryID, "amt": itemCost};						
						}else{											
							if(inventoryList[inventoryID].id===inventoryID){
								inventoryList[inventoryID].amt += itemCost;
							}else{
								inventoryList[inventoryID]={"id": inventoryID, "amt": itemCost};
							}
						}										

					  	break;
					case 5: //Customer Deposit
						depositAmount += amt;
						var depositID = customer.deposit_account_id;

						if(amt>0){ //Deposit														
							if(saleList[depositID]===undefined){
								saleList[depositID]={"id": depositID, "amt": amt};						
							}else{											
								if(saleList[depositID].id===depositID){
									saleList[depositID].amt += amt;
								}else{
									saleList[depositID]={"id": depositID, "amt": amt};
								}
							}																			
						}else{ //Witdraw												
							if(witdrawList[depositID]===undefined){
								witdrawList[depositID]={"id": depositID, "amt": amt*-1};						
							}else{											
								if(witdrawList[depositID].id===depositID){
									witdrawList[depositID].amt += (amt*-1);
								}else{
									witdrawList[depositID]={"id": depositID, "amt": amt*-1};
								}
							}														
						}

					  	break;					
					default:
				  	//default here
				} //End Swtich
			});//End Foreach Loop

			//VAT			
			if(invoice.vat_id>0){				
				var vatOutID = self.vatDS.get(invoice.vat_id).income_account_id;
				
				if(vatOutID>0){
					var vatAmt = kendo.parseFloat(invoice.vat)*rate;
					if(saleList[vatOutID]===undefined){
						saleList[vatOutID]={"id": vatOutID, "amt": vatAmt};						
					}else{											
						if(saleList[vatOutID].id===vatOutID){
							saleList[vatOutID].amt += vatAmt;
						}else{
							saleList[vatOutID]={"id": vatOutID, "amt": vatAmt};
						}
					}
				}
			}			
			
			//Sale list	to journal		
			if(!jQuery.isEmptyObject(saleList)){								
				//Sum cash
				var cash = 0;				
				$.each(saleList, function(index, value){					
					cash += value.amt;					
				});				

				//Cash on Dr
				entries.push({
					amount  : cash*rate,
					memo 	: "Invoice",
					is_debit: true,
					account : { id: invoice.account_id },
					rate 	: rate,
					locale 	: invoice.locale,
					issuedDate: invoice.issued_date,
					segment : segments,
					contact : customer
				});					

				//Sale accounts on Cr
				$.each(saleList, function(index, value){
					entries.push({
						amount  : value.amt*rate,
						memo 	: "Invoice",
						is_debit: false,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});							
				});
			}

			//Inventory to journal
			//COGS on Dr 			
			if(!jQuery.isEmptyObject(cogsList)){							
				$.each(cogsList, function(index, value){				
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: true,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});					
				});							
			}
			//Inventory on Cr
			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){					
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: false,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});					
				});
			}
			
			//Witdraw to journal
			if(!jQuery.isEmptyObject(witdrawList)){
				//Deposit on Dr
				$.each(witdrawList, function(index, value){
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: true,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});						
				});

				var wCash = 0;
				$.each(witdrawList, function(index, value){					
					wCash += value.amt;
				});

				//Cash on Cr
				entries.push({
					amount  :  wCash*rate,
					memo 	: "Invoice",
					is_debit: false,
					account : { id: invoice.account_id },
					rate 	: rate,
					locale 	: invoice.locale,
					issuedDate: invoice.issued_date,
					segment : segments,
					contact : customer
				});							
			}
			//Customer deposit
			if(depositAmount>0){
				this.paymentDS.add({
					company_id 	: invoice.company_id,
					contact_id 	: customer.id,
					reference_id: invoice_id,
					cashier 	: this.get("biller_id"),
					type 		: "deposit",
					amount 		: depositAmount,
					fine 		: 0,
					discount 	: 0,
					payment_date: invoice.issued_date,
					locale 		: invoice.locale,
					rate 		: invoice.rate,
					deleted 	: false
				});				
			}
			
			//Add journal to datasource
			banhji.journalEntry.addNew({
				reference: { id: invoice_id },
				type: invoice.type,
				memo: invoice.type,
				issuedDate: invoice.issued_date,
				contact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
				entries: entries
			});			
			banhji.journalEntry.save();			
		}	 		
	});	
	banhji.vendorSetting =  kendo.observable({
		lang 				: langVM,		
        contactTypeDS 		: dataStore(baseUrl + "contacts/type"),
        paymentMethodDS		: dataStore(baseUrl + "payment_methods"),
        paymentTermDS		: dataStore(baseUrl + "payment_terms"),
        contactTypeName 	: "",
        paymentMethodName 	: "",
        paymentTermName 	: "",
        paymentTermNetDue 		: "",
        paymentTermDiscountPeriod : "",
        paymentTermDiscountPercentage 	: "",
        pageLoad 			: function() {
        	
        },	    
        addContactType 		: function(){
        	var self = this, 
        	name = this.get("contactTypeName");

        	if(name!==""){
	        	this.contactTypeDS.add({
	        		parent_id 	: 2,
	        		contact_id 	: 0,
	        		name 		: name,
	        		description : "",
	        		is_system 	: 0
	        	});

	        	this.contactTypeDS.sync();
	        	this.contactTypeDS.bind("requestEnd", function(){
	        		self.set("contactTypeName", "");
	        	});
        	}
        },
        addPaymentMethod 		: function(){
        	var self = this, name = this.get("paymentMethodName");

        	if(name!==""){
	        	this.paymentMethodDS.add({	        		
	        		name 		: name,
	        		description : ""
	        	});

	        	this.paymentMethodDS.sync();
	        	this.paymentMethodDS.bind("requestEnd", function(){
	        		self.set("paymentMethodName", "");
	        	});
        	}
        },
        addPaymentTerm 		: function(){
        	var self = this, 
        	name = this.get("paymentTermName"),
        	netDue = this.get("paymentTermNetDue");

        	if(name!=="" && netDue!==""){
	        	this.paymentTermDS.add({	        		
	        		name 				: name,
	        		net_due 			: netDue,
	        		discount_period 	: this.get("paymentTermDiscountPeriod"),
	        		discount_percentage : this.get("paymentTermDiscountPercentage"),
	        		is_system 			: 0
	        	});

	        	this.paymentTermDS.sync();
	        	this.paymentTermDS.bind("requestEnd", function(){
	        		self.set("paymentTermName", "");
	        		self.set("paymentTermNetDue", "");
	        		self.set("paymentTermDiscountPeriod", "");
	        		self.set("paymentTermDiscountPercentage", "");
	        	});
        	}else{
        		alert("Term and Net Due are required.");
        	}
        },
        goPattern 	: function(e){
        	var data = e.data;

        	banhji.router.navigate('/vendor');        	

        	if(kendo.parseInt(data.contact_id)>0){
	        	banhji.vendor.loadPatternEdit(data.contact_id);   	
        	}else{
        		banhji.vendor.setPattern(data.id);
        	}
        }        
    });	


	/*************************
	*   SME Section   *
	**************************/
	banhji.customerCenter = kendo.observable({
		lang 				: langVM,
		transactionDS  		: dataStore(baseUrl + 'invoices/wtransaction'),
		contactDS 			: dataStore(baseUrl + 'contacts'),
		contactTypeDS		: dataStore(baseUrl + 'contacts/type'),
		noteDS 				: dataStore(baseUrl + 'notes'),		
		currencyDS 			: dataStore(baseUrl + 'currencies'),
		monthlyDS 			: dataStore(baseUrl + 'invoices/monthly_sale'),
		outstandingDS 		: dataStore(baseUrl + "invoices/woutstanding"),		

		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "year",
		sdate 				: "",
		edate 				: "",
				
		obj 				: null,
		note 				: "",		
		searchText 			: "",		
		contact_type_id 	: 0,
		currency_id 		: 0,
		user_id 			: banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id,

		balance 			: 0,
		deposit 			: 0,
		outInvoice 			: 0,
		overInvoice 		: 0,
		
		pageLoad 			: function(){		
												
		},
		loadOutStandingInvoice: function(id){
			var self = this;

			this.outstandingDS.query({
				filter: { field: "contact_id", value: id },
				page: 1,
				take: 100
			}).then(function(e) {
				var view = self.outstandingDS.view();

				self.set("deposit", kendo.toString(view[0].deposit, "c0", "km-KH"));
				self.set("outInvoice", kendo.toString(view[1].outInvoice, "n0"));
				self.set("overInvoice", kendo.toString(view[2].overInvoice, "n0"));
				self.set("balance", kendo.toString(view[3].balance, "c0", "km-KH"));
			});
		},
		loadTransaction 	: function(id){
			this.transactionDS.query({
			  	filter: { field:"contact_id", value: id },
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadBalance 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", operator:"invoice", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Invoice", "wInvoice"] },
			  		{ field:"status", operator:"invoice", value: 0 },
			  		{ field:"id", operator:"payment", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadDeposit 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", operator:"payment", value: obj.id },
			  		{ field:"type", operator:"payment", value:"deposit" },			  		
			  		{ field:"id", operator:"invoice", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadOverInvoice 	: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", operator:"invoice", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Invoice", "wInvoice"] },
			  		{ field:"status", operator:"invoice", value: 0 },
			  		{ field:"due_date <", operator:"invoice", value: kendo.toString(new Date(), "yyyy-MM-dd") },
			  		{ field:"id", operator:"payment", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},		
		loadNote 			: function(id){
			this.noteDS.query({
				filter: { field:"contact_id", value: id },
				sort: { field:"noted_date", dir:"desc" },
				page: 1,
				take: 100
			});
		},
		loadGraph 			: function(id){
			var self = this;

			this.monthlyDS.query({
				filter: { field: "contact_id", value: id },
				page: 1,
				take: 100
			}).then(function(e) {
			    var view = self.monthlyDS.view();
			    
				$('#sale-graph').kendoChart({
					dataSource: {data: view},												
					series: [
						{field: 'amount', categoryField:'month', type: 'line', axis: 'sale'}
					],
					valueAxes: [
						{
		                    name: "sale",
		                    color: "#007eff",
		                    min: 0,
		                    majorUnit: 10000,
		                    max: 100000
		                }
	                ],
	                categoryAxis: {
	                    //categories: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],		                    
	                    axisCrossingValues: [0, 13],
	                    justified: true
	                },
	                tooltip: {
	                    visible: true,
	                    format: "{0}",
	                    template: "#= series.field #: #= value #"
	                }
				});
			});		
		},		
		selectedRow			: function(e){
			var id = e.data.id,
			data = e.data;			
			
			this.set("obj", data);
			this.loadGraph(id);
			this.loadOutStandingInvoice(id);
			this.loadTransaction(id);			
			this.loadNote(id);
		},
		sorterChanges 		: function(){
			var value = this.get("sorter");

			switch(value){
			case "today":
				var today = new Date();
				
				this.set("sdate", today);
				this.set("edate", today);
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this, 
			para = [],
      		txtSearch = this.get("searchText"),       		
      		contact_type_id = this.get("contact_type_id"),
      		currency_id = this.get("currency_id");      		
      		
      		if(txtSearch){
      			para.push(      				
      				{ field: "number", operator: "like", value: txtSearch },
      				{ field: "surname", operator: "or_like", value: txtSearch },
					{ field: "name", operator: "or_like", value: txtSearch },
					{ field: "company", operator: "or_like", value: txtSearch }
      			);
      		}      		

      		if(contact_type_id){
      			para.push({ field: "contact_type_id", value: contact_type_id });
      		}else{
      			para.push({ field: "parent_id", model:"contact_type", operator:"where_related", value: 1 });
      		}

      		if(currency_id){
      			para.push({ field: "currency_id", value: currency_id });
      		}      		

      		this.contactDS.filter(para);
      		var loaded = false;
      		this.contactDS.bind("requestEnd", function(){
      			if(loaded==false){
      				loaded = true;

      				//Clear search filters
		      		self.set("searchText", "");		      		
		      		self.set("contact_type_id", 0);
		      		self.set("currency_id", 0);
      			}
      		});      			
		},
		searchTransaction	: function(){
			var self = this,
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),	        		
        		para = [];

        	//Dates
        	if(start && end){
            	para.push({ field:"start_date", value: kendo.toString(start, "yyyy-MM-dd") });
            	para.push({ field:"end_date", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
            }else if(start){
            	para.push({ field:"start_date", value: kendo.toString(start, "yyyy-MM-dd") });
            }else if(end){
            	para.push({ field:"end_date", value: kendo.toString(end, "yyyy-MM-dd") });
            }else{
            	
            }            

            this.transactionDS.query({
            	filter: para,
            	sort: { field: "issued_date", dir: "desc" },
            	page: 1,
            	pageSize: 100
            });            
		},	
		goEditContact 		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/customer/'+obj.id);
		},
		goEstimate			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/estimate');
			banhji.estimate.loadContact(obj.id);			
		},
		goSO				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/so');
			banhji.so.loadContact(obj.id);
		},
		goReceipt			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/receipt');
			banhji.receipt.loadContact(obj.id);
		},
		goInvoice			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/invoice');
			banhji.invoice.loadContact(obj.id);					
		},
		goGDN				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/gdn');
			banhji.gdn.loadContact(obj.id);
		},
		goStatement			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/statement');
			banhji.statement.loadContact(obj.id);
		},
		saveNote 			: function(){
			var self = this;

			if(this.get("note")!==""){
				this.noteDS.insert(0, {
					contact_id 	: this.get("obj").id,
					note 		: this.get("note"),
					noted_date	: new Date(),
					created_by 	: this.get("user_id"),

					creator 	: ""
				});
				var saved = false;
				this.noteDS.sync();
				this.noteDS.bind("requestEnd", function(){
					if(saved==false){
						saved = true;

						self.set("note", "");
					}
				});
			}else{
				alert("required memo...");
			}
		}		
	});

	banhji.customer = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(baseUrl + "contacts"),
		numberDS 				: dataStore(baseUrl + "contacts"),
		deleteDS 				: dataStore(baseUrl + "invoices"),		
		existingDS 				: dataStore(baseUrl + "contacts"),		
		contactPersonDS			: dataStore(baseUrl + "contact_persons"),
		currencyDS 				: dataStore(baseUrl + "currencies"),
		paymentTermDS			: dataStore(baseUrl + "payment_terms"),
		paymentMethodDS			: dataStore(baseUrl + "payment_methods"),

		genders					: ["M", "F"],
		statusList 				: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],

        obj 					: null,       
		originalNo				: null,	
		isDuplicateNumber 		: false,		

		isCompany 				: false,
		isEdit 					: false,				
		
		pageLoad 				: function(id){
			if(id){
				this.set("isEdit", true);							
				this.loadCustomer(id);
				this.loadContactPerson(id);				
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
										
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}			
		},		
		loadCustomer 			: function(id){
			var self = this;

			this.dataSource.query({
				filter: { "field":"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();

				if(view[0].contact_type_id=="6" || view[0].contact_type_id=="7" || view[0].contact_type_id=="8"){
					self.set("isCompany", true);
				}else{
					self.set("isCompany", false);
				}

				self.set("obj", view[0]);
				self.loadMap();
				self.set("originalNo", view[0].number);
				self.set("originalENo", view[0].enumber);
				self.set("originalWNo", view[0].wnumber);								
			});
		},
		loadContactPerson		: function(id){
			this.contactPersonDS.query({
				filter: { "field":"contact_id", value: id },
				page: 1,
				take: 100
			});
		},
		loadMap 				: function(){
			var obj = this.get("obj"), lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);
			
			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map,
					title: obj.number
				});
			} 
		},
		copyBillTo 				: function(){
			var obj = this.get("obj");

			obj.set("ship_to", obj.bill_to);
		},      	
		checkExistingNumber 	: function(){
			var self = this;	
			
			var number = this.get("obj").number;
			var originalNo = this.get("originalNo");
			
			if(number.length>0 && number!==originalNo){
				this.existingDS.query({
					filter: { field:"number", value: number },
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		pad 					: function(str, max){
			str = str.toString();
  			return str.length < max ? this.pad("0" + str, max) : str;
		},
		setNumber 				: function(){
			var self = this, obj = this.get("obj");
			
			this.numberDS.query({
				filter:{ field:"parent_id", operator:"where_related", model:"contact_type", value:1 },
				sort: { field:"number", dir:"desc" },
				page: 1,
				take: 1
			}).then(function(){
				var view = self.numberDS.view(), no = "0001";

				if(view.length>0){
					no = kendo.parseInt(view[0].number);
					if(no){						
						no++;
						no = self.pad(no, 4);							
					}												
				}					
				obj.set("number", no);					
			});			
		},		
		addEmptyContactPerson 	: function(){
			var contact_id = 0;
			if(this.get("isEdit")){
				contact_id = this.get("obj").id;
			}

			this.contactPersonDS.add({					 			
				contact_id 			: contact_id,
      			prefix 				: "",      			
				name 				: "",
				department			: "",
				phone				: "",
				email				: ""
			});								
		},
		deleteContactPerson 	: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.contactPersonDS.getByUid(d.uid);

				this.contactPersonDS.remove(obj);
			}
		},
      	addEmpty 				: function(){
      		this.dataSource.data([]);
      		this.set("obj", null);

			this.dataSource.add({
				"company_id" 			: 0,
				"ebranch_id" 			: 0,
				"elocation_id"			: 0,
				"wbranch_id" 			: 0,
				"wlocation_id" 			: 0,			
				"currency_id" 			: 0,
				"user_id" 				: 0,
				"contact_type_id" 		: 0,
				"number_head" 			: "ID",							
				"number"				: "",
				"enumber"				: "",
				"wnumber"				: "",
				"surname"				: "",
				"name"					: "",
				"gender"				: "M",
				"dob"					: "",
				"pob"					: "",				
				"family_member"			: "",
				"id_number"				: "",
				"phone" 				: "",
				"email" 				: "",			
				"job"					: "",
				"company"				: "",
				"company_en"			: "",		
				"business_type_id"		: 0,
				"vat_no"				: "",				
				"image_url"				: "",
				"memo"					: "",
				"address" 				: "",
				"bill_to" 				: "",
				"ship_to" 				: "",
				"latitute" 				: "",
				"longtitute" 			: "",														
				"payment_term_id"		: 0,
				"payment_method_id"		: 0,
				"credit_limit"			: 0,				
				"registered_date" 		: new Date(),
				"contact_account_id"	: 0,
				"ra_id"					: 0,
				"tax_item_id"		: 0,
				"deposit_account_id"	: 0,
				"discount_account_id"	: 0,
				"phase_id"				: 0,
				"voltage_id"			: 0,
				"ampere_id"				: 0,			
				"use_electricity"		: 0,
				"use_water"				: 0,
				"is_pattern" 			: 0,
				"status"				: 1								
			});			

			var data = this.dataSource.data();			
			var obj = data[data.length - 1];			
			this.set("obj", obj);

			this.setNumber();	
		},
		contactSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, saved = false;

			if(this.get("isEdit")){
				this.dataSource.sync();
				this.contactPersonDS.sync();
			}else{
				this.contactSync().then(function(data){
					self.saveContactPerson(data[0].id);
				}).then(function(){					
					self.contactPersonDS.data([]);

					self.addEmpty();
				});
			}						
		},
		delete 					: function(){
			var self = this,
			obj = this.get("obj");

			if (confirm("Are you sure, you want to delete it?")) {				
				this.deleteDS.query({
				  	filter: { field: "contact_id", value: obj.id },
				  	page: 1,
				  	take: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						var data = self.dataSource.get(obj.id);
				        self.dataSource.remove(data);
				        self.save();
					}
				});								
	    	}
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.contactPersonDS.cancelChanges();

			window.history.back();
		},
		saveContactPerson 		: function(id){
			$.each(this.contactPersonDS.data(), function(index, value) {
				value.set("contact_id", id);
			});

			this.contactPersonDS.sync();
		}
	});
	
	banhji.invoice =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		accountDS 			: dataStore(baseUrl + "accounts"),
		lineDS  			: dataStore(baseUrl + "invoices/line"),			
		contactDS  			: dataStore(baseUrl + "contacts"),
		referenceDS			: dataStore(baseUrl + "invoices"),
		referenceLineDS		: dataStore(baseUrl + "invoices/line"),					
		itemDS 				: dataStore(baseUrl + "items"),
		catalogDS			: dataStore(baseUrl + "items"),
		assemblyDS			: dataStore(baseUrl + "items/assembly"),
		vatDS 				: dataStore(baseUrl + "items"),		
		paymentTermDS 		: dataStore(baseUrl + "payment_terms"),			
		segmentItemDS		: banhji.segmentItem.ds,

		itemList 			: [],
		referenceTypes 		: [
			{ id:"Estimate", name:"Estimate" },
			{ id:"SO", name:"Sale Order" },
			{ id:"GDN", name:"GDN" }
		],
		
		obj 				: null,
		isEdit 				: false,

		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,			
		paid 				: false,		
		bolReference 		: false,

		sub_total 			: 0,
		vat 				: 0,
		total 				: 0,				
								
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					this.set("paid", false);
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}
		},	    
	    loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_term_id", view[0].payment_term_id);
		    	obj.set("vat_id", view[0].tax_item_id);		    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);

				self.lineDS.data([]);
				self.addRow();			
			});				
		},					
		loadReference 		: function(e){			
			var obj = this.get("obj");

			if(obj.reference_type!==""){
				this.set("bolReference", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: obj.reference_type }
				]);				
			}else{
				this.set("bolReference", false);
			}							
		},			
		loadObj 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];								    	
				
				//Status
				if(obj.status==1){
					self.set("paid", true);
				}else{
					self.set("paid", false);
				}

				self.set("sub_total", kendo.toString(obj.sub_total, "c", obj.locale));
		        self.set("vat", kendo.toString(obj.vat, "c", obj.locale));
		        self.set("total", kendo.toString(obj.amount, "c", obj.locale));	  			
								
				self.contactDS.filter({ field: "id", value: obj.contact_id });				
				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.set("obj", obj);
			});				
		},
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", operator:"where_not_in", value: 6 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},			
		addEmpty 		 	: function(){			
			var duedate = new Date();
			duedate.setDate(duedate.getDate()+7);
			this.set("obj", null);				

			this.dataSource.add({
				company_id 			: 0,
				location_id 		: 0,
				contact_id 			: "",
				payment_term_id		: 0,
				payment_method_id 	: 0,
				reference_id 		: 0,
				account_id 			: 0,
				vat_id 				: 0,
				biller_id 			: this.get("biller_id"),
 	    		number 				: "",
			   	type				: "Invoice",
			   	sub_total 			: 0,				   		   					   				   	
			   	amount				: 0,
			   	vat 				: 0,
			   	rate				: 1,			   	
			   	locale 				: "km-KH",			   	
			   	issued_date 		: new Date(),
			   	due_date 			: duedate,
			   	check_no 			: "",
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,

			   	segments 			: []				
	    	});		    		
			
			var data = this.dataSource.data();
			var obj = data[data.length-1];			
			this.set("obj", obj);

			this.addRow();			
		},
		addRow 				: function(){				
			var invoice_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				invoice_id = obj.id;
			}
						
			this.lineDS.add({					
				invoice_id 			: invoice_id,
				item_id 			: "",				
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				type 				: obj.type,
				movement 			: "-1",

				priceList 			: []
			});																	
		},		
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		changes				: function(){
			var obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, vat = 0, vatAmt = 0;
								
				if(kendo.parseInt(obj.vat_id)>0){
					var selectedVat = this.vatDS.get(obj.vat_id);					
					vatAmt = kendo.parseFloat(selectedVat.price_list[0].price);
				}								

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.unit * value.price;
					subTotal += amt;

					value.set("amount", amt);

					if(value.has_vat){
						vat += amt * vatAmt;						
					}
		        });

		        total = subTotal + vat;			

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("vat", kendo.toString(vat, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("vat", vat);			
				obj.set("amount", total);									    	
	    	}else{
	    		this.set("sub_total", kendo.toString(0, "c", obj.locale));
		        this.set("vat", kendo.toString(0, "c", obj.locale));
		        this.set("total", kendo.toString(0, "c", obj.locale));

		        obj.set("sub_total", 0);
		        obj.set("vat", 0);			
				obj.set("amount", 0);				
	    	}   	
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"), company_id = 0,		    	
		    	contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("payment_term_id", contact.payment_term_id);
		    	obj.set("vat_id", contact.tax_item_id);
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    		    			
				
		    	this.lineDS.data([]);
		    	this.addRow();		    	
		    	this.changes();
	    	}
	    },
	    segmentChanges 		 : function(e) {
			var obj = this.get("obj"),
			dataArr = obj.segments,
			lastIndex = dataArr.length - 1,
			last = banhji.segmentItem.ds.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = banhji.segmentItem.ds.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			invoice_id = 0, 
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id),
			contact = this.contactDS.get(obj.contact_id);

			if(data.item_id>0 && obj.contact_id>0){		        
		        if(item.is_catalog=="1"){
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:item.catalogs }
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.price_list[0].currency[0].rate);
		        			
					        if(self.get("isEdit")){
								invoice_id = obj.id;
							}
										
							self.lineDS.add({					
								invoice_id 			: invoice_id,
								item_id 			: value.id,
								measurement_id 		: value.price_list[0].measurement_id,
								meter_record_id	 	: 0,
								description 		: value.name,				
								unit 	 			: 1,
								price 				: value.price_list[0].price*rate,												
								amount 				: value.price_list[0].price*rate,
								rate				: rate,
								locale				: obj.locale,
								has_vat 			: false,
								type 				: "",

								priceList 			: value.price_list
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assemble=="1"){
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price*rate);
			        data.set("measurement_id", 0);
			        data.set("rate", rate);		        	        
			        data.set("priceList", []);

			        this.changes();		     
		        }else{
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price_list[0].price*rate);
			        data.set("measurement_id", item.price_list[0].measurement_id);
			        data.set("rate", rate);		        	        
			        data.set("priceList", item.price_list);

			        this.changes();
		    	}		        
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		measurementChanges 	: function(e){								
			var self = this, data = e.data, obj = this.get("obj");

			if(data.measurement_id>0){				
				var contact = this.contactDS.get(obj.contact_id);				

				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.currency[0].rate);
				        data.set("price", kendo.parseFloat(value.price)*rate);				       			       
				        data.set("rate", rate);

						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		referenceChange 	: function(e){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				obj.set("vat_id", ref.vat_id);

			 	this.referenceLineDS.query({
			 		filter: { field:"invoice_id", value: obj.reference_id },
			 		page: 1,
			 		take: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							invoice_id 			: obj.invoice_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,
							meter_record_id	 	: value.meter_record_id,
							description 		: value.description,				
							unit 	 			: value.unit,
							price 				: value.price,												
							amount 				: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							has_vat 			: value.has_vat,
							type 				: value.type,

							priceList 			: value.priceList
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}								
		},
		save 				: function(){				
	    	var self = this, obj = this.get("obj"), rate = this.getRate();

	    	obj.set("sub_total", kendo.parseFloat(obj.sub_total)*rate);
	    	obj.set("vat", kendo.parseFloat(obj.vat)*rate);
	        obj.set("amount", kendo.parseFloat(obj.amount)*rate);
	        obj.set("rate", rate);	        
	       
			//Update references
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("status", 1);
				this.referenceDS.sync();
			}
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);
						value.set("rate", rate);
					});
					self.lineDS.sync();
					self.addJournal(invoice[0].id);								
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);
										
					self.set("sub_total", 0);
					self.set("vat", 0);
					self.set("total", 0);
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	    
	    //Create
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },	    
	    clear 				: function(){	   	    	
	    	this.set("isEdit", false);
	    	this.set("paid", false);
	    	
			this.set("sub_total", 0);
			this.set("vat", 0);	
			this.set("total", 0);				
	    },
	    //Journal
	    getItemAccount 		: function(type, item_id){
	    	var self = this,	    	
	    	id = 0,
	    	item = this.itemDS.get(item_id);	    	
	    	
	    	if(item.accounts){
		    	$.each(item.accounts, function(index, value){
		    		if(value.type==type){
		    			id = value.id;

		    			return false;
		    		}
		    	});
	    	}	    	

	    	return kendo.parseInt(id);	    	
	    },	    
	    addJournal 			: function(invoice_id){
	    	var self = this,
	    	invoice = this.get("obj"),
	    	customer = this.contactDS.get(invoice.contact_id),
			rate = invoice.rate,
			segments = [],
	    	entries = [],
	    	saleList = {},
	    	inventoryList = {},
			cogsList = {},
			witdrawList = {},
			depositAmount = 0;

			//Segments
			$.each(invoice.segments, function(index, value){
				segments.push({ id:value });
			});
			
			//Arrange sale, cogs, inventory, customer deposit or widraw
			$.each(this.lineDS.data(), function(index, value){										
				var item = self.itemDS.get(value.item_id),
				amt = value.unit*value.price;

				//Add sale list
				var incomeID = self.itemDS.get(value.item_id).income_account_id;																				
				if(incomeID>0){
					if(saleList[incomeID]===undefined){
						saleList[incomeID]={"id": incomeID, "amt": amt};						
					}else{											
						if(saleList[incomeID].id===incomeID){
							saleList[incomeID].amt += amt;
						}else{
							saleList[incomeID]={"id": incomeID, "amt": amt};
						}
					}
				}								

				switch(kendo.parseInt(item.item_type_id)){		        
					case 1: //Inventory
					
						//Add cogs list
						var itemCost = value.unit*item.cost;
						var cogsID = self.itemDS.get(value.item_id).cogs_account_id;
						if(cogsList[cogsID]===undefined){
							cogsList[cogsID]={"id": cogsID, "amt": itemCost};						
						}else{											
							if(cogsList[cogsID].id===cogsID){
								cogsList[cogsID].amt += itemCost;
							}else{
								cogsList[cogsID]={"id": cogsID, "amt": itemCost};
							}
						}						

						//Add inventory list
						var inventoryID = self.itemDS.get(value.item_id).inventory_account_id;
						if(inventoryList[inventoryID]===undefined){
							inventoryList[inventoryID]={"id": inventoryID, "amt": itemCost};						
						}else{											
							if(inventoryList[inventoryID].id===inventoryID){
								inventoryList[inventoryID].amt += itemCost;
							}else{
								inventoryList[inventoryID]={"id": inventoryID, "amt": itemCost};
							}
						}										

					  	break;
					case 5: //Customer Deposit
						depositAmount += amt;
						var depositID = customer.deposit_account_id;

						if(amt>0){ //Deposit														
							if(saleList[depositID]===undefined){
								saleList[depositID]={"id": depositID, "amt": amt};						
							}else{											
								if(saleList[depositID].id===depositID){
									saleList[depositID].amt += amt;
								}else{
									saleList[depositID]={"id": depositID, "amt": amt};
								}
							}																			
						}else{ //Witdraw												
							if(witdrawList[depositID]===undefined){
								witdrawList[depositID]={"id": depositID, "amt": amt*-1};						
							}else{											
								if(witdrawList[depositID].id===depositID){
									witdrawList[depositID].amt += (amt*-1);
								}else{
									witdrawList[depositID]={"id": depositID, "amt": amt*-1};
								}
							}														
						}

					  	break;					
					default:
				  	//default here
				} //End Swtich
			});//End Foreach Loop

			//VAT			
			if(invoice.vat_id>0){				
				var vatOutID = self.vatDS.get(invoice.vat_id).income_account_id;
				
				if(vatOutID>0){
					var vatAmt = kendo.parseFloat(invoice.vat)*rate;
					if(saleList[vatOutID]===undefined){
						saleList[vatOutID]={"id": vatOutID, "amt": vatAmt};						
					}else{											
						if(saleList[vatOutID].id===vatOutID){
							saleList[vatOutID].amt += vatAmt;
						}else{
							saleList[vatOutID]={"id": vatOutID, "amt": vatAmt};
						}
					}
				}
			}			
			
			//Sale list	to journal		
			if(!jQuery.isEmptyObject(saleList)){								
				//Sum cash
				var cash = 0;				
				$.each(saleList, function(index, value){					
					cash += value.amt;					
				});				

				//A/R on Dr
				entries.push({
					amount  : cash*rate,
					memo 	: "Invoice",
					is_debit: true,
					account : { id: customer.contact_account_id },
					rate 	: rate,
					locale 	: invoice.locale,
					issuedDate: invoice.issued_date,
					segment : segments,
					contact : customer
				});					

				//Sale accounts on Cr
				$.each(saleList, function(index, value){
					entries.push({
						amount  : value.amt*rate,
						memo 	: "Invoice",
						is_debit: false,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});							
				});
			}

			//Inventory to journal
			//COGS on Dr 			
			if(!jQuery.isEmptyObject(cogsList)){							
				$.each(cogsList, function(index, value){				
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: true,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});					
				});							
			}
			//Inventory on Cr
			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){					
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: false,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});					
				});
			}
			
			//Witdraw to journal
			if(!jQuery.isEmptyObject(witdrawList)){
				//Deposit on Dr
				$.each(witdrawList, function(index, value){
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: true,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});						
				});

				var wCash = 0;
				$.each(witdrawList, function(index, value){					
					wCash += value.amt;
				});

				//Cash on Cr
				entries.push({
					amount  :  wCash*rate,
					memo 	: "Invoice",
					is_debit: false,
					account : { id: invoice.account_id },
					rate 	: rate,
					locale 	: invoice.locale,
					issuedDate: invoice.issued_date,
					segment : segments,
					contact : customer
				});							
			}
			//Customer deposit
			if(depositAmount>0){
				this.paymentDS.add({
					company_id 	: invoice.company_id,
					contact_id 	: customer.id,
					reference_id: invoice_id,
					cashier 	: this.get("biller_id"),
					type 		: "deposit",
					amount 		: depositAmount,
					fine 		: 0,
					discount 	: 0,
					payment_date: invoice.issued_date,
					locale 		: invoice.locale,
					rate 		: invoice.rate,
					deleted 	: false
				});				
			}
			
			//Add journal to datasource
			banhji.journalEntry.addNew({
				reference: { id: invoice_id },
				type: invoice.type,
				memo: invoice.type,
				issuedDate: invoice.issued_date,
				contact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
				entries: entries
			});			
			banhji.journalEntry.save();			
		}	 		
	});
	banhji.receipt =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		lineDS  			: dataStore(baseUrl + "invoices/line"),			
		contactDS  			: dataStore(baseUrl + "contacts"),
		referenceDS			: dataStore(baseUrl + "invoices"),
		referenceLineDS		: dataStore(baseUrl + "invoices/line"),					
		itemDS 				: dataStore(baseUrl + "items"),
		catalogDS			: dataStore(baseUrl + "items"),
		assemblyDS			: dataStore(baseUrl + "items/assembly"),
		vatDS 				: dataStore(baseUrl + "items"),		
		paymentMethodDS 	: dataStore(baseUrl + "payment_methods"),
		cashAccountDS		: dataStore(baseUrl + "accounts"),
		paymentDS 			: dataStore(baseUrl + "payments"),		
		segmentItemDS		: banhji.segmentItem.ds,

		itemList 			: [],
		referenceTypes 		: [
			{ id:"Estimate", name:"Estimate" },
			{ id:"SO", name:"Sale Order" },
			{ id:"GDN", name:"GDN" },
			{ id:"Invoice", name:"Invoice" }
		],
		
		obj 				: null,
		isEdit 				: false,

		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,			
		paid 				: false,		
		bolReference 		: false,

		sub_total 			: 0,
		vat 				: 0,
		total 				: 0,

		pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadInvoice(id);
			}else{				
				this.set("isEdit", false);
				this.set("paid", false);
				this.addEmpty();								
			}  																							
		},	    
	    loadContact 		: function(id){
			var self = this;			
			console.log(id);
			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_method_id", view[0].payment_method_id);
		    	obj.set("vat_id", view[0].tax_item_id);		    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);

				self.lineDS.data([]);
				self.addRow();				
			});				
		},					
		loadReference 		: function(e){			
			var obj = this.get("obj");

			if(obj.reference_type!==""){
				this.set("bolReference", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: obj.reference_type }
				]);				
			}else{
				this.set("bolReference", false);
			}							
		},			
		loadInvoice 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];								    	
				
				//Status
				if(obj.status==1){
					self.set("paid", true);
				}else{
					self.set("paid", false);
				}

				self.set("sub_total", kendo.toString(obj.sub_total, "c", obj.locale));
		        self.set("vat", kendo.toString(obj.vat, "c", obj.locale));
		        self.set("total", kendo.toString(obj.amount, "c", obj.locale));	  			
								
				self.contactDS.filter({ field: "id", value: obj.contact_id });				
				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.set("obj", obj);
			});				
		},
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", operator:"where_not_in", value: 6 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},			
		addEmpty 		 	: function(){
			if(this.dataSource.total()==0){
				var duedate = new Date();
				duedate.setDate(duedate.getDate()+7);
				this.set("obj", null);				

				this.dataSource.add({
					company_id 			: 0,
					location_id 		: 0,
					contact_id 			: "",
					payment_term_id		: 0,
					payment_method_id 	: 0,
					reference_id 		: 0,
					account_id 	 		: 2,
					vat_id 				: 0,
					biller_id 			: this.get("biller_id"),
	 	    		number 				: "",
				   	type				: "Receipt",
				   	sub_total 			: 0,				   		   					   				   	
				   	amount				: 0,
				   	vat 				: 0,
				   	rate				: 1,			   	
				   	locale 				: "km-KH",			   	
				   	issued_date 		: new Date(),
				   	due_date 			: duedate,
				   	check_no 			: "",
				   	bill_to 			: "",
				   	ship_to 			: "",
				   	memo 				: "",
				   	memo2 				: "",
				   	status 				: 0,

				   	segments 			: []				
		    	});		    		
				
				var data = this.dataSource.data();
				var obj = data[data.length-1];			
				this.set("obj", obj);

				this.addRow();  
			}
		},
		addRow 				: function(){				
			var invoice_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				invoice_id = obj.id;
			}
						
			this.lineDS.add({					
				invoice_id 			: invoice_id,
				item_id 			: "",
				currency_id 		: 0,
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				type 				: obj.type,
				movement 			: "-1",

				priceList 			: []
			});																	
		},
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		changes				: function(){
			var obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, vat = 0, vatAmt = 0;
								
				if(kendo.parseInt(obj.vat_id)>0){
					var selectedVat = this.vatDS.get(obj.vat_id);					
					vatAmt = kendo.parseFloat(selectedVat.price_list[0].price);
				}								

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.unit * value.price;
					subTotal += amt;

					value.set("amount", amt);

					if(value.has_vat){
						vat += amt * vatAmt;						
					}
		        });

		        total = subTotal + vat;			

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("vat", kendo.toString(vat, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("vat", vat);			
				obj.set("amount", total);									    	
	    	}else{
	    		this.set("sub_total", kendo.toString(0, "c", obj.locale));
		        this.set("vat", kendo.toString(0, "c", obj.locale));
		        this.set("total", kendo.toString(0, "c", obj.locale));

		        obj.set("sub_total", 0);
		        obj.set("vat", 0);			
				obj.set("amount", 0);				
	    	}   	
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"), company_id = 0,		    	
		    	contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("payment_method_id", contact.payment_method_id);
		    	obj.set("vat_id", contact.tax_item_id);
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    		    			
				
		    	this.lineDS.data([]);
		    	this.addRow();		    	
		    	this.changes();
	    	}
	    },
	    segmentChanges 		 : function(e) {
			var obj = this.get("obj"),
			dataArr = obj.segments,
			lastIndex = dataArr.length - 1,
			last = banhji.segmentItem.ds.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = banhji.segmentItem.ds.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			invoice_id = 0, 
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id),
			contact = this.contactDS.get(obj.contact_id);

			if(data.item_id>0 && obj.contact_id>0){		        
		        if(item.is_catalog=="1"){
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:item.catalogs }
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.price_list[0].currency[0].rate);
		        			
					        if(self.get("isEdit")){
								invoice_id = obj.id;
							}
										
							self.lineDS.add({					
								invoice_id 			: invoice_id,
								item_id 			: value.id,
								measurement_id 		: value.price_list[0].measurement_id,
								meter_record_id	 	: 0,
								description 		: value.name,				
								unit 	 			: 1,
								price 				: value.price_list[0].price*rate,												
								amount 				: value.price_list[0].price*rate,
								rate				: rate,
								locale				: obj.locale,
								has_vat 			: false,
								type 				: "",

								priceList 			: value.price_list
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assemble=="1"){
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price*rate);
			        data.set("measurement_id", 0);
			        data.set("rate", rate);		        	        
			        data.set("priceList", []);

			        this.changes();		     
		        }else{
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price_list[0].price*rate);
			        data.set("measurement_id", item.price_list[0].measurement_id);
			        data.set("rate", rate);		        	        
			        data.set("priceList", item.price_list);

			        this.changes();
		    	}		        
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		measurementChanges 	: function(e){								
			var self = this, data = e.data, obj = this.get("obj");

			if(data.measurement_id>0){				
				var contact = this.contactDS.get(obj.contact_id);				

				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.currency[0].rate);
				        data.set("price", kendo.parseFloat(value.price)*rate);				       			       
				        data.set("rate", rate);

						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		referenceChange 	: function(e){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				obj.set("vat_id", ref.vat_id);

			 	this.referenceLineDS.query({
			 		filter: { field:"invoice_id", value: obj.reference_id },
			 		page: 1,
			 		take: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							invoice_id 			: obj.invoice_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,
							meter_record_id	 	: value.meter_record_id,
							description 		: value.description,				
							unit 	 			: value.unit,
							price 				: value.price,												
							amount 				: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							has_vat 			: value.has_vat,
							type 				: value.type,

							priceList 			: value.priceList
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}								
		},
		addPayment 			: function(invoice_id){
			var obj = this.get("obj"), rate = this.getRate();

			this.paymentDS.add({
				company_id 			: obj.company_id,
				contact_id 			: obj.contact_id,
				cashier_id 			: this.get("biller_id"),
				meter_id 			: 0,							
				reference_id		: invoice_id,														
				payment_method_id	: obj.payment_method_id,
				account_id			: obj.account_id,
				check_no			: obj.check_no,							
				type 				: "invoice",
				amount 				: obj.amount,
				fine 				: 0,
				discount 			: 0,
				rate 				: obj.rate,
				locale 				: obj.locale,
				payment_date		: kendo.toString(new Date(obj.issued_date), "yyyy-MM-dd")
			});

			this.paymentDS.sync();					
		},
		save 				: function(){				
	    	var self = this, obj = this.get("obj"), rate = this.getRate();

	    	obj.set("sub_total", kendo.parseFloat(obj.sub_total)*rate);
	    	obj.set("vat", kendo.parseFloat(obj.vat)*rate);
	        obj.set("amount", kendo.parseFloat(obj.amount)*rate);
	        obj.set("rate", rate);				        
	       
			//Update references
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("status", 1);
				this.referenceDS.sync();
			}
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);
						value.set("rate", rate);
					});

					self.addPayment(invoice[0].id);

					self.lineDS.sync();
					self.addJournal(invoice[0].id);								
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);
					self.paymentDS.data([]);

					self.set("sub_total", 0);
					self.set("vat", 0);
					self.set("total", 0);
					
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	    
	    //Create
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },	    
	    clear 				: function(){	   	    	
	    	this.set("isEdit", false);
	    	this.set("paid", false);
	    	
			this.set("sub_total", 0);
			this.set("vat", 0);	
			this.set("total", 0);				
	    },
	    //Journal
	    getItemAccount 		: function(type, item_id){
	    	var self = this,	    	
	    	id = 0,
	    	item = this.itemDS.get(item_id);	    	
	    	
	    	if(item.accounts){
		    	$.each(item.accounts, function(index, value){
		    		if(value.type==type){
		    			id = value.id;

		    			return false;
		    		}
		    	});
	    	}	    	

	    	return kendo.parseInt(id);	    	
	    },	    
	    addJournal 			: function(invoice_id){
	    	var self = this,
	    	invoice = this.get("obj"),
	    	customer = this.contactDS.get(invoice.contact_id),
			rate = invoice.rate,
	    	entries = [],
	    	segments = [],
	    	saleList = {},
	    	inventoryList = {},
			cogsList = {},
			witdrawList = {},
			depositAmount = 0;

			//Segments
			$.each(invoice.segments, function(index, value){
				segments.push({ id:value });
			});
			
			//Arrange sale, cogs, inventory, customer deposit or widraw
			$.each(this.lineDS.data(), function(index, value){										
				var item = self.itemDS.get(value.item_id),
				amt = value.unit*value.price;

				//Add sale list
				var incomeID = self.itemDS.get(value.item_id).income_account_id;																				
				if(incomeID>0){
					if(saleList[incomeID]===undefined){
						saleList[incomeID]={"id": incomeID, "amt": amt};						
					}else{											
						if(saleList[incomeID].id===incomeID){
							saleList[incomeID].amt += amt;
						}else{
							saleList[incomeID]={"id": incomeID, "amt": amt};
						}
					}
				}								

				switch(kendo.parseInt(item.item_type_id)){		        
					case 1: //Inventory
					
						//Add cogs list
						var itemCost = value.unit*item.cost;
						var cogsID = self.itemDS.get(value.item_id).cogs_account_id;
						if(cogsList[cogsID]===undefined){
							cogsList[cogsID]={"id": cogsID, "amt": itemCost};						
						}else{											
							if(cogsList[cogsID].id===cogsID){
								cogsList[cogsID].amt += itemCost;
							}else{
								cogsList[cogsID]={"id": cogsID, "amt": itemCost};
							}
						}						

						//Add inventory list
						var inventoryID = self.itemDS.get(value.item_id).inventory_account_id;
						if(inventoryList[inventoryID]===undefined){
							inventoryList[inventoryID]={"id": inventoryID, "amt": itemCost};						
						}else{											
							if(inventoryList[inventoryID].id===inventoryID){
								inventoryList[inventoryID].amt += itemCost;
							}else{
								inventoryList[inventoryID]={"id": inventoryID, "amt": itemCost};
							}
						}										

					  	break;
					case 5: //Customer Deposit
						depositAmount += amt;
						var depositID = customer.deposit_account_id;

						if(amt>0){ //Deposit														
							if(saleList[depositID]===undefined){
								saleList[depositID]={"id": depositID, "amt": amt};						
							}else{											
								if(saleList[depositID].id===depositID){
									saleList[depositID].amt += amt;
								}else{
									saleList[depositID]={"id": depositID, "amt": amt};
								}
							}																			
						}else{ //Witdraw												
							if(witdrawList[depositID]===undefined){
								witdrawList[depositID]={"id": depositID, "amt": amt*-1};						
							}else{											
								if(witdrawList[depositID].id===depositID){
									witdrawList[depositID].amt += (amt*-1);
								}else{
									witdrawList[depositID]={"id": depositID, "amt": amt*-1};
								}
							}														
						}

					  	break;					
					default:
				  	//default here
				} //End Swtich
			});//End Foreach Loop

			//VAT			
			if(invoice.vat_id>0){				
				var vatOutID = self.vatDS.get(invoice.vat_id).income_account_id;
				
				if(vatOutID>0){
					var vatAmt = kendo.parseFloat(invoice.vat)*rate;
					if(saleList[vatOutID]===undefined){
						saleList[vatOutID]={"id": vatOutID, "amt": vatAmt};						
					}else{											
						if(saleList[vatOutID].id===vatOutID){
							saleList[vatOutID].amt += vatAmt;
						}else{
							saleList[vatOutID]={"id": vatOutID, "amt": vatAmt};
						}
					}
				}
			}			
			
			//Sale list	to journal		
			if(!jQuery.isEmptyObject(saleList)){								
				//Sum cash
				var cash = 0;				
				$.each(saleList, function(index, value){					
					cash += value.amt;					
				});				

				//Cash on Dr
				entries.push({
					amount  : cash*rate,
					memo 	: "Invoice",
					is_debit: true,
					account : { id: invoice.account_id },
					rate 	: rate,
					locale 	: invoice.locale,
					issuedDate: invoice.issued_date,
					segment : segments,
					contact : customer
				});					

				//Sale accounts on Cr
				$.each(saleList, function(index, value){
					entries.push({
						amount  : value.amt*rate,
						memo 	: "Invoice",
						is_debit: false,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});							
				});
			}

			//Inventory to journal
			//COGS on Dr 			
			if(!jQuery.isEmptyObject(cogsList)){							
				$.each(cogsList, function(index, value){				
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: true,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});					
				});							
			}
			//Inventory on Cr
			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){					
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: false,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});					
				});
			}
			
			//Witdraw to journal
			if(!jQuery.isEmptyObject(witdrawList)){
				//Deposit on Dr
				$.each(witdrawList, function(index, value){
					entries.push({
						amount  :  value.amt*rate,
						memo 	: "Invoice",
						is_debit: true,
						account : { id: value.id },
						rate 	: rate,
						locale 	: invoice.locale,
						issuedDate: invoice.issued_date,
						segment : segments,
						contact : customer
					});						
				});

				var wCash = 0;
				$.each(witdrawList, function(index, value){					
					wCash += value.amt;
				});

				//Cash on Cr
				entries.push({
					amount  :  wCash*rate,
					memo 	: "Invoice",
					is_debit: false,
					account : { id: invoice.account_id },
					rate 	: rate,
					locale 	: invoice.locale,
					issuedDate: invoice.issued_date,
					segment : segments,
					contact : customer
				});							
			}
			//Customer deposit
			if(depositAmount>0){
				this.paymentDS.add({
					company_id 	: invoice.company_id,
					contact_id 	: customer.id,
					reference_id: invoice_id,
					cashier 	: this.get("biller_id"),
					type 		: "deposit",
					amount 		: depositAmount,
					fine 		: 0,
					discount 	: 0,
					payment_date: invoice.issued_date,
					locale 		: invoice.locale,
					rate 		: invoice.rate,
					deleted 	: false
				});				
			}
			
			//Add journal to datasource
			banhji.journalEntry.addNew({
				reference: { id: invoice_id },
				type: invoice.type,
				memo: invoice.type,
				issuedDate: invoice.issued_date,
				contact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
				entries: entries
			});			
			banhji.journalEntry.save();			
		}	 		
	});
	banhji.so =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		lineDS  			: dataStore(baseUrl + "invoices/line"),			
		contactDS  			: dataStore(baseUrl + "contacts"),
		referenceDS			: dataStore(baseUrl + "invoices"),
		referenceLineDS		: dataStore(baseUrl + "invoices/line"),					
		itemDS 				: dataStore(baseUrl + "items"),
		vatDS 				: dataStore(baseUrl + "items"),
		catalogDS			: dataStore(baseUrl + "items"),
		assemblyDS			: dataStore(baseUrl + "items/assembly"),				
		segmentItemDS		: banhji.segmentItem.ds,

		itemList 			: [],
		referenceTypes 		: [
			{ id:"Estimate", name:"Estimate" },			
			{ id:"GDN", name:"GDN" }
		],
		
		obj 				: null,
		isEdit 				: false,

		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,			
		paid 				: false,		
		bolReference 		: false,

		sub_total 			: 0,
		vat 				: 0,
		total 				: 0,				
								
		pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadInvoice(id);
			}else{				
				this.set("isEdit", false);
				this.set("paid", false);
				this.addEmpty();								
			}  																							
		},	    
	    loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_term_id", view[0].payment_term_id);
		    	obj.set("vat_id", view[0].tax_item_id);		    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);

				self.lineDS.data([]);
				self.addRow();				
			});				
		},					
		loadReference 		: function(e){			
			var obj = this.get("obj");

			if(obj.reference_type!==""){
				this.set("bolReference", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: obj.reference_type }
				]);				
			}else{
				this.set("bolReference", false);
			}							
		},			
		loadInvoice 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];								    	
				
				//Status
				if(obj.status==1){
					self.set("paid", true);
				}else{
					self.set("paid", false);
				}

				self.set("sub_total", kendo.toString(obj.sub_total, "c", obj.locale));
		        self.set("vat", kendo.toString(obj.vat, "c", obj.locale));
		        self.set("total", kendo.toString(obj.amount, "c", obj.locale));	  			
								
				self.contactDS.filter({ field: "id", value: obj.contact_id });				
				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.set("obj", obj);
			});				
		},
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", operator:"where_not_in", value: 6 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},			
		addEmpty 		 	: function(){
			if(this.dataSource.total()==0){
				var duedate = new Date();
				duedate.setDate(duedate.getDate()+7);
				this.set("obj", null);				

				this.dataSource.add({
					company_id 			: 0,
					location_id 		: 0,
					contact_id 			: "",
					payment_term_id		: 0,
					payment_method_id 	: 0,
					reference_id 		: 0,
					account_id 	: 0,
					vat_id 				: 0,
					biller_id 			: this.get("biller_id"),
	 	    		number 				: "",
				   	type				: "SO",
				   	sub_total 			: 0,				   		   					   				   	
				   	amount				: 0,
				   	vat 				: 0,
				   	rate				: 1,			   	
				   	locale 				: "km-KH",			   	
				   	issued_date 		: new Date(),
				   	due_date 			: duedate,
				   	check_no 			: "",
				   	bill_to 			: "",
				   	ship_to 			: "",
				   	memo 				: "",
				   	memo2 				: "",
				   	status 				: 0,

				   	segments 			: []				
		    	});		    		
				
				var data = this.dataSource.data();
				var obj = data[data.length-1];			
				this.set("obj", obj);

				this.addRow();  
			}
		},
		addRow 				: function(){				
			var invoice_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				invoice_id = obj.id;
			}
						
			this.lineDS.add({					
				invoice_id 			: invoice_id,
				item_id 			: "",
				currency_id 		: 0,
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				type 				: obj.type,
				
				priceList 			: []
			});																	
		},
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		changes				: function(){
			var obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, vat = 0, vatAmt = 0;
								
				if(kendo.parseInt(obj.vat_id)>0){
					var selectedVat = this.vatDS.get(obj.vat_id);					
					vatAmt = kendo.parseFloat(selectedVat.price_list[0].price);
				}								

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.unit * value.price;
					subTotal += amt;

					value.set("amount", amt);

					if(value.has_vat){
						vat += amt * vatAmt;						
					}
		        });

		        total = subTotal + vat;			

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("vat", kendo.toString(vat, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("vat", vat);			
				obj.set("amount", total);									    	
	    	}else{
	    		this.set("sub_total", kendo.toString(0, "c", obj.locale));
		        this.set("vat", kendo.toString(0, "c", obj.locale));
		        this.set("total", kendo.toString(0, "c", obj.locale));

		        obj.set("sub_total", 0);
		        obj.set("vat", 0);			
				obj.set("amount", 0);				
	    	}   	
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"), company_id = 0,		    	
		    	contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("vat_id", contact.tax_item_id);
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    		    			
				
		    	this.lineDS.data([]);
		    	this.addRow();		    	
		    	this.changes();
	    	}
	    },
	    segmentChanges 		 : function(e) {
			var obj = this.get("obj"),
			dataArr = obj.segments,
			lastIndex = dataArr.length - 1,
			last = banhji.segmentItem.ds.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = banhji.segmentItem.ds.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			invoice_id = 0, 
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id),
			contact = this.contactDS.get(obj.contact_id);

			if(data.item_id>0 && obj.contact_id>0){		        
		        if(item.is_catalog=="1"){
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:item.catalogs }
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.price_list[0].currency[0].rate);
		        			
					        if(self.get("isEdit")){
								invoice_id = obj.id;
							}
										
							self.lineDS.add({					
								invoice_id 			: invoice_id,
								item_id 			: value.id,
								measurement_id 		: value.price_list[0].measurement_id,
								meter_record_id	 	: 0,
								description 		: value.name,				
								unit 	 			: 1,
								price 				: value.price_list[0].price*rate,												
								amount 				: value.price_list[0].price*rate,
								rate				: rate,
								locale				: obj.locale,
								has_vat 			: false,
								type 				: "",

								priceList 			: value.price_list
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assemble=="1"){
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price*rate);
			        data.set("measurement_id", 0);
			        data.set("rate", rate);		        	        
			        data.set("priceList", []);

			        this.changes();		     
		        }else{
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price_list[0].price*rate);
			        data.set("measurement_id", item.price_list[0].measurement_id);
			        data.set("rate", rate);		        	        
			        data.set("priceList", item.price_list);

			        this.changes();
		    	}		        
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		measurementChanges 	: function(e){								
			var self = this, data = e.data, obj = this.get("obj");

			if(data.measurement_id>0){				
				var contact = this.contactDS.get(obj.contact_id);				

				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.currency[0].rate);
				        data.set("price", kendo.parseFloat(value.price)*rate);				       			       
				        data.set("rate", rate);

						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		referenceChange 	: function(e){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				obj.set("vat_id", ref.vat_id);

			 	this.referenceLineDS.query({
			 		filter: { field:"invoice_id", value: obj.reference_id },
			 		page: 1,
			 		take: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							invoice_id 			: obj.invoice_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,
							meter_record_id	 	: value.meter_record_id,
							description 		: value.description,				
							unit 	 			: value.unit,
							price 				: value.price,												
							amount 				: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							has_vat 			: value.has_vat,
							type 				: value.type,

							priceList 			: value.priceList
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}								
		},
		save 				: function(){				
	    	var self = this, obj = this.get("obj"), rate = this.getRate();

	    	obj.set("sub_total", kendo.parseFloat(obj.sub_total)*rate);
	    	obj.set("vat", kendo.parseFloat(obj.vat)*rate);
	        obj.set("amount", kendo.parseFloat(obj.amount)*rate);
	        obj.set("rate", rate);	        
	       
			//Update references
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("status", 1);
				this.referenceDS.sync();
			}
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);
						value.set("rate", rate);
					});
					self.lineDS.sync();												
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);
					
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	    
	    //Create
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },	    
	    clear 				: function(){	   	    	
	    	this.set("isEdit", false);
	    	this.set("paid", false);
	    	
			this.set("sub_total", 0);
			this.set("vat", 0);	
			this.set("total", 0);				
	    }
	});
	banhji.estimate =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		lineDS  			: dataStore(baseUrl + "invoices/line"),			
		contactDS  			: dataStore(baseUrl + "contacts"),						
		itemDS 				: dataStore(baseUrl + "items"),
		vatDS 				: dataStore(baseUrl + "items"),
		catalogDS			: dataStore(baseUrl + "items"),
		assemblyDS			: dataStore(baseUrl + "items/assembly"),
		segmentItemDS		: banhji.segmentItem.ds,		

		itemList 			: [],		
		
		obj 				: null,
		isEdit 				: false,

		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,			
		paid 				: false,		

		sub_total 			: 0,
		vat 				: 0,
		total 				: 0,				
								
		pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadInvoice(id);
			}else{				
				this.set("isEdit", false);
				this.set("paid", false);
				this.addEmpty();								
			}  																							
		},	    
	    loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);		    	
		    	obj.set("vat_id", view[0].tax_item_id);		    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);

				self.lineDS.data([]);
				self.addRow();				
			});				
		},			
		loadInvoice 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];								    	
				
				//Status
				if(obj.status==1){
					self.set("paid", true);
				}else{
					self.set("paid", false);
				}

				self.set("sub_total", kendo.toString(obj.sub_total, "c", obj.locale));
		        self.set("vat", kendo.toString(obj.vat, "c", obj.locale));
		        self.set("total", kendo.toString(obj.amount, "c", obj.locale));	  			
								
				self.contactDS.filter({ field: "id", value: obj.contact_id });				
				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.set("obj", obj);
			});				
		},
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", operator:"where_not_in", value: 6 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},			
		addEmpty 		 	: function(){
			if(this.dataSource.total()==0){				
				this.set("obj", null);				

				this.dataSource.add({
					company_id 			: 0,
					location_id 		: 0,
					contact_id 			: "",
					payment_term_id		: 0,
					payment_method_id 	: 0,
					reference_id 		: 0,
					account_id 	 		: 0,
					vat_id 				: 0,
					biller_id 			: this.get("biller_id"),
	 	    		number 				: "",
				   	type				: "Estimate",
				   	sub_total 			: 0,				   		   					   				   	
				   	amount				: 0,
				   	vat 				: 0,
				   	rate				: 1,			   	
				   	locale 				: "km-KH",			   	
				   	issued_date 		: new Date(),
				   	due_date 			: "",
				   	check_no 			: "",
				   	bill_to 			: "",
				   	ship_to 			: "",
				   	memo 				: "",
				   	memo2 				: "",
				   	status 				: 0,

				   	segments 			: []				
		    	});		    		
				
				var data = this.dataSource.data();
				var obj = data[data.length-1];			
				this.set("obj", obj);

				this.addRow();  
			}
		},
		addRow 				: function(){				
			var invoice_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				invoice_id = obj.id;
			}
						
			this.lineDS.add({					
				invoice_id 			: invoice_id,
				item_id 			: "",
				currency_id 		: 0,
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				
				priceList 			: []
			});																	
		},
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		changes				: function(){
			var obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, vat = 0, vatAmt = 0;
								
				if(kendo.parseInt(obj.vat_id)>0){
					var selectedVat = this.vatDS.get(obj.vat_id);					
					vatAmt = kendo.parseFloat(selectedVat.price_list[0].price);
				}								

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.unit * value.price;
					subTotal += amt;

					value.set("amount", amt);

					if(value.has_vat){
						vat += amt * vatAmt;						
					}
		        });

		        total = subTotal + vat;			

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("vat", kendo.toString(vat, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("vat", vat);			
				obj.set("amount", total);									    	
	    	}else{
	    		this.set("sub_total", kendo.toString(0, "c", obj.locale));
		        this.set("vat", kendo.toString(0, "c", obj.locale));
		        this.set("total", kendo.toString(0, "c", obj.locale));

		        obj.set("sub_total", 0);
		        obj.set("vat", 0);			
				obj.set("amount", 0);				
	    	}   	
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"), company_id = 0,		    	
		    	contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("payment_term_id", contact.payment_term_id);
		    	obj.set("vat_id", contact.tax_item_id);
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    		    			
				
		    	this.lineDS.data([]);
		    	this.addRow();		    	
		    	this.changes();
	    	}
	    },
	    segmentChanges 		 : function(e) {
			var obj = this.get("obj"),
			dataArr = obj.segments,
			lastIndex = dataArr.length - 1,
			last = banhji.segmentItem.ds.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = banhji.segmentItem.ds.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},	    
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			invoice_id = 0, 
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id),
			contact = this.contactDS.get(obj.contact_id);

			if(data.item_id>0 && obj.contact_id>0){		        
		        if(item.is_catalog=="1"){
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:item.catalogs }
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.price_list[0].currency[0].rate);
		        			
					        if(self.get("isEdit")){
								invoice_id = obj.id;
							}
										
							self.lineDS.add({					
								invoice_id 			: invoice_id,
								item_id 			: value.id,
								measurement_id 		: value.price_list[0].measurement_id,
								meter_record_id	 	: 0,
								description 		: value.name,				
								unit 	 			: 1,
								price 				: value.price_list[0].price*rate,												
								amount 				: value.price_list[0].price*rate,
								rate				: rate,
								locale				: obj.locale,
								has_vat 			: false,
								type 				: "",

								priceList 			: value.price_list
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assemble=="1"){
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price*rate);
			        data.set("measurement_id", 0);
			        data.set("rate", rate);		        	        
			        data.set("priceList", []);

			        this.changes();		     
		        }else{
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price_list[0].price*rate);
			        data.set("measurement_id", item.price_list[0].measurement_id);
			        data.set("rate", rate);		        	        
			        data.set("priceList", item.price_list);

			        this.changes();
		    	}		        
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		measurementChanges 	: function(e){								
			var self = this, data = e.data, obj = this.get("obj");

			if(data.measurement_id>0){				
				var contact = this.contactDS.get(obj.contact_id);				

				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.currency[0].rate);
				        data.set("price", kendo.parseFloat(value.price)*rate);				       			       
				        data.set("rate", rate);

						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},		
		save 				: function(){				
	    	var self = this, obj = this.get("obj"), rate = this.getRate();

	    	obj.set("sub_total", kendo.parseFloat(obj.sub_total)*rate);
	    	obj.set("vat", kendo.parseFloat(obj.vat)*rate);
	        obj.set("amount", kendo.parseFloat(obj.amount)*rate);
	        obj.set("rate", rate);	        
	       
			//Update references
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("status", 1);
				this.referenceDS.sync();
			}
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);
						value.set("rate", rate);
					});
					self.lineDS.sync();
					self.addJournal(invoice[0].id);								
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);
					
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	    
	    //Create
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },	    
	    clear 				: function(){	   	    	
	    	this.set("isEdit", false);
	    	this.set("paid", false);
	    	
			this.set("sub_total", 0);
			this.set("vat", 0);	
			this.set("total", 0);				
	    }
	});
	banhji.gdn =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		lineDS  			: dataStore(baseUrl + "invoices/line"),			
		contactDS  			: dataStore(baseUrl + "contacts"),
		referenceDS			: dataStore(baseUrl + "invoices"),
		referenceLineDS		: dataStore(baseUrl + "invoices/line"),					
		itemDS 				: dataStore(baseUrl + "items"),
		catalogDS			: dataStore(baseUrl + "items"),
		assemblyDS			: dataStore(baseUrl + "items/assembly"),
		
		itemList 			: [],
		referenceTypes 		: [			
			{ id:"SO", name:"Sale Order" }
		],
		
		obj 				: null,
		isEdit 				: false,

		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,			
		paid 				: false,		
		bolReference 		: false,
		
		total 				: 0,				
								
		pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadInvoice(id);
			}else{				
				this.set("isEdit", false);
				this.set("paid", false);
				this.addEmpty();								
			}  																							
		},	    
	    loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);		    			    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);

				self.lineDS.data([]);
				self.addRow();				
			});				
		},					
		loadReference 		: function(e){			
			var obj = this.get("obj");

			if(obj.reference_type!==""){
				this.set("bolReference", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: obj.reference_type }
				]);				
			}else{
				this.set("bolReference", false);
			}							
		},			
		loadInvoice 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];								    	
				
				//Status
				if(obj.status==1){
					self.set("paid", true);
				}else{
					self.set("paid", false);
				}
				
		        self.set("total", kendo.toString(obj.amount, "n"));	  			
								
				self.contactDS.filter({ field: "id", value: obj.contact_id });				
				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.set("obj", obj);
			});				
		},
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", operator:"where_not_in", value: 6 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},			
		addEmpty 		 	: function(){
			if(this.dataSource.total()==0){				
				this.set("obj", null);				

				this.dataSource.add({
					company_id 			: 0,
					location_id 		: 0,
					contact_id 			: "",
					payment_term_id		: 0,
					payment_method_id 	: 0,
					reference_id 		: 0,
					account_id 	 		: 0,
					vat_id 				: 0,
					biller_id 			: this.get("biller_id"),
	 	    		number 				: "",
				   	type				: "GDN",
				   	sub_total 			: 0,				   		   					   				   	
				   	amount				: 0,
				   	vat 				: 0,
				   	rate				: 1,			   	
				   	locale 				: "km-KH",			   	
				   	issued_date 		: new Date(),
				   	due_date 			: "",
				   	check_no 			: "",
				   	bill_to 			: "",
				   	ship_to 			: "",
				   	memo 				: "",
				   	memo2 				: "",
				   	status 				: 0,

				   	segments 			: []				
		    	});		    		
				
				var data = this.dataSource.data();
				var obj = data[data.length-1];			
				this.set("obj", obj);

				this.addRow();  
			}
		},
		addRow 				: function(){				
			var invoice_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				invoice_id = obj.id;
			}
						
			this.lineDS.add({					
				invoice_id 			: invoice_id,
				item_id 			: "",
				currency_id 		: 0,
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				
				priceList 			: []
			});																	
		},
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);
	        this.changes();		        
		},
		changes				: function(){
			var obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0;											

				$.each(this.lineDS.data(), function(index, value) {				
					total += kendo.parseInt(value.unit);					
		        });
		        
		        this.set("total", kendo.toString(total, "n"));
		        		
				obj.set("amount", total);									    	
	    	}else{    		
		        this.set("total", 0);

		        obj.set("sub_total", 0);
		        obj.set("vat", 0);			
				obj.set("amount", 0);				
	    	}   	
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"), company_id = 0,		    	
		    	contact = this.contactDS.get(obj.contact_id);	    	
		    	
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    		    			
				
		    	this.lineDS.data([]);
		    	this.addRow();		    	
		    	this.changes();
	    	}
	    },	    
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			invoice_id = 0, 
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id),
			contact = this.contactDS.get(obj.contact_id);

			if(data.item_id>0 && obj.contact_id>0){		        
		        if(item.is_catalog=="1"){
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:item.catalogs }
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.price_list[0].currency[0].rate);
		        			
					        if(self.get("isEdit")){
								invoice_id = obj.id;
							}
										
							self.lineDS.add({					
								invoice_id 			: invoice_id,
								item_id 			: value.id,
								measurement_id 		: value.price_list[0].measurement_id,
								meter_record_id	 	: 0,
								description 		: value.name,				
								unit 	 			: 1,
								price 				: value.price_list[0].price*rate,												
								amount 				: value.price_list[0].price*rate,
								rate				: rate,
								locale				: obj.locale,
								has_vat 			: false,
								type 				: "",

								priceList 			: value.price_list
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assemble=="1"){
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price*rate);
			        data.set("measurement_id", 0);
			        data.set("rate", rate);		        	        
			        data.set("priceList", []);

			        this.changes();		     
		        }else{
		        	var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);

		    		data.set("description", item.name);	    		
			        data.set("price", item.price_list[0].price*rate);
			        data.set("measurement_id", item.price_list[0].measurement_id);
			        data.set("rate", rate);		        	        
			        data.set("priceList", item.price_list);

			        this.changes();
		    	}		        
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		measurementChanges 	: function(e){								
			var self = this, data = e.data, obj = this.get("obj");

			if(data.measurement_id>0){				
				var contact = this.contactDS.get(obj.contact_id);				

				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(value.currency[0].rate);
				        data.set("price", kendo.parseFloat(value.price)*rate);				       			       
				        data.set("rate", rate);

						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		referenceChange 	: function(e){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				obj.set("vat_id", ref.vat_id);

			 	this.referenceLineDS.query({
			 		filter: { field:"invoice_id", value: obj.reference_id },
			 		page: 1,
			 		take: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							invoice_id 			: obj.invoice_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,
							meter_record_id	 	: value.meter_record_id,
							description 		: value.description,				
							unit 	 			: value.unit,
							price 				: value.price,												
							amount 				: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							has_vat 			: value.has_vat,
							type 				: value.type,

							priceList 			: value.priceList
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}								
		},
		save 				: function(){				
	    	var self = this, obj = this.get("obj"), rate = this.getRate();
	    	
	        obj.set("rate", rate);	        
	       
			//Update references
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("status", 1);
				this.referenceDS.sync();
			}
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);
						value.set("rate", rate);
					});
					self.lineDS.sync();													
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);
					
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	    
	    //Create
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },	    
	    clear 				: function(){	   	    	
	    	this.set("isEdit", false);
	    	this.set("paid", false);	    	
			
			this.set("total", 0);				
	    } 		
	});
	banhji.statement = kendo.observable({
		lang 				: langVM,		
		dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "invoices/statement",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "issued_date", dir: "asc" },
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			aggregate: [
			    { field: "amount", aggregate: "sum" }
			],			
			batch: true,
			serverFiltering: true,			
			pageSize: 100
		}),
		agingDS  			: dataStore(baseUrl + "invoices/statement_aging"),
		contactDS  			: dataStore(baseUrl + "contacts"),
		companyDS  			: dataStore(baseUrl + "contacts/branch"),

		sortList			: [ 
	 		{ text:"All", 	value: "all" }, 
	 		{ text:"Today", 	value: "today" }, 
	 		{ text:"This Week",value: "week" }, 
	 		{ text:"This Month", 		value: "month" }, 
	 		{ text:"This Year", 	value: "year" } 
		],
		sorter 				: "all",		
		sdate 				: "",
		edate 				: "",

		obj 				: null,
		company 			: null,
		total 				: 0,

		pageLoad 			: function(id){
			this.loadContact(1);
			this.loadCompany(1);
		},		
		loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view();
				self.set("obj", view[0]);		    					
			});				
		},
		loadCompany 		: function(id){
			var self = this;			

			this.companyDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.companyDS.view();
				self.set("company", view[0]);		    					
			});				
		},
		total 				: function(){
			return this.dataSource.aggregates().amount.sum;
		}
	});
	banhji.customerList = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(baseUrl + "contacts"),
		contactTypeDS			: dataStore(baseUrl + "contacts/type"),

		contact_type_id 		: 0,
		
		pageLoad 				: function(){

		},
		search 					: function(){
			var para = [],
			contact_type_id = this.get("contact_type_id");

			if(contact_type_id){
				para.push({ field:"contact_type_id", value: contact_type_id });
			}

			para.push({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });

			this.dataSource.filter(para);
		}
	});
	banhji.customerSetting =  kendo.observable({
		lang 				: langVM,		
        contactTypeDS 		: dataStore(baseUrl + "contacts/type"),
        paymentMethodDS		: dataStore(baseUrl + "payment_methods"),
        paymentTermDS		: dataStore(baseUrl + "payment_terms"),        
        
        contactTypeName 	: "",
        paymentMethodName 	: "",
        paymentTermName 	: "",
        paymentTerm 		: "",
        paymentTermPercentage 	: "",         

        pageLoad 			: function() {
        	
        },	    
        addContactType 		: function(){
        	var name = this.get("contactTypeName");

        	if(name!==""){
	        	this.contactTypeDS.add({
	        		parent_id 	: 1,
	        		name 		: name,
	        		description : "",
	        		is_system 	: 0
	        	});

	        	this.contactTypeDS.sync();
        	}
        },
        addPaymentMethod 		: function(){
        	var name = this.get("paymentMethodName");

        	if(name!==""){
	        	this.paymentMethodDS.add({	        		
	        		name 		: name,
	        		description : ""
	        	});

	        	this.paymentMethodDS.sync();
        	}
        },
        addPaymentTerm 		: function(){
        	var name = this.get("paymentTermName");

        	if(name!==""){
	        	this.paymentTermDS.add({	        		
	        		name 		: name,
	        		term 		: this.get("paymentTerm"),
	        		discount_percentage : this.get("paymentTermPercentage")
	        	});

	        	this.paymentTermDS.sync();
        	}
        }        
    });


	/*************************
	*	Cashier Section   *
	**************************/
	banhji.cashier = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices/payment"),
		paymentByCashierDS	: dataStore(baseUrl + "payments/by_cashier"),		
		contactDS 			: dataStore(baseUrl + "contacts"),				
		invoiceDS 			: dataStore(baseUrl + "invoices"),
		updateInvoiceDS 	: dataStore(baseUrl + "invoices"),
		transactionDS 		: dataStore(baseUrl + "invoices"),
		paymentMethodDS 	: dataStore(baseUrl + "payment_methods"),

		invoiceList 		: [],	

		customer 			: null,		
		total_customer 		: 0,
		total_payment 		: kendo.toString(0,"c0", "km-KH"),

		//Payment		
		payment_date		: new Date(),
		payment_method_id	: 1,
		account_id 	 		: 2,
		check_no			: "",		
		cashier				: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,
		discount 			: 0,
		fine 				: 0,							
		pay_amount  		: kendo.toString(0,"c0", "km-KH"),
		receive_amount  	: kendo.toString(0,"c0", "km-KH"),
		remain				: kendo.toString(0,"c0", "km-KH"),						
		
		pageLoad 			: function(id){
			var self = this;

			if(id){
				this.set("invoiceList", []);

				this.invoiceDS.query({
					filter: { field:"id", value: id },
					page: 1,
					take: 100
				}).then(function(){
					var view = self.invoiceDS.view(),
					fullIdName = view[0].contact[0].number +" "+ view[0].contact[0].surname +" "+ view[0].contact[0].name;

					if(view[0].contact[0].contact_type_id==5 && view[0].contact[0].contact_type_id==6 && view[0].contact[0].contact_type_id==7){
						fullIdName = view[0].contact[0].number +" "+ view[0].contact[0].company;
					}

					self.loadInvoice(view[0].contact_id, fullIdName);
				});
			}else{
				this.loadPaymentByCashier();
			}			
		},
		total 				: function() {      		
	        var sum = 0;

	        $.each(this.invoiceList, function(index, value) {	        		            
	        	sum += kendo.parseInt(value.amount);		        	          
	        });

	        return kendo.toString(sum, "c0", "km-KH");
	    },		
		loadPaymentByCashier: function(){
			var self = this;

			this.paymentByCashierDS.query({
				filter: [
					{ field:"cashier_id", value: this.get("cashier") },
					{ field:"payment_date", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				]
			}).then(function(e){
				var view = self.paymentByCashierDS.view();
						    	
		    	self.set("total_customer", view[0].total_customer);
		    	self.set("total_payment", kendo.toString(view[0].amount, "c0", "km-KH"));
			});
		},		
		loadInvoice 		: function(contact_id, fullIdName){
			var self = this;

			this.invoiceDS.query({
				filter: [
					{ field:"contact_id", value: contact_id },
		    		{ field:"status", operator:"where_in", value: [0,2] },
		    		{ field:"type", operator:"where_in", value:["Invoice", "eInvoice", "wInvoice"] }
				],
				page: 1,
				take: 50	  	
			}).then(function(e) {
			    var view = self.invoiceDS.view();
			    
			    $.each(view, function(index, value){
		    		var result = $.grep(self.get("invoiceList"), function(e){ return e.id == value.id; });

		    		if (result.length == 0) {
					  	// not found
					  	var remainAmount = kendo.parseFloat(value.amount) - kendo.parseFloat(value.amount_paid);
					  	
					  	self.get("invoiceList").push({				
							id 				: value.id,
							isPay 			: true,				
							issued_date 	: value.issued_date,
							fullname 		: fullIdName,							
							number			: value.number,										
							amount 			: remainAmount,
							pay_amount 		: remainAmount,
							rate 			: value.rate,
							locale 			: value.locale,
							contact_id 		: value.contact_id,
							company_id 		: value.company_id
 						});
						self.change();
						self.autoIncreaseNo();
					} else if (result.length == 1) {
					  	// access the foo property using result[0].foo					  
					} else {
					  	// multiple items found					  
					}		    					    		
		    	});		    	
			});			
		},						
		autoIncreaseNo 		: function(){
			$(".sno").each(function(index,element){                 
			   $(element).text(index + 1); 
			});
		},
		change				: function(){		
			var total = 0;		
		    var tpay = 0;
		    $.each(this.get("invoiceList"), function(index, value){
		    	total += kendo.parseFloat(value.amount)*kendo.parseFloat(value.rate);
		    	tpay += kendo.parseFloat(value.pay_amount)*kendo.parseFloat(value.rate);
		    });

		    this.set("pay_amount", kendo.toString(tpay, "c0", "km-KH"));		  	   	    	
	    	
	    	var receive_amount = tpay + kendo.parseFloat(this.get("fine"));
			this.set("receive_amount", kendo.toString(receive_amount, "c0", "km-KH"));
	    	
	    	var remain = (total + kendo.parseFloat(this.get("fine"))) - (tpay + kendo.parseFloat(this.get("discount")));
	    	this.set("remain", kendo.toString(remain, "c0", "km-KH"));	    	   	
		},	
		remove 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var item = e.data,
		        index = this.get("invoiceList").indexOf(item);
		        this.get("invoiceList").splice(index, 1);
		        this.change();
		        this.autoIncreaseNo();
	    	}	    	
	    },
	    checkPay 			: function(e){
	    	e.preventDefault();

	    	var d = e.data;
	    	var target = e.currentTarget;

	    	if(target.checked){
	    		d.set("pay_amount", d.amount);
	    	}else{
	    		d.set("pay_amount", 0);
	    	}
	    	this.change();
	    },
		save 		 		: function(){
			var self = this, data = this.get("invoiceList");
			
			if(data.length>0){
				$.each(data, function(index, value){
					if(kendo.parseFloat(value.pay_amount)>0){
						var status = 2; //Partialy Paid
						if(value.pay_amount>=value.amount){							
							 status = 1; //Paid
						}

						self.dataSource.add({
							company_id 			: value.company_id,
							contact_id 			: value.contact_id,
							cashier_id 			: self.get("cashier"),
							meter_id 			: 0,							
							reference_id		: value.id,														
							payment_method_id	: this.get("payment_method_id"),
							account_id			: this.get("account_id"),
							check_no			: this.get("check_no"),							
							type 				: "invoice",
							amount 				: value.pay_amount,
							fine 				: self.get("fine"),
							discount 			: self.get("discount"),
							rate 				: value.rate,
							locale 				: value.locale,
							payment_date		: kendo.toString(self.get("payment_date"), "yyyy-MM-dd"),

							status 				: status
						});
					}
				});

				this.updateInvoiceDS.sync();
				this.dataSource.sync();
				var saved = false;
				this.dataSource.bind("requestEnd", function(e){
					if(saved==false){
						saved = true;

						self.clear();
						self.loadPaymentByCashier();
					}
				});
			}
		},					
		clear 				: function() {
			this.set("check_no", "");			
			this.set("discount", 0);
			this.set("fine", 0);		
			this.set("pay_amount", kendo.toString(0,"c0", "km-KH"));
			this.set("receive_amount", kendo.toString(0,"c0", "km-KH"));
			this.set("remain", kendo.toString(0,"c0", "km-KH"));

			this.set("invoiceList", []);

			this.updateInvoiceDS.data([]);
			this.dataSource.data([]);							
		}
	});
	banhji.reconcile = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(baseUrl + "reconciles"),
		existingDS 				: dataStore(baseUrl + "reconciles"),
		prevAmountDS			: dataStore(baseUrl + "reconciles"),
		reconcileItemDS			: dataStore(baseUrl + "reconciles/item"),
		paymentDS 				: dataStore(baseUrl + "payments"),
		denominationList 		: [
				{ 'denomination':1, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':2, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':5, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':10, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':20, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':50, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':100, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':200, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':500, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':1000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':2000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':5000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':10000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':20000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':50000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
				{ 'denomination':100000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' }
		],		
		reconcileItemList 		: [],	

		obj 					: null,		
		searchDate 				: new Date(),			
		isEdit 					: false,
		isExisting 				: false,

		cashier 				: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,
		cashier_name 			: banhji.userManagement.getLogin() === null ? "" : banhji.userManagement.getLogin().username,
		
		pageLoad 				: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadReconcile(id);
			}else{				
				this.set("isEdit", false);				
				this.addEmpty();
				this.loadPayment();
				this.loadPreviousAmount();

				this.checkExisting();
			}
		},
		str_date 				: function(){
			var strDate = "", obj = this.get("obj");

			if(obj){
				strDate = kendo.toString(new Date(obj.reconciled_date), "dd-MM-yyyy");
			}

			return strDate;
		},		
		loadReconcile 			: function(id){				
			var self = this, obj = this.get("obj");			
						
			this.dataSource.query({
				filter: { field: "id" , value: id },
				page: 1,
				take: 50
			}).then(function(){
				var view = self.dataSource.view();

				self.set("obj", view[0]);
				self.reconcileItemDS.filter({ field:"reconcile_id", value: id });				
			});								
		},
		loadPreviousAmount 			: function(){
			var self = this, obj = this.get("obj");

			this.prevAmountDS.query({
				filter: [
					{ field: "cashier", value: this.get("cashier") },										
					{ field: "reconciled_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				],				
				page: 1,
				take: 1
			}).then(function(){
				var view = self.prevAmountDS.view();

				obj.set("previous_amount", view[0].balance);
			});			
		},
		loadPayment 			: function(){
			var self = this, obj = this.get("obj");

			this.paymentDS.query({
				filter: [
					{ field: "cashier", value: this.get("cashier") },
					{ field: "type" , value: "invoice" },						
					{ field: "payment_date", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				],
				aggregate: [
					{ field: "amount", aggregate: "sum" }
				],
				page: 1,
				take: 50
			}).then(function(){
				var results = self.paymentDS.aggregates().amount;

				obj.set("received_amount", results.sum);
			});			
		},
		checkExisting 			: function(){				
			var self = this;			
						
			this.existingDS.query({
				filter: [
					{ field: "cashier", value: this.get("cashier") },										
					{ field: "reconciled_date", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				],
				page: 1,
				take: 50
			}).then(function(){
				var view = self.existingDS.view();

				if(view.length>0){
					self.set("isExisting", true);
				}else{
					self.set("isExisting", false);
				}					
			});								
		},		
		change					: function(){
			var totalD = 0;
			var totalR = 0;
			var totalDT = 0;
			var totalRT = 0;

			for(var i=0; i < this.denominationList.length; i++){
				var data = this.denominationList[i];
				var dem = kendo.parseFloat(data.denomination);

		    	totalD += kendo.parseFloat(data.qty_usd) * dem;
		    	totalR += kendo.parseFloat(data.qty_khr) * dem;

		    	totalDT += kendo.parseFloat(data.qty_usd_transfer) * dem;
		    	totalRT += kendo.parseFloat(data.qty_khr_transfer) * dem;	    	
			}

			this.set('totalD', kendo.toString(totalD, 'n0'));
			this.set('totalR', kendo.toString(totalR, 'c0'));

			this.set('totalDT', kendo.toString(totalDT, 'n0'));
			this.set('totalRT', kendo.toString(totalRT, 'c0'));		  	 	
		},	
		transferAll 			: function(){
			$.each(this.reconcileItemDS.data(), function(index, value){
				if(value.khr_qty>0){									
					value.set("khr_transfer", value.khr_qty);
				}

				if(value.usd_qty>0){									
					value.set("usd_transfer", value.usd_qty);
				}
			});
			
			this.change();
		},
		change 					: function(){
			var obj = this.get("obj"),
			khr_sum = 0, usd_sum = 0, khr_transfer_sum = 0, usd_transfer_sum = 0,
			usd2khr_amount = 0, usd2khr_transfer_amount = 0;

			$.each(this.reconcileItemDS.data(), function(index, value){
				if(value.khr_qty>0){
					var khrAmt = kendo.parseFloat(value.denomination) * kendo.parseFloat(value.khr_qty);
					khr_sum += khrAmt;					
					value.set("khr_amount", khrAmt);
				}

				if(value.usd_qty>0){
					var usdAmt = kendo.parseFloat(value.denomination) * kendo.parseFloat(value.usd_qty);
					usd_sum += usdAmt;
					value.set("usd_amount", usdAmt);
				}

				if(value.khr_transfer>0){
					var khr_transfer_amt = kendo.parseFloat(value.denomination) * kendo.parseFloat(value.khr_transfer);
					khr_transfer_sum += khr_transfer_amt;
					value.set("khr_transfer_amount", khr_transfer_amt);
				}

				if(value.usd_transfer>0){
					var usd_transfer_amt = kendo.parseFloat(value.denomination) * kendo.parseFloat(value.usd_transfer);
					usd_transfer_sum += usd_transfer_amt;
					value.set("usd_transfer_amount", usd_transfer_amt);
				}
			});

			//Refresh lisview
			var listView = $("#lvReconcileItem").data("kendoListView");			
			listView.refresh();

			//Total Cash1
			obj.set("total_cash1", kendo.parseFloat(obj.received_amount) + kendo.parseFloat(obj.previous_amount));

			//Actual cash
			obj.set("usd_amount", usd_sum);
			usd2khr_amount = obj.rate * usd_sum;
			obj.set("usd2khr_amount", usd2khr_amount);

			obj.set("khr_amount", khr_sum);

			//Total Cash2
			obj.set("total_cash2", kendo.parseFloat(obj.khr_amount) + kendo.parseFloat(obj.usd2khr_amount));

			//Reconcile
			obj.set("reconciled_amount", kendo.parseFloat(obj.total_cash1) - kendo.parseFloat(obj.total_cash2));

			//Transer
			obj.set("transfer_usd", usd_transfer_sum);
			usd2khr_transfer_amount = kendo.parseFloat(obj.rate) * kendo.parseFloat(usd_transfer_sum);
			obj.set("usd2khr_transfer_amount", usd2khr_transfer_amount);

			obj.set("transfer_khr", khr_transfer_sum);

			//Transfered amount
			obj.set("transfered_amount", kendo.parseFloat(obj.usd2khr_transfer_amount) + kendo.parseFloat(obj.transfer_khr));

			//Balance
			obj.set("balance", kendo.parseFloat(obj.total_cash1) - kendo.parseFloat(obj.transfered_amount));
		},
		addEmpty 				: function(){
			var self = this;
			this.set("isEdit", false);
			this.dataSource.data([]);
			this.reconcileItemDS.data([]);        	
      		
			this.dataSource.add({
				company_id 				: 0,
				transfer_account_id 	: 2,
				cashier 				: this.get('cashier'),															
				rate					: 4000,
				received_amount 		: 0,
				previous_amount 		: 0,
				total_cash1 			: 0,
				usd_amount 				: 0,
				usd2khr_amount			: 0,
				khr_amount 				: 0,
				total_cash2 			: 0,
				reconciled_amount 		: 0,
				transfer_usd			: 0,
				usd2khr_transfer_amount	: 0,
				transfer_khr 			: 0,					
				transfered_amount		: 0,
				balance 				: 0,										
				memo 					: "",
				reconciled_date 		: new Date(),
				status 					: 1		
			});			

			//Reconcile Item							
			$.each(this.get("denominationList"), function(index, value){
				self.reconcileItemDS.add({
					"reconcile_id" 			: 0,
					"denomination" 			: value.denomination,			   			   						   
				   	"khr_qty" 				: value.khr_qty,
				   	"khr_amount"			: 0,		   	
				   	"usd_qty" 				: value.usd_qty,
				   	"usd_amount"			: 0,
				   	"khr_transfer" 			: value.khr_transfer,
				   	"khr_transfer_amount" 	: 0,
				   	"usd_transfer" 			: value.usd_transfer,
				   	"usd_transfer_amount" 	: 0
				});
			});			

			var data = this.dataSource.data();			
			var obj = data[data.length - 1];			
			this.set("obj", obj);	
		},
		save 					: function(){
			var self = this;

			this.dataSource.sync();
			this.reconcileItemDS.sync();
		},			
		addReconcile 			: function(){
			var dfd = $.Deferred();

			var tr = this.get("totalReceive");
			var pr = this.get("prevRemain");				
			var receiveAmount = Number(tr.replace(/[^0-9\.]+/g,""));
			var prevRemain = Number(pr.replace(/[^0-9\.]+/g,""));		

			banhji.ds.reconcileDS.add({
				cashier 			: this.get('cashier'),					 
				reconciled_date 	: kendo.toString(new Date(), 'yyyy-MM-dd'),					
				rate				: this.get('rate'),
				received_amount 	: receiveAmount,
				prev_remain 		: prevRemain,
				reconciled_amount	: kendo.parseFloat(this.totalDR()),
				transfered_amount	: kendo.parseFloat(this.totalTransferCash()),
				transfer_account_id : this.get('transfer_account_id'),
				class_id 			: this.get('class_id'),
				memo 				: this.get('memo')
			});				        

	    	banhji.ds.reconcileDS.sync();
		    banhji.ds.reconcileDS.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;		
		},
		addJournal 				: function(){
			var self = this;				
			var totalTransferCash = kendo.parseFloat(this.totalTransferCash());

			//Transfer account on Dr
			banhji.journalEntry.add({
				journal_id 	: 0,
		 		account 	: this.get("transfer_account_id"), 		
		 		dr 			: totalTransferCash, 
		 		cr 			: 0,
		 		class_id  	: self.get("class_id"),
		 		memo 		: self.get("memo"),
		 		exchange_rate: 1,
			 	main 		: 0	 		
			});				
			
			var cashInTillList = {};
			$.each(banhji.ds.invoiceDS.data(), function(index, value){
				var cash_in_till_id = value.account_id;
				var amt = kendo.parseFloat(value.paid)															
				if(cash_in_till_id>0){
					if(cashInTillList[cash_in_till_id]===undefined){
						cashInTillList[cash_in_till_id]={"id": cash_in_till_id, "amt": amt};						
					}else{											
						if(cashInTillList[cash_in_till_id].id===cash_in_till_id){
							cashInTillList[cash_in_till_id].amt += amt;
						}else{
							cashInTillList[cash_in_till_id]={"id": cash_in_till_id, "amt": amt};
						}
					}
				}
			});

			//Cash in till on Cr
			$.each(cashInTillList, function(index, value){					
				banhji.journalEntry.add({
					journal_id 	: 0,
			 		account 	: value.id,	 		
			 		dr 			: 0, 
			 		cr 			: value.amt,
			 		class_id  	: self.get("class_id"),
			 		memo 		: self.get("memo"),
			 		exchange_rate: 1,
				 	main 		: 0	 		
				});
			});

		 	//Add journal to datasource
			banhji.transaction.addNew();
			var journal = banhji.transaction.get("current");
			
			journal.set("company_id", banhji.config.userData.company);
			journal.set("people_id", 0);
			journal.set("employee_id", banhji.config.userData.userId);
			journal.set("payment_id", 0);
			journal.set("payment_term_id", 0);
			journal.set("transaction_type", "Reconcile");
			journal.set("payment_method", "");
			journal.set("check_no", null);
			journal.set("memo", "ផ្ទៀងផ្ទាត់ និង ផ្ទេរសាច់ប្រាក់");
			journal.set("date", kendo.toString(new Date(this.get("searchDate")), "yyyy-MM-dd"));				
			journal.set("amount_billed", totalTransferCash);
			journal.set("amount_due", 0);
			journal.set("amount_paid", 0);
			journal.set("voucher", null);
			journal.set("class_id", this.get("class_id"));
			journal.set("status", 0);
			journal.set("reference", null);
			journal.set("vat_id", {id: null});
			journal.set("inJournal", 1);			 	
		 			 	
		 	banhji.transaction.save()
		 	.then(function(journal){			 		
	 			$.each(banhji.journalEntry.dataSource.data(), function(index, value){
	 				value.set("journal_id", journal.data.id);
	 			});
	 					 			
	 			banhji.journalEntry.save();
		 	});			  
		}
	});


	/*************************
	*	Inventory Section   *
	**************************/
	banhji.itemDashBoard = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "items/dashboard"),
		topTurnoverDayDS	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/inventory_turnover_list",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},						
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},						
			batch: true,
			serverFiltering: true
		}),
		topVendorItemDS 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/purchase_by_vendor_summary",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},						
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true
		}),
		topSaleItemDS 		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/inventory_sale_by_item",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},						
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true
		}),

		as_of 				: new Date(),
		type 				: 0,
		gross_profit_margin : 0,
		turnover_day 		: 0,
		total_value 		: 0,
						
		pageLoad 			: function(){
			this.dateChanges();
		},
		loadTopTurnoverDay : function(){
			var self = this, as_of = kendo.toString(this.get("as_of"), "yyyy-MM-dd");

			if(as_of){				
				this.topTurnoverDayDS.query({
					filter: { field:"issued_date <=", value: as_of },
					sort: { field: "days", dir: "desc" },								
					page: 1,
					take: 5
				}).then(function(){
					$(".sno").each(function(index,element){                 
					   $(element).text(index + 1); 
					});
				});
			}
		},
		loadTopVendorItem : function(){
			var self = this, as_of = kendo.toString(this.get("as_of"), "yyyy-MM-dd");

			if(as_of){				
				this.topVendorItemDS.query({
					filter: { field:"issued_date <=", value: as_of },
					sort: { field: "amount", dir: "desc" },								
					page: 1,
					take: 5
				}).then(function(){
					$(".sno1").each(function(index,element){                 
					   $(element).text(index + 1); 
					});
				});
			}			
		},
		loadTopSaleItem : function(){
			var self = this, as_of = kendo.toString(this.get("as_of"), "yyyy-MM-dd");

			if(as_of){				
				this.topSaleItemDS.query({
					filter: { field:"issued_date <=", value: as_of },
					sort: { field: "qty", dir: "desc" },								
					page: 1,
					take: 5
				}).then(function(){
					$(".sno2").each(function(index,element){                 
					   $(element).text(index + 1); 
					});
				});
			}			
		},
		dateChanges 	: function(){
			var self = this, as_of = kendo.toString(this.get("as_of"), "yyyy-MM-dd");

			if(as_of){
				this.loadTopTurnoverDay();
				this.loadTopVendorItem();
				this.loadTopSaleItem();

				this.dataSource.query({
					filter: { field:"issued_date <=", value:as_of },
					page: 1,
					take: 100
				}).then(function(e){
					var view = self.dataSource.view();					

					self.set("type", kendo.toString(view[0].type, "n0"));
					self.set("gross_profit_margin", kendo.toString(view[0].gross_profit_margin, "p0"));
					self.set("turnover_day", kendo.toString(view[0].turnover_day, "n0"));
					self.set("total_value", kendo.toString(view[0].total_value, "c", banhji.institute.locale));
				});
			}
		}		
	});
	banhji.itemCenter = kendo.observable({
		lang 				: langVM,		
		itemDS 				: dataStore(baseUrl + 'items'),
		poDS 				: dataStore(baseUrl + "invoices/line"),
    	soDS 				: dataStore(baseUrl + "invoices/line"),
		movementDS			: dataStore(baseUrl + 'items/movement'),		
		categoryDS 			: dataStore(baseUrl + "categories"),
		itemGroupDS			: dataStore(baseUrl + "items/group"),			

		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "year",
		sdate 				: "",
		edate 				: "",
				
		obj 				: null,
		on_po 				: 0,
		on_so				: 0,		
		searchText 			: "",	
		category_id 		: null,
		selectedItemGroup 	: [],
		isCategorySelected	: false,	
		
		pageLoad 			: function(){		
												
		},
		countPO 		: function(id){
    		var self = this;

    		this.poDS.query({
    			filter:[
	    			{ field:"item_id", value: id },
	    			{ field:"type", model:"invoice", operator:"where_related", value:"PO" },
	    			{ field:"status", model:"invoice", operator:"where_related", value:0 }
	    		],
	    		page:1,
	    		take:1
	    	}).then(function(){
	    		var view = self.poDS.view();

	    		if(view.length>0){
	    			var sum = 0;

	    			$.each(view, function(index, value){
	    				sum += kendo.parseInt(value.unit);
	    			});

	    			self.set("on_po", kendo.toString(sum, "n0"));
	    		}else{
	    			self.set("on_po", 0);
	    		}
	    	});
    	},
    	countSO 		: function(id){
    		var self = this;

    		this.soDS.query({
    			filter:[
	    			{ field:"item_id", value: id },
	    			{ field:"type", model:"invoice", operator:"where_related", value:"SO" },
	    			{ field:"status", model:"invoice", operator:"where_related", value:0 }
	    		],
	    		page:1,
	    		take:1
	    	}).then(function(){
	    		var view = self.soDS.view();

	    		if(view.length>0){
	    			var sum = 0;

	    			$.each(view, function(index, value){
	    				sum += kendo.parseInt(value.unit);
	    			});

	    			self.set("on_so", kendo.toString(sum, "n0"));
	    		}else{
	    			self.set("on_so", 0);
	    		}
	    	});
    	},
		loadOnHand 	: function(){
			var self = this, obj = this.get("obj");
			
			this.movementDS.filter([
			  		{ field:"item_id", value: obj.id },
					{ field:"type", model:"invoice", operator:"where_in_related", value: ["Invoice", "Receipt", "Purchase"] }
			]);
		},
		loadPO 	: function(){
			var self = this, obj = this.get("obj");
			
			this.movementDS.filter([
		  		{ field:"item_id", value: obj.id },
				{ field:"type", model:"invoice", operator:"where_related", value: "PO" }
			]);
		},
		loadSO 	: function(){
			var self = this, obj = this.get("obj");
			
			this.movementDS.filter([
		  		{ field:"item_id", value: obj.id },
				{ field:"type", model:"invoice", operator:"where_related", value: "SO" }
			]);
		},
		loadMovement 		: function(id){
			this.movementDS.query({
			  	filter: [
			  		{ field:"item_id", value: id },
					{ field:"type", model:"invoice", operator:"where_in_related", value: ["Invoice", "Receipt", "Purchase", "PO", "SO"] }
			  	],			  	
			  	page: 1,
			  	take: 20
			});
		},		
		selectedRow			: function(e){
			var id = e.data.id,
			data = e.data;			
			
			this.set("obj", data);
			this.loadMovement(id);
			this.countPO(id);
			this.countSO(id);			
		},
		sorterChanges 		: function(){
			var value = this.get("sorter");

			switch(value){
			case "today":
				var today = new Date();
				
				this.set("sdate", today);
				this.set("edate", today);
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		categoryChanges 		: function(){
			var category_id = this.get("category_id");

			if(category_id){
				this.set("isCategorySelected", true);
				this.itemGroupDS.filter({ field:"category_id", value: category_id });
			}else{
				this.set("isCategorySelected", false);
				this.set("selectedItemGroup", []);
			}        	
        },
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this,
			para = [],
			searchText = this.get("searchText"),			
			category_id = this.get("category_id"),
			selectedItemGroup = this.get("selectedItemGroup");

			if(searchText){
				para.push(      				
      				{ field: "sku", operator: "like", value: searchText },
      				{ field: "name", operator: "or_like", value: searchText }
      			);
			}        	

            if(selectedItemGroup.length>0){
				var ids = [];
				$.each(selectedItemGroup, function(index, value){
					ids.push(value);
				});
				
				para.push({ field:"item_group_id", operator:"where_in", value:ids });
			}else if(category_id){
				para.push({ field:"category_id", value:category_id });
			}

			para.push({ field:"item_type_id", value:1 });
			para.push({ field:"is_catalog", value: 0 });
			para.push({ field:"is_assemble", value: 0 });          

            this.itemDS.query({
            	filter: para,
            	page: 1,
            	take: 100
            }).then(function(data){
            	var view = self.itemDS.view();
            	
            	self.set("searchText", "");
            	self.set("category_id", 0);
            	self.set("isCategorySelected", false);
            	self.set("selectedItemGroup", []);
            });      			
		},
		searchMovement	: function(){
			var self = this,
				para = [],
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),	        		
        		obj = this.get("obj");

        	//Dates
        	if(start && end){
            	para.push({ field:"issued_date >=", model:"invoice", operator: "where_related", value: start });
            	para.push({ field:"issued_date <=", model:"invoice", operator: "where_related", value: end });            	            	
            }else if(start){
            	para.push({ field:"issued_date", model:"invoice", operator: "where_related", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", model:"invoice", operator: "where_related", value: end });
            }else{
            	
            }

            para.push({ field:"item_id", value: obj.id });             

            this.movementDS.query({
            	filter: para,            	
            	page: 1,
            	take: 20
            });            
		},
		edit				: function(){
			var obj = this.get("obj");

			if(obj.is_catalog=="1"){
				banhji.router.navigate('/item_catalog/'+obj.id);
			}else if(obj.is_assemble=="1"){
				banhji.router.navigate('/item_assembly/'+obj.id);
			}else{
				banhji.router.navigate('/item/'+obj.id);
			}
		},
		pricing				: function(){
			var obj = this.get("obj");

			if(obj.is_catalog=="1"){
				banhji.router.navigate('/item_catalog/'+obj.id);
			}else if(obj.is_assemble=="1"){
				banhji.router.navigate('/item_assembly/'+obj.id);
			}else{
				banhji.router.navigate('/price_list/'+obj.id);
			}			
		}		
	});	
	banhji.priceList =  kendo.observable({
		lang 				: langVM,    	
    	dataSource 			: dataStore(baseUrl + "price_lists"),
    	itemDS 				: dataStore(baseUrl + "items"),
    	recordDS 			: dataStore(baseUrl + "items/movement"),
    	poDS 				: dataStore(baseUrl + "invoices/line"),
    	soDS 				: dataStore(baseUrl + "invoices/line"),
    	currencyDS 			: dataStore(baseUrl + "currencies"),    	
    	unitDS	   			: dataStore(baseUrl + "measurements"),

    	obj 				: null,
    	priceList 			: null,
    	on_po 				: 0,
    	on_so 				: 0,
    	
    	pageLoad 		: function(id){    		
    		this.dataSource.filter({ field:"item_id", value: id });    		
    		this.recordDS.filter({ field:"item_id", value: id });    		
    		this.loadObj(id);
    		this.countPO(id);
    		this.countSO(id);
    	},
    	loadObj 	: function(id){
    		var self = this;

    		this.itemDS.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.itemDS.view();
						    	
		    	self.set("obj", view[0]);
			});
    	},
    	countPO 		: function(id){
    		var self = this;

    		this.poDS.query({
    			filter:[
	    			{ field:"item_id", value: id },
	    			{ field:"type", model:"invoice", operator:"where_related", value:"PO" },
	    			{ field:"status", model:"invoice", operator:"where_related", value:0 }
	    		],
	    		page:1,
	    		take:1
	    	}).then(function(){
	    		var view = self.poDS.view();

	    		if(view.length>0){
	    			var sum = 0;

	    			$.each(view, function(index, value){
	    				sum += kendo.parseInt(value.unit);
	    			});

	    			self.set("on_po", kendo.toString(sum, "n0"));
	    		}else{
	    			self.set("on_po", 0);
	    		}
	    	});
    	},
    	countSO 		: function(id){
    		var self = this;

    		this.soDS.query({
    			filter:[
	    			{ field:"item_id", value: id },
	    			{ field:"type", model:"invoice", operator:"where_related", value:"SO" },
	    			{ field:"status", model:"invoice", operator:"where_related", value:0 }
	    		],
	    		page:1,
	    		take:1
	    	}).then(function(){
	    		var view = self.soDS.view();

	    		if(view.length>0){
	    			var sum = 0;

	    			$.each(view, function(index, value){
	    				sum += kendo.parseInt(value.unit);
	    			});

	    			self.set("on_so", kendo.toString(sum, "n0"));
	    		}else{
	    			self.set("on_so", 0);
	    		}
	    	});
    	},
    	openWindow		: function(){
      		this.addEmpty();

         	var window = $("#priceList-window").data("kendoWindow");
          	window.title("តំលៃ");          	
          	window.center().open();         	
      	},
      	closeWindow 	: function(){	      		
      		this.dataSource.cancelChanges();

      		var window = $("#priceList-window").data("kendoWindow");          	         	
          	window.close();          	
      	},      	
      	addEmpty 		: function () {
      		this.dataSource.add({
      			currency_id 	: 0,      			
      			item_id		: this.get("product").id,
      			measurement_id 		: 0,
      			price 			: 0,
      			unit_value		: 0,

      			currency 		: [{locale:"km-KH"}],      			
      			measurement 	: []
			});

			var data = this.dataSource.data();
			var obj = data[data.length - 1];
      						
			this.set("priceList", obj);	
      	},      	 	
      	save 			: function(){
      		this.dataSource.sync();
      		banhji.itemCenter.dataSource.fetch();

      		var window = $("#priceList-window").data("kendoWindow");          	         	
          	window.close(); 		
      	},
      	edit 			: function(e){
      		var data = e.data;
      		
      		this.set("priceList", data);

      		var window = $("#priceList-window").data("kendoWindow");
          	window.title("តំលៃ");          	
          	window.center().open();       		
      	},      	
      	delete 			: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data;
		        this.dataSource.remove(data);
		        this.dataSource.sync();
		        banhji.itemCenter.dataSource.fetch();
	    	}	    	
	    }
    });	
    banhji.item =  kendo.observable({
    	lang 				: langVM,    	
    	dataSource 			: dataStore(baseUrl + "items"),
    	categoryDS 			: dataStore(baseUrl + "categories"),
    	itemGroupDS 		: dataStore(baseUrl + "items/group"),
    	brandDS 	 		: dataStore(baseUrl + "brands"),    	   	   	
    	measurementDS		: dataStore(baseUrl + "measurements"),
    	vendorDS 	 		: dataStore(baseUrl + "contacts"),
    	customerDS 	 		: dataStore(baseUrl + "contacts"),
    	itemVendorDS 	 	: dataStore(baseUrl + "items/contact"),
    	itemCustomerDS 	 	: dataStore(baseUrl + "items/contact"),
    	currencyDS 	 		: dataStore(baseUrl + "currencies"),   	
    	
    	statusList 			: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],

        vendorList 			: [],
        customerList 		: [],

    	obj 	 			: null,
    	isEdit 				: false,
    	
    	pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
				this.loadItemContact(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}  																							
		},
    	loadObj 			: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
			});
    	},
    	loadVendor 			: function(){
    		var self = this;

    		this.vendorDS.query({    			
				filter: { field:"parent_id", operator:"where_related", model:"contact_type", value:2 }
			}).then(function(e){
				var view = self.vendorDS.view();
				
				$.each(view, function(index, value){
					self.vendorList.push(value);
				});		    	
			});
    	},
    	loadCustomer 		: function(){
    		var self = this;

    		this.customerDS.query({    			
				filter: { field:"parent_id", operator:"where_related", model:"contact_type", value:1 }
			}).then(function(e){
				var view = self.customerDS.view();
				
				$.each(view, function(index, value){
					self.customerList.push(value);
				});		    	
			});
    	},
    	loadItemContact		: function(id){
			this.itemVendorDS.query({
				filter: [ 
					{ "field":"item_id", value: id },
					{ "field":"type", value: "vendor" }
				],
				page: 1,
				pageSize: 100
			});

			this.itemCustomerDS.query({
				filter: [ 
					{ "field":"item_id", value: id },
					{ "field":"type", value: "customer" }
				],
				page: 1,
				pageSize: 100
			});
		},    	   	
      	addEmpty 			: function(){      		
      		this.dataSource.data([]);
      		this.set("obj", null);

      		this.dataSource.add({
      			company_id 				: 0,
      			contact_id 				: "",
      			currency_id 			: 0,
      			category_id 			: 0,
      			item_type_id 			: 1,      			      			
      			category_id 			: 0,
      			item_group_id 			: 0,
      			item_sub_group_id 		: 0,
      			brand_id 				: 0,
      			measurement_id			: 0,
      			main_id 				: 0,
      			sku 					: "",
      			international_code 		: "",
      			IMEI 					: "",
      			serial_number 			: "",
      			supplier_code 			: "",
      			color_code 				: "",
      			name 					: "",
      			description				: "",
      			measurements 			: "",
      			catalogs 				: [],
      			cost 					: 0,
      			price 					: 0,
      			amount 					: 0,
      			rate 					: 1,
      			on_hand					: 0,      			      			     			
      			order_point 			: 0,
      			income_account_id 		: 0,
      			cogs_account_id  		: 0,
      			inventory_account_id 	: 0,
      			deposit_account_id 		: 0,
      			transaction_account_id 	: 0,
      			preferred_vendor_id 	: 0,
      			image_url 				: "",      			
      			favorite 				: false,
      			is_catalog 				: 0,
      			is_assemble 			: 0,
      			status 					: 1,
      			deleted 				: 0
			});      		

			var data = this.dataSource.data();
			var obj = data[data.length - 1];
      						
			this.set("obj", obj);			
      	},
      	objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },
      	cancel 				: function(e){
      		e.preventDefault();

      		this.dataSource.cancelChanges();
      		window.history.back();      		
      	},      	
      	save 				: function(){
      		var self = this;

      		if(this.get("isEdit")){
      			this.dataSource.sync();
      			this.itemVendorDS.sync();
      			this.itemCustomerDS.sync();
      		}else{
	      		this.objSync().then(function(data){
	      			$.each(self.itemVendorDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			$.each(self.itemCustomerDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			self.itemVendorDS.sync();
	      			self.itemCustomerDS.sync();
	      		}).then(function(){	      			
	      			self.itemVendorDS.data([]);
	      			self.itemCustomerDS.data([]);

	      			self.addEmpty();
	      		});
      		}      		      		
      	},      	
      	delete 				: function(){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var obj = this.dataSource.at(0);
		        this.dataSource.remove(obj);
		        this.dataSource.sync();
		        window.history.back();
	    	}	    	
	    },
	    addEmptyItemVendor 	: function(){
			var item_id = 0;
			if(this.get("isEdit")){
				item_id = this.get("obj").id;
			}

			this.itemVendorDS.add({
				item_id 	: item_id,					 			
				contact_id 	: "",
				code 		: "",      				
				type 		: "vendor"
			});								
		},
		deleteItemVendor 	: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.itemVendorDS.getByUid(d.uid);

				this.itemVendorDS.remove(obj);
			}
		},
		addEmptyItemCustomer 	: function(){
			var item_id = 0;
			if(this.get("isEdit")){
				item_id = this.get("obj").id;
			}

			this.itemCustomerDS.add({
				item_id 	: item_id,					 			
				contact_id 	: "",
				code 		: "",      				
				type 		: "customer"
			});								
		},
		deleteItemCustomer 	: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.itemCustomerDS.getByUid(d.uid);

				this.itemCustomerDS.remove(obj);
			}
		}
    });
    banhji.itemCatalog =  kendo.observable({
    	lang 				: langVM,    	
    	dataSource 			: dataStore(baseUrl + "items"),
    	itemDS 				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},			
			batch: true,
			serverFiltering: true			
		}),
    	    	    	   	
    	statusList 			: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],

    	obj 	 			: null,    	
    	isEdit 				: false,
    	
    	pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}  																							
		},
    	loadObj 			: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);		    	
			});
    	},    	   	
      	addEmpty 			: function(){      		
      		this.dataSource.data([]);      		
      		this.set("obj", null);

      		this.dataSource.add({
      			company_id 				: 0,
      			contact_id 				: 0,      			
      			category_id 			: 8,
      			brand_id 				: 0,
      			item_type_id 			: 1,      			      			
      			measurement_id			: 0,      			
      			main_id 				: 0,
      			sku 					: "",
      			supplier_code 			: "",
      			color_code 				: "",
      			name 					: "",
      			description				: "",
      			catalogs 				: "",
      			cost 					: 0,
      			price 					: 0,
      			on_hand					: 0,      			     			
      			order_point 			: 0,
      			income_account_id 		: 0,
      			cogs_account_id  		: 0,
      			inventory_account_id 	: 0,
      			deposit_account_id 		: 0,
      			transaction_account_id 	: 0,
      			preferred_vendor_id 	: 0,
      			image_url 				: "",      			
      			favorite 				: false,
      			is_catalog 				: 1,
      			status 					: 1,
      			deleted 				: 0
			});      		

			var data = this.dataSource.data();
			var obj = data[data.length - 1];
      						
			this.set("obj", obj);			
      	},      	
      	cancel 				: function(e){
      		e.preventDefault();

      		this.dataSource.cancelChanges();
      		window.history.back();      		
      	},      	
      	save 				: function(){
      		var self = this, obj = this.get("obj");
      		
      		if(this.get("isEdit")){
      			this.dataSource.sync();      			
      		}else{
	      		this.dataSource.sync();
	      		var saved = false;
	      		this.dataSource.bind("requestEnd", function(e){
	      			if(e.type=="create" && saved==false){		      						      			
		      			self.addEmpty();
	      			}
	      		});
      		}      		      		   		      		
      	},      	
      	delete 				: function(){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var obj = this.dataSource.at(0);
		        this.dataSource.remove(obj);
		        this.dataSource.sync();
		        window.history.back();
	    	}	    	
	    }
    });
	banhji.itemAssembly =  kendo.observable({
		lang 				: langVM,    	
    	dataSource 			: dataStore(baseUrl + "items"),
    	itemDS 				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			group: { field: "category" },
			batch: true,
			serverFiltering: true			
		}),
    	assemblyDS 			: dataStore(baseUrl + "items/assembly"),
    	    	   	
    	statusList 			: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],

    	obj 	 			: null,
    	assembly_id			: "",
    	isEdit 				: false,
    	total 				: 0,
    	
    	pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}  																							
		},
    	loadObj 			: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
		    	self.assemblyDS.filter({ field:"item_id", value:id });
		    	self.set("total", kendo.toString(view[0].price, "c", banhji.institute.locale));
			});
    	},
    	changes				: function(){
			var obj = this.get("obj");

			if(this.assemblyDS.total()>0){			
				var total = 0, subTotal = 0;										

				$.each(this.assemblyDS.data(), function(index, value) {				
					subTotal = value.quantity * value.price;
					total += subTotal;

					value.set("amount", subTotal);					
		        });
		          
				obj.set("price", total);
				this.set("total", kendo.toString(total, "c", banhji.institute.locale));													    	
	    	}else{	    				
				obj.set("price", 0);
				this.set("total", 0);					
	    	}   	
		},		
		measurementChanges 	: function(e){								
			var self = this, data = e.data;
			
			if(data.measurement_id>0){
				$.each(data.priceList, function(index, value){
					if(value.measurement_id==data.measurement_id){						
				        data.set("price", kendo.parseFloat(value.price));				       			       
				        
						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},    	   	
      	addEmpty 			: function(){      		
      		this.dataSource.data([]);
      		this.assemblyDS.data([]);
      		this.set("obj", null);

      		this.dataSource.add({
      			company_id 				: 0,
      			contact_id 				: 0,      			
      			category_id 			: 9,
      			brand_id 				: 0,
      			item_type_id 			: 1,      			      			
      			measurement_id			: 0,      			
      			main_id 				: 0,
      			sku 					: "",
      			supplier_code 			: "",
      			color_code 				: "",
      			name 					: "",
      			description				: "",
      			cost 					: "",
      			on_hand					: 0,      			     			
      			order_point 			: 0,
      			income_account_id 		: 0,
      			cogs_account_id  		: 0,
      			inventory_account_id 	: 0,
      			deposit_account_id 		: 0,
      			transaction_account_id 	: 0,
      			preferred_vendor_id 	: 0,
      			image_url 				: "",      			
      			favorite 				: false,
      			status 					: 1,
      			is_assemble 			: 1,
      			deleted 				: 0
			});      		

			var data = this.dataSource.data();
			var obj = data[data.length - 1];
      						
			this.set("obj", obj);			
      	},
      	addItem 			: function(){      		
      		var assembly_id = this.get("assembly_id"),
      		isExisting = false,
      		item = this.itemDS.get(assembly_id),
      		item_id = 0, obj = this.get("obj");
			
			if(this.get("isEdit")){
				item_id = obj.id;
			}
      		
      		if(item){
	      		if(this.assemblyDS.total()>0){
	      			$.each(this.assemblyDS.data(), function(index, value){
	      				if(value.assembly_id==assembly_id){
	      					isExisting = true;

	      					return false;
	      				}
	      			});
	      		}
	      		
	      		if(isExisting===false){	      			
		      		this.assemblyDS.add({
		      			item_id 		: item_id,
		      			assembly_id 	: assembly_id,
		      			currency_id 	: item.price_list[0].currency_id,
		      			measurement_id 	: item.price_list[0].measurement_id,
		      			quantity 		: 1,
		      			unit_value 		: 0,
		      			price 			: item.price_list[0].price,
		      			amount 			: item.price_list[0].price,
		      			
		      			assembly 		: [{ sku:item.sku, name:item.name, description:item.description }],
		      			currency 		: [item.price_list[0].currency[0]],
		      			price_list 		: item.price_list		      			
					});

					this.changes();	      		
				}
			}			
      	},
      	removeItem 			: function(e){
      		e.preventDefault();

      		if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data, 
		        obj = this.assemblyDS.get(data.id);

		        this.assemblyDS.remove(obj);		        	        
	    	}
      	},
      	cancel 				: function(e){
      		e.preventDefault();

      		this.dataSource.cancelChanges();
      		window.history.back();      		
      	},      	
      	save 				: function(){
      		var self = this;

      		if(this.get("isEdit")){
      			this.dataSource.sync();
      			this.assemblyDS.sync();
      		}else{
	      		this.itemSync().then(function(item){
	      			$.each(self.assemblyDS.data(), function(index, value){
	      				value.set("item_id", item[0].id);
	      			});

	      			self.assemblyDS.sync();
	      		}).then(function(){
	      			self.dataSource.data([]);
	      			self.assemblyDS.data([]);

	      			self.addEmpty();
	      		});
      		}      		   		      		
      	},      	
      	delete 				: function(){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var obj = this.dataSource.at(0);
		        this.dataSource.remove(obj);
		        this.dataSource.sync();
		        window.history.back();
	    	}	    	
	    },
	    itemSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    }
    });
	banhji.itemRecord =  kendo.observable({
		lang 				: langVM,    	
    	dataSource 			: dataStore(baseUrl + "items/record"),
    	itemDS 				: dataStore(baseUrl + "items"),
    	invoiceDS 			: dataStore(baseUrl + "invoices"),    	
    	currencyDS 			: dataStore(baseUrl + "currencies"),
    	contactDS  			: dataStore(baseUrl + "contacts"),
    	measurementDS 	   	: dataStore(baseUrl + "measurements"),
    	
    	obj 				: null,
    	item 				: null,    	
    	isEdit 				: false,

    	pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}  																							
		},
		loadObj 			: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
			});
    	},
    	loadItem     		: function(id){
    		var self = this;

    		this.itemDS.query({
    			filter: { field:"id", value: id }
    		}).then(function(){
    			var view = self.itemDS.view();

    			self.set("item", view[0]);
    		});
    	},
    	itemChanges 		: function(){
    		var obj = this.get("obj");

    		if(obj.item_id>0){
    			var item = this.itemDS.get(obj.item_id);

    			this.set("item", item);
    		}
    	},	
      	addEmpty 			: function(){
      		this.dataSource.data([]);
      		this.set("obj", null);

      		this.dataSource.add({
      			contact_id 		: "",
      			reference_id 	: "",      			
      			currency_id 	: 1,      				      			
      			measurement_id 	: 0,
      			item_id 		: "",
      			unit 			: 0,
      			price 			: 0,
      			amount			: 0,
      			rate 			: 1,
      			movement 		: "IN",
      			issued_date		: new Date(),
      			memo 			: ""
			});

			var data = this.dataSource.data();
			var obj = data[data.length - 1];
      						
			this.set("obj", obj);      					
      	},      	
      	cancel 		 	: function(e){
      		e.preventDefault();

      		this.dataSource.cancelChanges();
      		window.history.back();      		
      	}, 
      	save 			: function(){
      		var self = this, obj = this.get("obj");

      		if(obj.unit<0){
      			obj.set("movement", "OUT");
      		}

      		this.dataSource.sync();
      		var saved = false;
      		this.dataSource.bind("requestEnd", function(e){
      			if(e.type=="create" && saved==false){
      				saved = true;

      				self.addEmpty();
      			}
      		});
      	},      	
      	delete 			: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data;
		        this.dataSource.remove(data);
		        this.dataSource.sync();
	    	}	    	
	    }
    });
    banhji.itemAdjustment = kendo.observable({
    	lang 				: langVM,
    	dataSource  		: dataStore(baseUrl + "invoices"),	
    	lineDS  			: dataStore(baseUrl + "invoices/line"),	
		itemDS  			: dataStore(baseUrl + "items"),
		contactDS 			: dataStore(baseUrl + "contacts"),
		accountDS 			: dataStore(baseUrl + "accounts"),		
		segmentItemDS		: banhji.segmentItem.ds,
		categoryDS 			: dataStore(baseUrl + "categories"),
		itemGroupDS			: dataStore(baseUrl + "items/group"),
		
		obj 				: null,		
		biller_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,	
		
		category_id 		: null,
		selectedItemGroup 	: [],
		isCategorySelected	: false,

		pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}  																							
		},
		loadObj 			: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
			});
    	},
    	categoryChanges 		: function(){
			var category_id = this.get("category_id");

			if(category_id){
				this.set("isCategorySelected", true);
				this.itemGroupDS.filter({ field:"category_id", value: category_id });
			}else{
				this.set("isCategorySelected", false);
				this.set("selectedItemGroup", []);
			}        	
        }, 		
		onChange 			: function(e) {
			e.preventDefault();

      		var selected = e.data,
      		index = this.lineDS.indexOf(e.data),
  			dataItem = this.lineDS.at(index+1);            
            
            if(kendo.parseInt(selected.new_qty)>0){
            	var diff = selected.new_qty - selected.on_hand;         
		        selected.set("unit", diff);
		        if(diff>0){
		        	selected.set("movement", 1);
		        }else{
		        	selected.set("movement", -1);
		        }
			}			
      					
			if(dataItem){
				$(".txt"+dataItem.uid).focus();
			}else{
				dataItem = this.lineDS.at(0);
				$(".txt"+dataItem.uid).focus();
			}            
        },        
        segmentChanges 		 : function(e) {
			var obj = this.get("obj"),
			dataArr = obj.segments,
			lastIndex = dataArr.length - 1,
			last = banhji.segmentItem.ds.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = banhji.segmentItem.ds.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		search 				: function(){
			var self = this,
			para = [],			
			category_id = this.get("category_id"),
			selectedItemGroup = this.get("selectedItemGroup");        	

            if(selectedItemGroup.length>0){
				var ids = [];
				$.each(selectedItemGroup, function(index, value){
					ids.push(value);
				});
				
				para.push({ field:"item_group_id", operator:"where_in", value:ids });
			}else if(category_id){
				para.push({ field:"category_id", value:category_id });
			}

			para.push({ field:"item_type_id", value:1 });
			para.push({ field:"is_catalog", value: 0 });
			para.push({ field:"is_assemble", value: 0 });          

            this.itemDS.query({
            	filter: para,
            	page: 1,
            	take: 100
            }).then(function(data){
            	var view = self.itemDS.view();
            	self.lineDS.data([]);

            	$.each(view, function(index, value){
            		self.lineDS.add({
            			invoice_id 			: 0,
						item_id 			: value.id,
						measurement_id 		: value.measurement_id,						
						description 		: value.sku +" "+ value.name,
						on_hand 			: value.on_hand,
						new_qty 			: "",				
						unit 	 			: "",
						price 				: value.price,												
						amount 				: 0,
						rate				: 1,
						locale				: banhji.institute.locale,
						movement 			: ""						
            		});
            	});
            });
		},
		removeRow 			: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);	        		        
		},
        addEmpty 		 	: function(){							
			this.set("obj", null);				
			
			this.dataSource.add({
				company_id 			: 0,
				location_id 		: 0,
				contact_id 			: "",
				payment_term_id		: 0,
				payment_method_id 	: 0,
				reference_id 		: 0,
				account_id 	 		: 0,
				vat_id 				: 0,
				biller_id 			: this.get("biller_id"),
 	    		number 				: "",
			   	type				: "Adjustment",
			   	sub_total 			: 0,				   		   					   				   	
			   	amount				: 0,
			   	vat 				: 0,
			   	rate				: 1,			   	
			   	locale 				: "km-KH",			   	
			   	issued_date 		: new Date(),
			   	due_date 			: "",
			   	check_no 			: "",
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,

			   	segments 			: []				
	    	});		    		
			
			var data = this.dataSource.data();
			var obj = data[data.length-1];			
			this.set("obj", obj);			
		},
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },      	
      	save 				: function(){				
	    	var self = this;			
	    	
	    	if(this.get("isEdit")){
	    		this.dataSource.sync();
	    		this.lineDS.sync();
	    	}else{
	    		//Add brand new invoice
				this.invoiceSync()
				.then(function(invoice){
					$.each(self.lineDS.data(), function(index, value){										
						value.set("invoice_id", invoice[0].id);						
					});
					self.lineDS.sync();											
				}).then(function(){
					self.dataSource.data([]);
					self.lineDS.data([]);										
					
					self.addEmpty();
				});
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		},	          	
      	delete 			: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data;
		        this.dataSource.remove(data);
		        this.dataSource.sync();
	    	}	    	
	    }
	});
	banhji.itemSetting =  kendo.observable({
		lang 				: langVM,		        
        categoryDS 			: dataStore(baseUrl + "categories"),
        subCategoryDS 		: dataStore(baseUrl + "categories"),
        itemGroupDS 		: dataStore(baseUrl + "items/group"),
        subItemGroupDS		: dataStore(baseUrl + "items/group"),
        measurementDS		: dataStore(baseUrl + "measurements"),
        brandDS 			: dataStore(baseUrl + "brands"),
        subBrandDS			: dataStore(baseUrl + "brands"),        

        category_sub_of 	: 0,
        category_code 		: "",
        category_name 		: "",
        category_abbr 		: "",

        item_group_category_id 	: 0,
        item_group_sub_of 	: 0,
        item_group_code 	: "",
        item_group_name 	: "",
        item_group_abbr 	: "",

        measurement_name 	: "",

        brand_sub_of 	 	: 0,
        brand_code 			: "",
        brand_name 			: "",
        brand_abbr 			: "",

        pageLoad 			: function() {
        	
        },        
        addCategory 		: function(){
        	var self = this, 
        	name = this.get("category_name"),
        	code = this.get("category_code");

        	if(name!=="" && code!==""){        		
	        	this.categoryDS.add({	        		
	        		sub_of 		 	: this.get("category_sub_of"),
	        		code 			: code,	        		
	        		name 			: name,
	        		abbr 			: this.get("category_abbr"),	        		
	        		is_system 		: 0
	        	});

	        	this.categoryDS.sync();
	        	this.categoryDS.bind("requestEnd", function(e){
	        		if(e.type=="create"){
	        			self.set("category_sub_of", 0);
	        			self.set("category_code", "");
	        			self.set("category_name", "");
	        			self.set("category_abbr", "");
	        		}
	        	});
        	}else{
        		alert("required number and name!");
        	}
        },
        addItemGroup 		: function(){
        	var self = this, 
        	category_id = this.get("item_group_category_id"),
        	name = this.get("item_group_name"),
        	code = this.get("item_group_code");

        	if(category_id>0 && name!=="" && code!==""){        		
	        	this.itemGroupDS.add({	        		
	        		category_id	 	: category_id,
	        		sub_of 		 	: this.get("item_group_sub_of"),
	        		code 			: code,	        		
	        		name 			: name,
	        		abbr 			: this.get("item_group_abbr"),	        		
	        		is_system 		: 0
	        	});

	        	this.itemGroupDS.sync();
	        	this.itemGroupDS.bind("requestEnd", function(e){
	        		if(e.type=="create"){
	        			self.set("item_group_category_id", 0);
	        			self.set("item_group_sub_of", 0);
	        			self.set("item_group_code", "");
	        			self.set("item_group_name", "");
	        			self.set("item_group_abbr", "");
	        		}
	        	});
        	}else{
        		alert("required category, number, and name!");
        	}
        },
        addMeasurement 		: function(){
        	var self = this, 
        	name = this.get("measurement_name");

        	if(name!==""){
	        	this.measurementDS.add({	        		
	        		name 		: name,
	        		description : name
	        	});

	        	this.measurementDS.sync();
	        	this.measurementDS.bind("requestEnd", function(e){
	        		if(e.type=="create"){	        			
	        			self.set("measurement_name", "");	        			
	        		}
	        	});
        	}else{
        		alert("required name");
        	}
        },
        addBrand 		: function(){
        	var self = this, 
        	code = this.get("brand_code"),
        	name = this.get("brand_name");

        	if(name!=="" && code!==""){
	        	this.brandDS.add({
	        		sub_of 		: this.get("brand_sub_of"),
	        		code 		: code,        		
	        		name 		: name,
	        		abbr 		: this.get("brand_abbr")
	        	});

	        	this.brandDS.sync();
	        	this.brandDS.bind("requestEnd", function(e){
	        		if(e.type=="create"){	        			
	        			self.set("brand_sub_of", 0);
	        			self.set("brand_code", "");
	        			self.set("brand_name", "");
	        			self.set("brand_abbr", "");	        			
	        		}
	        	});
        	}else{
        		alert("required number and name!");
        	}
        }
    });
	banhji.inventoryPositionSummary =  kendo.observable({
		lang 				: langVM,    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/inventory_position_summary",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "on_hand", dir: "desc" },
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),

    	as_of 				: new Date(),  	
    	
    	pageLoad 			: function(id){			
																						
		},			
		strDate 			: function(){
			var strDate = "As of " + kendo.toString(this.get("as_of"), "dd-MM-yyyy");			

			return strDate;
		},
		search 				: function(){
			var para = [], 
			as_of = kendo.toString(this.get("as_of"), "yyyy-MM-dd");

        	//Dates
        	if(as_of){        		
            	para.push({ field:"issued_date <=", value: as_of });            	          	            	
            }                   

            this.dataSource.filter(para);
		}    	
    });
    banhji.inventoryPositionDetail =  kendo.observable({
    	lang 				: langVM,    	
    	dataSource 			: dataStore(baseUrl + "items/inventory_position_detail"),

    	sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today",	value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",   	
    	
    	pageLoad 			: function(id){			
																						
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date >=", value: start });
            	para.push({ field:"issued_date <=", value: end });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
		}    	
    });
    banhji.inventorySaleByItem =  kendo.observable({
    	lang 				: langVM,    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/inventory_sale_by_item",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "qty", dir: "desc" },
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),

    	sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today",	value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",   	
    	
    	pageLoad 			: function(){			
																						
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date >=", value: start });
            	para.push({ field:"issued_date <=", value: end });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
            var loaded = false;
            this.dataSource.bind("requestEnd", function(e){
            	if(e.type=="read" && loaded==false){
            		loaded = true;

            		self.dataSource.sort({ field: "qty", dir: "desc" });
            	}
            });
		}    	
    });
    banhji.inventoryTurnoverList =  kendo.observable({
    	lang 				: langVM,    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/inventory_turnover_list",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "days", dir: "desc" },
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),
    	
		as_of 				: new Date(),   	
    	
    	pageLoad 			: function(){			
																						
		},			
		strDate 			: function(){
			var strDate = "As of " + kendo.toString(this.get("as_of"), "dd-MM-yyyy");			

			return strDate;
		},
		search 				: function(){
			var para = [], 
			as_of = kendo.toString(this.get("as_of"), "yyyy-MM-dd");

        	//Dates
        	if(as_of){        		
            	para.push({ field:"issued_date <=", value: as_of });            	          	            	
            }                   

            this.dataSource.filter(para);
		}    	
    });
    banhji.inventoryList =  kendo.observable({
		lang 				: langVM,    	
    	dataSource 			: dataStore(baseUrl + "items"),
    	categoryDS 			: dataStore(baseUrl + "categories"),
    	itemGroupDS 		: dataStore(baseUrl + "items/group"),    	
    	contactDS  			: dataStore(baseUrl + "contacts"),
    	vendorDS  			: dataStore(baseUrl + "contacts"),
    	    	
    	searchField			: "",
    	category_id 		: 0,
    	item_group_id 		: 0,     	
    	
    	pageLoad 			: function(){    		
    		
    	},
    	search 				: function(){
    		var para = [],
    		searchField = this.get("searchField"),
    		category_id = this.get("category_id"),
    		item_group_id = this.get("item_group_id");

    		if(searchField!==""){
    			para.push(      				
      				{ field: "sku", operator: "like", value: searchField },
      				{ field: "name", operator: "or_like", value: searchField }
      			);
    		}

    		if(item_group_id>0){
    			para.push({ field:"item_group_id", value:item_group_id });
    		}else if(category_id>0){
    			para.push({ field:"category_id", value:category_id });
    		}

    		this.dataSource.filter(para);    		
    	},
    	searchFavorite 	: function(){
    		this.dataSource.filter({ field:"favorite", value: 1 });
    	},    	
    	vendorChanges 	: function(e){    		
    		var index = e.sender.select().index();
    		var data = this.vendorDS.at(index);    		
    		
    		this.dataSource.filter({ field:"contact_id", operator:"by_vendor", value:data.id });
    	}    		
    });
    banhji.inventoryMovementSummary =  kendo.observable({
    	lang 				: langVM,    	    	    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/inventory_movement_summary",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "begining", dir: "desc" },
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),

    	sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today",	value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",   	
    	
    	pageLoad 			: function(id){			
																						
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date >=", value: start });
            	para.push({ field:"issued_date <=", value: end });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
		}    	
    });
    banhji.inventoryMovementDetail =  kendo.observable({
    	lang 				: langVM,    	    	    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/inventory_movement_detail",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "begining", dir: "desc" },
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),

    	sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today",	value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",   	
    	
    	pageLoad 			: function(id){			
																						
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date >=", value: start });
            	para.push({ field:"issued_date <=", value: end });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
		}    	
    });
    banhji.inventoryPurchaseByVendorSummary =  kendo.observable({
    	lang 				: langVM,    	    	    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/purchase_by_vendor_summary",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "amount", dir: "desc" },
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),

    	sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today",	value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",   	
    	
    	pageLoad 			: function(id){			
																						
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date >=", value: start });
            	para.push({ field:"issued_date <=", value: end });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
		}    	
    });
    banhji.inventoryPurchaseByVendorDetail = kendo.observable({
    	lang 				: langVM,    	    	    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl + "items/purchase_by_vendor_detail",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "issued_date", dir: "asc" },			
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),

    	sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today",	value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",   	
    	
    	pageLoad 			: function(id){			
																						
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date >=", value: start });
            	para.push({ field:"issued_date <=", value: end });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
		}    	
    });


	/*************************
	*   Electricity Section   *
	**************************/
	banhji.eDashBoard = kendo.observable({
		dataSource 			: dataStore(baseUrl + "invoices/edashboard"),
		saleByLocationDS 	: dataStore(baseUrl + "invoices/esale_by_location"),

		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "year",
		sdate 				: "",
		edate 				: "",		

		locale 				: "km-KH",
		balance 			: kendo.toString(0, "c0"),
		deposit 			: kendo.toString(0, "c0"),

		activeCustomer 		: kendo.toString(0, "n0"),		
		inactiveCustomer 	: kendo.toString(0, "n0"),
		voidCustomer 		: kendo.toString(0, "n0"),
		totalCustomer 		: kendo.toString(0, "n0"),

		totalUnpaid 		: kendo.toString(0, "n0"),
		totalDisconnect 	: kendo.toString(0, "n0"),
				
		pageLoad 			: function(){
			var self = this;			

			this.dataSource.query({			  
			  	page: 1,
			 	take: 50
			}).then(function(e) {
			    var view = self.dataSource.view();
			    
			    self.set("balance", kendo.toString(view[0], "c0"));
			    self.set("deposit", kendo.toString(view[1], "c0"));
			    
			    self.set("activeCustomer", kendo.toString(view[2], "n0"));
			    self.set("inactiveCustomer", kendo.toString(view[3], "n0"));
			    self.set("voidCustomer", kendo.toString(view[4], "n0"));
			    self.set("totalCustomer", kendo.toString(view[5], "n0"));
			    
			    self.set("totalUnpaid", kendo.toString(view[6], "n0"));
			    self.set("totalDisconnect", kendo.toString(view[7], "n0"));
		  	});
		},

		sorterChanges 		: function(){
			var value = this.get("sorter");

			switch(value){
			case "today":
				var today = new Date();
				
				this.set("sdate", today);
				this.set("edate", "");
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		autoIncreaseNo 		: function(){
			$(".sno").each(function(index,element){                 
			   $(element).text(index + 1); 
			});
		},
		search 				: function(){
			var self = this,
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),	        		
        		para = [];

        	//Dates
        	if(start && end){
            	para.push({ field:"issued_date >=", value: kendo.toString(start, "yyyy-MM-dd") });
            	para.push({ field:"issued_date <=", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
            }else if(start){
            	para.push({ field:"issued_date", value: kendo.toString(start, "yyyy-MM-dd") });
            }else if(end){
            	para.push({ field:"issued_date <=", value: kendo.toString(end, "yyyy-MM-dd") });
            }else{
            	
            }

            this.saleByLocationDS.query({
            	filter: para,
            	page: 1,
            	pageSize: 100
            }).then(function(){
            	self.autoIncreaseNo();
            });            
		}		
	});	
	banhji.meter = kendo.observable({		
		customer 		: null,
		meter 			: null,
		current_company_id : null,
		utility_id 		: null,		
		company_id 		: 0,
		contact_id 		: 0,

		tariffList 		: [],
		exemptionList 	: [],
		maintenanceList : [],

		ampereList 		: [],
		phaseList 		: [],
		voltageList 	: [],
		parentMeterList : [],

		dataSource 		: dataStore(baseUrl + "meters/index"),
		meterDS  		: dataStore(baseUrl + "meters/index"),
		contactDS 		: dataStore(baseUrl + "contacts/index"),
		locationDS 		: dataStore(baseUrl + "meters/location"),		
		electricityBoxDS : dataStore(baseUrl + "electricity_boxes/index"),
		electricityUnitDS : dataStore(baseUrl + "electricity_units/index"),		
		itemDS 			: dataStore(baseUrl + "meters/item"),
		feeDS 			: dataStore(baseUrl + "fees/index"),
		statusList 		: [            
			{ "id": 1, "name": "កំពុងប្រើប្រាស់" },
			{ "id": 2, "name": "ផ្អាក់ប្រើប្រាស់" },
			{ "id": 0, "name": "ឈប់ប្រើប្រាស់" }
        ],		

		pageLoad 		: function(utility_id){
			if(this.get("utility_id")!=utility_id){
			 	this.set("utility_id", utility_id);

			 	
			}								
		},
		loadData 		: function(company_id){			
			if(this.get("current_company_id")!=company_id){
			 	this.set("current_company_id", company_id);
				
				this.locationDS.filter([
					{ field:"company_id", value: company_id },
					{ field:"utility_id", value: this.get("utility_id") }
				]);

				var category_id = 1;
				if(this.get("utility_id")=="2"){
					category_id = 3;
				}
				
				this.itemDS.filter([
					{ field:"company_id", value: company_id },
					{ field:"category_id", value: category_id }
				]);

				this.loadFee(company_id);

				if(this.get("utility_id")=="1"){
					this.loadElectricityUnit(company_id);
				}
			}						
		},				
		loadFee		 	: function(company_id){
			var self = this;
			
			this.set("tariffList", []);
			this.set("exemptionList", []);
			this.set("maintenanceList", []);

			this.feeDS.filter([
				{ field:"company_id", value: company_id },
				{ field:"utility_id", value: this.get("utility_id") }
			]);
			this.feeDS.bind("requestEnd", function(e){
				var response = e.response.results;
				
				$.each(response, function(index, value){																						
					if(value.type=="tariff"){							
						self.tariffList.push({
							id 	: value.id,
							name: value.name 
						});
					}
					if(value.type=="exemption"){							
						self.exemptionList.push({
							id 	: value.id,
							name: value.name 
						});
					}
					if(value.type=="maintenance"){
						self.maintenanceList.push({
							id 	: value.id,
							name: value.name 
						});
					}								
				});
			});
		},
		loadElectricityUnit : function(company_id){
			var self = this;

			this.set("ampereList", []);
			this.set("phaseList", []);
			this.set("voltageList", []);
			
			this.electricityUnitDS.filter({ field:"company_id", value: company_id });
			this.electricityUnitDS.bind("requestEnd", function(e){
				var response = e.response.results;

				$.each(response, function(index, value){					
					if(value.type==="ampere"){
						self.ampereList.push({
							id 	: value.id,
							name: value.name 
						});
					}
					if(value.type==="phase"){
						self.phaseList.push({
							id 	: value.id,
							name: value.name 
						});
					}
					if(value.type==="voltage"){
						self.voltageList.push({
							id 	: value.id,
							name: value.name 
						});
					}									
				});
			});								
		},
		loadMeter 		: function(contact_id){
			var self = this;

			this.dataSource.filter([
				{ field:"contact_id", value: contact_id },
				{ field:"utility_id", value: this.get("utility_id") }
			]);
			this.dataSource.bind("requestEnd", function(e){
				var response = e.response.results;
				
				$.each(response, function(index, value){																						
					if(value.reactive_of==0 && value.backup_of==0){							
						self.parentMeterList.push({
							id 	: value.id,
							name: value.number 
						});
					}										
				});
			});			
		},
		addEmpty		: function(){										      		
      		this.dataSource.add({
      			company_id 			: this.get("company_id"),
      			utility_id 			: this.get("utility_id"),
      			location_id 		: 0,
      			electricity_box_id 	: 0,
      			contact_id 			: this.get("contact_id"),
      			item_id 			: 0,
      			reactive_of 		: 0,
				backup_of 			: 0,
				number 				: "",
				multiplier			: 1,
				max_number			: 10000,
				ear_sealed			: true,
				cover_sealed		: true,				
				memo				: "",	
				status				: 1,
				date_used 			: new Date(),

				item_name 			: "",
				electricity_box_number : "",
				
				amperes 			: {id:0},				
				phases 				: {id:0},				
				voltages 			: {id:0},
				
				tariffs 			: {id:0},				
				exemptions 			: {id:0},								
				maintenances 		: {id:0}
			});

			var data = this.dataSource.data();
			var obj = data[data.length - 1];
      						
			this.set("meter", obj);			
      	},
      	openMeterWindow	: function(){
      		this.addEmpty();

         	var window = $("#meter-window").data("kendoWindow");
          	window.title("Meter");          	
          	window.center().open();         	
      	},
      	closeMeterWindow: function(){	      		
      		this.dataSource.cancelChanges();
      		var window = $("#meter-window").data("kendoWindow");          	         	
          	window.close();          	
      	},
      	edit 			: function(e){
      		var data = e.data;
      		
      		this.set("meter", data);      		    		

      		var window = $("#meter-window").data("kendoWindow");
          	window.title("Meter");          	
          	window.center().open();
      	},
      	save 			: function(){
      		var self = this;

      		this.dataSource.sync();
      		var saved = false;
      		this.dataSource.bind("requestEnd", function(e){
      			if(saved==false){
					saved = true;

	      			self.set("meter", null);

	      			var window = $("#meter-window").data("kendoWindow");          	         	
	          		window.close();
          		}
      		});
      	},      	
      	delete 			: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data;
		        this.dataSource.remove(data);
		        this.dataSource.sync();
	    	}	    	
	    }
	});	
	banhji.reading = kendo.observable({		
		monthOfSearch 	: null,
		company 		: null,
		location_id 	: null,
		meter_id 		: null,
		utility_id 		: null,
				
		month_of 		: new Date(),
		from_date		: new Date(),
		to_date			: new Date(),
		read_by 		: null,		
						
		dataSource 		: new kendo.data.DataSource({
			transport: {
				read: {
					url: baseUrl + "meters/reading",
					headers: {
						"Entity": getDB()
					},
					type: "GET",
					dataType: "json"
				}			  	
			},						
			pageSize: 100,							  	
		  	schema: {
				model: {
					id: "id"
				},
				data: "results",
				total: "count"	
			}
		}),
		readerDS 		: dataStore(baseUrl + "contacts/employee"),
		branchDS 		: dataStore(baseUrl + "contacts/branch"),
		elocationDS 	: dataStore(baseUrl + "meters/elocation"),
		wlocationDS 	: dataStore(baseUrl + "meters/wlocation"),
		
		meterDS			: dataStore(baseUrl + "meters/index"),
		meterRecordDS	: dataStore(baseUrl + "meters/reading"),
		
		pageLoad 		: function(utility_id){
			if(this.get("utility_id")!=utility_id){
			 	this.set("utility_id", utility_id);


			}								
		},
		strMonthOf 		: function(){
			return "អំនានប្រចាំខែ " + kendo.toString(this.get("monthOfSearch"), "MM-yyyy");
		},		
		search 			: function(){								
			var monthOfSearch = this.get("monthOfSearch");			
			var location_id = this.get("location_id");
			var meter_id = this.get("meter_id");
			var para = Array();
		
			if(monthOfSearch){				
				if(location_id || meter_id){						
					var monthOf = new Date(monthOfSearch);
					monthOf.setDate(1);
					monthOf = kendo.toString(monthOf, "yyyy-MM-dd");
					para.push({ month_of: monthOf });				
					
					this.dataSource.transport.options.read.data={
						month_of: monthOf,
						location_id: location_id,
						meter_id: meter_id
					};
					this.dataSource.read();	
				}
			}		
		},						
		isSupported 	: function() {
			// check if File API is supported in this browser
			if(window.File && window.FileReader && window.FileList && window.Blob) {
				return true;
			} else {
				return false;
			}
		},			
		readFile 		: function(e){
			e.preventDefault();
			var self = this;

			var reader = new FileReader();					
			if(this.get("isSupported")) {
				var file = document.getElementById('myFile').files[0];
				// var file = $('#myFile').get(0).files[0];

				if(file !== undefined) {
					this.set("uploadStatus", "");
					reader.readAsText(file);
					
					reader.onload = function() {						
 						var result = reader.result.split('\r');	 						
 						
						// for (var i = 1; i < result.length; i ++) {								
						// 	var data = result[i].split(',');
						// 	readingList.push(data);															
						// }

						self.dataSource.transport.options.read.data = result;
						self.dataSource.read();																		
					}

					reader.onerror = function() {							
						this.set("uploadStatus", reader.error);
					}						
				} else {
					this.set("uploadStatus", "សូមSelectឯកសា!");
				}

			} else {
				this.set("uploadStatus", "Invalid file!");					
			}
		},				
      	onChange 		: function(e) {
      		e.preventDefault();

      		var self = this;
      		var selected = e.data;            
            
            if(kendo.parseInt(selected.current)>0){        
		        var add_up = 0;
		        if(selected.new_round){
		        	add_up = kendo.parseInt(selected.max_number);            	
	        	}
	        	var usage = ((kendo.parseInt(selected.current) + add_up) - kendo.parseInt(selected.previous))*selected.multiplier;
	            selected.set("usage", usage);
	            
	            if(usage<0){
					selected.set("isValid", false);
				}else{
					selected.set("isValid", true);
				}
			}else{
				selected.set("usage", "");
				selected.set("isValid", true);
			}

			var nextID = selected.index+1;
			$(".txt"+nextID).focus();            
        },
        companyChanges	: function(e){        	
        	this.set("location_id", null);
        },
        total 			: function() {      		
	        var sum = 0;

	        $.each(this.dataSource.data(), function(index, value) {	        		            
	        	sum += kendo.parseInt(value.usage);		        	          
	        });

	        return kendo.toString(sum, "n0");
	    },
	    checkInput 		: function() {	        
	        var isValid = true;
	        var hasReading = false;

	        $.each(this.dataSource.data(), function(index, value) {
	        	if(value.current>0){
	        		hasReading = true;
	        	}

	        	if(value.isValid==false){
	        		isValid = false;
	        	}		        	          
	        });

	        if(hasReading==false){
	        	isValid = false;
	        }

	        return isValid;
	    },             	
      	save 			: function(){
      		var self = this;	      		     			
  			var monthOf = new Date(this.get("month_of"));
			monthOf.setDate(1);
			monthOf = kendo.toString(monthOf, "yyyy-MM-dd");

			$.each(this.dataSource.data(), function(index, value){
				if(kendo.parseInt(value.current)>0){
					self.meterRecordDS.add({				
						meter_id	: value.id,
						read_by 	: self.get("read_by"),
						input_by 	: 0,						
					   	previous	: value.previous,
					   	current 	: value.current,					   	
					   	new_round	: value.new_round,
					   	usage 		: value.usage,					   	
					   	month_of 	: monthOf,
					   	from_date	: kendo.toString(self.get("from_date"), "yyyy-MM-dd"),						   
					   	to_date 	: kendo.toString(self.get("to_date"), "yyyy-MM-dd")
					});
				}
			});

			this.meterRecordDS.sync();
			var saved = false;				
			this.meterRecordDS.bind("requestEnd", function(e){				
				if(saved==false){
					saved = true;

					self.meterRecordDS.data([]);
					self.dataSource.data([]);
				}
			});      			
      	}      			
	});
	banhji.uInvoice = kendo.observable({		
		dataSource  	: dataStore(baseUrl + "invoices/uInvoice"),
		meterDS  		: dataStore(baseUrl + "meters"),		
		branchDS 		: dataStore(baseUrl + "contacts/branch"),
		elocationDS 	: dataStore(baseUrl + "meters/elocation"),
		wlocationDS 	: dataStore(baseUrl + "meters/wlocation"),		
		tariffItemDS 	: dataStore(baseUrl + "meters/tariff_item"),		
		readingDS 		: new kendo.data.DataSource({
			transport: {
				read: {
					url: baseUrl + "meters/reading_for_invoice",
					headers: {
						"Entity": getDB()
					},
					type: "GET",
					dataType: "json"
				}			  	
			},						
			pageSize: 100,							  	
		  	schema: {
				model: {
					id: "id"
				},
				data: "results",
				total: "count"	
			}		  			
		}),

		chkAll 			: false,		
		monthOfSearch 	: null,
		company_id 		: null,
		location_id 	: null,
		utility_id		: 1,
		biller 			: banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id,
				
		issued_date		: new Date(),
		payment_date 	: new Date(),
		due_date 		: new Date(),	
		month_of 		: new Date(),
		
		pageLoad 		: function(utility_id){
			this.set("utility_id", utility_id);

			this.tariffItemDS.read();
		},		
		search 			: function(){
			var monthOfSearch = this.get("monthOfSearch");			
			var location_id = this.get("location_id");
			var meter_id = this.get("meter_id");
			var para = Array();
		
			if(monthOfSearch){
				if(location_id || meter_id){						
					var monthOf = new Date(monthOfSearch);
					monthOf.setDate(1);
					monthOf = kendo.toString(monthOf, "yyyy-MM-dd");
					para.push({ month_of: monthOf });				
					
					this.readingDS.transport.options.read.data={
						month_of: monthOf,
						location_id: location_id,
						meter_id: meter_id
					};
					this.readingDS.read();	
				}
			}
		},	
		checkAll 		: function(e){
			e.preventDefault();

			var bolValue = this.get("chkAll");
			var data = this.readingDS.data();
			
			if(data.length>0){						
		        $.each(data, function(index, value){		        			        	
		        	value.set("isCheck", bolValue);		        	
		        });		        			        
	        }							
		},		
		companyChanges 	: function(e){				
        	e.preventDefault();
        	this.set("location_id", null);
        },
        total 			: function(){      		
	        var sum = 0;

	        $.each(this.readingDS.data(), function(index, value) {	        		            
	        	sum += kendo.parseInt(value.usage);		        	          
	        });

	        return kendo.toString(sum, "n0");
	    },	 
		save 	 		: function(){
			var self = this;
			var monthOf = new Date(this.get("month_of"));
			monthOf.setDate(1);
			monthOf = kendo.toString(monthOf, "yyyy-MM-dd");

			var data = this.readingDS.data();

			var invoiceType = "eInvoice";
			if(this.get("utility_id")==2){
				invoiceType = "wInvoice";
			}			
			//Get unique contact_id
			var uniqueCustomerID = [];
			$.each(data, function(index, value){
				if(value.isCheck){				
			    	if($.inArray(value.customers.id, uniqueCustomerID) === -1) uniqueCustomerID.push(value.customers.id);
			    }				
			});			
			
			for (var i=0;i<uniqueCustomerID.length;i++) {
				var invoiceLineList = [];
				var amount = 0, rate = 1, locale = "km-KH", company_id = 0, location_id = 0;

				//Calculation
				$.each(data, function(indexmr, mr){															
					if(mr.customers.id==uniqueCustomerID[i]){						
						var usage = kendo.parseInt(mr.usage);
						var current_amount = 0;

						var company_rate = self.branchDS.get(mr.customers.company_id).rate;						
						rate = kendo.parseFloat(company_rate)/kendo.parseFloat(mr.customers.rate);
						locale = mr.customers.locale;
						company_id = mr.customers.company_id;
						location_id = mr.meters.location_id;
						
						//Exemption as usage						
						if(mr.exemptions.length>0){							
							if(mr.exemptions[0].unit=="usage"){
								var exemptionUsage = kendo.parseFloat(mr.exemptions[0].amount);
								if(usage>exemptionUsage){
									usage -= exemptionUsage;
								}else{
									usage = 0;
								}

								invoiceLineList.push({				
							   		"invoice_id"		: 0,
									"item_id" 			: 0,															
								   	"meter_record_id"	: 0,
								   	"description" 		: mr.exemptions[0].name,					   	
								   	"unit" 				: mr.exemptions[0].amount,
								   	"price"				: 0,					   	
								   	"amount" 			: 0,
								   	"rate"				: rate,
								   	"locale" 			: locale,
								   	"has_vat" 			: false
								});
							}					
						}
						
						//Tariff						
						if(mr.tariffs.length>0){							
							$.each(self.tariffItemDS.data(), function(indext, tariff){
								var tariffUsage = kendo.parseFloat(tariff.usage);						
								var tamount = 0;
								
								if(kendo.parseInt(tariff.fee_id)==mr.tariffs[0].id){
									if(tariff.is_flat){								
										tamount = kendo.parseFloat(tariff.price);																																																																																
									}else{								
										tamount = usage * kendo.parseFloat(tariff.price);																						
									}

									invoiceLineList.push({				
								   		"invoice_id"		: 0,
										"item_id" 			: 0,																
									   	"meter_record_id"	: mr.id,
									   	"description" 		: mr.tariffs[0].name,					   	
									   	"unit" 				: usage,
									   	"price"				: tariff.price,					   	
									   	"amount" 			: tamount*rate,
									   	"rate"				: rate,
									   	"locale" 			: locale,
									   	"has_vat" 			: false
									});

									current_amount += tamount;				

									return false;						
								}
							});					
						}
						
						//Exemption as money and $
						if(mr.exemptions.length>0){											
							if(mr.exemptions[0].unit=="money"){												
								invoiceLineList.push({				
							   		"invoice_id"		: 0,
									"item_id" 			: 0,															
								   	"meter_record_id"	: 0,
								   	"description" 		: mr.exemptions[0].name,					   	
								   	"unit" 				: 1,
								   	"price"				: mr.exemptions[0].amount,					   	
								   	"amount" 			: mr.exemptions[0].amount*rate,
								   	"rate"				: rate,
								   	"locale" 			: locale,
								   	"has_vat" 			: false
								});

								if(current_amount>kendo.parseFloat(mr.exemptions[0].amount)){
									current_amount -=  kendo.parseFloat(mr.exemptions[0].amount);
								}else{
									current_amount = 0;
								}						
							}

							if(mr.exemptions[0].unit=="%"){
								var exemptionPercent = amount / kendo.parseFloat(mr.exemptions[0].amount);
								invoiceLineList.push({				
							   		"invoice_id"		: 0,
									"item_id" 			: 0,													
								   	"meter_record_id"	: 0,
								   	"description" 		: mr.exemptions[0].name,					   	
								   	"unit" 				: 1,
								   	"price"				: mr.exemptions[0].amount,					   	
								   	"amount" 			: exemptionPercent*rate,
								   	"rate"				: rate,
								   	"locale" 			: locale,
								   	"has_vat" 			: false
								});
							}
						}

						amount += current_amount;
					}					
				});				

				//Add invoice
				this.dataSource.add({				
			   		"company_id"	: company_id,
			   		"contact_id"	: uniqueCustomerID[i],
			   		"payment_term_id": 0,
			   		"payment_method_id":0,
			   		"reference_id" 	: 0,
			   		"account_id"  	: 0,
			   		"vat_id"		: 0,
			   		"biller_id" 	: this.get("biller"),
			   		"location_id" 	: location_id,	
					"number" 		: "",											
				   	"type"			: invoiceType,
				   	"amount" 		: amount*rate,
				   	"vat" 			: 0,					   	
				   	"rate" 			: rate,
				   	"locale" 		: locale,
				   	"month_of" 		: monthOf,
				   	"issued_date"	: kendo.toString(this.get("issued_date"), "yyyy-MM-dd"),					   	
				   	"payment_date" 	: kendo.toString(this.get("payment_date"), "yyyy-MM-dd"),
				   	"due_date" 		: kendo.toString(this.get("due_date"), "yyyy-MM-dd"),
				   	"check_no" 		: "",
				   	"memo" 			: "",
				   	"memo2" 		: "",
				   	"status" 		: 0,

				   	"invoice_lines" : invoiceLineList
				});
			}

			var saved = false;			
			this.dataSource.sync();
			this.dataSource.bind("requestEnd", function(e){
				if(saved==false){
					saved = true;
					
					self.readingDS.read();
				}
			});
		}	
	});	
	banhji.invoicePrint = kendo.observable({
		monthOfSearch 	: new Date("2015-08-01"),
		company_id 		: 4,
		location_id 	: 8,
		utility_id		: 1,
		invoice_id 		: null,	
		isVisible 		: true,		
				
		dataSource 	 	: dataStore(baseUrl + "invoices/print"),
		invoiceDS 	 	: dataStore(baseUrl + "invoices/index"),
		branchDS 		: dataStore(baseUrl + "contacts/branch"),
		elocationDS 	: dataStore(baseUrl + "meters/elocation"),
		wlocationDS 	: dataStore(baseUrl + "meters/wlocation"),
				
		pageLoad 		: function(utility_id, id){
			this.set("utility_id", utility_id);			
			
			if(id){

			}			
		},
		search 			: function(){
			var self = this;

			var monthOfSearch = this.get("monthOfSearch");			
			var location_id = this.get("location_id");
								
			if(monthOfSearch && location_id){								
				var monthOf = new Date(monthOfSearch);
				monthOf.setDate(1);
				monthOf = kendo.toString(monthOf, "yyyy-MM-dd");
												
				this.dataSource.query({
					filter: [
						{ field:"month_of", value: monthOf },
						{ field:"location_id", value: location_id }
					],
					page: 1,
					pageSize: 5
				}).then(function(e){
					self.barcod();
				});				
			}											
		},
		companyChanges 	: function(e){				
        	e.preventDefault();
        	this.set("location_id", null);
        },	
		barcod 			: function(){									
			var view = this.dataSource.view();
			
			for (var i=0;i<view.length;i++) {
				var d = view[i];
				
				if(this.get("utility_id")=="1"){								
					$("."+d.number).kendoBarcode({
						renderAs: "svg",
					  	value: d.customers.number,
					  	type: "code128",
					  	width: 200,
						height: 40,
						text:{
						    visible: false
						}	
					});
				}else{
					$("."+d.number).kendoBarcode({
						renderAs: "svg",
					  	value: d.customers.number,
					  	type: "code128",
					  	width: 200,
						height: 40
					});
				}
			}		
		},		
		print 			: function(e) {
			var printBtn = e.target;
			if(printBtn.checked) {
				$(".hiddenPrint").css("visibility", "hidden");
			} else {
				$(".hiddenPrint").css("visibility", "visible");
			}
		}
	});


	/*************************
	*	Water Section   *
	**************************/
	banhji.wDashBoard = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices/wdashboard"),
		saleByBranchDS 		: dataStore(baseUrl + "invoices/wsale_by_branch"),
		saleByLocationDS 	: dataStore(baseUrl + "invoices/wsale_by_location"),

		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "year",
		sdate 				: "",
		edate 				: "",		

		locale 				: "km-KH",
		balance 			: kendo.toString(0, "c0"),
		deposit 			: kendo.toString(0, "c0"),

		activeCustomer 		: kendo.toString(0, "n0"),		
		inactiveCustomer 	: kendo.toString(0, "n0"),
		voidCustomer 		: kendo.toString(0, "n0"),
		totalCustomer 		: kendo.toString(0, "n0"),

		totalUnpaid 		: kendo.toString(0, "n0"),
		totalDisconnect 	: kendo.toString(0, "n0"),
				
		pageLoad 			: function(){
			var self = this;

			this.dataSource.query({			  
			  	page: 1,
			 	take: 50
			}).then(function(e) {
			    var view = self.dataSource.view();
			    
			    self.set("balance", kendo.toString(view[0], "c0", banhji.institute.locale));
			    self.set("deposit", kendo.toString(view[1], "c0", banhji.institute.locale));
			    
			    self.set("activeCustomer", kendo.toString(view[2], "n0"));
			    self.set("inactiveCustomer", kendo.toString(view[3], "n0"));
			    self.set("voidCustomer", kendo.toString(view[4], "n0"));
			    self.set("totalCustomer", kendo.toString(view[5], "n0"));
			    
			    self.set("totalUnpaid", kendo.toString(view[6], "n0"));
			    self.set("totalNoMeter", kendo.toString(view[7], "n0"));
		  	});
		},
		sorterChanges 		: function(){
			var value = this.get("sorter");

			switch(value){
			case "today":
				var today = new Date();
				
				this.set("sdate", today);
				this.set("edate", today);
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		autoIncreaseNo 		: function(){
			$(".sno").each(function(index,element){                 
			   $(element).text(index + 1); 
			});

			$(".snoo").each(function(index,element){                 
			   $(element).text(index + 1); 
			});
		},
		search 				: function(){
			var self = this,
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),	        		
        		para = [];

        	//Dates
        	if((start && end) && (new Date(start) < new Date(end))){        		
            	para.push({ field:"start_date", value: kendo.toString(start, "yyyy-MM-dd") });
            	para.push({ field:"end_date", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
            }else if(start){
            	para.push({ field:"start_date", value: kendo.toString(start, "yyyy-MM-dd") });
            }else if(end){
            	para.push({ field:"end_date", value: kendo.toString(end, "yyyy-MM-dd") });
            }else{
            	
            }

            this.saleByBranchDS.query({
            	filter: para,
            	page: 1,
            	pageSize: 100
            });

            this.saleByLocationDS.query({
            	filter: para,
            	page: 1,
            	pageSize: 100
            }).then(function(){
            	self.autoIncreaseNo();
            });             
		}
	});
	banhji.wCustomerCenter = kendo.observable({
		lang 				: langVM,
		transactionDS  		: dataStore(baseUrl + 'invoices/wtransaction'),
		contactDS 			: dataStore(baseUrl + 'contacts'),
		contactTypeDS		: dataStore(baseUrl + 'contacts/type'),
		noteDS 				: dataStore(baseUrl + 'notes'),		
		branchDS 			: dataStore(baseUrl + 'contacts/branch'),
		locationDS 			: dataStore(baseUrl + 'locations'),
		currencyDS 			: dataStore(baseUrl + 'currencies'),
		monthlyDS 			: dataStore(baseUrl + 'invoices/wmonthly'),
		outstandingDS 		: dataStore(baseUrl + "invoices/woutstanding"),
		meterDS 			: dataStore(baseUrl + 'meters/wdeposit'),

		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "year",
		sdate 				: "",
		edate 				: "",
				
		obj 				: null,
		note 				: "",		
		searchText 			: "",
		branch_id 			: 0,
		location_id 		: 0,
		contact_type_id 	: 0,
		currency_id 		: 0,
		user_id 			: banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id,

		balance 			: 0,
		deposit 			: 0,
		outInvoice 			: 0,
		overInvoice 		: 0,
		
		pageLoad 			: function(){		
												
		},
		loadOutStandingInvoice: function(id){
			var self = this;

			this.outstandingDS.query({
				filter: { field: "contact_id", value: id },
				page: 1,
				take: 100
			}).then(function(e) {
				var view = self.outstandingDS.view();

				self.set("deposit", kendo.toString(view[0].deposit, "c0", "km-KH"));
				self.set("outInvoice", kendo.toString(view[1].outInvoice, "n0"));
				self.set("overInvoice", kendo.toString(view[2].overInvoice, "n0"));
				self.set("balance", kendo.toString(view[3].balance, "c0", "km-KH"));
			});
		},
		loadTransaction 	: function(id){
			this.transactionDS.query({
			  	filter: { field:"contact_id", value: id },
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadBalance 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", operator:"invoice", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Invoice", "wInvoice"] },
			  		{ field:"status", operator:"invoice", value: 0 },
			  		{ field:"id", operator:"payment", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadDeposit 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", operator:"payment", value: obj.id },
			  		{ field:"type", operator:"payment", value:"deposit" },			  		
			  		{ field:"id", operator:"invoice", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadOverInvoice 	: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", operator:"invoice", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Invoice", "wInvoice"] },
			  		{ field:"status", operator:"invoice", value: 0 },
			  		{ field:"due_date <", operator:"invoice", value: kendo.toString(new Date(), "yyyy-MM-dd") },
			  		{ field:"id", operator:"payment", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	take: 100
			});
		},
		loadMeter 			: function(id){
			this.meterDS.filter([
				{ field:"contact_id", value: id },
				{ field:"utility_id", value: 2 }
			]);
		},
		loadNote 			: function(id){
			this.noteDS.query({
				filter: { field:"contact_id", value: id },
				sort: { field:"noted_date", dir:"desc" },
				page: 1,
				take: 100
			});
		},
		loadGraph 			: function(id){
			var self = this;

			this.monthlyDS.query({
				filter: { field: "contact_id", value: id },
				page: 1,
				take: 100
			}).then(function(e) {
			    var view = self.monthlyDS.view();
			    
				$('#wUsage-graph').kendoChart({
					dataSource: {data: view},												
					series: [
						{field: 'amount', categoryField:'month', type: 'line', axis: 'sale'},
						{field: 'usage', categoryField:'month', type: 'area', axis: 'usage'}
					],
					valueAxes: [
						{
		                    name: "sale",
		                    color: "#007eff",
		                    min: 0,
		                    majorUnit: 10000,
		                    max: 100000
		                }, 
		                {
		                    name: "usage",
		                    min: 0,	
		                    majorUnit: 5,		                   
		                    max: 50
		                }
	                ],
	                categoryAxis: {
	                    //categories: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],		                    
	                    axisCrossingValues: [0, 13],
	                    justified: true
	                },
	                tooltip: {
	                    visible: true,
	                    format: "{0}",
	                    template: "#= series.field #: #= value #"
	                }
				});
			});		
		},		
		selectedRow			: function(e){
			var id = e.data.id,
			data = e.data;			
			
			this.set("obj", data);
			this.loadGraph(id);
			this.loadOutStandingInvoice(id);
			this.loadTransaction(id);
			this.loadMeter(id);
			this.loadNote(id);
		},
		sorterChanges 		: function(){
			var value = this.get("sorter");

			switch(value){
			case "today":
				var today = new Date();
				
				this.set("sdate", today);
				this.set("edate", today);
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this, 
			para = [],
      		txtSearch = this.get("searchText"), 
      		company_id = this.get("branch_id"),
      		location_id = this.get("location_id"), 
      		contact_type_id = this.get("contact_type_id"),
      		currency_id = this.get("currency_id");

      		para.push({ field: "use_water", value: 1 });
      		
      		if(txtSearch){
      			para.push(      				
      				{ field: "wnumber", operator: "like", value: txtSearch },
      				{ field: "surname", operator: "or_like", value: txtSearch },
					{ field: "name", operator: "or_like", value: txtSearch },
					{ field: "company", operator: "or_like", value: txtSearch }
      			);
      		}

      		if(location_id){
      			para.push({ field: "wlocation_id", value: location_id });
      		}else{
      			if(company_id){
	      			para.push({ field: "wbranch_id", value: company_id });
	      		}
      		}

      		if(contact_type_id){
      			para.push({ field: "contact_type_id", value: contact_type_id });
      		}

      		if(currency_id){
      			para.push({ field: "currency_id", value: currency_id });
      		}      		

      		this.contactDS.filter(para);
      		var loaded = false;
      		this.contactDS.bind("requestEnd", function(e){
      			if(e.type=="read" && loaded==false){
      				loaded = true;

      				//Clear search filters
		      		self.set("searchText", "");
		      		self.set("branch_id", 0);
		      		self.set("location_id", 0);
		      		self.set("contact_type_id", 0);
		      		self.set("currency_id", 0);
      			}
      		});      			
		},
		searchTransaction	: function(){
			var self = this,
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),	        		
        		para = [];

        	//Dates
        	if(start && end){
            	para.push({ field:"start_date", value: kendo.toString(start, "yyyy-MM-dd") });
            	para.push({ field:"end_date", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
            }else if(start){
            	para.push({ field:"start_date", value: kendo.toString(start, "yyyy-MM-dd") });
            }else if(end){
            	para.push({ field:"end_date", value: kendo.toString(end, "yyyy-MM-dd") });
            }else{
            	
            }            

            this.transactionDS.query({
            	filter: para,
            	sort: { field: "issued_date", dir: "desc" },
            	page: 1,
            	pageSize: 100
            });            
		},
		branchChanges 		: function(e){
			if(e.sender.selectedIndex==0){
				this.set("location_id", 0);
			}
		},		
		goToNewWaterDeposit		: function(){
			var obj = this.get("obj");	
			
			banhji.router.navigate('/wDeposit');
			banhji.wDeposit.loadContact(obj.id);			
		},
		goToWaterDepositWitdraw	: function(e){
			var data = e.data;

			banhji.router.navigate('/wDeposit_witdraw');
			banhji.wDepositWitdraw.loadMeter(data.id);
		},
		goEditContact 		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/wCustomer/'+obj.id);
		},
		goEstimate			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/estimate');
			banhji.estimate.loadContact(obj.id);			
		},
		goSO				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/so');
			banhji.so.loadContact(obj.id);
		},
		goReceipt			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/receipt');
			banhji.receipt.loadContact(obj.id);
		},
		goInvoice			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/invoice');
			banhji.invoice.loadContact(obj.id);					
		},
		goGDN				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/gdn');
			banhji.gdn.loadContact(obj.id);
		},
		goStatement			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/statement');
			banhji.statement.loadContact(obj.id);
		},
		saveNote 			: function(){
			var self = this;

			if(this.get("note")!==""){
				this.noteDS.insert(0, {
					contact_id 	: this.get("obj").id,
					note 		: this.get("note"),
					noted_date	: new Date(),
					created_by 	: this.get("user_id"),

					creator 	: ""
				});
				var saved = false;
				this.noteDS.sync();
				this.noteDS.bind("requestEnd", function(){
					if(saved==false){
						saved = true;

						self.set("note", "");
					}
				});
			}else{
				alert("ត្រូវការ កំណត់Memo");
			}
		}		
	});
	banhji.wNewCustomer = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(baseUrl + "contacts"),
		numberDS 				: dataStore(baseUrl + "contacts"),			
		branchDS  				: dataStore(baseUrl + "contacts/branch"),
		locationDS  			: dataStore(baseUrl + "locations"),

        obj 					: null,
        isDuplicateNumber 		: false,		
		
		pageLoad 				: function(){
					
		},
		openWindow		: function(e){
			var data = e.data;

			this.set("obj", data);
      		
         	var window = $("#window").data("kendoWindow");
          	window.title(data.number +"-"+ data.fullname);          	
          	window.center().open();         	
      	},
      	closeWindow 	: function(){	      		
      		this.dataSource.cancelChanges();

      		var window = $("#window").data("kendoWindow");          	         	
          	window.close();          	
      	},
      	checkExistingNumber 	: function(){
			var self = this, obj = this.get("obj");	
			
			var number = obj.wnumber;			
			
			if(number){
				this.numberDS.query({
					filter: [
						{ field:"wnumber", value: number },
						{ field:"wlocation_id", value: obj.wlocation_id },
					],
					page: 1,
					take: 1
				}).then(function(e){
					var view = self.numberDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		pad 					: function(str, max){
			str = str.toString();
  			return str.length < max ? this.pad("0" + str, max) : str;
		},
		locationChanges			: function(){
			var self = this, obj = this.get("obj");

			if(obj.wlocation_id>0){
				var loc = this.locationDS.get(obj.wlocation_id);
				obj.set("wnumber_head", loc.abbr);

				this.numberDS.query({
					filter:{ field:"wlocation_id", value:obj.wlocation_id },
					sort: { field:"wnumber", dir:"desc" },
					page: 1,
					take: 1
				}).then(function(){
					var view = self.numberDS.view(), no = "0001";

					if(view.length>0){
						no = kendo.parseInt(view[0].wnumber);
						if(no){						
							no++;
							no = self.pad(no, 4);							
						}												
					}					
					obj.set("wnumber", no);					
				});
			}
		},
      	save 			: function(){
      		var self = this, saved = false, obj = this.get("obj");

      		obj.set("use_water", 1);

      		this.dataSource.sync();
      		this.dataSource.bind("requestEnd", function(e){      			
      			if(e.type=="update" && saved==false){
      				saved = true;

      				self.dataSource.fetch();
      				self.set("obj", null);
      				
      				var window = $("#window").data("kendoWindow");          	         	
          			window.close();
      			}
      		});
      	}
	});
	banhji.wCustomer = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(baseUrl + "contacts"),
		numberDS 				: dataStore(baseUrl + "contacts"),		
		deleteDS 				: dataStore(baseUrl + "invoices"),			
		existingDS 				: dataStore(baseUrl + "contacts"),
		WExistingDS				: dataStore(baseUrl + "contacts"),
		locationDS 				: dataStore(baseUrl + "locations"),			
		contactPersonDS			: dataStore(baseUrl + "contact_persons"),		
		currencyDS 				: dataStore(baseUrl + "currencies"),
		paymentTermDS			: dataStore(baseUrl + "payment_terms"),
		paymentMethodDS			: dataStore(baseUrl + "payment_methods"),

		genders					: ["M", "F"],
		statusList 				: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],
        obj 					: null,       
		originalNo				: null,		
		originalWNo				: null,		
		isDuplicateNumber 		: false,		
		isDuplicateWNumber 		: false,
		isCompany 				: false,
		isEdit 					: false,		
		pageLoad 				: function(id){			
			this.set("isEdit", true);							
			this.loadCustomer(id);
			this.loadContactPerson(id);					
		},		
		loadCustomer 			: function(id){
			var self = this;

			this.dataSource.query({
				filter: { "field":"id", value: id },
				page: 1,
				take: 1
			}).then(function(e){
				var view = self.dataSource.view();

				if(view[0].contact_type_id=="6" || view[0].contact_type_id=="7" || view[0].contact_type_id=="8"){
					self.set("isCompany", true);
				}else{
					self.set("isCompany", false);
				}

				self.set("obj", view[0]);
				self.loadMap();
				self.set("originalNo", view[0].number);				
				self.set("originalWNo", view[0].wnumber);								
			});
		},
		loadContactPerson		: function(id){
			this.contactPersonDS.query({
				filter: { "field":"contact_id", value: id },
				page: 1,
				take: 100
			});
		},
		loadMap 				: function(){
			var obj = this.get("obj"), lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);
			
			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map,
					title: obj.wnumber
				});
			} 
		},
		copyBillTo 				: function(){
			var obj = this.get("obj");

			obj.set("ship_to", obj.bill_to);
		},
		pad 					: function(str, max){
			str = str.toString();
  			return str.length < max ? this.pad("0" + str, max) : str;
		},
		setNumber 				: function(){
			var self = this, obj = this.get("obj");
			
			this.numberDS.query({
				filter:{ field:"parent_id", operator:"where_related", model:"contact_type", value:1 },
				sort: { field:"number", dir:"desc" },
				page: 1,
				take: 1
			}).then(function(){
				var view = self.numberDS.view(), no = "0001";

				if(view.length>0){
					no = kendo.parseInt(view[0].number);
					if(no){						
						no++;
						no = self.pad(no, 4);							
					}												
				}					
				obj.set("number", no);					
			});			
		},
		locationChanges			: function(){
			var self = this, obj = this.get("obj");

			if(obj.wlocation_id>0){
				var loc = this.locationDS.get(obj.wlocation_id);
				obj.set("wnumber_head", loc.abbr);

				this.numberDS.query({
					filter:{ field:"wlocation_id", value:obj.wlocation_id },
					sort: { field:"wnumber", dir:"desc" },
					page: 1,
					take: 1
				}).then(function(){
					var view = self.numberDS.view(), no = "0001";

					if(view.length>0){
						no = kendo.parseInt(view[0].wnumber);
						if(no){						
							no++;
							no = self.pad(no, 4);							
						}												
					}					
					obj.set("wnumber", no);					
				});
			}
		},      	
		checkExistingNumber 	: function(){
			var self = this;	
			
			var number = this.get("obj").number;
			var originalNo = this.get("originalNo");
			
			if(number.length>0 && number!==originalNo){
				this.existingDS.query({
					filter: { field:"number", value: number },
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},		
		checkExistingWNumber 	: function(){
			var self = this, obj = this.get("obj");	
			
			var number = obj.wnumber;
			var originalNo = this.get("originalWNo");
			
			if(number.length>0 && number!==originalNo){
				this.WExistingDS.query({
					filter: [
						{ field:"wnumber", value: number },
						{ field:"wlocation_id", value: obj.wlocation_id },
					],
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.WExistingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateWNumber", true);						
					}else{
						self.set("isDuplicateWNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateWNumber", false);
			}			
		},
		addEmptyContactPerson 	: function(){			
			this.contactPersonDS.add({					 			
				contact_id 			: this.get("obj").id,
      			prefix 				: "",      			
				name 				: "",
				department			: "",
				phone				: "",
				email				: ""
			});								
		},
		deleteContactPerson 	: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.contactPersonDS.getByUid(d.uid);

				this.contactPersonDS.remove(obj);
			}
		},						
		save 					: function(){			
			this.dataSource.sync();
			this.contactPersonDS.sync();							
		},
		delete 					: function(){
			var self = this,
			obj = this.get("obj");

			if (confirm("Are you sure, you want to delete it?")) {				
				this.deleteDS.query({
				  	filter: { field: "contact_id", value: obj.id },
				  	page: 1,
				  	take: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete.");
					}else{
						var data = self.dataSource.get(obj.id);
				        self.dataSource.remove(data);
				        self.save();
					}
				});											
	    	}
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.contactPersonDS.cancelChanges();

			window.history.back();
		}
	});
	banhji.wCustomerOrder = kendo.observable({
		lang 				: langVM,
		dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: baseUrl+"contacts",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				update 	: {
					url: baseUrl+"contacts",
					type: "PUT",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.take,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),		
		branchDS 			: dataStore(baseUrl + "contacts/branch"),		
		locationDS 			: dataStore(baseUrl + "locations"),		
		branch_id 			: 0,
		location_id 		: 0,				
		pageLoad 			: function(){
			
		},		
		search 				: function(){
			var self = this, 
			location_id = this.get("location_id");

			if(location_id){
				this.dataSource.query({
					filter:{ field:"wlocation_id", value:location_id },
					sort:{ field:"worder", dir:"asc" },
					page:1,
					take:10000
				});								
			}else{
				alert("ត្រូវការ Location");
			}			 
		},		
		save 				: function(){
			$.each(this.dataSource.data(), function(index, value){
				value.set("worder", index);
			});

			this.dataSource.sync();
			var saved = false;
			this.dataSource.bind("requestEnd", function(e){				
				if(e.type=="update" && saved==false){
					saved = true;
					$("#ntf1").data("kendoNotification").info("Saved Successful");
				}
			});
		}
	});
	banhji.wInstallment = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "installments"),		
		deleteDS 			: dataStore(baseUrl + "installments"),		
		contactDS 			: dataStore(baseUrl + "contacts"),
		statusList 			: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],
        obj 				: null,             
        isEdit 				: false,       	

		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadInstallment(id);				
			}else{
				this.set("isEdit", false);
				
				this.addEmpty();				
			}									
		},
		loadInstallment 	: function(id){
			var self = this;

			this.dataSource.query({
				filter: { field:"id", value: id },
				page: 1,
  				take: 50
			}).then(function(e) {
			    var view = self.dataSource.view();
			    
			    
			});
		},		
		loadMap 			: function(){
			var obj = this.get("obj"), lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);

			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map,
					title: obj.number
				});
			} 
		},
		loadData 			: function(company_id){			
			if(this.get("current_company_id")!=company_id){
			 	this.set("current_company_id", company_id);

			 	var self = this;
				
				//Location
				this.locationDS.filter([
					{ field:"company_id", value: company_id },
					{ field:"utility_id", value: 2 }
				]);				
				
				//Item
				this.itemDS.filter([
					{ field:"company_id", value: company_id },
					{ field:"category_id", value: 3 }
				]);

				//Fee
				this.set("tariffList", []);
				this.set("exemptionList", []);
				this.set("maintenanceList", []);

				this.feeDS.query({
					filter: [
						{ field:"company_id", value: company_id },
						{ field:"utility_id", value: 2 }
					],
					page: 1,
	  				take: 100
				}).then(function(e) {
				    var view = self.feeDS.view();
				    
				    $.each(view, function(index, value){																						
						if(value.type=="tariff"){							
							self.tariffList.push({
								id 	: value.id,
								name: value.name 
							});
						}
						if(value.type=="exemption"){							
							self.exemptionList.push({
								id 	: value.id,
								name: value.name 
							});
						}
						if(value.type=="maintenance"){
							self.maintenanceList.push({
								id 	: value.id,
								name: value.name 
							});
						}								
					});
				    
				    if(self.get("isEdit")){
				    	var obj = self.dataSource.view();
				    	self.set("obj", obj[0]);			    				    	
			    		self.loadMap();
				    }
				});				
			}						
		},
		checkExistingNumber : function(){
			var self = this;	
			
			var number = this.get("obj").number;
			var originalNo = this.get("originalNo");
			
			if(number.length>0 && number!==originalNo){
				this.existingDS.query({
					filter: { field:"number", value: number },
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},		
		addEmpty 			: function(){			
        	this.set("isEdit", false);
        	this.dataSource.data([]);

      		if(this.dataSource.total()==0){
				this.dataSource.add({					 			
					company_id 			: this.get("company_id"),
	      			utility_id 			: 2,
	      			location_id 		: 0,
	      			electricity_box_id 	: 0,
	      			contact_id 			: this.get("contact_id"),
	      			item_id 			: 0,
	      			reactive_of 		: 0,
					backup_of 			: 0,
					number 				: "",
					multiplier			: 1,
					max_number			: 10000,
					ear_sealed			: true,
					cover_sealed		: true,				
					memo				: "",
					longtitute 			: "",
					latitute 			: "",	
					status				: 1,
					date_used 			: new Date(),

					item_name 			: "",
					electricity_box_number : "",
					
					amperes 			: {id:0},				
					phases 				: {id:0},				
					voltages 			: {id:0},
					
					tariffs 			: {id:0},				
					exemptions 			: {id:0},								
					maintenances 		: {id:0}
				});
				
				var data = this.dataSource.data();			
				var obj = data[data.length - 1];			
				this.set("obj", obj);
			}				
		},		
		save 				: function(){			
			var self = this, saved = false;

			this.dataSource.sync();			
			this.dataSource.bind("requestEnd", function(e){				
				if(e.type=="create" && saved==false){					
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();
					self.addEmpty();										
				}

				if(e.type=="update" && saved==false){
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();
				}

				if(e.type=="destroy" && saved==false){
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();					
					window.history.back();
				}
			});
		},
		delete 				: function(){
			var self = this,
			id = this.get("obj").id;

			if (confirm("Are you sure, you want to delete it?")) {
				this.deleteDS.query({
				  	filter: { field: "meter_id", value: id },
				  	page: 1,
				  	take: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						var data = self.dataSource.get(id);
				        self.dataSource.remove(data);
				        self.save();
					}
				});				
	    	}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			window.history.back();
		}		
	});
	banhji.wDeposit =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		lineDS 				: dataStore(baseUrl + "invoices/line"),					
		contactDS  			: dataStore(baseUrl + "contacts"),
		meterDS  			: dataStore(baseUrl + "meters"),
		itemDS 				: dataStore(baseUrl + "items"),
		paymentDS  			: dataStore(baseUrl + "payments"),					
				
		itemList 			: [],

		obj 				: null,
		isEdit 				: false,
		cashier_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,		

		pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadDeposit(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					this.set("obj", null);

					this.dataSource.data([]);
					this.lineDS.data([]);
					this.meterDS.data([]);
					this.paymentDS.data([]);

					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}  																							
		},	    
	    loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_method_id", view[0].payment_method_id);
		    	obj.set("account_id", view[0].account_id);
		    	obj.set("deposit_account_id", view[0].deposit_account_id);		    		    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);				
			});				
		},							
		loadDeposit 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];				 			

				self.lineDS.filter({ field: "invoice_id", value: obj.id });
				self.contactDS.filter({ field: "id", value: obj.contact_id });
				self.paymentDS.filter([
					{ field: "reference_id", value: obj.id },
					{ field: "type", value: "wdeposit" }
				]);
				self.set("obj", obj);
			});				
		},
		setItem 			: function(){
			var self = this;

			this.itemDS.query({
				filter: [
					{ field:"item_type_id", value: 1 },
					{ field:"status", value: 1 }
				],
				page: 1,
				take: 100
			}).then(function(){
				var view = self.itemDS.view();

				$.each(view, function(index, value){
					self.itemList.push(value);
				});
			});
		},		
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},					
		addEmpty 		 	: function(){
			this.dataSource.add({
				company_id 			: 0,
				location_id 		: 0,
				contact_id 			: "",
				payment_term_id		: 0,
				payment_method_id 	: 0,
				reference_id 		: 0,
				deposit_account_id 	: 0,
				account_id 			: 2,					
				vat_id 				: 0,
				biller_id 			: this.get("cashier_id"),
 	    		number 				: "",
			   	type				: "wdeposit",
			   	sub_total 			: 0,				   		   					   				   	
			   	amount				: 0,
			   	vat 				: 0,
			   	rate				: 1,			   	
			   	locale 				: "km-KH",			   	
			   	issued_date 		: new Date(),
			   	due_date 			: "",
			   	check_no 			: "",
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,

			   	segments 			: []
	    	});		    		
			
			var data = this.dataSource.data();
			var obj = data[data.length-1];			
			this.set("obj", obj);

			this.addRow();			
		},		
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"),		    	
		    	contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("payment_method_id", contact.payment_method_id);
		    	obj.set("account_id", contact.account_id);
		    	obj.set("deposit_account_id", contact.deposit_account_id);
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    	
	    	}
	    },
	    changes				: function(){
			var obj = this.get("obj"),
			total = 0;			
			
			$.each(this.lineDS.data(), function(index, value) {				
				total += value.amount;				
	        });
	       		
			obj.set("amount", total);	    	
		},
	    itemChanges 		: function(e){								
			var data = e.data, obj = this.get("obj");

			if(data.item_id>0 && obj.contact_id>0){
				var item = this.itemDS.get(data.item_id),
				contact = this.contactDS.get(obj.contact_id),							
				rate = kendo.parseFloat(contact.currency[0].rate)/kendo.parseFloat(item.price_list[0].currency[0].rate);
		        	        
	    		data.set("description", item.name);
	    		data.set("amount", item.price_list[0].price*rate);		        
		        data.set("rate", rate);		        	        
		        		        	        
		        this.changes();
	        }else{
	        	alert("Please select customer!");
	        }	                	        	
		},
		addRow 				: function(){				
			var obj = this.get("obj");		
						
			this.lineDS.add({					
				invoice_id 			: 0,
				item_id 			: "",
				measurement_id 		: 0,
				meter_record_id	 	: 0,
				description 		: "",				
				unit 	 			: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: 1,
				locale				: obj.locale,
				has_vat 			: false,
				type 				: "",

				priceList 			: []
			});																	
		},		
		addPayment 			: function(meter_id){
			var obj = this.get("obj"), rate = this.getRate(),
			deposit = this.dataSource.at(0);

			this.paymentDS.add({
				company_id 			: obj.company_id,
				contact_id 			: obj.contact_id,
				cashier_id 			: this.get("cashier_id"),
				meter_id 			: meter_id,							
				reference_id		: deposit.id,														
				payment_method_id	: obj.payment_method_id,
				account_id			: obj.account_id,
				check_no			: obj.check_no,							
				type 				: "wdeposit",
				amount 				: obj.amount,
				fine 				: 0,
				discount 			: 0,
				rate 				: rate,
				locale 				: obj.locale,
				payment_date		: kendo.toString(new Date(obj.issued_date), "yyyy-MM-dd")
			});

			this.paymentDS.sync();					
		},
		meterSync 		: function(deposit_id){
	    	var dfd = $.Deferred(), obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			this.meterDS.add({
				company_id 			: contact.wbranch_id,
      			utility_id 			: 2,
      			deposit_id 			: deposit_id,
      			invoice_id 			: 0,
      			location_id 		: contact.wlocation_id,
      			ampere_id 			: 0,
      			phase_id 			: 0,
      			voltage_id 			: 0,
      			electricity_box_id 	: 0,
      			contact_id 			: obj.contact_id,
      			item_id 			: 0,
      			reactive_of 		: 0,
				backup_of 			: 0,
				number 				: "",				
				multiplier			: 1,
				max_number			: 10000,
				startup_reading 	: 0,
				ear_sealed			: true,
				cover_sealed		: true,				
				memo				: "",
				longtitute 			: "",
				latitute 			: "",	
				status				: 0,
				date_used 			: "",

				item_name 			: "",
				electricity_box_number : "",
				
				amperes 			: {id:0},				
				phases 				: {id:0},				
				voltages 			: {id:0},
				
				tariffs 			: {id:0},				
				exemptions 			: {id:0},								
				maintenances 		: {id:0}
			});	        

	    	this.meterDS.sync();
		    this.meterDS.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },
	    invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },
		save 				: function(){							
		    var self = this, obj = this.get("obj"), rate = this.getRate();

		    if(obj.amount>0){	
		        obj.set("amount", kendo.parseFloat(obj.amount)*rate);
		        obj.set("rate", rate);				        
		       		    	
		    	if(this.get("isEdit")){
		    		this.dataSource.sync();
		    		this.lineDS.sync();

		    		if(this.lineDS.hasChanges()){
		    			var pay = this.paymentDS.at(0);
		    			pay.set("amount", obj.amount);
		    			this.paymentDS.sync();
		    		}		    		
		    	}else{
		    		//Add brand new invoice
					this.invoiceSync()
					.then(function(invoice){
						$.each(self.lineDS.data(), function(index, value){										
							value.set("invoice_id", invoice[0].id);
							value.set("rate", rate);
						});

						self.lineDS.sync();						

						return self.meterSync(invoice[0].id);
					}).then(function(meter){
						self.addPayment(meter[0].id);
					}).then(function(){												
						self.dataSource.data([]);
						self.lineDS.data([]);
						self.meterDS.data([]);
						self.paymentDS.data([]);

						banhji.wCustomerCenter.meterDS.fetch();
						window.history.back();
					});
				}
			}else{
				alert("សូមមេត្តា បញ្ចូលចំនួនប្រាក់កក់");
			}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		}	 		
	});
	banhji.wDepositWitdraw =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices"),
		prevDepositDS 		: dataStore(baseUrl + "invoices"),							
		contactDS  			: dataStore(baseUrl + "contacts"),
		meterDS  			: dataStore(baseUrl + "meters"),		
		paymentDS  			: dataStore(baseUrl + "payments"),
		obj 				: null,
		meter 				: null,
		isEdit 				: false,
		cashier_id			: banhji.userManagement.getLogin() === null ? 0 : banhji.userManagement.getLogin().id,
		total 				: 0,
		pageLoad 			: function(id){			
			if(id){
				this.set("isEdit", true);							
				this.loadDeposit(id);
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
					
					this.dataSource.data([]);					
					this.meterDS.data([]);
					this.paymentDS.data([]);

					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}								
			}  																							
		},	    
		loadMeter 		: function(id){
			var self = this;			

			this.meterDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.meterDS.view();

				self.set("meter", view[0]);
				self.loadContact(view[0].contact_id);
				self.loadPrevDeposit(view[0].deposit_id);		    			    	    					
			});				
		},
		loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);		    	
		    	obj.set("deposit_account_id", view[0].deposit_account_id);		    		    			  				  											
				obj.set("locale", view[0].currency[0].locale);
				obj.set("bill_to", view[0].bill_to);
			});				
		},
		loadPrevDeposit		: function(id){
			var self = this;			

			this.prevDepositDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.prevDepositDS.view();
				
		    	self.set("total", kendo.toString(view[0].amount*-1, view[0].locale=="km-KH"?"c0":"c", view[0].locale));		    					
			});				
		},							
		loadDeposit 		: function(id){
			var self = this;			

			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var obj = self.dataSource.view()[0];				 			

				self.lineDS.filter({ field: "invoice_id", value: id });
				self.contactDS.filter({ field: "id", value: obj.contact_id });
				self.paymentDS.filter([
					{ field: "reference_id", value: id },
					{ field: "type", value: "wdeposit" }
				]);
				self.set("obj", obj);
			});				
		},			
		getRate 			: function(){
			var rate = 1, obj = this.get("obj"),
			contact = this.contactDS.get(obj.contact_id);

			rate = banhji.currency.getAmount(banhji.institute.locale) / banhji.currency.getAmount(contact.currency[0].locale);			

			return rate;		
		},
		contactChanges 		: function(e){	    	
	    	if(e.sender.selectedIndex>0){
		    	var obj = this.get("obj"),		    	
		    	contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("account_id", contact.account_id);
		    	obj.set("deposit_account_id", contact.deposit_account_id);
		    	obj.set("locale", contact.currency[0].locale);
		    	obj.set("bill_to", contact.bill_to);		    	
	    	}
	    },					
		addEmpty 		 	: function(){
			this.set("obj", null);

			this.dataSource.add({
				company_id 			: 0,
				location_id 		: 0,
				contact_id 			: "",
				payment_term_id		: 0,
				payment_method_id 	: 0,
				reference_id 		: 0,
				deposit_account_id 	: 0,
				account_id 	 		: 2,					
				vat_id 				: 0,
				biller_id 			: this.get("cashier_id"),
 	    		number 				: "",
			   	type				: "wdeposit",
			   	sub_total 			: 0,				   		   					   				   	
			   	amount				: 0,
			   	vat 				: 0,
			   	rate				: 1,			   	
			   	locale 				: "km-KH",			   	
			   	issued_date 		: new Date(),
			   	due_date 			: "",
			   	check_no 			: "",
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,

			   	segments 			: []
	    	});		    		
			
			var data = this.dataSource.data();
			var obj = data[data.length-1];			
			this.set("obj", obj);				
		},				
		addPayment 			: function(invoice_id){
			var obj = this.get("obj"), rate = this.getRate(),
			meter = this.meterDS.at(0);

			this.paymentDS.add({
				company_id 			: obj.company_id,
				contact_id 			: obj.contact_id,
				cashier_id 			: this.get("cashier_id"),
				meter_id 			: meter.id,							
				reference_id		: invoice_id,														
				payment_method_id	: obj.payment_method_id,
				account_id			: obj.account_id,
				check_no			: obj.check_no,							
				type 				: "wdeposit",
				amount 				: obj.amount,
				fine 				: 0,
				discount 			: 0,
				rate 				: rate,
				locale 				: obj.locale,
				payment_date		: kendo.toString(new Date(obj.issued_date), "yyyy-MM-dd")
			});

			this.paymentDS.sync();					
		},
		invoiceSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },
		save 				: function(){
			if(this.dataSource.hasChanges()){							
			    var self = this, obj = this.get("obj"), rate = this.getRate(),
			    payment = this.prevDepositDS.at(0);
		    		    
		        obj.set("amount", kendo.parseFloat(payment.amount)*rate*-1);
		        obj.set("rate", rate);				        
		       		    	
		    	if(this.get("isEdit")){
		    		this.dataSource.sync();	    					    		
		    	}else{
		    		//Add brand new invoice
					this.invoiceSync()
					.then(function(invoice){						
						var meter = self.meterDS.at(0);
						meter.set("status", 2);

						self.meterDS.sync();
						self.addPayment(invoice[0].id);										
					}).then(function(){												
						self.dataSource.data([]);
						self.prevDepositDS.data([]);						
						self.meterDS.data([]);
						self.paymentDS.data([]);

						banhji.wCustomerCenter.meterDS.fetch();
						window.history.back();
					});
				}
			}			
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			window.history.back();
		}	 		
	});	
	banhji.wMeter = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "meters"),
		existingDS 			: dataStore(baseUrl + "meters"),
		deleteDS 			: dataStore(baseUrl + "meters/record"),		
		contactDS 			: dataStore(baseUrl + "contacts"),					
		locationDS 			: dataStore(baseUrl + "locations"),
		itemDS 				: dataStore(baseUrl + "items"),
		feeDS 				: dataStore(baseUrl + "fees"),
		statusList 			: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],
        tariffList 			: [],
        exemptionList 		: [],
        maintenanceList 	: [],
        deposit_link 		: null,
        invoice_link 		: null,
        deposit_amount 		: 0,
        invoice_amount 		: 0,
        obj 				: null,             
        current_company_id 	: 0,
        current_meter_id 	: 0,
        isDuplicateNumber 	: false,
        originalNo 			: null,
		pageLoad 			: function(id){
			this.loadMeter(id);									
		},		
		loadMeter 			: function(id){
			var self = this;

			if(this.get("current_meter_id")!=id){
			 	this.set("current_meter_id", id);				

				this.dataSource.query({
					filter: { field:"id", value: id },
					page: 1,
	  				take: 50
				}).then(function(e) {
				    var view = self.dataSource.view();

				    self.set("originalNo", view[0].number);				    
				    self.contactDS.filter({ field:"id", value:view[0].contact_id });		    			    	
			    	self.contactDS.filter([]);

			    	return self.feeQuery(view[0].company_id);	    		   	    			    			    				    
				}).then(function(fee){
					var view = self.dataSource.view();					
					
					self.set("obj", view[0]);
					self.set("deposit_link", "#/wDeposit/"+view[0].deposit_id);
					self.set("invoice_link", "#/wMeterInvoice/"+view[0].invoice_id);

					if(view[0].deposit[0]){
						self.set("deposit_amount", kendo.toString(kendo.parseFloat(view[0].deposit[0].amount), "c", view[0].deposit[0].locale));
					}else{
						self.set("deposit_amount", 0);
					}

					if(view[0].invoice[0]){
						self.set("invoice_amount", kendo.toString(kendo.parseFloat(view[0].invoice[0].amount), "c", view[0].invoice[0].locale));
					}else{
						self.set("invoice_amount", 0);
					}					
										
					self.loadMap();
				});
			}
		},		
		loadMap 			: function(){
			var obj = this.get("obj"), lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);

			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map,
					title: obj.number
				});
			} 
		},
		feeQuery 			: function(company_id){
			var self = this, dfd = $.Deferred();

			if(this.get("current_company_id")!=company_id){
			 	this.set("current_company_id", company_id);
				
		    	this.feeDS.query({
					filter: [
						{ field:"company_id", value: company_id },
						{ field:"utility_id", value: 2 }
					]
				}).then(function(e) {
					var view = self.feeDS.view();

					self.set("tariffList", []);
					self.set("exemptionList", []);
					self.set("maintenanceList", []);

					$.each(view, function(index, value){																						
						if(value.type=="tariff"){							
							self.tariffList.push({
								id 	: value.id,
								name: value.name 
							});
						}
						if(value.type=="exemption"){							
							self.exemptionList.push({
								id 	: value.id,
								name: value.name 
							});
						}
						if(value.type=="maintenance"){
							self.maintenanceList.push({
								id 	: value.id,
								name: value.name 
							});
						}								
					});

					dfd.resolve(view);				    			   		    			
				});
			}			

		    return dfd;	    		    	
	    },	    	
		contactChanges 		: function(e){
			if(e.sender.selectedIndex>0){
				var obj = this.get("obj"),
				contact = this.contactDS.get(obj.contact_id);

				obj.set("company_id", contact.wbranch_id);
				obj.set("location_id", contact.wlocation_id);
				
				this.feeQuery(contact.wbranch_id);
			}
		},
		checkExistingNumber : function(){
			var self = this;	
			
			var number = this.get("obj").number;
			var originalNo = this.get("originalNo");
			
			if(number.length>0 && number!==originalNo){
				this.existingDS.query({
					filter: { field:"number", value: number },
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},				
		save 				: function(){			
			var self = this, saved = false;

			this.dataSource.sync();			
			this.dataSource.bind("requestEnd", function(e){				
				if(e.type=="create" && saved==false){					
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();
					self.addEmpty();										
				}

				if(e.type=="update" && saved==false){
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();
					window.history.back();
				}

				if(e.type=="destroy" && saved==false){
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();					
					window.history.back();
				}
			});
		},
		delete 				: function(){
			var self = this,
			obj = this.get("obj");

			if (confirm("Are you sure, you want to delete it?")) {
				this.deleteDS.query({
				  	filter: { field: "meter_id", value: obj.id },
				  	page: 1,
				  	take: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						var data = self.dataSource.get(obj.id);
				        self.dataSource.remove(data);
				        self.save();
					}
				});				
	    	}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			window.history.back();
		}		
	});
	banhji.wReadingCenter = kendo.observable({
		lang 				: langVM,		
		dataSource 			: dataStore(baseUrl + "meters/record"),
		meterDS 			: dataStore(baseUrl + "meters"),
		meter_id 			: null,
		rowIndex 			: 0,
		pageLoad 			: function(id){
			if(id){
				this.dataSource.query({
					filter: { field:"meter_id", value: id },
					sort: { field:"month_of", dir:"desc" },
					page: 1,
					take: 100
				});
			}						
		},			
		search 				: function(){											
			var meter_id = this.get("meter_id");
			this.set("rowIndex", 0);
			
			if(meter_id){
				this.dataSource.query({
					filter: { field:"meter_id", value: meter_id },
					sort: { field:"month_of", dir:"desc" },
					page: 1,
					take: 100
				});
			}					
		}  	  			
	});
	banhji.wEditReading = kendo.observable({
		lang 				: langVM,		
		dataSource 			: dataStore(baseUrl + "meters/record"),
		meterDS	 			: dataStore(baseUrl + "meters"),
		readerDS 			: dataStore(baseUrl + "employees"),
		invoiceDS 			: dataStore(baseUrl + "invoices"),
		invoiceLineDS 		: dataStore(baseUrl + "invoices/line"),
		feeDS 		 		: dataStore(baseUrl + "fees"),
		tariffItemDS 		: dataStore(baseUrl + "fees/item"),
		obj 				: null,
		invoice 			: null,
		hasInvoice 			: false,
		originalAmount 		: 0,
		pageLoad 			: function(id){
			var self = this;

			this.dataSource.query({
				filter: { field:"id", value: id },				
				page: 1,
				take: 100
			}).then(function(e) {
			    var view = self.dataSource.view();

			    self.set("obj", view[0]);
			    self.loadMeter(view[0].meter_id);
			    self.loadInvoiceLine(view[0].id);			    
			});
		},
		loadInvoice 		: function(id){
			var self = this;

			this.invoiceDS.query({
				filter: { field:"id", value: id },				
				page: 1,
				take: 100
			}).then(function(e) {
			    var view = self.invoiceDS.view();

			    self.set("invoice", view[0]);
			    self.set("originalAmount", view[0].amount);			    
			});
		},
		loadInvoiceLine 	: function(id){
			var self = this;

			this.invoiceLineDS.query({
				filter: { field:"meter_record_id", value: id },				
				page: 1,
				take: 100
			}).then(function(e) {
			    var view = self.invoiceLineDS.view();

			    if(view.length>0){
			    	self.set("hasInvoice", true);
			    	self.loadInvoice(view[0].invoice_id);			    	
			    }else{
			    	self.set("hasInvoice", false);
			    }
			});
		},
		loadMeter 			: function(id){
			var self = this;

			this.meterDS.query({
				filter: { field:"id", value: id },				
				page: 1,
				take: 100
			}).then(function(e) {
			    var view = self.meterDS.view();

			    self.feeDS.filter({ field:"company_id", value: view[0].company_id });
			    self.tariffItemDS.query({
					filter: { field:"fee_id", value: view[0].tariff_id },				
					sort: { field: "usage", dir: "desc" },
					page: 1,
					take: 100
				});
			});
		},
		readingChanges 		: function(){
			var obj = this.get("obj"),			
			usage = obj.current - obj.previous;

			obj.set("usage", usage);
		},
		save 			: function(){
			var obj = this.get("obj"),			
			usage = obj.current - obj.previous;			

			if(this.get("hasInvoice")){
				var line = this.invoiceLineDS.at(0),
				meter = this.meterDS.at(0),				
				exemption = this.feeDS.get(meter.exemption_id),
				maintenance = this.feeDS.get(meter.maintenance_id),
				usage = obj.current - obj.previous,
				price = 0,
				amount = 0,
				originalAmount = this.get("originalAmount");
				
				//Apply usage exemption
				if(exemption.unit=="usage"){
					var exemptionUsage = kendo.parseInt(exemption.amount);
					if(usage>exemptionUsage){
						usage -= exemptionUsage;
					}else{
						usage = 0;
					}
				}

				//Apply tariff
				$.each(this.tariffItemDS.data(), function(index, value){
					if(usage>=value.usage){
						if(value.is_flat){								
							amount = kendo.parseFloat(value.price);
						}else{								
							amount = usage * kendo.parseFloat(value.price);
						}

						price = value.price;

						return false;
					}										
				});

				//Apply money exemption
				if(exemption.unit=="money"){
					var exemptionAmount = kendo.parseFloat(exemption.amount);

					if(amount>exemptionAmount){
						amount -=  exemptionAmount;
					}else{
						amount = 0;
					}
				}

				//Apply % exemption
				if(exemption.unit=="%"){
					var exemptionPercentTageAmount = amount * kendo.parseFloat(exemption.amount);

					if(amount>exemptionPercentTageAmount){
						amount -=  exemptionPercentTageAmount;
					}else{
						amount = 0;
					}					
				}							

				//Update line
				$.each(this.invoiceLineDS.data(), function(index, value){
					if(value.type=="tariff"){
						value.set("unit", usage);
						value.set("price", price);
						value.set("amount", amount);
					}										
				});

				var inv = this.get("invoice"),
				diffAmount = originalAmount - amount,
				newBalance = originalAmount - diffAmount;

				inv.set("amount", newBalance);
				
				this.invoiceLineDS.sync();
				this.set("originalAmount", 0);			
			}

			this.dataSource.sync();
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			window.history.back();
		}			
	});
	banhji.wReading = kendo.observable({
		lang 				: langVM,						
		dataSource 			: new kendo.data.DataSource({
			transport: {
				read: {
					url: baseUrl + "meters/wreading",
					headers: {
						"Entity": getDB()
					},
					type: "GET",
					dataType: "json"
				}			  	
			},						
			pageSize: 100,							  	
		  	schema: {
				model: {
					id: "id"
				},
				data: "results",
				total: "count"	
			}
		}),
		readerDS 			: dataStore(baseUrl + "contacts/employee"),
		branchDS 			: dataStore(baseUrl + "contacts/branch"),		
		locationDS 			: dataStore(baseUrl + "locations"),		
		meterDS				: dataStore(baseUrl + "meters"),
		meterRecordDS		: dataStore(baseUrl + "meters/record"),
		monthOfSearch 		: null,		
		brand_id 			: null,
		location_id 		: null,
		meter_id 			: null,
		month_of 			: new Date(),
		from_date			: new Date(),
		to_date				: new Date(),
		read_by 			: null,
		pageLoad 			: function(){
										
		},
		strMonthOf 			: function(){
			return "អំនានប្រចាំខែ " + kendo.toString(this.get("monthOfSearch"), "MM-yyyy");
		},		
		search 				: function(){											
			var monthOfSearch = this.get("monthOfSearch"),
			location_id = this.get("location_id"),
			meter_id = this.get("meter_id");
					
			if(monthOfSearch){				
				if(location_id || meter_id){						
					var monthOf = new Date(monthOfSearch);
					monthOf.setDate(1);
					monthOf = kendo.toString(monthOf, "yyyy-MM-dd");
										
					this.dataSource.transport.options.read.data={
						month_of 	: monthOf,
						location_id : location_id,
						meter_id 	: meter_id
					};
					this.dataSource.read();	
				}
			}else{
				alert("សូមSelect ខែ");
			}		
		},						
		isSupported 		: function() {
			// check if File API is supported in this browser
			if(window.File && window.FileReader && window.FileList && window.Blob) {
				return true;
			} else {
				return false;
			}
		},			
		readFile 			: function(e){
			e.preventDefault();
			var self = this;

			var reader = new FileReader();					
			if(this.get("isSupported")) {
				var file = document.getElementById('myFile').files[0];
				// var file = $('#myFile').get(0).files[0];

				if(file !== undefined) {
					this.set("uploadStatus", "");
					reader.readAsText(file);
					
					reader.onload = function() {						
 						var result = reader.result.split('\r');	 						
 						
						// for (var i = 1; i < result.length; i ++) {								
						// 	var data = result[i].split(',');
						// 	readingList.push(data);															
						// }

						self.dataSource.transport.options.read.data = result;
						self.dataSource.read();																		
					}

					reader.onerror = function() {							
						this.set("uploadStatus", reader.error);
					}						
				} else {
					this.set("uploadStatus", "Please select file");
				}

			} else {
				this.set("uploadStatus", "Invalid file!");					
			}
		},				
      	onChange 			: function(e) {
      		e.preventDefault();

      		var self = this;
      		var selected = e.data;            
            
            if(kendo.parseInt(selected.current)>0){        
		        var add_up = 0;
		        if(selected.new_round){
		        	add_up = kendo.parseInt(selected.max_number);            	
	        	}
	        	var usage = ((kendo.parseInt(selected.current) + add_up) - kendo.parseInt(selected.previous))*selected.multiplier;
	            selected.set("usage", usage);
	            
	            if(usage<0){
					selected.set("isValid", false);
				}else{
					selected.set("isValid", true);
				}
			}else{
				selected.set("usage", "");
				selected.set("isValid", true);
			}

			var nextID = selected.index+1;
			$(".txt"+nextID).focus();            
        },       
        total 				: function() {      		
	        var sum = 0;

	        $.each(this.dataSource.data(), function(index, value) {	        		            
	        	sum += kendo.parseInt(value.usage);		        	          
	        });

	        return kendo.toString(sum, "n0");
	    },
	    checkInput 			: function() {	        
	        var isValid = true;
	        var hasReading = false;

	        $.each(this.dataSource.data(), function(index, value) {
	        	if(value.current>0){
	        		hasReading = true;
	        	}

	        	if(value.isValid==false){
	        		isValid = false;
	        	}		        	          
	        });

	        if(hasReading==false){
	        	isValid = false;
	        }

	        return isValid;
	    },             	
      	save 				: function(){
      		var self = this;	      		     			
  			var monthOf = new Date(this.get("month_of"));
			monthOf.setDate(1);
			monthOf = kendo.toString(monthOf, "yyyy-MM-dd");

			$.each(this.dataSource.data(), function(index, value){
				if(kendo.parseInt(value.current)>0){
					self.meterRecordDS.add({				
						meter_id	: value.id,
						read_by 	: self.get("read_by"),
						input_by 	: 0,						
					   	previous	: value.previous,
					   	current 	: value.current,					   	
					   	new_round	: false,
					   	usage 		: value.usage,					   	
					   	month_of 	: monthOf,
					   	from_date	: kendo.toString(self.get("from_date"), "yyyy-MM-dd"),						   
					   	to_date 	: kendo.toString(self.get("to_date"), "yyyy-MM-dd"),
					   	memo 		: ""
					});
				}
			});

			this.meterRecordDS.sync();
			var saved = false;				
			this.meterRecordDS.bind("requestEnd", function(e){				
				if(saved==false){
					saved = true;

					self.meterRecordDS.data([]);
					self.dataSource.data([]);
				}
			});      			
      	}      			
	});
	banhji.wIRReader = kendo.observable({
		lang 				: langVM,						
		dataSource 			: new kendo.data.DataSource({
			transport: {
				read: {
					url: baseUrl + "meters/wreading",
					headers: {
						"Entity": getDB()
					},
					type: "GET",
					dataType: "json"
				}			  	
			},						
			pageSize: 100,							  	
		  	schema: {
				model: {
					id: "id"
				},
				data: "results",
				total: "count"	
			}
		}),
		readerDS 			: dataStore(baseUrl + "contacts/employee"),
		branchDS 			: dataStore(baseUrl + "contacts/branch"),		
		locationDS 			: dataStore(baseUrl + "locations"),		
		meterDS				: dataStore(baseUrl + "meters"),
		meterRecordDS		: dataStore(baseUrl + "meters/record"),
		monthOfSearch 		: null,		
		brand_id 			: null,
		location_id 		: null,
		meter_id 			: null,
		month_of 			: new Date(),
		from_date			: new Date(),
		to_date				: new Date(),
		read_by 			: null,
		pageLoad 			: function(){
										
		},
		strMonthOf 			: function(){
			return "អំនានប្រចាំខែ " + kendo.toString(this.get("monthOfSearch"), "MM-yyyy");
		},		
		search 				: function(){											
			var monthOfSearch = this.get("monthOfSearch"),
			location_id = this.get("location_id"),
			meter_id = this.get("meter_id");
					
			if(monthOfSearch){				
				if(location_id || meter_id){						
					var monthOf = new Date(monthOfSearch);
					monthOf.setDate(1);
					monthOf = kendo.toString(monthOf, "yyyy-MM-dd");
										
					this.dataSource.transport.options.read.data={
						month_of 	: monthOf,
						location_id : location_id,
						meter_id 	: meter_id
					};
					this.dataSource.read();	
				}
			}else{
				alert("សូមSelect ខែ");
			}		
		},						
		isSupported 		: function() {
			// check if File API is supported in this browser
			if(window.File && window.FileReader && window.FileList && window.Blob) {
				return true;
			} else {
				return false;
			}
		},			
		readFile 			: function(e){
			e.preventDefault();
			var self = this;

			var reader = new FileReader();					
			if(this.get("isSupported")) {
				var file = document.getElementById('myFile').files[0];
				// var file = $('#myFile').get(0).files[0];

				if(file !== undefined) {
					this.set("uploadStatus", "");
					reader.readAsText(file);
					
					reader.onload = function() {						
 						var result = reader.result.split('\r');	 						
 						
						// for (var i = 1; i < result.length; i ++) {								
						// 	var data = result[i].split(',');
						// 	readingList.push(data);															
						// }

						self.dataSource.transport.options.read.data = result;
						self.dataSource.read();																		
					}

					reader.onerror = function() {							
						this.set("uploadStatus", reader.error);
					}						
				} else {
					this.set("uploadStatus", "Please select file!");
				}

			} else {
				this.set("uploadStatus", "Invalid file!");					
			}
		},				
      	onChange 			: function(e) {
      		e.preventDefault();

      		var self = this;
      		var selected = e.data;            
            
            if(kendo.parseInt(selected.current)>0){        
		        var add_up = 0;
		        if(selected.new_round){
		        	add_up = kendo.parseInt(selected.max_number);            	
	        	}
	        	var usage = ((kendo.parseInt(selected.current) + add_up) - kendo.parseInt(selected.previous))*selected.multiplier;
	            selected.set("usage", usage);
	            
	            if(usage<0){
					selected.set("isValid", false);
				}else{
					selected.set("isValid", true);
				}
			}else{
				selected.set("usage", "");
				selected.set("isValid", true);
			}

			var nextID = selected.index+1;
			$(".txt"+nextID).focus();            
        },       
        total 				: function() {      		
	        var sum = 0;

	        $.each(this.dataSource.data(), function(index, value) {	        		            
	        	sum += kendo.parseInt(value.usage);		        	          
	        });

	        return kendo.toString(sum, "n0");
	    },
	    checkInput 			: function() {	        
	        var isValid = true;
	        var hasReading = false;

	        $.each(this.dataSource.data(), function(index, value) {
	        	if(value.current>0){
	        		hasReading = true;
	        	}

	        	if(value.isValid==false){
	        		isValid = false;
	        	}		        	          
	        });

	        if(hasReading==false){
	        	isValid = false;
	        }

	        return isValid;
	    },             	
      	save 				: function(){
      		var self = this;	      		     			
  			var monthOf = new Date(this.get("month_of"));
			monthOf.setDate(1);
			monthOf = kendo.toString(monthOf, "yyyy-MM-dd");

			$.each(this.dataSource.data(), function(index, value){
				if(kendo.parseInt(value.current)>0){
					self.meterRecordDS.add({				
						meter_id	: value.id,
						read_by 	: self.get("read_by"),
						input_by 	: 0,						
					   	previous	: value.previous,
					   	current 	: value.current,					   	
					   	new_round	: false,
					   	usage 		: value.usage,					   	
					   	month_of 	: monthOf,
					   	from_date	: kendo.toString(self.get("from_date"), "yyyy-MM-dd"),						   
					   	to_date 	: kendo.toString(self.get("to_date"), "yyyy-MM-dd"),
					   	memo 		: ""
					});
				}
			});

			this.meterRecordDS.sync();
			var saved = false;				
			this.meterRecordDS.bind("requestEnd", function(e){				
				if(saved==false){
					saved = true;

					self.meterRecordDS.data([]);
					self.dataSource.data([]);
				}
			});      			
      	}      			
	});
	banhji.wInvoice = kendo.observable({
		lang 				: langVM,		
		dataSource  		: dataStore(baseUrl + "invoices/uInvoice"),
		meterDS  			: dataStore(baseUrl + "meters"),		
		branchDS 			: dataStore(baseUrl + "contacts/branch"),		
		locationDS 			: dataStore(baseUrl + "locations"),				
		feeDS 		 		: dataStore(baseUrl + "fees"),
		tariffItemDS 		: dataStore(baseUrl + "fees/item"),		
		readingDS 			: new kendo.data.DataSource({
			transport: {
				read: {
					url: baseUrl + "meters/reading_for_invoice",
					headers: {
						"Entity": getDB()
					},
					type: "GET",
					dataType: "json"
				}			  	
			},						
			pageSize: 100,							  	
		  	schema: {
				model: {
					id: "id"
				},
				data: "results",
				total: "count"	
			}		  			
		}),
		chkAll 			: false,		
		monthOfSearch 	: null,
		company_id 		: null,
		location_id 	: null,
		meter_id 		: null,		
		biller 			: banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id,
				
		issued_date		: new Date(),
		payment_date 	: new Date(),
		due_date 		: new Date(),	
		month_of 		: new Date(),
		
		pageLoad 		: function(){
			this.feeDS.filter({ field:"utility_id", value: 2 });			
			this.tariffItemDS.query({
				filter: [],				
				sort: [					
					{ field: "fee_id", dir: "asc" },
					{ field: "usage", dir: "desc" }
				],
				page: 1,
				take: 100
			});			
		},		
		search 			: function(){
			var monthOfSearch = this.get("monthOfSearch"),
			location_id = this.get("location_id"),
			meter_id = this.get("meter_id");
					
			if(monthOfSearch){				
				if(location_id || meter_id){						
					var monthOf = new Date(monthOfSearch);
					monthOf.setDate(1);
					monthOf = kendo.toString(monthOf, "yyyy-MM-dd");
										
					this.readingDS.transport.options.read.data={
						month_of 	: monthOf,
						location_id : location_id,
						meter_id 	: meter_id
					};
					this.readingDS.read();	
				}
			}else{
				alert("សូមSelect ខែ");
			}
		},	
		checkAll 		: function(e){
			e.preventDefault();

			var bolValue = this.get("chkAll");
			var data = this.readingDS.data();
			
			if(data.length>0){						
		        $.each(data, function(index, value){		        			        	
		        	value.set("isCheck", bolValue);		        	
		        });		        			        
	        }							
		},		
        total 			: function(){      		
	        var sum = 0;

	        $.each(this.readingDS.data(), function(index, value) {	        		            
	        	sum += kendo.parseInt(value.usage);		        	          
	        });

	        return kendo.toString(sum, "n0");
	    },	    	 
		save 	 		: function(){
			var self = this,
			data = this.readingDS.data(),
			companyRate =  banhji.currency.getAmount(banhji.institute.locale),
			monthOf = new Date(this.get("month_of"));

			monthOf.setDate(1);
			monthOf = kendo.toString(monthOf, "yyyy-MM-dd");
					
			//Get unique contact_id
			var uniqueCustomerID = [];
			$.each(data, function(index, value){
				if(value.isCheck){				
			    	if($.inArray(value.customer[0].id, uniqueCustomerID) === -1) uniqueCustomerID.push(value.customer[0].id);
			    }				
			});			
			
			for (var i=0;i<uniqueCustomerID.length;i++) {
				var contactID = uniqueCustomerID[i], invoiceLineList = [], amount = 0, rate = 1, locale = "km-KH", company_id = 0, location_id = 0;

				//Calculation
				$.each(data, function(index, value){															
					if(value.customer[0].id==contactID){						
						var usage = kendo.parseInt(value.usage),
						current_amount = 0,						
						customerCurrency = banhji.currency.dataSource.get(value.customer[0].currency_id),					
						tariff = self.feeDS.get(value.meter[0].tariff_id),
						exemption = self.feeDS.get(value.meter[0].exemption_id),
						maintenance = self.feeDS.get(value.meter[0].maintenance_id);

						company_id = value.customer[0].wbranch_id;
						location_id = value.customer[0].wlocation_id;						
						rate = kendo.parseFloat(customerCurrency.rate)/companyRate;						
						locale = customerCurrency.locale;

						//Apply usage exemption						
						if(value.meter[0].exemption_id>0){							
							if(exemption.unit=="usage"){
								var exemptionUsage = kendo.parseFloat(exemption.amount);
								if(usage>exemptionUsage){
									usage -= exemptionUsage;
								}else{
									usage = 0;
								}

								invoiceLineList.push({				
							   		"invoice_id"		: 0,
									"item_id" 			: 0,															
								   	"meter_record_id"	: value.id,
								   	"description" 		: exemption.name,					   	
								   	"unit" 				: 1,
								   	"price"				: exemption.amount,					   	
								   	"amount" 			: exemption.amount,
								   	"rate"				: rate,
								   	"locale" 			: locale,
								   	"has_vat" 			: false,
								   	"type" 				: "exemptionUsage"
								});
							}					
						}
						
						//Apply tariff						
						if(value.meter[0].tariff_id>0){							
							$.each(self.tariffItemDS.data(), function(indexti, tariffItem){
								var tariffItemUsage = kendo.parseInt(tariffItem.usage);
								
								if((tariffItem.fee_id==tariff.id) && (usage>=tariffItemUsage)){
									if(tariffItem.is_flat){								
										current_amount = kendo.parseFloat(tariffItem.price);																																																																																
									}else{								
										current_amount = usage * kendo.parseFloat(tariffItem.price);																						
									}

									invoiceLineList.push({				
								   		"invoice_id"		: 0,
										"item_id" 			: 0,																
									   	"meter_record_id"	: value.id,
									   	"description" 		: tariff.name,					   	
									   	"unit" 				: usage,
									   	"price"				: tariffItem.price,					   	
									   	"amount" 			: current_amount,
									   	"rate"				: rate,
									   	"locale" 			: locale,
									   	"has_vat" 			: false,
								   		"type" 				: "tariff"
									});

									return false;						
								}
							});					
						}
						
						//Apply exemption
						if(value.meter[0].exemption_id>0){
							//Exemption money											
							if(exemption.unit=="money"){												
								invoiceLineList.push({				
							   		"invoice_id"		: 0,
									"item_id" 			: 0,															
								   	"meter_record_id"	: value.id,
								   	"description" 		: exemption.name,					   	
								   	"unit" 				: 1,
								   	"price"				: exemption.amount,					   	
								   	"amount" 			: exemption.amount,
								   	"rate"				: rate,
								   	"locale" 			: locale,
								   	"has_vat" 			: false,
								   	"type" 				: "exemptionMoney"
								});

								if(current_amount>kendo.parseFloat(exemption.amount)){
									current_amount -= kendo.parseFloat(exemption.amount);
								}else{
									current_amount = 0;
								}						
							}

							//Exemtpion %
							if(exemption.unit=="%"){
								var exemptionPercentTageAmount = current_amount * kendo.parseFloat(exemption.amount);

								invoiceLineList.push({				
							   		"invoice_id"		: 0,
									"item_id" 			: 0,													
								   	"meter_record_id"	: value.id,
								   	"description" 		: exemption.name,					   	
								   	"unit" 				: 1,
								   	"price"				: exemption.amount,					   	
								   	"amount" 			: exemptionPercentTageAmount,
								   	"rate"				: rate,
								   	"locale" 			: locale,
								   	"has_vat" 			: false,
								   	"type" 				: "exemptionP"
								});

								if(current_amount>exemptionPercentTageAmount){
									current_amount -= exemptionPercentTageAmount;
								}else{
									current_amount = 0;
								}
							}
						}

						//Apply maintenance						
						if(value.meter[0].maintenance_id>0){
							invoiceLineList.push({				
						   		"invoice_id"		: 0,
								"item_id" 			: 0,															
							   	"meter_record_id"	: value.id,
							   	"description" 		: maintenance.name,					   	
							   	"unit" 				: 1,
							   	"price"				: maintenance.amount,					   	
							   	"amount" 			: maintenance.amount,
							   	"rate"				: rate,
							   	"locale" 			: locale,
							   	"has_vat" 			: false,
							   	"type" 				: "maintenance"
							});

							current_amount += kendo.parseFloat(maintenance.amount);												
						}

						amount += current_amount;
					}					
				});				
				
				//Add invoice
				this.dataSource.add({				
			   		"company_id"		: company_id,
			   		"location_id" 		: location_id,
			   		"contact_id"		: contactID,
			   		"payment_term_id" 	: 0,
			   		"payment_method_id" : 0,
			   		"reference_id" 		: 0,
			   		"account_id" 		: 0,
			   		"vat_id"			: 0,
			   		"biller_id" 		: this.get("biller"),			   			
					"number" 			: "",											
				   	"type"				: "wInvoice",
				   	"amount" 			: amount,
				   	"amount_paid" 		: 0,
				   	"vat" 				: 0,					   	
				   	"rate" 				: rate,
				   	"locale" 			: locale,
				   	"month_of" 			: monthOf,
				   	"issued_date"		: kendo.toString(this.get("issued_date"), "yyyy-MM-dd"),					   	
				   	"payment_date" 		: kendo.toString(this.get("payment_date"), "yyyy-MM-dd"),
				   	"due_date" 			: kendo.toString(this.get("due_date"), "yyyy-MM-dd"),
				   	"check_no" 			: "",
				   	"memo" 				: "",
				   	"memo2" 			: "",
				   	"status" 			: 0,

				   	"invoice_lines"  	: invoiceLineList
				});
			}

			var saved = false;			
			this.dataSource.sync();
			this.dataSource.bind("requestEnd", function(e){
				if(saved==false){
					saved = true;
					
					self.readingDS.read();
				}
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			window.history.back();
		}	
	});
	banhji.wPrintCenter = kendo.observable({
		lang 				: langVM,				
		dataSource 	 		: dataStore(baseUrl + "invoices/wprint"),
		snapshotDS 	 		: dataStore(baseUrl + "invoices/wprint_snapshot"),
		branchDS 			: dataStore(baseUrl + "contacts/branch"),
		locationDS 			: dataStore(baseUrl + "locations"),
		obj 				: null,
		monthOfSearch 		: "",
		branch_id 			: null,
		selectedLocations 	: [],
		isBranchSelected	: false,
		chkAll				: true,
		pageLoad 			: function(id){			
			if(id){
				this.dataSource.filter({ field:"id", value: id });
			}			
		},
		branchChanges 		: function(){
			var branch_id = this.get("branch_id");

			if(branch_id){
				this.set("isBranchSelected", true);
				this.locationDS.filter({ field:"company_id", value: branch_id });
			}else{
				this.set("isBranchSelected", false);
				this.set("selectedLocations", []);
			}        	
        },
        checkAll 			: function(){
			var bolValue = this.get("chkAll");
			var data = this.dataSource.data();
			
			if(data.length>0){						
		        $.each(data, function(index, value){		        			        	
		        	value.set("isCheck", bolValue);		        	
		        });		        			        
	        }							
		},
		search 				: function(){
			var self = this, 
			para = [],
			monthOfSearch = this.get("monthOfSearch"),
			branch_id = this.get("branch_id"),
			selectedLocations = this.get("selectedLocations");
			
			if(selectedLocations.length>0){
				var ids = [];
				$.each(selectedLocations, function(index, value){
					ids.push(value);
				});
				
				para.push({ field:"location_id", operator:"where_in", value:ids });
			}else if(branch_id){
				para.push({ field:"company_id", value:branch_id });
			}					

			if(monthOfSearch){								
				var monthOf = new Date(monthOfSearch);
				monthOf.setDate(1);
				monthOf = kendo.toString(monthOf, "yyyy-MM-dd");
												
				para.push({ field:"month_of", value:monthOf });
			}			
						
			this.dataSource.query({
				filter: para,
				page:1,
				take:100
			}).then(function(){
				self.checkAll();
			});

			this.snapshotDS.query({
				filter: para,
				page:1,
				take:100
			}).then(function(){
				var view = self.snapshotDS.view();
				self.set("obj", view[0]);
			});							
		},
		print 				: function(){
			if(this.dataSource.total()>0){
				var ids = [];
				$.each(this.dataSource.data(), function(index, value){		        			        	
		        	if(value.isCheck){
		        		ids.push(value.id);
		        	}	        	
		        });

				if(ids.length>0){
			        banhji.router.navigate('/wInvoice_print');

			        banhji.wInvoicePrint.dataSource.query({
			        	filter: { field:"id", operator:"where_in", value:ids },
			        	page:1,
			        	take:100
			        }).then(function(){
			        	banhji.wInvoicePrint.barcod();
			        });
		    	}else{
		    		alert("Please check the box");
		    	}
			}else{
				alert("No data found");
			}
		}		
	});
	banhji.wInvoicePrint = kendo.observable({
		lang 				: langVM,				
		dataSource 	 		: dataStore(baseUrl + "invoices/wInvoice_print"),
		invoiceDS 	 		: dataStore(baseUrl + "invoices"),	
		isVisible 			: true,
		user_id 			: banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id,	
				
		pageLoad 			: function(id){
			if(id){
				var self = this;
				this.dataSource.query({
					filter: { field:"id", value: id },
					page:1,
					take:100
				}).then(function(){
					self.barcod();
				});
			}			
		},					
		barcod 			: function(){									
			var view = this.dataSource.view();
			
			for (var i=0;i<view.length;i++) {
				var d = view[i];				
												
				$("#"+d.contact[0].wnumber).kendoBarcode({
					renderAs: "svg",
				  	value: d.contact[0].wnumber,
				  	type: "code128",
				  	width: 200,
					height: 40,
					text:{
					    visible: false
					}	
				});				
			}		
		},
		print 						: function(){
			var self = this;
			$.each(this.dataSource.data(), function(index, value){
				value.set("print_count", kendo.parseInt(value.print_count)+1);
				value.set("printed_by", self.get("user_id"));
			});

			window.print();

			this.dataSource.sync();
			// var saved = false;
			// this.dataSource.bind("requestEnd", function(){
			// 	if(e.type=="update"){
			// 		saved = true;

			// 		self.dataSource.data([]);
			// 		window.history.back();
			// 	}
			// });
		},		
		hideFrameInvoice 			: function(e) {
			var printBtn = e.target;
			if(printBtn.checked) {
				$(".hiddenPrint").css("visibility", "hidden");
			} else {
				$(".hiddenPrint").css("visibility", "visible");
			}
		}
	});
	banhji.wInventoryItem =  kendo.observable({
		lang 				: langVM,    	
    	dataSource 			: dataStore(baseUrl + "items"),
    	categoryDS 			: dataStore(baseUrl + "categories"),
    	itemGroupDS			: dataStore(baseUrl + "items/group"),    	
    	contactDS  			: dataStore(baseUrl + "contacts"),
    	
    	searchField			: "",
    	category_id 		: 0,
    	item_group_id 		: 0,
    	    	
    	pageLoad 			: function(){    		
    		
    	},
    	search 				: function(){
    		var para = [],
    		searchField = this.get("searchField"),
    		category_id = this.get("category_id"),
    		item_group_id = this.get("item_group_id");

    		if(searchField!==""){
    			para.push(      				
      				{ field: "sku", operator: "like", value: searchField },
      				{ field: "name", operator: "or_like", value: searchField }
      			);
    		}

    		if(item_group_id>0){
    			para.push({ field:"item_group_id", value:item_group_id });
    		}else if(category_id>0){
    			para.push({ field:"category_id", value:category_id });
    		}

    		para.push({ field:"item_type_id", value:1 });

    		this.dataSource.filter(para);    		
    	},
    	searchFavorite 		: function(){
    		this.dataSource.filter({ field:"favorite", value: true });
    	},
    	categoryChanges : function(e){
    		e.preventDefault();
    		
    		var data = e.data;    		
    		this.dataSource.filter({ field:"category_id", value:data.id });
    	}		
    });	
	banhji.wSettings =  kendo.observable({
		lang 				: langVM,		
        contactTypeDS 		: dataStore(baseUrl + "contacts/type"),        
        blockDS 	 		: dataStore(baseUrl + "locations"),
        branchDS 	 		: dataStore(baseUrl + "contacts/branch"),
        tariffDS 	 		: dataStore(baseUrl + "fees"),
        tariffItemDS 		: dataStore(baseUrl + "fees/item"),
        exemptionDS  		: dataStore(baseUrl + "fees"),
        maintenanceDS  		: dataStore(baseUrl + "fees"),
        flatList			: [ 
	 		{ id:"false", name: "Not Flat" }, 
	 		{ id:"true", name: "Flat" }
		],
		exemptionTypeList			: [ 
	 		{ id:"usage", name: "m3" }, 
	 		{ id:"money", name: "Money" },
	 		{ id:"%", name: "%" }
		],
        contactTypeName 	: "",
        blockName 			: "",
        blockCompanyId  	: 0,
        blockAbbr 			: "",
        tariffName 			: "",
        tariffCompanyId 	: 0,
        fee_id 				: 0,
        tariffUsage 		: "",
        tariffPrice 		: "",
        tariffFlat 			: false,
        selectedTariffName 	: "",
        selectedTariff 		: false,
        exemptionName 		: "",
        exemptionAmount 	: "",
        exemptionCompanyId 	: 0,
        exemptionType 		: "",
        maintenanceName 	: "",
        maintenanceAmount 	: "",
        maintenanceCompanyId: 0,
        pageLoad 			: function() {
        	this.contactTypeDS.filter({ field:"parent_id", value: 1 });
        	this.blockDS.filter({ field:"utility_id", value: 2 });
        	this.tariffDS.filter([
        		{ field:"utility_id", value: 2 },
        		{ field:"type", value: "tariff" }
        	]);
        	this.exemptionDS.filter([
        		{ field:"utility_id", value: 2 },
        		{ field:"type", value: "exemption" }
        	]);
        	this.maintenanceDS.filter([
        		{ field:"utility_id", value: 2 },
        		{ field:"type", value: "maintenance" }
        	]);
        },	    
        addContactType 		: function(){
        	var name = this.get("contactTypeName");

        	if(name!==""){
	        	this.contactTypeDS.add({
	        		parent_id 	: 1,
	        		name 		: name
	        	});

	        	this.contactTypeDS.sync();
        	}
        },
        addBlock 			: function(){
        	var name = this.get("blockName");
        	
        	if(name!==""){
	        	this.blockDS.add({	        		
	        		company_id 	: this.get("blockCompanyId"),
	        		utility_id 	: 2,
	        		name 		: name,
	        		abbr 		: this.get("blockAbbr"),
	        		company 	: []
	        	});

	        	this.blockDS.sync();
        	}
        },
        addTariff 			: function(){
        	var name = this.get("tariffName");
        	
        	if(name!==""){
	        	this.tariffDS.add({	        		
	        		company_id 	: this.get("tariffCompanyId"),
	        		utility_id 	: 2,
	        		type 		: "tariff",
	        		name 		: name,
	        		amount 		: 0,
	        		unit 		: null,
	        		status 		: 1,

	        		company 	: []
	        	});

	        	this.tariffDS.sync();
        	}
        },
        addTariffItem 		: function(){
        	var usage = this.get("tariffUsage");
        	
        	if(usage!==""){
	        	this.tariffItemDS.add({	        		
	        		fee_id 		: this.get("fee_id"),
	        		usage 	 	: usage,
	        		price 		: this.get("tariffPrice"),
	        		is_flat		: this.get("tariffFlat")	        		
	        	});

	        	this.tariffItemDS.sync();
        	}
        },
        loadTariffItem 		: function(e){
	        var d = e.data;

	        this.set("selectedTariff", true);
	        this.set("fee_id", d.id);
	        this.set("selectedTariffName", d.name);
	        this.tariffItemDS.query({
	        	filter: { field:"fee_id", value: d.id },
	        	sort: { field:"usage", dir:"asc" },
	        	page: 1,
	        	take: 100
	        });  	
        },
        addExemption 		: function(){
        	var name = this.get("exemptionName");
        	
        	if(name!==""){
	        	this.exemptionDS.add({	        		
	        		company_id 	: this.get("exemptionCompanyId"),
	        		utility_id 	: 2,
	        		type 		: "exemption",
	        		name 		: name,
	        		amount 		: this.get("exemptionAmount"),
	        		unit 		: this.get("exemptionType"),
	        		status 		: 1,

	        		company 	: []
	        	});

	        	this.exemptionDS.sync();
        	}
        },
        addMaintenance		: function(){
        	var name = this.get("maintenanceName");
        	
        	if(name!==""){
	        	this.maintenanceDS.add({	        		
	        		company_id 	: this.get("maintenanceCompanyId"),
	        		utility_id 	: 2,
	        		type 		: "maintenance",
	        		name 		: name,
	        		amount 		: this.get("maintenanceAmount"),
	        		unit 		: null,
	        		status 		: 1,

	        		company 	: []
	        	});

	        	this.maintenanceDS.sync();
        	}
        }
    });
	banhji.wBranch =  kendo.observable({
		lang 				: langVM,		
        dataSource 			: dataStore(baseUrl + "contacts/branch"),
        existingDS			: dataStore(baseUrl + "contacts/branch"),
        deleteDS 			: dataStore(baseUrl + "locations"),
        currencyDS 			: dataStore(baseUrl + 'currencies'),

        statusList 			: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],

        obj 			: null,
        isEdit 			: false,
        isExisting 		: false,         	
                
        pageLoad 		: function(id){
        	var self = this;

        	if(id){        		
        		this.set("isEdit", true);        		
        		
        		this.dataSource.query({
				  	filter: { field: "id", value: id },
				  	page: 1,
				  	take: 50
				}).then(function(e) {
    				var view = self.dataSource.view();

    				if(view.length>0){
    					self.set("obj", view[0]);
    				}else{
    					self.addEmpty();
    				}
				});
        	}else{        		
        		this.set("isEdit", false);
        		this.addEmpty();
        	}
        },        
        checkExisting 	: function(){
        	var self = this, 
        	number = this.get("obj").operation_license;

        	this.existingDS.query({
			  	filter: { field: "operation_license", value: number },
			  	page: 1,
			  	take: 50
			}).then(function(e) {
				var view = self.existingDS.view();

				if(view.length>0){
					self.set("isExisting", true);
				}else{
					self.set("isExisting", false);
				}
			});
        },
        addEmpty 		: function(){
        	this.set("isEdit", false);
        	this.dataSource.data([]);

      		if(this.dataSource.total()==0){
				this.dataSource.add({					 			
					utility_id 			: 2,
					currency_id 		: 0,
					province_id 		: 0,
					country_id 			: 0,
					name 				: "",
					description 		: "",
					abbr 				: "",
					representative 		: "",
					email 				: "",
					mobile 				: "",
					phone 				: "",
					address 			: "",					
					expire_date 		: "",
					max_customer 		: "",
					operation_license 	: "",
					term_of_condition 	: "",
					image_url 			: "",
					status 				: 1
				});
				
				var data = this.dataSource.data();			
				var obj = data[data.length - 1];			
				this.set("obj", obj);
			}	
		},
		save 			: function(){			
			var self = this, saved = false;

			this.dataSource.sync();			
			this.dataSource.bind("requestEnd", function(e){				
				if(e.type=="create" && saved==false){					
					saved = true;
					
					self.addEmpty();
					banhji.wSettings.branchDS.fetch();					
				}

				if(e.type=="update" && saved==false){
					saved = true;
					banhji.wSettings.branchDS.fetch();
				}

				if(e.type=="destroy" && saved==false){
					saved = true;
					banhji.wSettings.branchDS.fetch();
					window.history.back();
				}
			});
		},
		delete 			: function(){
			var self = this,
			id = this.get("obj").id;

			if (confirm("Are you sure, you want to delete it?")) {
				this.deleteDS.query({
				  	filter: { field: "company_id", value: id },
				  	page: 1,
				  	take: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						var data = self.dataSource.get(id);
				        self.dataSource.remove(data);
				        self.save();
					}
				});				
	    	}
		},
		cancel 			: function(){
			this.dataSource.cancelChanges();
			window.history.back();
		}
    });
    //Water Reports
	banhji.wReportCenter = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices/wkpi"),
		branchDS 			: dataStore(baseUrl + "contacts/branch"),
		obj 				: null,
		branch_id 			: null,
		pageLoad 			: function(){
			
		},
		branchChanges		: function(){			
			var branch_id = this.get("branch_id");
			
			this.loadKPI(branch_id);			
		},
		loadKPI 			: function(id){
			var self = this;
			
			if(id){
				this.dataSource.query({
					filter: { field:"company_id", value: id },
					page: 1,
					take: 100
				}).then(function(){
					var view = self.dataSource.view();
					
					if(view.length>0){
						self.set("obj", view[0]);
					}else{
						self.set("obj", null);
					}
				});
			}else{
				this.set("obj", null);
			}			
		}
	});
	banhji.wCustomerNoMeter = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "contacts/no_meter"),
		branchDS 			: dataStore(baseUrl + "contacts/branch"),		
		
		branch_id 			: 0,				
				
		pageLoad 			: function(){
			
		},
		goToNewMeter 		: function(e){
			var obj = e.data;	
			
			banhji.router.navigate('/wDeposit');
			banhji.wDeposit.loadContact(obj.id);			
		},				
		search 				: function(){
			var branch_id = this.get("branch_id"), para = [];

        	if(branch_id){
        		this.dataSource.filter([
	    			{ field:"wbranch_id", value: branch_id },
	    			{ field:"use_water", value: 1 },
	    			{ field:"status", value: 1 },
	    		]); 
        	}else{
        		alert("Please select license");
        	}        	                 
		}
	});
	banhji.wBrandNewCustomer = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "contacts/branch_new"),
		branchDS 			: dataStore(baseUrl + "contacts/branch"),
		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "month",
		sdate 				: "",
		edate 				: "",
		branch_id 			: 0,
		pageLoad 			: function(){
			
		},
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");				
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		search 				: function(){
			var self = this,
				branch_id = this.get("branch_id"),
				start = this.get("sdate"),
        		end = this.get("edate"),	        		
        		para = [];

        	//Dates
        	if((start && end) && (new Date(start) < new Date(end))){        		
            	para.push({ field:"registered_date >=", value: kendo.toString(start, "yyyy-MM-dd") });
            	para.push({ field:"registered_date <=", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
            }else if(start){
            	para.push({ field:"registered_date", value: kendo.toString(start, "yyyy-MM-dd") });
            }else if(end){
            	para.push({ field:"registered_date <=", value: kendo.toString(end, "yyyy-MM-dd") });
            }else{
            	
            }

            if(branch_id){
            	para.push({ field:"wbranch_id", value:branch_id });
            }

            para.push({ field:"use_water", value:1 });
            para.push({ field:"status", value:1 });    

            this.dataSource.query({
            	filter: para,
            	sort: { field: "registered_date", dir: "desc" },
            	page: 1,
            	take: 100
            });            
		}
	});
    banhji.wAgingSummary = kendo.observable({
    	lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices/waging_summary"),		
		branchDS 			: dataStore(baseUrl + "contacts/branch"),		
		locationDS 			: dataStore(baseUrl + "locations"),
		
		branch_id 			: 0,
		location_id 		: 0,
		search_date 		: new Date(),
		strDate 			: "",		
				
		pageLoad 			: function(){
			
		},			
		strDate 			: function(){
			var search_date = this.get("search_date");
			
			return kendo.toString(new Date(search_date), "dd-MM-yyyy");
		},
		search 				: function(){
			var para = [],
			branch_id = this.get("branch_id"), 
			location_id = this.get("location_id"), 
			search_date = kendo.toString(this.get("search_date"), "yyyy-MM-dd");

        	if(location_id){
        		para.push({ field:"wlocation_id", value: location_id });
        	}else if(branch_id){
        		para.push({ field:"wbranch_id", value: branch_id });
        	}

        	if(search_date){
        		para.push({ field:"search_date", value: search_date });
        	}

        	if(para.length>0){
	            this.dataSource.query({
	            	filter: para,	            	           	
	            	page: 1,
	            	take: 100
	            });
            }             
		}
	});
	banhji.wAgingDetail = kendo.observable({
		lang 				: langVM,
		dataSource 			: new kendo.data.DataSource({
			transport: {
                read 	: {
					url: baseUrl + "invoices/waging_detail",
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
            },
            schema:{
                model: {
                    fields: {                                    
                        number: { type: "string" },
                        amount: { type: "number" },
                        issued_date: { type: "date" },
                        due_date: { type: "date" },
                        fullIdName: { type: "string" },
                        age: { type: "number" },
                        ageGroup: { type: "string" }
                    }
                },
				data: 'results',
				total: 'count'
            },
            pageSize: 100,
            serverFiltering: true,
            sort: { field: "issued_date", dir: "asc" },
            group: {
                field: "Aging", aggregates: [                	
                	{ field: "number", aggregate: "count" },
                    { field: "amount", aggregate: "sum" }
                ]
            },
            aggregate: [            	
            	{ field: "number", aggregate: "count" }, 
            	{ field: "amount", aggregate: "sum" }
            ]
		}),		
		branchDS 			: dataStore(baseUrl + "contacts/branch"),		
		locationDS 			: dataStore(baseUrl + "locations"),
		
		branch_id 			: 0,
		location_id 		: 0,
		search_date 		: new Date(),
		strDate 			: "",		
				
		pageLoad 			: function(){
			
		},			
		strDate 			: function(){
			var search_date = this.get("search_date");
			
			return kendo.toString(new Date(search_date), "dd-MM-yyyy");
		},
		search 				: function(){
			var para = [],
			branch_id = this.get("branch_id"), 
			location_id = this.get("location_id"), 
			search_date = kendo.toString(this.get("search_date"), "yyyy-MM-dd");

        	if(location_id){
        		para.push({ field:"location_id", value: location_id });
        	}else if(branch_id){
        		para.push({ field:"company_id", value: branch_id });
        	}

        	if(search_date){
        		para.push({ field:"issued_date <=", value: search_date });
        	}

        	if(para.length>0){
	            this.dataSource.filter(para);
            }             
		}
	});
	banhji.wSaleSummary = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices/wsale_summary"),
		sortList			: [ 
	 		{ text:"All", 	value: "all" }, 
	 		{ text:"Today", 	value: "today" }, 
	 		{ text:"This Week",value: "week" }, 
	 		{ text:"This Month", 		value: "month" }, 
	 		{ text:"This Year", 	value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		pageLoad 			: function(){
			
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date", operator:"between", value1:"'"+start+"'", value2:"'"+end+"'" });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
		}
	});
	banhji.wSaleDetail = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "invoices/wsale_detail"),
		branchDS 			: dataStore(baseUrl + "contacts/branch"),
		locationDS 			: dataStore(baseUrl + "locations"),
		sortList			: [ 
	 		{ text:"All", 	value: "all" }, 
	 		{ text:"Today", 	value: "today" }, 
	 		{ text:"This Week",value: "week" }, 
	 		{ text:"This Month", 		value: "month" }, 
	 		{ text:"This Year", 	value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		branch_id 			: null,
		selectedLocations 	: [],
		isBranchSelected	: false,
		pageLoad 			: function(){
			
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		branchChanges 		: function(){
			var branch_id = this.get("branch_id");

			if(branch_id){
				this.set("isBranchSelected", true);
				this.locationDS.filter({ field:"company_id", value: branch_id });
			}else{
				this.set("isBranchSelected", false);
				this.set("selectedLocations", []);
			}        	
        },
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),
			branch_id = this.get("branch_id"),
			selectedLocations = this.get("selectedLocations");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date", operator:"between", value1:"'"+start+"'", value2:"'"+end+"'" });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }

            if(selectedLocations.length>0){
				var ids = [];
				$.each(selectedLocations, function(index, value){
					ids.push(value);
				});
				
				para.push({ field:"location_id", operator:"where_in", value:ids });
			}else if(branch_id){
				para.push({ field:"company_id", value:branch_id });
			}          

            this.dataSource.filter(para);
		}
	});
	banhji.wPaymentSummary = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "payments/wsummary"),

		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		strDate 			: "",		
				
		pageLoad 			: function(){
			
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this, start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), end = kendo.toString(this.get("edate"), "yyyy-MM-dd"), para = [];

        	//Dates
        	if(start && end){        		
            	para.push({ field:"date", operation:">=", value: kendo.toString(start, "yyyy-MM-dd") });
            	para.push({ field:"date", operation:"<=", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
            }else if(start){
            	para.push({ field:"date", operation:"=", value: kendo.toString(start, "yyyy-MM-dd") });
            }else if(end){
            	para.push({ field:"date", operation:"<=", value: kendo.toString(end, "yyyy-MM-dd") });
            }else{
            	
            }          

            this.dataSource.query({
            	filter: para,            	
            	page: 1,
            	take: 100
            });             
		}
	});
	banhji.wPaymentDetail = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "payments/wdetail"),

		sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today", value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "month",
		sdate 				: "",
		edate 				: "",		
				
		pageLoad 			: function(){
			
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},		
		search 				: function(){
			var self = this, start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), end = kendo.toString(this.get("edate"), "yyyy-MM-dd"), para = [];

        	//Dates
        	if(start && end){        		
            	para.push({ field:"payment_date >=", value: kendo.toString(start, "yyyy-MM-dd") });
            	para.push({ field:"payment_date <=", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
            }else if(start){
            	para.push({ field:"payment_date", value: kendo.toString(start, "yyyy-MM-dd") });
            }else if(end){
            	para.push({ field:"payment_date <=", value: kendo.toString(end, "yyyy-MM-dd") });
            }else{
            	
            }

            para.push({ field:"type", operator:"where_in", value:["invoice", "receipt", "wdeposit"] });

            this.dataSource.query({
            	filter: para,
            	sort: { field: "payment_date", dir: "desc" },
            	page: 1,
            	take: 100
            });             
		}
	});
	banhji.wPaymentBySourceSummary = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "payments/wsource_summary"),
		sortList			: [ 
	 		{ text:"All", 	value: "all" }, 
	 		{ text:"Today", 	value: "today" }, 
	 		{ text:"This Week",value: "week" }, 
	 		{ text:"This Month", 		value: "month" }, 
	 		{ text:"This Year", 	value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		pageLoad 			: function(){
			
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"payment_date", operator:"between", value1:"'"+start+"'", value2:"'"+end+"'" });            	          	            	
            }else if(start){
            	para.push({ field:"payment_date", value: start });
            }else if(end){
            	para.push({ field:"payment_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
		}
	});
	banhji.wPaymentBySourceDetail = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "payments/wsource_detail"),
		branchDS 			: dataStore(baseUrl + "contacts/branch"),
		locationDS 			: dataStore(baseUrl + "locations"),
		sortList			: [ 
	 		{ text:"All", 	value: "all" }, 
	 		{ text:"Today", 	value: "today" }, 
	 		{ text:"This Week",value: "week" }, 
	 		{ text:"This Month", 		value: "month" }, 
	 		{ text:"This Year", 	value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		branch_id 			: null,
		selectedLocations 	: [],
		isBranchSelected	: false,
		pageLoad 			: function(){
			
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		branchChanges 		: function(){
			var branch_id = this.get("branch_id");

			if(branch_id){
				this.set("isBranchSelected", true);
				this.locationDS.filter({ field:"company_id", value: branch_id });
			}else{
				this.set("isBranchSelected", false);
				this.set("selectedLocations", []);
			}        	
        },
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),
			branch_id = this.get("branch_id"),
			selectedLocations = this.get("selectedLocations");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"payment_date", operator:"between", value1:"'"+start+"'", value2:"'"+end+"'" });            	          	            	
            }else if(start){
            	para.push({ field:"payment_date", value: start });
            }else if(end){
            	para.push({ field:"payment_date <=", value: end });
            }else{
            	
            }

            if(selectedLocations.length>0){
				var ids = [];
				$.each(selectedLocations, function(index, value){
					ids.push(value);
				});
				
				para.push({ field:"wlocation_id", operator:"where_in", model:"contact", value:ids });
			}else if(branch_id){
				para.push({ field:"company_id", value:branch_id });
			}          

            this.dataSource.filter(para);
		}
	});	    	
	//END OF DAWINE  ---------------------------------------------------------------------------------


	<!-- views and layout -->
	banhji.view = {
		layout 		: new kendo.Layout('#layout', {model: banhji.Layout}),
		blank		: new kendo.View('<div></div>'),
		vendorMenu 	: new kendo.View("#vendor-menu-tmpl", {wrap: false, tagName: 'ul'}),
		// menu 		: new kendo.Layout('#menu-tmpl', {model: banhji.Layout}),
		// loginV 		: new kendo.View("#login-tmpl", {model: auth}),
		index  		: new kendo.Layout("#index", {model: banhji.index}),
		myTmpl 		: new kendo.Layout('#my-tmpl'),
		userList 	: new kendo.View('#admin-userList-tmpl', {model: user}),
		newUser 	: new kendo.View('#userList-new-tmpl', {model: user}),
		editUser 	: new kendo.View('#userList-edit-tmpl', {model: user}),
		pwdUser 	: new kendo.View('#userList-password-tmpl', {model: user}),
		adTmpl 		: new kendo.Layout('#admin-tmpl'),
		structure 	: new kendo.View('#admin-structure-tmpl', {model: banhji.segment}),
		structureNew: new kendo.View('#admin-structure-new-tmpl', {model: banhji.segment}),
		structureSingle: new kendo.View('#admin-structure-single-tmpl', {model: banhji.segment}),
		vendors 	: new kendo.Layout("#vendors-tmpl", {model: banhji.vendors}),
		vendorNew 	: new kendo.Layout("#vendor-new-tmpl", {model: banhji.vendors}),
		vendorDash 	: new kendo.Layout("#vendor-dashboard-tmpl", {model: banhji.vendors}),
		//vendor 		: new kendo.Layout("#vendor-tmpl", {model: banhji.vendors}),
		vendorBill 	: new kendo.View("#bill-list-container-tmpl", {model: banhji.bill}),
		vendorList 	: new kendo.View("#vendors-list-tmpl", {model: banhji.vendors}),
		vendorDetail: new kendo.View("#vendor-detail-tmpl", {model:banhji.vendors}),
		// vendorList 	: new kendo.View("#accounts-list-tmpl", {model: banhji.account}),
		payment 	: new kendo.View("#payment-tmpl", {model: banhji.payment}),
		poCenter 	: new kendo.View("#po-center-template", {model: banhji.po}),
		// billForm 	: new kendo.Layout("#vendors-bill-form-header-tmpl", {model: banhji.expense}),
		billExp 	: new kendo.View("#vendors-expense-form-header-tmpl", {model: banhji.expense}),
		billPur 	: new kendo.View("#vendors-purchase-form-header-tmpl", {model: banhji.purchase}),
		accountingDash: new kendo.View("#accounting-dashboard", {model: banhji.accountingSetting}),
		accountDash : new kendo.Layout("#accounting-dashboard-tmpl", {model: banhji.accounting}),
		accounting_menu: new kendo.View('#accounting-menu-tmpl', {wrap: false, tagName: 'ul'}),
		accounting_setting: new kendo.View('#accounting-setting-template', { model: banhji.accountingSetting }),
		currencyPage: new kendo.View('#currency-page-template', { model: banhji.currency }),
		trialBalanceView: new kendo.View('#accounting-trialBalance-tmpl', { model: banhji.accountingSetting }),
		currencyForm: new kendo.View("#currency-list-edit-template", {model: banhji.currencies}),
		mainView : new kendo.Layout("#admin-segment-items-tmpl", {model: banhji.segmentItem}),
		actionView : new kendo.View("#admin-segment-items-list-action-tmpl", {model: banhji.segmentItem}),
		listView : new kendo.View("#admin-segment-items-list-conatiner-tmpl", {model: banhji.segmentItem}),
		settings 	: new kendo.View("#companySettingsView", {model: banhji.company}),
		settingList : new kendo.View("#companySettingsListView", {model: banhji.company}),
		menu 		: new kendo.Layout('#menu-tmpl', {model: banhji.userManagement}),
		page 		: new kendo.View('#page', {model: banhji.userManagement}),
		pageAdmin	: new kendo.Layout('#page-admin'),
		loginView 	: new kendo.View('#login-template', {model: banhji.userManagement}),
		signupView 	: new kendo.View('#signup-template', {model: banhji.userManagement}),
		userListView: new kendo.View('#page-admin-userlist', {model:banhji.users}),
		addUserView : new kendo.View('#page-admin-userlist-add-template', {model: banhji.users}),
		editRoleView: new kendo.View('#page-admin-userlist-edit-role-template', {model: banhji.users}),
		passwordView: new kendo.View('#page-admin-userlist-password-template', {model: banhji.userManagement}),
		journalReView:new kendo.View('#journal-report-tmpl', {model: banhji.report}),
		glReView:new kendo.View('#journal-ledger-report-tmpl', {model: banhji.report}),
		// companyL:new kendo.Layout("#company", {model: admin}),
		// companyList: new kendo.View("#companyList"),
		// comNew: new kendo.View("#companyNew", {model: company}),
		// myPage: new kendo.Layout("#myId", {model: admin})

		//DAWINE -----------------------------------------------------------------------------------------
		vendorCenter: new kendo.Layout("#vendorCenter", {model: banhji.vendorCenter}),
		vendor: new kendo.Layout("#vendor", {model: banhji.vendor}),
		po: new kendo.Layout("#po", {model: banhji.po}),
		grn: new kendo.Layout("#grn", {model: banhji.grn}),
		purchase: new kendo.Layout("#purchase", {model: banhji.purchase}),		
		vendorSetting: new kendo.Layout("#vendorSetting", {model: banhji.vendorSetting}),

		customerCenter: new kendo.Layout("#customerCenter", {model: banhji.customerCenter}),
		customerDashboard: new kendo.Layout("#customerDashboard", {model: banhji.customerCenter}),
		customer: new kendo.Layout("#customer", {model: banhji.customer}),
		customerList : new kendo.Layout("#customerList", {model: banhji.customerList}),		
		
		invoice: new kendo.Layout("#invoice", {model: banhji.invoice}),
		receipt: new kendo.Layout("#receipt", {model: banhji.receipt}),
		estimate: new kendo.Layout("#estimate", {model: banhji.estimate}),
		so: new kendo.Layout("#so", {model: banhji.so}),
		gdn: new kendo.Layout("#gdn", {model: banhji.gdn}),		
		statement: new kendo.Layout("#statement", {model: banhji.statement}),
		customerReportCenter: new kendo.Layout("#customerReportCenter"),
		customerSetting: new kendo.Layout("#customerSetting", {model: banhji.customerSetting}),

		//Cashier
		cashier: new kendo.Layout("#cashier", {model: banhji.cashier}),
		reconcile: new kendo.Layout("#reconcile", {model: banhji.reconcile}),
		currencyRate: new kendo.Layout("#currencyRate", {model: banhji.currencyRate}),

		//Inventory		
		itemDashBoard: new kendo.Layout("#itemDashBoard", {model: banhji.itemDashBoard}),
		itemCenter: new kendo.Layout("#itemCenter", {model: banhji.itemCenter}),		
		item: new kendo.Layout("#item", {model: banhji.item}),
		priceList: new kendo.Layout("#priceList", {model: banhji.priceList}),
		itemCatalog: new kendo.Layout("#itemCatalog", {model: banhji.itemCatalog}),
		itemAssembly: new kendo.Layout("#itemAssembly", {model: banhji.itemAssembly}),
		itemRecord: new kendo.Layout("#itemRecord", {model: banhji.itemRecord}),
		itemAdjustment: new kendo.Layout("#itemAdjustment", {model: banhji.itemAdjustment}),
		itemSetting: new kendo.Layout("#itemSetting", {model: banhji.itemSetting}),
		itemReportCenter: new kendo.Layout("#itemReportCenter"),
		inventoryPositionSummary: new kendo.Layout("#inventoryPositionSummary", {model: banhji.inventoryPositionSummary}),
		inventoryPositionDetail: new kendo.Layout("#inventoryPositionDetail", {model: banhji.inventoryPositionDetail}),
		inventorySaleByItem: new kendo.Layout("#inventorySaleByItem", {model: banhji.inventorySaleByItem}),
		inventoryTurnoverList: new kendo.Layout("#inventoryTurnoverList", {model: banhji.inventoryTurnoverList}),
		inventoryList: new kendo.Layout("#inventoryList", {model: banhji.inventoryList}),
		inventoryMovementSummary: new kendo.Layout("#inventoryMovementSummary", {model: banhji.inventoryMovementSummary}),
		inventoryMovementDetail: new kendo.Layout("#inventoryMovementDetail", {model: banhji.inventoryMovementDetail}),
		inventoryPurchaseByVendorSummary: new kendo.Layout("#inventoryPurchaseByVendorSummary", {model: banhji.inventoryPurchaseByVendorSummary}),
		inventoryPurchaseByVendorDetail: new kendo.Layout("#inventoryPurchaseByVendorDetail", {model: banhji.inventoryPurchaseByVendorDetail}),
		
		//Electricity
		eDashBoard: new kendo.Layout("#eDashBoard", {model: banhji.eDashBoard}),		
		eMeter: new kendo.Layout("#eMeter", {model: banhji.meter}),		
		eReading: new kendo.Layout("#eReading", {model: banhji.reading}),		
		eInvoice: new kendo.Layout("#eInvoice", {model: banhji.uInvoice}),		
		eInvoicePrint: new kendo.Layout("#eInvoicePrint", {model: banhji.invoicePrint}),		
		
		//Water
		wDashBoard: new kendo.Layout("#wDashBoard", {model: banhji.wDashBoard}),
		wCustomerCenter: new kendo.Layout("#wCustomerCenter", {model: banhji.wCustomerCenter}),
		wNewCustomer: new kendo.Layout("#wNewCustomer", {model: banhji.wNewCustomer}),
		wCustomer: new kendo.Layout("#wCustomer", {model: banhji.wCustomer}),
		wCustomerOrder: new kendo.Layout("#wCustomerOrder", {model: banhji.wCustomerOrder}),		
		wDeposit: new kendo.Layout("#wDeposit", {model: banhji.wDeposit}),
		wDepositWitdraw: new kendo.Layout("#wDepositWitdraw", {model: banhji.wDepositWitdraw}),
		wMeter: new kendo.Layout("#wMeter", {model: banhji.wMeter}),
		wReadingCenter: new kendo.Layout("#wReadingCenter", {model: banhji.wReadingCenter}),
		wEditReading: new kendo.Layout("#wEditReading", {model: banhji.wEditReading}),
		wReading: new kendo.Layout("#wReading", {model: banhji.wReading}),
		wIRReader: new kendo.Layout("#wIRReader", {model: banhji.wIRReader}),
		wReadingBook: new kendo.Layout("#wReadingBook", {model: langVM}),
		wInvoice: new kendo.Layout("#wInvoice", {model: banhji.wInvoice}),
		wPrintCenter: new kendo.Layout("#wPrintCenter", {model: banhji.wPrintCenter}),
		wInvoicePrint: new kendo.Layout("#wInvoicePrint", {model: banhji.wInvoicePrint}),		
		wInstallment: new kendo.Layout("#wInstallment", {model: banhji.wInstallment}),
		wInventoryItem: new kendo.Layout("#wInventoryItem", {model: banhji.wInventoryItem}),
				
		wReportCenter: new kendo.Layout("#wReportCenter", {model: banhji.wReportCenter}),
		wCustomerList: new kendo.Layout("#wCustomerList"),
		wCustomerBalance: new kendo.Layout("#wCustomerBalance"),
		wCustomerDeposit: new kendo.Layout("#wCustomerDeposit"),
		wLowConsumption: new kendo.Layout("#wLowConsumption"),
		wDisconnectList: new kendo.Layout("#wDisconnectList"),
		wAgingSummary: new kendo.Layout("#wAgingSummary", {model: banhji.wAgingSummary}),
		wAgingDetail: new kendo.Layout("#wAgingDetail", {model: banhji.wAgingDetail}),
		wSaleSummary: new kendo.Layout("#wSaleSummary", {model: banhji.wSaleSummary}),
		wSaleDetail: new kendo.Layout("#wSaleDetail", {model: banhji.wSaleDetail}),
		wPaymentSummary: new kendo.Layout("#wPaymentSummary", {model: banhji.wPaymentSummary}),
		wPaymentDetail: new kendo.Layout("#wPaymentDetail", {model: banhji.wPaymentDetail}),
		wPaymentBySourceSummary: new kendo.Layout("#wPaymentBySourceSummary", {model: banhji.wPaymentBySourceSummary}),
		wPaymentBySourceDetail: new kendo.Layout("#wPaymentBySourceDetail", {model: banhji.wPaymentBySourceDetail}),
		wCustomerNoMeter: new kendo.Layout("#wCustomerNoMeter", {model: banhji.wCustomerNoMeter}),
		wBrandNewCustomer: new kendo.Layout("#wBrandNewCustomer", {model: banhji.wBrandNewCustomer}),
		wBranch: new kendo.Layout("#wBranch", {model: banhji.wBranch}),		
		wSettings: new kendo.Layout("#wSettings", {model: banhji.wSettings}),		

		vendorMenu: new kendo.View("#vendorMenu", {model: langVM}),
		customerMenu: new kendo.View("#customerMenu", {model: langVM}),
		waterMenu: new kendo.View("#waterMenu", {model: langVM}),
		inventoryMenu: new kendo.View("#inventoryMenu", {model: langVM})				
		//END OF DAWINE  ---------------------------------------------------------------------------------
	};
	<!-- views and layout-->
	banhji.router = new kendo.Router({
		init: function() {
			var language = JSON.parse(localStorage.getItem('userData/lang'));	
			switch(language) {
				case "KH": 
					langVM.set('lang', km_KH);
					localforage.setItem("lang", language);
					langVM.set('localeCode', language);
					break;
				case "EN":
					langVM.set('lang', en_US);
					localforage.setItem("lang", language);
					langVM.set('localeCode', language);
					break;
				default: 
					langVM.set('lang', en_US);
					localforage.setItem("lang", language);
					langVM.set('localeCode', language);
			}

			$('#current-section').html('|&nbsp;Company');
			$('#home-menu').addClass('active');
			banhji.view.layout.render("#wrapperApplication");
			var blank = new kendo.View('#blank-tmpl');
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			if(banhji.userManagement.getLogin() === false) {
				window.location.assign("<?php echo base_url(); ?>home");
			}
		},
		routeMissing: function(e) {
			// banhji.view.layout.showIn("#layout-view", banhji.view.missing);
			console.log("no resource found.")
		}
	});

	/* Login page */
	banhji.router.route('/', function(){
		var blank = new kendo.View('#blank-tmpl');
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		$('#main-top-navigation').append('<li><a href="\#">Home</a></li>');
		$('#current-section').text("");
		$("#secondary-menu").html("");
		if(getDB() !== null) {
			banhji.view.layout.showIn('#content', banhji.view.index);
			var dataSource = new kendo.data.DataSource({
				transport: {
					read 	: {
						url: baseUrl + 'sales',
						type: "GET",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					parameterMap: function(options, operation) {
						if(operation === 'read') {
							return {
								limit: options.take,
								page: options.page,
								filter: options.filter
							};
						}
					}
				},
				schema 	: {
					data: 'results',
					total: 'count'
				},
				group: {
					field: 'month',
					aggregates: [
						{field: 'amount', aggregate: 'sum'}
					]
				},
				batch: true,
				serverFiltering: true,
				serverPaging: true,
				pageSize: 100
			});
			var incomeDS = new kendo.data.DataSource({
				transport: {
					read 	: {
						url: baseUrl + 'sales/income',
						type: "GET",
						headers: {
							"Entity": getDB(),
							"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
						},
						dataType: 'json'
					},
					parameterMap: function(options, operation) {
						if(operation === 'read') {
							return {
								limit: options.take,
								page: options.page,
								filter: options.filter
							};
						}
					}
				},
				schema 	: {
					data: 'results',
					total: 'count'
				},
				group: {
					field: 'month',
					dir: 'desc',
					aggregates: [
						{field: 'amount', aggregate: 'sum'}
					]
				},
				batch: true,
				serverFiltering: true,
				serverPaging: true,
				pageSize: 100
			});
			dataSource.fetch(function(e){
				$('#index-sales-graph').kendoChart({
					dataSource: {data: dataSource.data()},
					series: [
						{field: 'amount', categoryField: 'month', color: '#004c99', type: 'line'}
					],
					title: {
						text: "ចំណូលលក់ប្រចាំខែ"
					},
					tooltip: {
	                    visible: true,
	                    format: "{0:C}",
	                }
				});
			});
			banhji.index.customer.fetch();
			banhji.index.expenseDS.fetch(function(e){
				var data = banhji.index.expenseDS.data();
				var amount = 0;
				banhji.index.set('expense', 0);
				$.each(data, function(index, value) {
					amount += kendo.parseFloat(value.amount);
				});	
				kendo.culture(banhji.index.companyInf().institute[0].locale);
				banhji.index.set('expense', kendo.toString(amount, 'c2'));
			});
			incomeDS.fetch(function(e){
				var data = incomeDS.data();
				$('#index-income-graph').kendoChart({
					series: [
						{
							name: 'Income', 
							field: 'income',
							data: data[0].income,
							categoryField: 'month', 
							color: '#004c99', 
							downColor: "red",
							type: 'line'
						},
						{
							name: 'Expense', 
							field: 'expense',
							data: data[0].income, 
							categoryField: 'month', 
							color: '#000000', 
							downColor: "red", 
							type: 'line'
						},
						{
							name: 'Revenue', 
							field: 'amount',
							data: data[0].sale,
							categoryField: 'month', 
							color: '#cccccc', 
							downColor: "red", 
							type: 'column'
						}
					],
					legend: {
						position: "top"
					},
					title: {
						text: "Statment Of Profit Or Loss"
					},
					tooltip: {
	                    visible: true,
	                    format: "{0:C}",
	                }
				});			
			});
			// banhji.index.equation.fetch(function(e){
			// 	var data = banhji.index.equation.data();
			// 	$.each(data, function(i, v){
			// 		if(v.type === 1) {
			// 			banhji.index.set('asset', v.amount);
			// 		} else if(v.type === 2) {
			// 			banhji.index.set('liability', v.amount);
			// 		} else {
			// 			banhji.index.set('equity', v.amount);
			// 		}
			// 	});
			// });
			banhji.index.cash.fetch(function(e){
				var data = banhji.index.cash.data();
				$.each(data, function(i, v){
					kendo.culture(banhji.index.companyInf().institute[0].locale);

					banhji.index.set('cashBal', kendo.toString(kendo.parseFloat(v.amount), "c", banhji.institute.locale));
				});
			});

			banhji.index.dateChanges();
		} else {
			window.location.assign("<?php echo base_url(); ?>home");
		}
	});
	banhji.router.route('/login', function() {
		banhji.view.layout.showIn('#content', banhji.view.loginV);
	});
	banhji.router.route('/admin', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			if(auth.isAdmin() === true) {
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
			} else {
				console.log("not admin");
			}

		}
	});
	banhji.router.route('/userList', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			if(auth.isAdmin()) {
				user.dataStore.cancelChanges();
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
				banhji.view.adTmpl.showIn('#myContainer', banhji.view.userList);
			} else {
				console.log("not admin");
			}
		}
	});
	banhji.router.route('/userList/new', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			if(auth.isAdmin()) {
				user.dataStore.insert(0,{
					username: "",
					password: "",
					status: true,
					created_at: new Date(),
					updated_at: new Date()
				});
				user.set('current', user.dataStore.at(0));
				if(user.get('current').isNew()) {
					console.log('New');
				}
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
				banhji.view.adTmpl.showIn('#myContainer', banhji.view.newUser);
			} else {
				console.log("not admin");
			}
		}
	});
	banhji.router.route('/userList/:id/edit', function(id){
		user.dataStore.cancelChanges();
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			if(auth.isAdmin()) {
				var model = user.dataStore.get(id);
				if (model === undefined) {
					user.dataStore.query({
						filter: {field: 'id', value: id}
					}).then(function(e){
						user.set('current', user.dataStore.get(id));
					});
				} else {
					user.set('current', model);
				}
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
				banhji.view.adTmpl.showIn('#myContainer', banhji.view.editUser);
			} else {
				console.log("not admin");
			}
		}
	});
	banhji.router.route('/userList/:id/changePassword', function(id){
		user.dataStore.cancelChanges();
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			if(auth.isAdmin()) {
				var model = user.dataStore.get(id);
				if (model === undefined) {
					user.dataStore.query({
						filter: {field: 'id', value: id}
					}).then(function(e){
						user.set('current', user.dataStore.get(id));
					});
				} else {
					user.set('current', model);
				}
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
				banhji.view.adTmpl.showIn('#myContainer', banhji.view.pwdUser);
			} else {
				console.log("not admin");
			}
		}
	});
	banhji.router.route('/admin/company-settings', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			if(auth.isAdmin()) {
				banhji.company.init();
				user.dataStore.cancelChanges();
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
				banhji.view.adTmpl.showIn('#myContainer', banhji.view.settingList);
			} else {
				console.log("not admin");
			}
		}
	});
	banhji.router.route('/admin/company/:id', function(id){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			if(auth.isAdmin()) {
				banhji.company.init();
				banhji.company.findById(id);
				user.dataStore.cancelChanges();
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
				banhji.view.adTmpl.showIn('#myContainer', banhji.view.settings);
			} else {
				console.log("not admin");
			}
		}
	});
	banhji.router.route('/admin/company/new', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			if(auth.isAdmin()) {
				banhji.company.init();
				user.dataStore.cancelChanges();
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
				banhji.view.adTmpl.showIn('#myContainer', banhji.view.settings);
			} else {
				console.log("not admin");
			}
		}
	});
	banhji.router.route('/admin/companyList/new', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			if(auth.isAdmin()) {
				user.dataStore.insert(0,{
					username: "",
					password: "",
					status: true
				});
				user.set('current', user.dataStore.at(0));
				if(user.get('current').isNew()) {
					console.log('New');
				}
				banhji.view.layout.showIn('#content', banhji.view.adTmpl);
				banhji.view.adTmpl.showIn('#myContainer', banhji.view.newUser);
			} else {
				console.log("not admin");
			}
		}
	});
	banhji.router.route('/admin/companyList/:id/edit', function(id){
		user.dataStore.cancelChanges();
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			var model = user.dataStore.get(id);
			if (model === undefined) {
				user.dataStore.query({
					filter: {field: 'id', value: id}
				}).then(function(e){
					user.set('current', user.dataStore.get(id));
				});
			} else {
				user.set('current', model);
			}
			banhji.view.layout.showIn('#content', banhji.view.adTmpl);
			banhji.view.adTmpl.showIn('#myContainer', banhji.view.editUser);
		}
	});
	banhji.router.route('/structure', function() {
		// show structure list
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', banhji.view.adTmpl);
			banhji.view.adTmpl.showIn('#myContainer', banhji.view.structure);
		}
	});
	banhji.router.route('/structure/new', function() {
		// create new structure
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.segment.dataStore.insert(0, {
				code_length: 1,
				name: null,
				created_at: '',
				updated_at: ''
			});
			banhji.segment.setCurrent(banhji.segment.dataStore.at(0));
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', banhji.view.adTmpl);
			banhji.view.adTmpl.showIn('#myContainer', banhji.view.structureNew);
		}
	});
	banhji.router.route('/structure/:id', function(id) {
		// view edit, or delete given structure with id
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			if(banhji.segment.dataStore.get(id)) {
				banhji.segment.setCurrent(banhji.segment.dataStore.get(id));
			} else {
				banhji.segment.find({field: 'id', value: id});
			}
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', banhji.view.adTmpl);
			banhji.view.adTmpl.showIn('#myContainer', banhji.view.structureSingle);
		}
	});
	banhji.router.route('/structure/:id/segments', function(id){		
		if(banhji.segment.dataStore.get(id)) {
			banhji.segmentItem.set('segment', banhji.segment.dataStore.get(id));
		} else {
			banhji.segment.dataStore.fetch(function(e){
				banhji.segmentItem.set('segment', banhji.segment.dataStore.get(id));
			});
		}
		banhji.segmentItem.bySegment(id);
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		banhji.view.layout.showIn('#content', banhji.view.adTmpl);
		banhji.view.adTmpl.showIn('#myContainer', banhji.view.mainView);
		banhji.view.mainView.showIn("#segment-list-container", banhji.view.listView);
	});
	banhji.router.route('/my', function(){
		// for managing current logged in user
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#content', banhji.view.myTmpl);
			console.log("dfd");
		}		
	});
	// user management
	banhji.router.route('/my/manage', function(){});
	banhji.router.route('/my/manage/:id/update', function(id){});
	banhji.router.route('/my/manage/:id/chagne_password', function(){});
	banhji.router.route('/my/manage/new', function(){});
	banhji.router.route('/role', function(){});
	banhji.router.route('/role/:id/update', function(){});
	banhji.router.route('/role/new', function(){});
	banhji.router.route('/currencies/u/list', function(){
		console.log('currency list');
	});
	banhji.router.route('/vendors/u/new', function() {
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.vendors.accountDS.get("dataStore").query({
				filter: {field: 'account_type_id', operator: 'where_in', value: [13, 14, 21]},
				page: 1,
				pageSize: 200
			}).done(function(e){
				var data = banhji.vendors.accountDS.dataStore.data();
				$.each(data, function(i, v){
					if(v.type.id === 13) {
						banhji.vendors.get('apAccount').push(v);
					} else if(v.type.id === 14) {
						banhji.vendors.get('discountAC').push(v);
					} else {
						banhji.vendors.get('prepaidAC').push(v);
					}
				});
			});
			banhji.currency.getEnabled();
			banhji.vendors.set('isEdit', false);
			banhji.vendors.addNew();
			banhji.vendors.setCurrent(banhji.vendors.get('dataSource').at(0));
			banhji.view.layout.showIn('#menu', banhji.view.blank);
			banhji.view.layout.showIn('#content', banhji.view.vendorNew);
		}
	});
	banhji.router.route('/vendors/:id/edit', function(id) {
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.vendors.accountDS.get("dataStore").query({
				filter: {field: 'account_type_id', operator: 'where_in', value: [13, 14, 21]},
				page: 1,
				pageSize: 200
			}).done(function(e){
				var data = banhji.vendors.accountDS.dataStore.data();
				$.each(data, function(i, v){
					if(v.type.id === 13) {
						banhji.vendors.get('apAccount').push(v);
					} else if(v.type.id === 14) {
						banhji.vendors.get('discountAC').push(v);
					} else {
						banhji.vendors.get('prepaidAC').push(v);
					}
				});
			});
			banhji.currency.getEnabled();
			banhji.vendors.selectPaymentOption();
			banhji.vendors.set('isEdit', true);
			banhji.view.layout.showIn('#menu', banhji.view.blank);
			banhji.view.layout.showIn('#content', banhji.view.vendorNew);
			banhji.vendors.loadMap();
		}
	});
	//-----------------------
	banhji.vendorLayout = new kendo.Layout("#vendors-section-tmpl", {model: banhji.vendors});
	banhji.vendorDash 	= new kendo.Layout("#vendors-section-dashboard-tmpl", {model: banhji.vendors});
	// new vendor section
	banhji.router.route('/vendors', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.vendors.set('current', null);
			// banhji.vendors.billVM.getOpenBills();
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.vendorMenu);
			// $('#current-section').text(" | អ្នកផ្គត់ផ្គង");
			banhji.view.layout.showIn('#content', banhji.vendorLayout);
			banhji.vendorLayout.showIn('#vendorDashboard', banhji.vendorDash);
			// var date = new Date();
			// banhji.vendors.set('startDate', kendo.toString(date, 'yyyy-MM') + '-01');
			banhji.vendors.getMonthlyExp();
			var grid = $('#sidebar').data('kendoGrid');
			// if(id) {
			// 	banhji.vendors.setCurrent(banhji.vendors.dataSource.get(id));
			// 	// if(banhji.vendors.get('current') === 'null') {
			// 	// 	banhji.vendors.dataSource.query({
			// 	// 		filter: { field: 'id', operator: 'like', value: id},
			// 	// 		page: 1,
			// 	// 		pageSize: 1
			// 	// 	}).done(function(e){
			// 	// 		var vendor = banhji.vendors.dataSource.data()[0];
			// 	// 		if(vendor) {
			// 	// 			banhji.vendors.setCurrent(vendor);
			// 	// 			banhji.vendors.findBillByVendor(vendor.id);
			// 	// 		}
			// 	// 	});
			// 	// } else {
			// 	// }
			// }
		}
	});
	// end new vendor section

	banhji.router.route('/vendors/u/list',  function(){
		banhji.view.layout.showIn('#menu', banhji.view.blank);
		banhji.view.layout.showIn('#content', banhji.view.vendorList);
		$("#vendorListView").kendoListView({
			dataSource: banhji.vendors.dataSource,
			template: "<div>#:company#</div>",
			selectable: true,
			change: function() {
				var selected = this.select();
				var model = this.dataItem(selected);
				banhji.vendors.setCurrent(model);
			}
		});
	});
	banhji.router.route('/bills/purchase/new', function(){	
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.purchase.init();
			banhji.billForm.addNew();
			banhji.billForm.get('current').set('type', 'purchase');
			banhji.billForm.getAccount();
			banhji.view.layout.showIn('#content', banhji.view.billPur);
   			banhji.purchase.itemDS.data([]);
			var po = $("#purchase_po").kendoDropDownList({
				dataSource: banhji.purchase.poDS,
				template: '<span>បញ្ជាទិញលេខ #:id#</span>',
				valueTemplate: '<span>បញ្ជាទិញលេខ #:id#</span>',
				dataTextField: "invoice_number",
				dataValueField: "id",
				height: 400,
				change: function(e) {
					var value = this.value();
					banhji.purchase.set('po', e.sender.dataSource.get(value));
					if(banhji.vendors.dataSource.get(banhji.purchase.get('po').vendor.id) === undefined ) {
						banhji.vendors.dataSource.query({
							filter: {field: 'id', operator: '', value: banhji.purchase.get('po').vendor.id},
							page: 1,
							pageSize: 1
						}).then(function(e){
							var model = banhji.vendors.dataSource.at(0);
							banhji.vendors.setCurrent(model);
						});
					} else {
						var model = banhji.vendors.dataSource.get(banhji.purchase.get('po').vendor.id);
						banhji.vendors.setCurrent(model);
					}
					banhji.purchase.itemDS.data([]);
					banhji.purchase.purchaseItem.query({
						filter: {field: 'bill_id', operator: '', value: banhji.purchase.get('po').id},
						page: 1,
						pageSize: 100
					}).then(function(e){
						var data = banhji.purchase.purchaseItem.data();
						for(var i=0; i < data.length; i++) {
							var number = banhji.purchase.itemDS.data().length + 1;
							banhji.purchase.itemDS.add({
								number: data[i].number,
								amount: data[i].amount,
								rate: data[i].rate,
								unit: data[i].unit,
								item: data[i].item,
								isTaxed: data[i].isTaxed,
								bill: null
							});
						}
						banhji.purchase.form.total();	
					});
					banhji.billForm.get('current').set("amount", banhji.purchase.get('po').amount);
					banhji.billForm.get('current').set("segment", banhji.purchase.get('po').segment);
					banhji.billForm.get('current').set("vendor", banhji.purchase.get('po').vendor);
				}
			}).data('kendoDropDownList');
			banhji.purchase.addItem();
			banhji.purchase.addItem();
		}
	});
	banhji.router.route('/bills/purchase/:id', function(id){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.purchase.init();
			// banhji.purchase.itemDS.data([]);
			banhji.billForm.getById(id).done(function(arg){
				banhji.billForm.setCurrent(arg);
				banhji.expense.getAccount();
				banhji.billForm.getAccount(arg);
				banhji.billForm.total();
			});	

			banhji.view.layout.showIn('#content', banhji.view.billPur);
			// banhji.view.billForm.showIn("#bill-form-list-container", banhji.view.billExp);
		}
	});
	banhji.router.route('/bills/expense/new', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.billForm.addNew();
			if(banhji.billForm.get('current').status === 'partial') {
				banhji.billForm.set('ribbon', "បង់បានខ្លះ");
				$('#expense-ribbon').addClass('primary');
			} else if(banhji.billForm.get('current').status === 'closed') {
				banhji.billForm.set('ribbon', "បង់ប្រាក់រួច");
				$('#expense-ribbon').removeClass('default');
				$('#expense-ribbon').addClass('primary');
			} else {
				banhji.billForm.set('ribbon', "ទទួល");
				$('#expense-ribbon').removeClass('default');
				$('#expense-ribbon').removeClass('primary');
				$('#expense-ribbon').addClass('warning');
			}
			banhji.billForm.get('current').set('type', 'expense');
			banhji.billForm.getAccount();
			banhji.expense.getAccount();
			banhji.billForm.getAccount().done(function(status){
				banhji.view.layout.showIn('#content', banhji.view.billExp);
				banhji.expense.addItem();
				banhji.expense.addItem();
				console.log(status);
			});				
		}
	});
	banhji.router.route('/bills/expense/:id', function(id){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {	
			banhji.billForm.getById(id).done(function(arg){
				banhji.billForm.setCurrent(arg);
			});	
			banhji.expense.getAccount();
			banhji.billForm.getAccount();		
			banhji.view.layout.showIn('#content', banhji.view.billExp);			
		}
	});
	banhji.router.route('/vendors/u/po', function(){
		var po = new kendo.View("#purchase-order-tmpl", {model: banhji.vm});
		
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.vm.init();
			banhji.vm.addNew();
			banhji.view.layout.showIn('#content', po);
			banhji.vm.addItem();
			banhji.vm.addItem();
		}
	});
	banhji.router.route('/vendors/u/po/:id', function(id){
		// instantiate layout and view
		var po = new kendo.View("#purchase-order-tmpl", {model: banhji.vm});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			var vendor, bill, that = this;
			banhji.vm.init();
			bill = banhji.vm.ds.get(id);
			if(bill === undefined) {
				banhji.vm.ds.query({
					filter:{ field: 'id', operator: '', value: id},
					page: 1,
					limit: 1
				}).done(function(e){
					banhji.vm.setCurrent(banhji.vm.ds.data()[0]);
					banhji.vm.itemDS.ds.query({
						filter:{field: 'bill_id', operator: '', value:banhji.vm.ds.data()[0].id},
						limit: 100,
						page: 1
					}).then(function(e){
						banhji.vm.total();
					});
				});
			} else {
				this.setCurrent(bill);
				this.itemDS.read();
			}
			banhji.view.layout.showIn('#content', po);
		}
	});
	banhji.router.route('/pocenter/:id/purchase', function(id){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.purchase.init();
			// banhji.billForm.addNew();
			// banhji.billForm.get('current').set('type', 'purchase');
			banhji.billForm.getAccount();
			banhji.view.layout.showIn('#content', banhji.view.billPur);
			banhji.purchase.addItem();
		}
	});
	banhji.router.route('/payment/vendor(/:id)', function(id){	
		var vendorPmtView = new kendo.View("#vendors-payment-template", {model: banhji.vendorPmt});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/manage');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.blank);
			$('#current-section').text(" | អ្នកផ្គត់ផ្គង");
			$("#secondary-menu").html("");
			banhji.view.layout.showIn('#content', vendorPmtView);
			if(id) {
				banhji.vendorPmt.set('vendorID', id);
			}
			// banhji.vendorPmt.billDS.query({
			// 	filter: [
			// 		{field: 'type <>', operator: '', value: 'po'},
			// 		{field: 'type <>', operator: '', value: 'grn'},
			// 		{field: 'status <>', operator: '', value: 'closed'}
			// 	],
			// 	page: 1,
			// 	pageSize: 100
			// }).then(function(e){
			// 	banhji.vendorPmt.set('tmp', []);
			// 	var data = banhji.vendorPmt.billDS.data();
			// 	$.each(data, function(i, v){
			// 		banhji.vendorPmt.get('tmp').push({
			// 			isPaid: false,
			// 			due : v.due_date,
			// 			vendor: {id: v.vendor.id, company: v.vendor.company},
			// 			invoice: v.invoice_number,
			// 			amountBilled: v.amount,
			// 			paid: v.paid,
			// 			amount: v.amount - v.paid,
			// 			bill: {id: v.id}
			// 		});
			// 	});
			// 	banhji.vendorPmt.calcTotal();
			// 	var today = new Date();
			// 	banhji.vendorPmt.payments.query({
			// 		filter: [
			// 			{field: 'type', value: 'bill'}
			// 		],
			// 		page: 1,
			// 		pageSize: 100
			// 	}).then(function(e){
			// 		// var data = banhji.vendorPmt.payments.data();
			// 		var invNumber = 0, invAmount = 0;
			// 		banhji.vendorPmt.set('pmtData', banhji.vendorPmt.payments.data()[0].results);
			// 		banhji.vendorPmt.set('tInvToday', banhji.vendorPmt.payments.data()[0].meta.num);
			// 		banhji.vendorPmt.set('tAmtToday', banhji.vendorPmt.payments.data()[0].meta.todayAmount);
			// 	});
			// });
		}
	});
	banhji.router.route('/vendor_payment_report', function(){
		var vendorPmtView = new kendo.View("#vendors-payment-report-template", {model: banhji.vendorPmt});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/manage');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.blank);
			$('#current-section').text(" | អ្នកផ្គត់ផ្គង");
			$("#secondary-menu").html("");
			banhji.vendorPmt.pmtDS.query({
				filter: [
					{field: 'type', value: 'purchase'},
					{field: 'type', operator: 'or', value: 'expense'}
				],
				page: 1,
				pageSize: 1
			});
			banhji.view.layout.showIn('#content', vendorPmtView);
		}
	});
	// account section
	banhji.router.route('/accounting_setting', function() {
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/manage');
		} else {			
			banhji.accountingSetting.inst.fetch(function(){
				banhji.accountingSetting.set('currentInstitute', banhji.accountingSetting.inst.data()[0]);
					if(banhji.accountingSetting.get('currentInstitute')) {
						banhji.view.layout.showIn('#menu', banhji.view.menu);
						banhji.view.menu.showIn('#secondary-menu', banhji.view.accounting_menu);
						$('#current-section').text(" | គណនេយ្យ");
						banhji.view.layout.showIn('#content', banhji.view.accounting_setting);
					} else {

					}
				});
		}
	});
	banhji.router.route('/currencies', function() {
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/manage');
		} else {			
			banhji.accountingSetting.inst.fetch(function(){
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.accounting_menu);
				$('#current-section').text("");
				banhji.view.layout.showIn('#content', banhji.view.currencyPage);
			});
		}
	});
	banhji.router.route('/accounting_dashboard', function() {
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/manage');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accounting_menu);
			$('#current-section').text("");
			banhji.accountingSetting.searchByDate();
			banhji.recurring.getCount();
			banhji.view.layout.showIn('#content', banhji.view.accountingDash);
			banhji.accountingSetting.getJournalCount();
			banhji.accountingSetting.getGraph();
		}	
	});
	banhji.router.route('/accounts(/:id)', function(id){
		// list all accounts
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/manage');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accounting_menu);
			// $('#current-section').text(" | គណនេយ្យ");
			banhji.accounting.init();
			banhji.view.layout.showIn('#content', banhji.view.accountDash);
		}
	});
	banhji.router.route('/accounts/u/new', function() {
		var accounting = kendo.observable({
			ds 			: dataStore(baseUrl + 'accounts'),
			coa 	 	: dataStore(baseUrl + 'accounts/coa'),
			types 		: dataStore(baseUrl + 'accounts/types'),
			accounting 	: banhji.accounting,
			edited 		: false,
			close 		: function() {
				window.history.back(-1);
				this.ds.cancelChanges();
			},
			onTypeChange: function(e) {
				var selected = e.sender._old;
				this.coa.filter({field: 'account_type_id', operator: '', value: selected});
				if(selected === "6") {
					this.set('showCash', true);
				} else {
					this.set('showCash', false);
				}
			},
			setCurrent 	: function(current) {
				accounting.set('current', current);
			},
			del 		: function() {},
			showCash 	: false,
			checkExist 	: function() {
				var existed = false;
				if(banhji.account.dataStore.data().length > 0) {
					$.each(banhji.account.dataStore.data(), function(i, v) {
						if(accounting.accounting.get('current').code === v.code) {
							existed = true;
							return false;
						} else if(accounting.accounting.get('current').name === v.name){
							existed = true;
							return false;
						} else if(accounting.accounting.get('current').name_en === v.name_en){
							existed = true;
							return false;
						}
					});
				}
				return existed;
			},
			saveClose 	: function() {
				var validator = $("#account-new-form").kendoValidator().data('kendoValidator');
				if(validator.validate()) {
					var self = this;
					// if(this.checkExist()) {
						alert("សូមពិនិត្យឡើងវិញ ទិន្ន័យមានរួចហើយ");
					// } else {
						this.accounting.accounts.dataStore.sync();
						this.accounting.accounts.dataStore.bind('requestEnd', function(e){
							if(e.response.error === false) {
								self.close();
							} else {
								alert("សូមពិនិត្យឡើងវិញ");
							}	
						});
					// }		
				} else {
					console.log('saveClose');
				}	
			},
			save 		: function() {
				var validator = $("#account-new-form").kendoValidator().data('kendoValidator');
				if(validator.validate()) {
					// if(this.checkExist()) {
					// 	alert("សូមពិនិត្យឡើងវិញ ទិន្ន័យមានរួចហើយ");
					// } else {
						this.accounting.accounts.dataStore.sync();
						this.accounting.accounts.dataStore.bind("requestEnd", function(e){
							var res = e.response;
							if(res.results.length > 0) {
								// $("#notification").data('kendoNotification').info("កត់ត្រាបានសំរេច");
								accounting.accountings.account.dataStore.insert(0,{
									type: null,
									parentAccount: null,
									code: null,
									name: null,
									name_en: null,
									description: null
								});
								alert("កត់ត្រាបានសំរេច");
								accounting.accounting.setCurrent(accounting.accounting.accounts.dataStore.at(0));
							}
						});
					// }
				} else {
					console.log('dlkfjdslf');
				}
			}
		});
		var accountPage = new kendo.View("#accounting-page-template", {model: accounting});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', accountPage);	
			banhji.account.dataStore.add({				
				type: null,
				parentAccount: null,
				code: null,
				name: null,
				name_en: null,
				description: null
			});

			accounting.accounting.setCurrent(banhji.account.dataStore.at(banhji.account.dataStore.data().length - 1));
		}	
	});
	banhji.router.route('/accounts/u/edit', function() {
		var accounting = kendo.observable({
			ds 			: dataStore(baseUrl + 'accounts'),
			coa 	 	: dataStore(baseUrl + 'accounts/coa'),
			types 		: dataStore(baseUrl + 'accounts/types'),
			accounting 	: banhji.accounting,
			close 		: function() {
				window.history.back(-1);
				if(banhji.account.dataStore.hasChanges()) {
					banhji.account.dataStore.cancelChanges();
				}
				this.ds.cancelChanges();
			},
			edited 		: true,
			onTypeChange: function(e) {
				var selected = e.sender._old;
				this.coa.filter({field: 'account_type_id', operator: '', value: selected});
				if(selected === "6") {
					this.set('showCash', true);
				} else {
					this.set('showCash', false);
				}
			},
			setCurrent 	: function(current) {
				accounting.set('current', current);
			},
			showCash 	: false,
			del 		: function() {
				var del = confirm("តើអ្នកពិតជាចង់លុបគណនីនេះមែនទេ?");
				if(del) {
					this.accounting.accounts.dataStore.remove(this.accounting.get('current'));
					this.saveClose();
				}				
			},
			checkExist 	: function() {
				var existed = false;
				if(this.accounting.accounts.dataStore.data().length > 0) {
					$.each(this.accounting.accounts.dataStore.data(), function(i, v) {
						if(banhji.accounting.get('current').code === v.code) {
							existed = true;
							return false;
						} else if(banhji.accounting.get('current').name === v.name){
							existed = true;
							return false;
						} else if(banhji.accounting.get('current').name_en === v.name_en){
							existed = true;
							return false;
						}
					});
				}
				return existed;
			},
			saveClose 	: function() {
				var validator = $("#account-new-form").kendoValidator().data('kendoValidator');
				if(validator.validate()) {
					var self = this;
					if(this.checkExist()) {
						banhji.accounting.accounts.dataStore.cancelChanges();
						var d = banhji.account.dataStore.get(banhji.accounting.get('current').id);
						banhji.accounting.get('current').set('code', d.code);
						banhji.accounting.get('current').set('name', d.name);
						banhji.accounting.get('current').set('name_e', d.name_e);
						alert("សូមពិនិត្យឡើងវិញ ទិន្ន័យមានរួចហើយ");
					} else {
						this.accounting.accounts.dataStore.sync();
						this.accounting.accounts.dataStore.bind('requestEnd', function(e){
							if(e.response.error === false) {
								self.close();
							} else {
								alert("សូមពិនិត្យឡើងវិញ");
							}	
						});
					}		
				} else {
					console.log('saveClose');
				}	
			},
			save 		: function() {
				var validator = $("#account-new-form").kendoValidator().data('kendoValidator');
				if(validator.validate()) {
					if(this.checkExist()) {
						alert("សូមពិនិត្យឡើងវិញ ទិន្ន័យមានរួចហើយ");
					} else {
						this.accounting.accounts.dataStore.sync();
						this.accounting.accounts.dataStore.bind("requestEnd", function(e){
							var res = e.response;
							if(res.results.length > 0) {
								// $("#notification").data('kendoNotification').info("កត់ត្រាបានសំរេច");
								accounting.accountings.account.dataStore.insert(0,{
									type: null,
									parentAccount: null,
									code: null,
									name: null,
									name_en: null,
									description: null
								});
								alert("កត់ត្រាបានសំរេច");
								accounting.accounting.setCurrent(accounting.accounting.accounts.dataStore.at(0));
							}
						});
					}
				} else {
					console.log('dlkfjdslf');
				}
			}
		});
		var accountPage = new kendo.View("#accounting-page-template", {model: accounting});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			// accounting.init();
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', accountPage);
			if(accounting.accounting.get('current')) {
				// accounting.accounting.setCurrent('current', {
				// 	type: banhji.accounting.get('current').type,
				// 	parentAccount: banhji.accounting.get('current').parentAccount,
				// 	code: banhji.accounting.get('current').code,
				// 	name: banhji.accounting.get('current').name,
				// 	name_en: banhji.accounting.get('current').name_en,
				// 	description: banhji.accounting.get('current').description
				// });
			}
		}	
	});
	banhji.router.route('/accounts/u/listItem', function(){
		var view = new kendo.View('#accountingItem-template', {model: banhji.accountingItem});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/manage');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);

			$('#current-section').text(" | គណនេយ្យ");
			$("#secondary-menu").html("");
			banhji.view.layout.showIn('#content', view);
			banhji.accountingItem.dataSource.query({
				filter: {field: 'item_type_id', operator: '', value: 5},
				page: 1,
				pageSize: 100
			});
			
		}	
	});
	banhji.router.route('/accounts/u/gl', function() {
		var gl = new kendo.View("#journal-account-tmpl", {model: banhji.gl});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			// banhji.gl.init();
			if(banhji.gl.get('accountList').length === 0) {
				banhji.account.dataStore.query({
					filter: {field: 'active', operator: '', value: true},
					page: 1,
					pageSize: 500
				}).done(function(e){
					banhji.gl.set('accountList', banhji.account.dataStore.data());
				});
				console.log("check 2");
			}
			if(banhji.gl.get('classDS').length === 0) {
				banhji.gl.segments.query({
					page 	: 1,
					pageSize: 500
				}).done(function(e){
					// $.each(banhji.gl.segments.data(), function(i, v) {
						banhji.gl.set('classDS', banhji.gl.segments.data());
					// });
				}).fail(function(e){
					console.log(e);
				});
			}
			banhji.gl.add();
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', gl);
			banhji.gl.addEntry();
			banhji.gl.addEntry();
		}	
	});
	banhji.router.route('/accounts/u/gl(/:id)', function(id){
		var gl = new kendo.View("#journal-account-tmpl", {model: banhji.gl});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			// banhji.gl.init();
			if(banhji.gl.get('accountList').length === 0) {
				banhji.account.dataStore.query({
					filter: {field: 'active', operator: '', value: true},
					page: 1,
					pageSize: 500
				}).done(function(e){
					banhji.gl.set('accountList', banhji.account.dataStore.data());
				});
			}
			if(banhji.gl.get('classDS').length === 0) {
				banhji.gl.segments.query({
					page 	: 1,
					pageSize: 500
				}).done(function(e){
					// $.each(banhji.gl.segments.data(), function(i, v) {
						banhji.gl.set('classDS', banhji.gl.segments.data());
					// });
				}).fail(function(e){
					console.log(e);
				});
			}
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', gl);
			banhji.gl.entry.dataStore.query({
				filter: {field: 'id', operator: '', value: id},
				page: 1,
				pageSize: 1
			}).done(function(e){
				banhji.gl.setCurrent(banhji.gl.entry.dataStore.data()[0]);
				for(var i = 0; i < banhji.gl.entry.dataStore.data()[0].entries.length; i++) {
					banhji.gl.entries.push(banhji.gl.entry.dataStore.data()[0].entries[i]);
				}
			});
		}	
	});
	banhji.router.route('/trial_balance', function(){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/manage');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accounting_menu);
			// $('#current-section').text(" | គណនេយ្យ");
			
			banhji.view.layout.showIn('#content', banhji.view.trialBalanceView);
		}	
	});	
	banhji.router.route('/cashier/dashboard', function(){
		var cashier = new kendo.View("#cashier-tmpl", { model: banhji.cashiers.page });
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			// $('#current-section').text(" | បេឡាករ");
			banhji.view.menu.showIn('#secondary-menu', banhji.view.blank);
			banhji.view.layout.showIn('#content', cashier);
			banhji.cashiers.deposit.init();
			banhji.cashiers.transfer.init();
			banhji.cashiers.deposit.addJournal();
			banhji.cashiers.deposit.addEntry();
		}
	});
	banhji.router.route('/cashier/u/deposit', function(){
		var deposit = new kendo.View("#cashier-deposit-tmpl", {model: banhji.cashiers.deposit});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.cashiers.deposit.init();
			banhji.cashiers.deposit.addJournal();
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', deposit);
			banhji.cashiers.deposit.addEntry();
		}	
	});
	banhji.router.route('/cashier/u/transfer', function(){
		var transfer = new kendo.View("#cashier-transfer-tmpl", {model: banhji.cashiers.transfer});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.cashiers.transfer.init();
			banhji.cashiers.transfer.addJournal();
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', transfer);
			banhji.cashiers.transfer.addEntry();
		}	
	});
	banhji.router.route('/vendors/u/grn', function(){
		banhji.grn.init();
		var form = new kendo.View("#grn-form-template", {model:banhji.grn});
		banhji.grn.addNew();
		banhji.view.layout.showIn('#content', form);
		banhji.grn.itemDS.data([]);
		banhji.grn.addItem();
		banhji.grn.addItem();
	});
	banhji.router.route('/vendors/u/grn/:id', function(id){
		banhji.grn.init();
		var form = new kendo.View("#grn-form-template", {model:banhji.grn});
		banhji.billDS.query({
			filter: {field: "id", operator: '', value: id}
		}).done(function(e){
			var po = banhji.billDS.data();
			banhji.grn.setCurrent(po[0]);
			banhji.grn.itemDS.query({
				filter: {field: 'bill_id', operator:'', value: id}
			}).done(function(e){
				var data = banhji.grn.itemDS.data();
				banhji.grn.itemDS.data([]);
				$.each(data, function(index, value){
					banhji.grn.itemDS.add({
						number: value.number,
						amount: value.amount,
						rate: value.rate,
						unit: value.unit,
						unitReceipt: value.unitReceipt,
						item: value.item,
						isTaxed: value.isTaxed,
						balance: value.unit - value.unitReceipt,
						bill: value.bill
					})
				});
				banhji.grn.total();
			});
		});
		// banhji.grn.addNew();
		banhji.view.layout.showIn('#content', form);
		banhji.grn.itemDS.data([]);
	});
	banhji.router.route('/pocenter', function(){
		var view = new kendo.View("#test-template", {model: banhji.po});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', view);
			banhji.billForm.ds.filter([
				{field: 'type', operator: '', value: 'po'},
				{field: 'status !=', operator: '', value: 'closed'},
				{field: 'deleted', operator: '', value: 'false'}
			]);
		}
	});	
	banhji.router.route('/purchase/:id/po', function(id){
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.purchase.init();
			var data = banhji.po.billVM.ds.get(id);
			banhji.po.setCurrent(data);
			banhji.purchase.set('po', data);
			if(banhji.vendors.dataSource.data().length === 0) {
				banhji.vendors.dataSource.query({
					filter: {field: 'id', operator: '', value: data.vendor.id}
				}).done(function(e){
					var data = banhji.vendors.dataSource.at(0);
					banhji.billForm.get('current').set('vendor', data);
				});
			}
			banhji.billForm.ds.insert(0,{
				type 			: "purchase",
				invoice_number 	: data.invoice_number,
				account 		: null,
				amount 			: data.amount,
				taxAmount		: data.taxAmount,
				paid 			: data.paid,
				status 			: 'open',
				notice 			: data.notice,
				comment 		: data.comment,
				internal_notice	: data.internal_notice,
				due_date 		: new Date(),
				expected_date 	: new Date(),
				payment_term 	: 0,
				segment 		: data.segment,
				address 		: data.address,
				delivery_address: data.delivery_address,
				voucher  		: data.voucher,
				paidCash 		: true,
				vendor 			: data.vendor
			});
			banhji.billForm.setCurrent(banhji.billForm.ds.at(0));
			banhji.billForm.getAccount();
			banhji.view.layout.showIn('#content', banhji.view.billPur);
   			banhji.purchase.itemDS.data([]);
			var po = $("#purchase_po").kendoDropDownList({
				dataSource: banhji.purchase.poDS,
				template: '<span>បញ្ជាទិញលេខ #:id#</span>',
				valueTemplate: '<span>បញ្ជាទិញលេខ #:id#</span>',
				dataTextField: "invoice_number",
				dataValueField: "id",
				height: 400,
				change: function(e) {
					var value = this.value();
					banhji.purchase.set('po', e.sender.dataSource.get(value));
					if(banhji.vendors.dataSource.get(banhji.purchase.get('po').vendor.id) === undefined ) {
						banhji.vendors.dataSource.query({
							filter: {field: 'id', operator: '', value: banhji.purchase.get('po').vendor.id},
							page: 1,
							pageSize: 1
						}).then(function(e){
							var model = banhji.vendors.dataSource.at(0);
							banhji.vendors.setCurrent(model);
						});
					} else {
						var model = banhji.vendors.dataSource.get(banhji.purchase.get('po').vendor.id);
						banhji.vendors.setCurrent(model);
					}
					banhji.purchase.itemDS.data([]);
					banhji.purchase.purchaseItem.query({
						filter: {field: 'bill_id', operator: '', value: banhji.purchase.get('po').id},
						page: 1,
						pageSize: 100
					}).then(function(e){
						var data = banhji.purchase.purchaseItem.data();
						for(var i=0; i < data.length; i++) {
							var number = banhji.purchase.itemDS.data().length + 1;
							banhji.purchase.itemDS.add({
								number: data[i].number,
								amount: data[i].amount,
								rate: data[i].rate,
								unit: data[i].unit,
								item: data[i].item,
								isTaxed: data[i].isTaxed,
								bill: null
							});
						}
						banhji.purchase.form.total();	
					});
					banhji.billForm.get('current').set("amount", banhji.purchase.get('po').amount);
					banhji.billForm.get('current').set("segment", banhji.purchase.get('po').segment);
					banhji.billForm.get('current').set("vendor", banhji.purchase.get('po').vendor);
				}
			}).data('kendoDropDownList');
			po.value(banhji.po.get('current').id);
			banhji.po.itemDS.query({
				filter: {field: 'bill_id', operator: '', value: data.id}
			}).done(function(e){
				var data = banhji.po.itemDS.data();
				$.each(data, function(index, value){
					banhji.purchase.itemDS.add({
						number: value.number,
						amount: value.amount,
						rate: value.rate,
						unit: value.unit,
						item: value.item,
						isTaxed: value.isTaxed,
						bill: null
					});
				});
			});
		}
	});
	banhji.router.route('/purchase_return', function(){
		banhji.purchaseReturn = kendo.observable({
			ds 		: dataStore(baseUrl + 'bills'),
			accounts: dataStore(baseUrl + "accounts"),
			journal : dataStore(baseUrl + 'journals'),
			jEntry 	: dataStore(baseUrl + 'journals/entries'),
			classDS : banhji.segmentItem.ds,
			items 	: dataStore(baseUrl + 'items'),
			itemDS 	: banhji.itemVM.ds,
			itemRec : dataStore(baseUrl + 'items/records'),
			keyword : '',
			status 	: null,
			isOpen 	: true,
			hasData : false,
			prData 	: [],
			useCash : true,
			cashAC 	: null,
			apAcct 	: null,
			setCurrent: function(current) {
				this.set('current', current);
			},
			check 	: function(e) {
				if(e.data.back > e.data.unit) {
					e.data.set('back', e.data.unit);
				}
			},
			search 	: function() {
				if(this.get('keyword') !== "") {
					this.ds.query({
						filter: {field: 'invoice_number', operator: '', value: this.get('keyword')}
					}).done(function(e){
						var data = banhji.purchaseReturn.ds.data()[0];
						if(data) {
							banhji.purchaseReturn.setCurrent(data);
							if(data.status === 'open') {
								banhji.purchaseReturn.set('isOpen', true);
								banhji.purchaseReturn.set('status', 'មិនទានបង់រួច');
							} else {
								banhji.purchaseReturn.set('isOpen', false);
								banhji.purchaseReturn.set('status', 'បង់រួច');
							}
							banhji.purchaseReturn.itemDS.query({
								filter: {field: 'bill_id', operator: '', value: data.id}
							}).done(function(e){
								banhji.purchaseReturn.prData.splice(0,banhji.purchaseReturn.prData.length);
								$.each(banhji.purchaseReturn.itemDS.data(), function(index, value){
									banhji.purchaseReturn.prData.push({
										item: value.item,
										unit: value.unit,
										cost: value.amount/value.unit,
										total: value.amount,
										back: value.unit,
										isTaxed: value.isTaxed
									});
								});
							});
							banhji.purchaseReturn.set('hasData', true);
							if(banhji.vendors.dataSource.get(banhji.purchaseReturn.get('current').vendor.id)) {
								this.set('apAcct', banhji.vendors.dataSource.get(banhji.purchaseReturn.get('current').vendor.id).ap);
							} else {
								banhji.vendors.dataSource.query({
									filter: {field: 'id', operator: '', value: banhji.purchaseReturn.get('current').vendor.id}
								}).done(function(e){
									var data = banhji.vendors.dataSource.data()[0];
									banhji.purchaseReturn.set('apAcct', data.ap);
								});
							}
						} else {
							banhji.purchaseReturn.set('hasData', false);
						}
					});
				} else {
					console.log('not good');
				}	
			},
			refund 	: function() {
				this.set('useCash', true);
				if(this.get('prData').length > 0) {
					$.each(this.get('prData'), function(index, value){
						banhji.itemRec.add({
							amount: value.cost, 
							unit: value.unit,
							is_in: false,
							item: value.item
						});
					});
				}
				this.itemRec.sync();
				this.itemRec.bind("requestEnd", function(e){
					var res = e.response;
					var amount = 0;
					if(res.results.length() > 0) {
						var entries = [];
						for(var x = 0; x < res.results.length(); x++) {
							var itemAccounts= banhji.itemDS.get(res.results[x].item.id);
							var inventoryAC = null;
							for(var y = 0; y < itemAccounts.accounts.length; y++) {
								if(itemAccounts.accounts[y].type === 'inventory') {
									inventoryAC = itemAccounts.accounts[y];
									break;
								}
							}
							if(entries.length > 0) {
								$.each(entries, function(index, value){
									if(value.account === inventoryAC) {
										entries[index].amount += res.results[x].amount;
									} else {
										entries.push({
											amount  : res.results[x].amount,
											memo 	: 'return items for bill id '+ banhji.purchaseReturn.get('current').id,
											is_debit: false,
											account : inventoryAC,
											rate 	: 1,
											locale 	: 'km-KH',
											contact : banhji.purchaseReturn.get('current').vendor
										});
									}
								});
							} else {
								entries.push({
									amount  : res.results[x].amount,
									memo 	: 'return items for bill id '+ banhji.purchaseReturn.get('current').id,
									is_debit: false,
									account : inventoryAC,
									rate 	: 1,
									locale 	: 'km-KH',
									contact : banhji.purchaseReturn.get('current').vendor
								});
							}
							amount += res.results[x].amount;
								
						}
						entries.push({
							amount  : amount,
							memo 	: 'return items for bill id '+ banhji.purchaseReturn.get('current').id,
							is_debit: true,
							account : banhji.purchaseReturn.get('cashAC'),
							rate 	: 1,
							locale 	: 'km-KH',
							contact : banhji.purchaseReturn.get('current').vendor
						});
						banhji.journalEntry.addNew({
							reference: res.data[0],
							type: 'purchase return',
							memo: 'purchase return for bill id ' + res.data[0].id,
							conatact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
							entries: entries
						});
						banhji.journalEntry.save();
					}
				});
			},
			offset 	: function() {
				this.set('useCash', false);
				if(this.get('prData').length > 0) {
					$.each(this.get('prData'), function(index, value){
						banhji.itemRec.add({
							amount: value.cost, 
							unit: value.unit,
							is_in: false,
							item: value.item
						});
					});
				}
				this.itemRec.sync();
				this.itemRec.bind("requestEnd", function(e){
					var res = e.response;
					if(res.results.length() > 0) {
						var entries = [];
						var ap = null;
						for(var x = 0; x < res.results.length(); x++) {
							var itemAccounts= banhji.itemDS.get(res.results[x].item.id);
							var inventoryAC = null;
							for(var x = 0; x < res.results.length(); x++) {
								var itemAccounts= banhji.itemDS.get(res.results[x].item.id);
								var inventoryAC = null;
								for(var y = 0; y < itemAccounts.accounts.length; y++) {
									if(itemAccounts.accounts[y].type === 'inventory') {
										inventoryAC = itemAccounts.accounts[y];
										break;
									}
								}
								if(entries.length > 0) {
									$.each(entries, function(index, value){
										if(value.account === inventoryAC) {
											entries[index].amount += res.results[x].amount;
										} else {
											entries.push({
												amount  : res.results[x].amount,
												memo 	: 'return items for bill id '+ banhji.purchaseReturn.get('current').id,
												is_debit: false,
												account : inventoryAC,
												rate 	: 1,
												locale 	: 'km-KH',
												contact : banhji.purchaseReturn.get('current').vendor
											});
										}
									});
								} else {
									entries.push({
										amount  : res.results[x].amount,
										memo 	: 'return items for bill id '+ banhji.purchaseReturn.get('current').id,
										is_debit: false,
										account : inventoryAC,
										rate 	: 1,
										locale 	: 'km-KH',
										contact : banhji.purchaseReturn.get('current').vendor
									});
								}
								amount += res.results[x].amount;		
							}
							entries.push({
								amount  : banhji.purchaseReturn.get('current').amount,
								memo 	: 'purchase-'+res.data[0].id,
								is_debit: true,
								account : banhji.purchaseReturn.get('apAcct'),
								rate 	: 1,
								locale 	: 'km-KH',
								contact : banhji.purchaseReturn.get('current').vendor
							});
						}
						
						banhji.journalEntry.addNew({
							reference: res.data[0],
							type: 'purchase return',
							memo: 'purchase return for bill id ' + res.data[0].id,
							conatact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
							entries: entries
						});
						banhji.journalEntry.save();
					}
				});
			},
			test 	: function() {
				return this.get('apAcct');
			},
			save 	: function() {
				if(this.get('current').status === 'open') {
					// got the journal
					this.journal.query({
						filter: [
							{field: 'reference', operator: '', value: this.get('current').id},
							{field: 'type', opertor: '', value: 'purchase'}
						],
						page: 1,
						pageSize: 1
					}).done(function(e){
						var journal = banhji.purchaseReturn.journal.data();
						// check if this is partial return or full item return
						// got the journal entry
						banhji.purchaseReturn.jEntry.query({
							filter: {field: 'id', operator: '', value: journal[0].id},
							page: 1,
							pageSize: 10
						}).done(function(e){
							var data = banhji.purchaseReturn.jEntry.data();
							// real computing here
							var entries = [];
							var amount = 0;
							
							$.each(banhji.get('prData'), function(i, v){
								var item = banhji.purchaseReturn.items.get(v.item.it);
								amount += v.back * v.cost;
								if(entries.length > 0) {
									$.each(entries, function(index, value){
										var account = null;
										$.each(item.accounts, function(x, va){
											if(va.type === "inventory") {
												account = va;
											}
										});
										if(value.account === account) {
											value.amount += v.back * v.cost;
										} else {
											entries.push({
												amount  : v.back * v.cost,
												memo 	: 'purchase return for purchase id '+ banhji.purchaseReturn.get('current').id,
												is_debit: false,
												account : account,
												rate 	: 1,
												locale 	: 'km-KH',
												contact : banhji.vendors.get('current')
											});
										}
									});
								} else {
									var account = null;
									$.each(item.accounts, function(x, va){
										if(va.type === "inventory") {
											account = va;
										}
									});
									entries.push({
										amount  : v.back * v.cost,
										memo 	: 'purchase return for purchase id '+ banhji.purchaseReturn.get('current').id,
										is_debit: false,
										account : account,
										rate 	: 1,
										locale 	: 'km-KH',
										contact : banhji.vendors.get('current')
									});
								}
							});
							$.each(data, function(index, value){
								if(value.is_debit === 'false') {
									entries.push({
										amount  : amount,
										memo 	: 'purchase return for purchase id '+ banhji.purchaseReturn.get('current').id,
										is_debit: true,
										account : inventoryAC,
										rate 	: 1,
										locale 	: 'km-KH',
										contact : banhji.vendors.get('current')
									});
									return false;
								}
							});
							banhji.journalEntry.addNew({
								reference: banhji.purchaseReturn.get('current').id,
								type: 'purchase return',
								memo: 'purchase return id-' + banhji.purchaseReturn.get('current').id,
								conatact: {id: banhji.userManagement.getLogin().id, name: banhji.userManagement.getLogin().username},
								entries: entries
							});
							return banhji.journalEntry.save();
						}).done(function(data){
							if(this.get('prData').length > 0) {
								$.each(this.get('prData'), function(index, value){
									banhji.purchaseReturn.itemRec.add({
										amount: value.cost, 
										unit: value.unit,
										is_in: false,
										item: value.item
									});
								});
								banhji.purchaseReturn.itemRec.sync();
								banhji.purchaseReturn.itemRec.bind('requestEnd', function(e){
									banhji.purchaseReturn.set('hasData', false);
								});
							}
						});
					});
				} else {
					console.log('closed');
				}
				
			}
		});
		var pr = new kendo.View("#purchase-return-template", {model: banhji.purchaseReturn});
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.purchaseReturn.accounts.filter({field: 'account_type_id', operator: '', value: 6});
			banhji.purchaseReturn.items.filter({field: 'category_id', operator: '', value: 1});
			banhji.view.layout.showIn('#content', pr);
		}
	});
	banhji.router.route('/journalReport', function(){
		// list all accounts
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			$('#current-section').text(" | របាយការណ៍");
			$("#secondary-menu").html("");
			banhji.view.layout.showIn('#content', banhji.view.journalReView);
			banhji.report.journal.query({
				filter: [
					{field: 'created_at >=', operator: '', value: kendo.toString(banhji.report.get('startDate'), 'yyyy-MM-dd')},
					{field: 'created_at <=', operator: '', value: kendo.toString(banhji.report.get('endDate'), 'yyyy-MM-dd')}
				],
				page: 1,
				pageSize: 200
			}).done(function(e){
				var damount = 0, camount = 0;
				if(banhji.report.journal.data().length > 0) {
					for( var i = 0; i < banhji.report.journal.data().length; i++) {
						if(banhji.report.journal.data()[i].entries.length> 0) {
							for( var x = 0; x < banhji.report.journal.data()[i].entries.length; x++) {
								// console.log(banhji.report.journal.data()[i].entries[x].amount);
								if(banhji.report.journal.data()[i].entries[x].is_debit === 'false') {
									camount += kendo.parseFloat(banhji.report.journal.data()[i].entries[x].amount);
								} else {
									damount += kendo.parseFloat(banhji.report.journal.data()[i].entries[x].amount);
								}
							}
						}
					}
				}
				banhji.report.set('jDebit', kendo.toString(damount, 'c3'));
				banhji.report.set('jCredit', kendo.toString(camount, 'c3'));
			});				
		}	
	});
	banhji.router.route('/glReport', function(){
		// list all accounts
		if(!banhji.userManagement.getLogin()) {
			banhji.router.navigate('/login');
		} else {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			$('#current-section').text(" | របាយការណ៍");
			$("#secondary-menu").html("");
			banhji.view.layout.showIn('#content', banhji.view.glReView);
			banhji.report.gl.query({
				filter: [
					{field: 'created_at >=', operator: '', value: kendo.toString(banhji.report.get('startDate'), 'yyyy-MM-dd')},
					{field: 'created_at <=', operator: '', value: kendo.toString(banhji.report.get('endDate'), 'yyyy-MM-dd')}
				],
				page: 1,
				pageSize: 200
			}).done(function(e){
				var damount = 0, camount = 0;
				if(banhji.report.gl.data().length > 0) {
					for( var i = 0; i < banhji.report.gl.data().length; i++) {
						if(banhji.report.gl.data()[i].entries.length> 0) {
							for( var x = 0; x < banhji.report.journal.data()[i].entries.length; x++) {
								// console.log(banhji.report.journal.data()[i].entries[x].amount);
								if(banhji.report.gl.data()[i].entries[x].is_debit === 'false') {
									camount += kendo.parseFloat(banhji.report.gl.data()[i].entries[x].amount);
								} else {
									damount += kendo.parseFloat(banhji.report.gl.data()[i].entries[x].amount);
								}
							}
						}
					}
				}
				banhji.report.set('jDebit', kendo.toString(damount, 'c3'));
				banhji.report.set('jCredit', kendo.toString(camount, 'c3'));
			});				
		}	
	});
	banhji.router.route('/manage', function(){
		banhji.view.layout.showIn('#menu', banhji.view.blank);
		$('#current-section').text("");
		$("#secondary-menu").html("");
		banhji.view.layout.showIn('#content', banhji.view.loginView);
	});
	banhji.router.route('/no-page', function(){
		if(getDB() === null) {
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.layout.showIn('#content', banhji.view.page);	
		} else {
			banhji.router.navigate('/')
		}		
	});
	banhji.router.route('/page', function(){
		banhji.view.layout.showIn('#menu', banhji.view.menu);	
		banhji.view.layout.showIn('#content', banhji.view.pageAdmin);	
	});	
	banhji.router.route('/create_company', function(){
		var view = new kendo.View("#create-company-template", {model: banhji.userManagement});
		$('#createComMessage').text("");
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		banhji.userManagement.addInst();
		banhji.view.layout.showIn('#content', view);			
	});
	banhji.router.route('/page/companyInfo', function(){
		var view = new kendo.View("#create-company-template", {model: banhji.userManagement});
		$('#createComMessage').text("");
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		banhji.userManagement.inst.query({
			filter: {field: 'id', operator: '', value: banhji.userManagement.getLogin().institute[0].id},
			pageSize: 1,
			page: 1
		}).then(function(e){
			var data = banhji.userManagement.inst.data()[0];
			banhji.userManagement.setInstitute(data);
		});
		banhji.view.layout.showIn('#content', view);				
	});
	banhji.router.route('/page/companyLogo', function(){
		var view = new kendo.View("#page-admin-comany-logo-template", {model: banhji.userManagement});
		$('#createComMessage').text("");
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		banhji.userManagement.inst.query({
			filter: {field: 'id', operator: '', value: banhji.userManagement.getLogin().institute[0].id},
			pageSize: 1,
			page: 1
		}).then(function(e){
			var data = banhji.userManagement.inst.data()[0];
			banhji.userManagement.setInstitute(data);
		});
		banhji.view.layout.showIn('#content', view);			
	});
	banhji.router.route('/page/userlist', function(){
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		// if(banhji.userManagement.getLogin().perm.length > 0) {
		// 	if(banhji.userManagement.getLogin().perm[0].id === "1") {
				banhji.view.layout.showIn('#content', banhji.view.pageAdmin);
				banhji.view.pageAdmin.showIn('#col2', banhji.view.userListView);
		// 	}
		// }		
	});
	banhji.router.route('/page/password', function(){
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		banhji.view.layout.showIn('#content', banhji.view.passwordView);
		banhji.userManagement.pwdDS.add({
			username: banhji.userManagement.getLogin().username,
			password: banhji.userManagement.get('password')
		});		
	});

	banhji.employee = kendo.observable({
		dataSource 	: dataStore(baseUrl + 'employees'),
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		add 		: function() {	
			this.dataSource.insert(0, {
				surname: null,
				name: null,
				department: null,
				position: null,
				role_id: null,
			});
			this.setCurrent(this.dataSource.at(0));
			banhji.view.pageAdmin.showIn('#col2', employeeForm);
		},
		edit 		: function(e) {
			banhji.view.pageAdmin.showIn('#col2', employeeForm);
			this.setCurrent(e.data);
			// console.log(e.data);
		},
		cancel 		: function() {
			this.dataSource.cancelChanges();
			banhji.view.pageAdmin.showIn('#col2', employeeView);
		},
		remove 		: function(e) {
			this.dataSource.remove(e.data);
			this.save();
		},
		save 		: function() {
			this.dataSource.sync();
			this.dataSource.bind('requestEnd', function(e){
				var type = e.type, res = e.response;
				if(type === 'create' && res.results.length > 0) {
					alert('created');
				} else if(type === 'update') {
					alert('updated');
				} else if(type === 'destroy') {
					alert('deleted');
				}
				banhji.view.pageAdmin.showIn('#col2', employeeView);
			});
		}
	});
	var employeeView = new kendo.View('#employee-template', {model: banhji.employee});
	var employeeForm = new kendo.View("#employee-form-template", {model: banhji.employee});
	banhji.router.route('/page/employee', function(){
		banhji.view.layout.showIn('#content', banhji.view.pageAdmin);
		banhji.view.pageAdmin.showIn('#col2', employeeView);
		banhji.employee.dataSource.query({
			filter: {field: 'deleted', operator: '', value: 'false'},
			page: 1,
			pageSize: 100
		});
	});

	banhji.router.route('/app/:userid', function(userid){
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		console.log('app ' + userid);
	});

	//DAWINE -----------------------------------------------------------------------------------------	
	/*************************
	* Accounting Section   *
	**************************/
	banhji.router.route("/currency_rate", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.currencyRate);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.currencyRate;
			
			if(banhji.pageLoaded["currency_rate"]==undefined){
				banhji.pageLoaded["currency_rate"] = true;

				var currency = $("#cbbCurrency").kendoComboBox({
                    dataTextField: "code",
                    dataValueField: "id",
                    height: 400,
                    template:"#=code# - #=country#",
                    dataSource: {
                    	transport: {
							read 	: {
								url: baseUrl+"currencies",
								type: "GET",
								headers: {
									"Entity": getDB(),
									"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
								},
								dataType: 'json'
							}							
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},						
						group: { field: "group" },						
						page: 1,						
						take: 100
                    }
                }).data("kendoComboBox");

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":								
						sdate = today;
															  					
					  	break;
					case "week":			  	
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));						
						
					  	break;
					case "month":							  	
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":				
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
											  
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();                	
                });

                start.max(end.value());
                end.min(start.value());				

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],
		        	currency_id = currency.value(), 
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){        		
		            	para.push({ field:"date >=", value: sdate });
		            	para.push({ field:"date <=", value: edate });            	          	            	
		            }else if(start.value()){
		            	para.push({ field:"date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"date <=", value: edate });
		            }else{
		            	
		            }

		            if(currency_id){
		            	para.push({ field:"currency_id", value: currency_id }); 
		            }         

		            vm.dataSource.filter(para);		            
		        });
			}

			vm.pageLoad();			
		}		
	});

	/*************************
	*   Vendor Section   *
	**************************/
	banhji.router.route("/vendor_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.vendorCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.vendorMenu);
			
			var vm = banhji.vendorCenter;

			if(banhji.pageLoaded["vendor_center"]==undefined){
				banhji.pageLoaded["vendor_center"] = true;
				
				vm.sorterChanges();				
				vm.contactTypeDS.filter({ field:"parent_id", value:2 });
				
				vm.contactDS.query({
				  	filter:{ field:"parent_id", operator:"where_related", model:"contact_type", value:2 },
				  	page: 1,
				  	take: 50
				}).then(function(e) {
				    var view = vm.contactDS.data();
				    
				    if(view.length>0){
				    	vm.set("obj", view[0]);
				    	vm.loadGraph(view[0].id);
				    	vm.loadSummary(view[0].id);
				    	vm.loadTransaction(view[0].id);				    	
				    	vm.loadNote(view[0].id);
				    }
				});				               
			}				
		}
	});
	banhji.router.route("/vendor(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{			
			var vm = banhji.vendor;
			vm.pageLoad(id);
			
			banhji.view.layout.showIn("#content", banhji.view.vendor);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			if(banhji.pageLoaded["vendor"]==undefined){
				banhji.pageLoaded["vendor"] = true;				

		        vm.contactTypeDS.filter({ field:"parent_id", value: 2 });
		        vm.apDS.filter({ field:"account_type_id", value: 13 });
		        vm.discountDS.filter({ field:"account_type_id", operator:"where_in", value: [21,22] });
		        vm.prepaymentDS.filter({ field:"account_type_id", value: 9 });

		        $("#ddlTaxItem").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "items/item",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"item_type_id", value: 6 }
					},
					template: '#=sku# #=name#'             
		        }).data("kendoDropDownList");		       		         

		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){					
		        	e.preventDefault();					

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});	        	
			}			
		}				
	});
	banhji.router.route("/po(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.po);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.po;
			
			if(banhji.pageLoaded["po"]==undefined){
				banhji.pageLoaded["po"] = true;				
								
				vm.setItem();						
				vm.vatDS.filter({ field:"item_type_id", value: 6 });            

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}		
	});
	banhji.router.route("/grn(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.grn);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.grn;
			
			if(banhji.pageLoaded["grn"]==undefined){
				banhji.pageLoaded["grn"] = true;				
								
				vm.setItem();				         

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}	
	});
	banhji.router.route("/purchase(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.purchase);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.purchase;
			
			if(banhji.pageLoaded["purchase"]==undefined){
				banhji.pageLoaded["purchase"] = true;				
								
				vm.setItem();						
				vm.vatDS.filter({ field:"item_type_id", value: 6 });
				vm.cashAccountDS.filter({ field:"account_type_id", value: 6 });            

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}		
	});	
	banhji.router.route("/vendor_setting", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.vendorSetting);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.vendorMenu);

			var vm = banhji.vendorSetting;
			
			if(banhji.pageLoaded["vendor_setting"]==undefined){
				banhji.pageLoaded["vendor_setting"] = true;

				vm.contactTypeDS.filter({ field:"parent_id", value: 2 });
			}

			vm.pageLoad();			     		
		}
	});


	/*************************
	*   SME Section   *
	**************************/
	banhji.router.route("/customers", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.customerCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);
			
			var vm = banhji.customerCenter;

			if(banhji.pageLoaded["customers"]==undefined){
				banhji.pageLoaded["customers"] = true;
				
				vm.sorterChanges();				
				vm.contactTypeDS.filter({ field:"parent_id", value:1 });
				
				vm.contactDS.query({
				  	filter:{ field:"parent_id", operator:"where_related", model:"contact_type", value:1 },
				  	page: 1,
				  	take: 50
				}).then(function(e) {
				    var view = vm.contactDS.data();
				    
				    if(view.length>0){
				    	vm.set("obj", view[0]);
				    	vm.loadGraph(view[0].id);
				    	vm.loadOutStandingInvoice(view[0].id);
				    	vm.loadTransaction(view[0].id);				    	
				    	vm.loadNote(view[0].id);
				    }
				});				               
			}				
		}
	});
	banhji.router.route("/customer(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{			
			var vm = banhji.customer;
						
			banhji.view.layout.showIn("#content", banhji.view.customer);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			if(banhji.pageLoaded["customer"]==undefined){
				banhji.pageLoaded["customer"] = true;				

		        $("#ddlCustomerType").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "contacts/type",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"parent_id", value: 1 }
					},
					change: function(e){
		            	var value = this.value(); 

	                	if(value=="6" || value=="7" || value=="8"){
	                		vm.set("isCompany", true);
	                	}else{
	                		vm.set("isCompany", false);
	                	}
		            }                
		        }).data("kendoDropDownList");

		        $("#ddlTaxItem").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "items/item",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"item_type_id", value: 6 }
					},
					template: '#=sku# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlAR").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 7 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlRA").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 20 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlDepositAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 16 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlDiscountAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value:21 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");		        

		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();				

					if(validator.validate() && vm.get("isDuplicateNumber")==false){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});	        	
			}

			vm.pageLoad(id);			
		}				
	});
	banhji.router.route("/invoice(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.invoice);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.invoice;
			
			if(banhji.pageLoaded["invoice"]==undefined){
				banhji.pageLoaded["invoice"] = true;				
								
				vm.setItem();						
				vm.vatDS.filter({ field:"item_type_id", value: 6 });            

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}		
	});
	banhji.router.route("/receipt(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.receipt);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.receipt;
			
			if(banhji.pageLoaded["receipt"]==undefined){
				banhji.pageLoaded["receipt"] = true;				
								
				vm.setItem();						
				vm.vatDS.filter({ field:"item_type_id", value: 6 });
				vm.cashAccountDS.filter({ field:"account_type_id", value: 6 });            

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}		
	});
	banhji.router.route("/so(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.so);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.so;
			
			if(banhji.pageLoaded["so"]==undefined){
				banhji.pageLoaded["so"] = true;				
								
				vm.setItem();						
				vm.vatDS.filter({ field:"item_type_id", value: 6 });				         

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}	
	});
	banhji.router.route("/estimate(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.estimate);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.estimate;
			
			if(banhji.pageLoaded["estimate"]==undefined){
				banhji.pageLoaded["estimate"] = true;				
								
				vm.setItem();						
				vm.vatDS.filter({ field:"item_type_id", value: 6 });            

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}	
	});
	banhji.router.route("/gdn(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.gdn);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.gdn;
			
			if(banhji.pageLoaded["gdn"]==undefined){
				banhji.pageLoaded["gdn"] = true;				
								
				vm.setItem();				         

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}	
	});
	banhji.router.route("/statement(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{			

			banhji.view.layout.showIn("#content", banhji.view.statement);					
			
			var vm = banhji.statement;

			if(banhji.pageLoaded["statement"]==undefined){
				banhji.pageLoaded["statement"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":								
						sdate = today;
															  					
					  	break;
					case "week":			  	
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));						
						
					  	break;
					case "month":							  	
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":				
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
											  
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();                	
                });

                start.max(end.value());
                end.min(start.value());
								
				$("#gridAging").kendoGrid({
					autoBind: false,		            		            		           
		            dataSource: vm.agingDS,		           
		            resizable: true,
		            columns: [		                		                	                
		                { field: "amount", title:"Current", template:'#=kendo.toString(current, locale=="km-KH"?"c0":"c", locale)#', attributes:{style:"text-align:right;"} },		                
		                { field: "oneMonth", title:"1-30", template:'#=kendo.toString(oneMonth, locale=="km-KH"?"c0":"c", locale)#', attributes:{style:"text-align:right;"} },
		                { field: "twoMonth", title:"31-60", template:'#=kendo.toString(twoMonth, locale=="km-KH"?"c0":"c", locale)#', attributes:{style:"text-align:right;"} },		                
		                { field: "threeMonth", title:"61-90", template:'#=kendo.toString(threeMonth, locale=="km-KH"?"c0":"c", locale)#', attributes:{style:"text-align:right;"} },
		                { field: "overMonth", title:">90", template:'#=kendo.toString(overMonth, locale=="km-KH"?"c0":"c", locale)#', attributes:{style:"text-align:right;"} },		                
		                { field: "amount", title:"Total", template:'#=kendo.toString(amount, locale=="km-KH"?"c0":"c", locale)#', attributes:{style:"text-align:right;"} }
		            ]
		        });

		        $("#grid").kendoGrid({
		            toolbar: ["excel"],
		            excel: {
		                fileName: "statement.xlsx"
		            },		            		           
		            dataSource: vm.dataSource,
		            autoBind:false,		            		           		                        
		            reorderable: true,
		            resizable: true,
		            rowTemplate: kendo.template($("#statement-row-template").html())
		            // columns: [		                
		            //     { field: "issued_date", title: "Date" },
		            //     { field: "description", title: "Description" },		                
		            //     { field: "amount", title:"Amount", template:'#=kendo.toString(amount, locale=="km-KH"?"c0":"c", locale)#', attributes:{style:"text-align:right;"} },		                
		            //     { field: "balance", title:"Balance", attributes:{style:"text-align:right;"}, template:kendo.template($("#statement-balance-template").html()) },
		            // ]
		        });

		        $("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [], 
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){        		
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });            	          	            	
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            para.push({ field:"contact_id", value: vm.obj.id });          

		            vm.dataSource.filter(para);
		            vm.agingDS.filter(para);
		            vm.agingDS.bind("requestEnd", function(e){
		            	if(e.type=="read"){
		            		var response = e.response.results;
		            		vm.set("total", kendo.toString(response[0].amount), "c");
		            	}
		            });
		        });		       			
			}

			vm.pageLoad(id);
		}		
	});
	banhji.router.route("/customer_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.customerReportCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

			//var vm = banhji.customerReportCenter;			
			
			if(banhji.pageLoaded["customer_report_center"]==undefined){
				banhji.pageLoaded["customer_report_center"] = true;				
								
			}			
		}		
	});
	banhji.router.route("/customer_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.customerList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

			var vm = banhji.customerList;			
			
			if(banhji.pageLoaded["customer_list"]==undefined){
				banhji.pageLoaded["customer_list"] = true;				
				
				vm.contactTypeDS.filter({ field:"parent_id", value:1 });
				vm.dataSource.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });

				$("#grid").kendoGrid({
				    dataSource: vm.dataSource,
				    toolbar: ["excel"],
		            excel: {
		                fileName: "Customer_List.xlsx",
		                filterable: true
		            },
		            reorderable: true,
				    groupable: true,
				    sortable: true,				    				    
				    pageable: true,				    
				    columns:[
				    	{ field: "number", title:"Number" },
				    	{ field: "surname", title:"Surname" },
				    	{ field: "name", title:"Name" },
				    	{ field: "contact_type", title:"Type" }
				    ]				    
				});
			}			
		}		
	});
	banhji.router.route("/customer_setting", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.customerSetting);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

			var vm = banhji.customerSetting;
			
			if(banhji.pageLoaded["customer_setting"]==undefined){
				banhji.pageLoaded["customer_setting"] = true;

				vm.contactTypeDS.filter({ field:"parent_id", value: 1 });
			}

			vm.pageLoad();			     		
		}
	});


	/*************************
	*   Cashier Section   *
	**************************/
	banhji.router.route("/cashier(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashier);				
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.cashier;
						
			if(banhji.pageLoaded["cashier"]==undefined){
				banhji.pageLoaded["cashier"] = true;
				
				$("#ddlContact").kendoComboBox({
					placeholder: "លេខកូដអតិថិជន...",
					valuePrimitive: true,
	                dataTextField: "fullname",
	                dataValueField: "id",
	                filter: "search",
	                autoBind: false,
	                minLength: 3,
	                height: 400,
	                dataSource: vm.contactDS,
	                change: function(e) {
					    var value = this.value(),					    
					    data = this.dataSource.get(value);

					    vm.set("customer", data);
					    vm.transactionDS.filter({ field:"contact_id", value: value });
					    vm.loadInvoice(value, data.fullname);					    				    	
					},
					template:'#=number# #=fullname#'
	            });	           

		        $("#ddlCashAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 6 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});        		
			}

			vm.pageLoad(id);
		}							
	});
	banhji.router.route("/reconcile(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.reconcile);				
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.reconcile;
			vm.pageLoad(id);
			
			if(banhji.pageLoaded["reconcile"]==undefined){
				banhji.pageLoaded["reconcile"] = true;

				$("#ddlCashAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 6 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate() && vm.get("isExisting")==false && vm.get("obj").transfered_amount>0){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}
		}					
	});


	/*************************
	*   Inventory Section   *
	**************************/
	banhji.router.route("/inventories", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.itemDashBoard);			
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);
			
			var vm = banhji.itemDashBoard;

			if(banhji.pageLoaded["inventories"]==undefined){							
				banhji.pageLoaded["inventories"] = true;
												
			}

			vm.pageLoad();
		}				
	});	
	banhji.router.route("/item_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.itemCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);
			
			var vm = banhji.itemCenter;

			if(banhji.pageLoaded["item_center"]==undefined){
				banhji.pageLoaded["item_center"] = true;
				
				vm.sorterChanges();				
								
				vm.itemDS.query({
				  	filter:{ field:"item_type_id", value:1 },
				  	page: 1,
				  	take: 100
				}).then(function(){
					var view = vm.itemDS.view();
					vm.set("obj", view[0]);
					vm.loadMovement(view[0].id);
				});				               
			}				
		}
	});
	banhji.router.route("/item(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.item;
			
			banhji.view.layout.showIn("#content", banhji.view.item);						
			
			if(banhji.pageLoaded["item"]==undefined){
				banhji.pageLoaded["item"] = true;				

				vm.loadVendor();
				vm.loadCustomer();

				var categories = $("#categories").kendoDropDownList({
                    optionLabel: "(--- Category ---)",
                    valuePrimitive: true,
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.categoryDS,
                    change: function(e) {
					    //var value = this.value();
					    vm.set("item_group_id", 0);
					}
                }).data("kendoDropDownList");

                var itemGroups = $("#itemGroups").kendoDropDownList({
                	optionLabel: "(--- Group ---)",
                	valuePrimitive: true,
                    autoBind: false,
                    cascadeFrom: "categories",
                    cascadeFromField: "category_id",                    
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.itemGroupDS
                }).data("kendoDropDownList");				

				$("#ddlIncome").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",		            
		            template: '#=code# #=name#',
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 20 }
					}
		        }).data("kendoDropDownList");

		        $("#ddlCogs").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            template: '#=code# #=name#',
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 21 }
					}		            
		        }).data("kendoDropDownList");

		        $("#ddlInventory").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            template: '#=code# #=name#',
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 8 }
					}
		        }).data("kendoDropDownList");

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);	
		}
	});
	banhji.router.route("/price_list/:id", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{			
			var vm = banhji.priceList;
			
			banhji.view.layout.showIn("#content", banhji.view.priceList);
			
			if(banhji.pageLoaded["price_list"]==undefined){
				banhji.pageLoaded["price_list"] = true;
				
			}

			vm.pageLoad(id);				
		}
	});
	banhji.router.route("/item_catalog(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.itemCatalog;
			
			banhji.view.layout.showIn("#content", banhji.view.itemCatalog);						
			
			if(banhji.pageLoaded["item_catalog"]==undefined){
				banhji.pageLoaded["item_catalog"] = true;

				vm.itemDS.filter([
					{ field:"item_type_id", operator:"where_in", value: [1,4] }
				]);

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);	
		}
	});
	banhji.router.route("/item_assembly(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.itemAssembly;
			
			banhji.view.layout.showIn("#content", banhji.view.itemAssembly);						
			
			if(banhji.pageLoaded["item_assembly"]==undefined){
				banhji.pageLoaded["item_assembly"] = true;

				vm.itemDS.filter([
					{ field:"item_type_id", operator:"where_in", value: [1,4] },
					{ field:"category_id", operator:"where_not_in", value: [8,9] }
				]);

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);	
		}
	});
	banhji.router.route("/item_record(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{		
			var vm = banhji.itemRecord;
			banhji.view.layout.showIn("#content", banhji.view.itemRecord);
			
			if(banhji.pageLoaded["item_record"]==undefined){
				banhji.pageLoaded["item_record"] = true;

				vm.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});	            
			}

			vm.pageLoad(id);				
		}
	});
	banhji.router.route("/item_adjustment(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.itemAdjustment);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.itemAdjustment;

			if(banhji.pageLoaded["item_adjustment"]==undefined){
				banhji.pageLoaded["item_adjustment"] = true;
								
				vm.contactDS.filter({ field:"contact_type_id", value:3 });

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);
		}		
	});
	banhji.router.route("/item_setting", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.itemSetting);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.itemSetting;
			
			if(banhji.pageLoaded["item_setting"]==undefined){
				banhji.pageLoaded["item_setting"] = true;
				
				vm.subCategoryDS.filter({ field:"sub_of", value: 0 });
				vm.subItemGroupDS.filter({ field:"sub_of", value: 0 });
				vm.subBrandDS.filter({ field:"sub_of", value: 0 });
			}

			vm.pageLoad();			     		
		}
	});
	banhji.router.route("/item_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.itemReportCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			//var vm = banhji.itemReportCenter;			
			
			if(banhji.pageLoaded["item_report_center"]==undefined){
				banhji.pageLoaded["item_report_center"] = true;				
											
			}			
		}		
	});
	banhji.router.route("/inventory_position_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryPositionSummary);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryPositionSummary;			
			
			if(banhji.pageLoaded["inventory_position_summary"]==undefined){
				banhji.pageLoaded["inventory_position_summary"] = true;				
				
			}			
		}		
	});
	banhji.router.route("/inventory_position_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryPositionDetail);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryPositionDetail;			
			
			if(banhji.pageLoaded["inventory_position_detail"]==undefined){
				banhji.pageLoaded["inventory_position_detail"] = true;				
								
			}			
		}		
	});
	banhji.router.route("/inventory_sale_by_item", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventorySaleByItem);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventorySaleByItem;			
			
			if(banhji.pageLoaded["inventory_sale_by_item"]==undefined){
				banhji.pageLoaded["inventory_sale_by_item"] = true;				
				
			}			
		}		
	});
	banhji.router.route("/inventory_turnover_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryTurnoverList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryTurnoverList;			
			
			if(banhji.pageLoaded["inventory_turnover_list"]==undefined){
				banhji.pageLoaded["inventory_turnover_list"] = true;				
				
			}			
		}		
	});
	banhji.router.route("/inventory_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);
			
			var vm = banhji.inventoryList;						
			
			if(banhji.pageLoaded["inventory_list"]==undefined){
				banhji.pageLoaded["inventory_list"] = true;

				vm.vendorDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value: 2 });

				var categories = $("#categories").kendoDropDownList({
                    optionLabel: "(--- Category ---)",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.categoryDS,
                    change: function(e) {
					    //var value = this.value();
					    vm.set("item_group_id", 0);
					}
                }).data("kendoDropDownList");

                var itemGroups = $("#itemGroups").kendoDropDownList({
                    autoBind: false,
                    cascadeFrom: "categories",
                    cascadeFromField: "category_id",
                    optionLabel: "(--- Group ---)",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.itemGroupDS
                }).data("kendoDropDownList");
			}

			vm.pageLoad();				
		}
	});
	banhji.router.route("/inventory_movement_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryMovementSummary);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryMovementSummary;			
			
			if(banhji.pageLoaded["inventory_movement_summary"]==undefined){
				banhji.pageLoaded["inventory_movement_summary"] = true;				
				
			}			
		}		
	});
	banhji.router.route("/inventory_movement_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryMovementDetail);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryMovementDetail;			
			
			if(banhji.pageLoaded["inventory_movement_detail"]==undefined){
				banhji.pageLoaded["inventory_movement_detail"] = true;				
				
			}			
		}		
	});
	banhji.router.route("/inventory_purchase_by_vendor_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryPurchaseByVendorSummary);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryPurchaseByVendorSummary;			
			
			if(banhji.pageLoaded["inventory_purchase_by_vendor_summary"]==undefined){
				banhji.pageLoaded["inventory_purchase_by_vendor_summary"] = true;				
				
			}			
		}		
	});
	banhji.router.route("/inventory_purchase_by_vendor_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryPurchaseByVendorDetail);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryPurchaseByVendorDetail;			
			
			if(banhji.pageLoaded["inventory_purchase_by_vendor_detail"]==undefined){
				banhji.pageLoaded["inventory_purchase_by_vendor_detail"] = true;				
				
			}			
		}		
	});


	/*************************
	*   Electricity Section   *
	**************************/
	banhji.router.route("/electricity", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.eDashBoard;
			
			banhji.view.layout.showIn("#content", banhji.view.eDashBoard);
			$("#secondary-menu").html("<li><a href='\#/electricity' class='glyphicons home'><i></i></a></li> <li><a href='\#/customer'>អតិថិជនថ្មី</a></li> <li><a href='\#/meter/1'>Meter</a></li> <li><a href='\#/reading/1'>Reading</a></li> <li><a href='\#/uInvoice/1'>វិក្កយបត្រ</a></li> <li><a href='\#/uInvoice_print/1'>Printវិក្កយបត្រ</a></li> <li><a href='\#/cashier'>បេឡាករ</a></li> ");			
					
			vm.pageLoad();		

			if(banhji.pageLoaded["electricity"]==undefined){							
				banhji.pageLoaded["electricity"] = true;

				vm.sorterChanges();
				vm.search();

				var monthlyDS = new kendo.data.DataSource({
					transport: {
						read 	: {
							url: baseUrl + 'invoices/emonthly',
							type: "GET",
							headers: {
								"Entity": getDB(),
								"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
							},
							dataType: 'json'
						},
						parameterMap: function(options, operation) {
							if(operation === 'read') {
								return {
									limit: options.take,
									page: options.page,
									filter: options.filter
								};
							}
						}
					},
					schema 	: {
						data: 'results',
						total: 'count'
					},
					group: {
						field: 'issued_date',
						aggregates: [
							{field: 'amount', aggregate: 'sum'}
						]
					},
					batch: true,
					serverFiltering: true,
					serverPaging: true,
					pageSize: 1000
				});				 
        		
        		monthlyDS.fetch(function(e){				
					$('#esale-graph').kendoChart({
						dataSource: {data: monthlyDS.data()},
						series: [
							{field: 'amount', categoryField: 'issued_date'}
						]
					});
				});				
			}
		}				
	});	
	banhji.router.route("/meter/:utility_id", function(utility_id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			var vm = banhji.meter;
			
			if(utility_id=="1"){
				banhji.view.layout.showIn("#content", banhji.view.eMeter);
			}else{
				banhji.view.layout.showIn("#content", banhji.view.wMeter);
			}					
			kendo.fx($("#slide-form")).slideIn("down").play();
			
			vm.pageLoad(utility_id);		

			if(banhji.pageLoaded["meter"+utility_id]==undefined){							
				banhji.pageLoaded["meter"+utility_id] = true;

				var location = $("#location").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            autoBind: false,
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",			            
		            dataSource: vm.locationDS
		        }).data("kendoDropDownList");

				if(utility_id=="1"){
					$("#electricityBox").kendoDropDownList({
			        	optionLabel: "(--- Select ---)",
			        	autoBind: false,
			        	valuePrimitive: true,
			        	cascadeFrom: "location",
			        	cascadeFromField: "location_id",	            	            
			            dataTextField: "number",
			            dataValueField: "id",	            
			            dataSource: vm.electricityBoxDS
			        }).data("kendoDropDownList");
		        }								

				$("#customers").kendoComboBox({
					placeholder: "លេខកូដអតិថិជន...",
	                dataTextField: "fullIdName",
	                dataValueField: "id",
	                filter: "search",
	                autoBind: false,
	                minLength: 3,
	                height: 400,
	                dataSource: vm.contactDS,
	                change: function(e){
	                	var value = this.value();                		
	                	var data = this.dataSource.get(value);				
						
						vm.set("meter", null);
						vm.set("contact_id", data.id);
						vm.set("company_id", data.company_id);
						vm.loadMeter(value);
						vm.loadData(data.company_id);				
	                }
	            });

	            $("#meters").kendoComboBox({
					placeholder: "លេខកូដកុងទ័រ...",
	                dataTextField: "number",
	                dataValueField: "id",
	                filter: "startswith",
	                autoBind: false,
	                minLength: 3,
	                height: 400,
	                dataSource: vm.meterDS,
	                change: function(e){
	                	var value = this.value();                		
	                	var data = this.dataSource.get(value);				
						
						vm.set("meter", null);
						vm.set("contact_id", data.contact_id);
						vm.set("company_id", data.company_id);
						vm.loadMeter(data.contact_id);
						vm.loadData(data.company_id);				
	                }
	            });		        

		        var validator = $("#example").kendoValidator().data("kendoValidator"),
				status = $("#status");

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();     	

			            status.text("Saveបានសំរេច")
				        	.removeClass("alert alert-error")
				        	.addClass("alert alert-success");
				        status.show();
				        setTimeout(function(){
							status.hide();
						},4000);
			        }else{		        	
			            status.text("សូមត្រួតពិនិត្រឪ្យបានត្រឹមត្រូវម្ដងទៀត")
			                .removeClass("alert alert-success")
				            .addClass("alert alert-error");
			        }		            
				});	        	
			}			
		}				
	});		
	banhji.router.route("/reading/:utility_id", function(utility_id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{		
			var vm = banhji.reading;
			vm.pageLoad(utility_id);			

			if(utility_id=="1"){
				banhji.view.layout.showIn("#content", banhji.view.eReading);
			}else{
				banhji.view.layout.showIn("#content", banhji.view.wReading);
			}

			if(banhji.pageLoaded["reading"+utility_id]==undefined){
				banhji.pageLoaded["reading"+utility_id] = true;

				$("#pager").kendoPager({
	                dataSource: vm.dataSource
	            });

	            $("#meters").kendoComboBox({
					placeholder: "លេខកូដកុងទ័រ...",
					valuePrimitive: true,
	                dataTextField: "number",
	                dataValueField: "id",
	                filter: "startswith",
	                autoBind: false,
	                minLength: 3,
	                height: 400,
	                dataSource: vm.meterDS
	            });

	            var company = $("#company").kendoDropDownList({
		            optionLabel: "(--- License ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: vm.branchDS
		        }).data("kendoDropDownList");

	            if(utility_id=="1"){
			        var elocation = $("#elocation").kendoDropDownList({
			        	optionLabel: "(--- Location ---)",
		                autoBind: false,
		                cascadeFrom: "company",
		                cascadeFromField: "company_id",
		                valuePrimitive: true,                
		                dataTextField: "name",
		                dataValueField: "id",
		                dataSource: vm.elocationDS
		            }).data("kendoDropDownList");
		    	}else{
		            var wlocation = $("#wlocation").kendoDropDownList({
			        	optionLabel: "(--- Location ---)",
		                autoBind: false,
		                cascadeFrom: "company",
		                cascadeFromField: "company_id",
		                valuePrimitive: true,                
		                dataTextField: "name",
		                dataValueField: "id",
		                dataSource: vm.wlocationDS
		            }).data("kendoDropDownList");						
				}

				var validator = $("#example").kendoValidator({
					rules: {
				        greaterdate: function (input) {
		                    if (input.is("[data-greaterdate-msg]") && input.val() != "") {                                    
		                        var edate = kendo.parseDate(input.val()),
		                            sdate = kendo.parseDate($("[name='" + input.data("greaterdateField") + "']").val());
		                        return sdate == null || sdate.getTime() < edate.getTime();
		                    }
		                    return true;
		                }               
				    }
				}).data("kendoValidator"), status = $("#status");

				$("#save").click(function(e){
					e.preventDefault();
					
		            if(validator.validate() && vm.checkInput()){
		            	vm.save();

			            status.text("Saveបានសំរេច")
				        	.removeClass("alert alert-error")
				        	.addClass("alert alert-success");
				        status.show();
				        setTimeout(function(){
							status.hide();
						},4000);
			        }else{
			        	status.show();		        	        	
			            status.text("សូមត្រួតពិនិត្រឪ្យបានត្រឹមត្រូវម្ដងទៀត")
			                .removeClass("alert alert-success")
				            .addClass("alert alert-error");
			        }
				});
			}
		}		
	});
	banhji.router.route("/uInvoice/:utility_id", function(utility_id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{					
			var vm = banhji.uInvoice;

			if(utility_id=="1"){
				banhji.view.layout.showIn("#content", banhji.view.eInvoice);
			}else{
				banhji.view.layout.showIn("#content", banhji.view.wInvoice);
			}

			vm.pageLoad(utility_id);
			
			if(banhji.pageLoaded["uInvoice"+utility_id]==undefined){
				banhji.pageLoaded["uInvoice"+utility_id] = true;			

				$("#meters").kendoComboBox({
					placeholder: "លេខកូដកុងទ័រ...",
					valuePrimitive: true,
	                dataTextField: "number",
	                dataValueField: "id",
	                filter: "startswith",
	                autoBind: false,
	                minLength: 3,
	                height: 400,
	                dataSource: vm.meterDS
	            });

	            $("#pager").kendoPager({
	                dataSource: vm.readingDS
	            });

				var company = $("#company").kendoDropDownList({
		            optionLabel: "(--- License ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: vm.branchDS
		        }).data("kendoDropDownList");

				if(utility_id=="1"){
			        var elocation = $("#elocation").kendoDropDownList({
			        	optionLabel: "(--- Location ---)",
		                autoBind: false,
		                cascadeFrom: "company",
		                cascadeFromField: "company_id",
		                valuePrimitive: true,                
		                dataTextField: "name",
		                dataValueField: "id",
		                dataSource: vm.elocationDS
		            }).data("kendoDropDownList");
		    	}else{
		            var wlocation = $("#wlocation").kendoDropDownList({
			        	optionLabel: "(--- Location ---)",
		                autoBind: false,
		                cascadeFrom: "company",
		                cascadeFromField: "company_id",
		                valuePrimitive: true,                
		                dataTextField: "name",
		                dataValueField: "id",
		                dataSource: vm.wlocationDS
		            }).data("kendoDropDownList");						
				}
		        
				var validator = $("#example").kendoValidator().data("kendoValidator"),
					status = $("#status");						

				$("#save").click(function(e){
					e.preventDefault();			
					
		            if(validator.validate()){	            	            	
		            	vm.save();
						
			            status.text("Saveបានសំរេច")
				        	.removeClass("alert alert-error")
				        	.addClass("alert alert-success");
				        status.show();
				        setTimeout(function(){
							status.hide();
						},4000);				        
			        }else{
			        	status.show();		        	
			            status.text("សូមត្រួតពិនិត្រឪ្យបានត្រឹមត្រូវម្ដងទៀត")
			                .removeClass("alert alert-success")
				            .addClass("alert alert-error");
			        }
				});
			}
		}		
	});
	banhji.router.route("/uInvoice_print/:utility_id(/:id)", function(utility_id, id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{			
			var vm = banhji.invoicePrint;
			vm.pageLoad(utility_id, id);

			if(utility_id=="1"){
				banhji.view.layout.showIn("#content", banhji.view.eInvoicePrint);
			}else{				
				banhji.view.layout.showIn("#content", banhji.view.wInvoicePrint);
			}			
			
			if(banhji.pageLoaded["uInvoice_print"+utility_id]==undefined){
				banhji.pageLoaded["uInvoice_print"+utility_id] = true;

				$("#pager").kendoPager({
	                dataSource: vm.dataSource
	            });
				
				$("#invoices").kendoComboBox({
					placeholder: "Number...",
					valuePrimitive: true,
	                dataTextField: "number",
	                dataValueField: "id",
	                filter: "startswith",
	                autoBind: false,
	                minLength: 3,
	                height: 400,
	                dataSource: vm.invoiceDS,
	                change: function(e) {
					    var value = this.value();
					    vm.dataSource.query({
					    	filter: { field:"id", value: value }
					    }).then(function(e){
					    	vm.barcod();					    				    	
					    });
					}
	            });

				var company = $("#company").kendoDropDownList({
		            optionLabel: "(--- License ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: vm.branchDS
		        }).data("kendoDropDownList");

		        if(utility_id=="1"){
			        var elocation = $("#elocation").kendoDropDownList({
			        	optionLabel: "(--- Location ---)",
		                autoBind: false,
		                cascadeFrom: "company",
		                cascadeFromField: "company_id",
		                valuePrimitive: true,                
		                dataTextField: "name",
		                dataValueField: "id",
		                dataSource: vm.elocationDS
		            }).data("kendoDropDownList");
		    	}else{
		            var wlocation = $("#wlocation").kendoDropDownList({
			        	optionLabel: "(--- Location ---)",
		                autoBind: false,
		                cascadeFrom: "company",
		                cascadeFromField: "company_id",
		                valuePrimitive: true,                
		                dataTextField: "name",
		                dataValueField: "id",
		                dataSource: vm.wlocationDS
		            }).data("kendoDropDownList");						
				}			
			}
		}							
	});


	/*************************
	*   Water Section   *
	**************************/
	banhji.router.route("/water", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wDashBoard);			
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			
			var vm = banhji.wDashBoard;

			if(banhji.pageLoaded["water"]==undefined){							
				banhji.pageLoaded["water"] = true;

				vm.sorterChanges();
				vm.search();

				var container = $("#employeeForm");
                kendo.init(container);
                container.kendoValidator({
                    rules: {
                        greaterdate: function (input) {
                            if (input.is("[data-greaterdate-msg]") && input.val() != "") {                                    
                                var date = kendo.parseDate(input.val()),
                                    otherDate = kendo.parseDate($("[name='" + input.data("greaterdateField") + "']").val());
                                return otherDate == null || otherDate.getTime() < date.getTime();
                            }

                            return true;
                        }
                    }
                });

                var validator = $("#employeeForm").data("kendoValidator");
                validator.validate();                       

				var monthlyDS = new kendo.data.DataSource({
					transport: {
						read 	: {
							url: baseUrl + 'invoices/wmonthly',
							type: "GET",
							headers: {
								"Entity": getDB(),
								"User": banhji.userManagement.getLogin() === null ? '':banhji.userManagement.getLogin().id
							},
							dataType: 'json'
						},
						parameterMap: function(options, operation) {
							if(operation === 'read') {
								return {
									limit: options.take,
									page: options.page,
									filter: options.filter
								};
							}
						}
					},
					schema 	: {
						data: 'results',
						total: 'count'
					},
					group: {
						field: 'month',
						aggregates: [
							{field: 'amount', aggregate: 'sum'},
							{field: 'usage', aggregate: 'sum'}
						]
					},
					batch: true,
					serverFiltering: true,
					serverPaging: true,
					pageSize: 1000
				});				 
        		
        		monthlyDS.fetch(function(e){				
					$('#wsale-graph').kendoChart({
						dataSource: {data: monthlyDS.data()},												
						series: [
							{field: 'amount', categoryField:'month', type: 'line', axis: 'sale'},
							{field: 'usage', categoryField:'month', type: 'column', axis: 'usage'}
						],
						valueAxes: [
							{
			                    name: "sale",
			                    color: "#007eff",
			                    min: 0,
			                    majorUnit: 5000000,
			                    max: 50000000
			                }, 
			                {
			                    name: "usage",
			                    color: "#3399ff",
			                    min: 0,	
			                    majorUnit: 5000,		                   
			                    max: 50000
			                }
		                ],
		                categoryAxis: {
		                    //categories: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],		                    
		                    axisCrossingValues: [0, 13],
		                    justified: true
		                },
		                tooltip: {
		                    visible: true,
		                    format: "{0}"
		                }

					});
				});		
			}

			vm.pageLoad();
		}				
	});
	banhji.router.route("/wCustomer_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wCustomerCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wCustomerCenter;

			if(banhji.pageLoaded["wCustomer_center"]==undefined){
				banhji.pageLoaded["wCustomer_center"] = true;
				
				vm.sorterChanges();			
				vm.branchDS.filter({ field:"utility_id", value:2 });
				vm.contactTypeDS.filter({ field:"parent_id", value:1 });
								
				vm.contactDS.query({
				  	filter:[
				  		{ field:"use_water", value:1 },
				  		{ field:"parent_id", operator:"where_related", model:"contact_type", value:1 }
				  	],
				  	page: 1,
				  	take: 50
				}).then(function(e) {
				    var view = vm.contactDS.data();
				    
				    if(view.length>0){
				    	vm.set("obj", view[0]);
				    	vm.loadGraph(view[0].id);
				    	vm.loadOutStandingInvoice(view[0].id);
				    	vm.loadTransaction(view[0].id);
				    	vm.loadMeter(view[0].id);
				    	vm.loadNote(view[0].id);
				    }
				});							

				//Search
				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: "true",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.branchDS,
                    change: function(e) {
					    vm.set("location_id", null);					    
					}
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: "true",
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.locationDS
                }).data("kendoDropDownList");                
			}				
		}
	});
	banhji.router.route("/wNew_customer", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{			
			var vm = banhji.wNewCustomer;
			
			banhji.view.layout.showIn("#content", banhji.view.wNewCustomer);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			if(banhji.pageLoaded["wNew_customer"]==undefined){
				banhji.pageLoaded["wNew_customer"] = true;

				vm.dataSource.filter([
					{ field:"parent_id", model:"contact_type", operator:"where_related", value:1 },
					{ field:"use_water", value:0 },
					{ field:"status", value:1 }
				]);

				vm.branchDS.filter({ field:"utility_id", value: 2 });

				var ddlBranch = $("#ddlBranch").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            autoBind: false,
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: vm.branchDS          
		        }).data("kendoDropDownList");

		        var ddlLocation = $("#ddlLocation").kendoDropDownList({
		        	optionLabel: "(--- Select ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.locationDS
                }).data("kendoDropDownList");
		        
		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate() && vm.isDuplicateNumber==false){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});	        	
			}

			vm.pageLoad();			
		}				
	});
	banhji.router.route("/wCustomer/:id", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{			
			var vm = banhji.wCustomer;
						
			banhji.view.layout.showIn("#content", banhji.view.wCustomer);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			if(banhji.pageLoaded["wCustomer"]==undefined){
				banhji.pageLoaded["wCustomer"] = true;				

				$("#ddlContactType").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "contacts/type",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"parent_id", value: 1 }
					},
					change: function(e){
		            	var value = this.value(); 

	                	if(value=="6" || value=="7" || value=="8"){
	                		vm.set("isCompany", true);
	                	}else{
	                		vm.set("isCompany", false);
	                	}
		            }                
		        }).data("kendoDropDownList");		        

		        $("#ddlAR").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 7 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlRA").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 20 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlDepositAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 16 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlDiscountAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value:21 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlTaxItem").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "items/item",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"item_type_id", value: 6 }
					},
					template: '#=sku# #=name#'             
		        }).data("kendoDropDownList");		        

		        var ddlBranch = $("#ddlBranch").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "contacts/branch",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"utility_id", value: 2 }
					}          
		        }).data("kendoDropDownList");

		        var ddlLocation = $("#ddlLocation").kendoDropDownList({
		        	optionLabel: "(--- Select ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.locationDS
                }).data("kendoDropDownList");	

		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate() 
						&& (vm.get("isDuplicateNumber")==false)						
						&& (vm.get("isDuplicateWNumber")==false)){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});	        	
			}

			vm.pageLoad(id);			
		}				
	});
	banhji.router.route("/wCustomer_order", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wCustomerOrder);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wCustomerOrder;

			if(banhji.pageLoaded["wCustomer_order"]==undefined){
				banhji.pageLoaded["wCustomer_order"] = true;
				
				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: "true",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.branchDS,
                    change: function(e) {
					    vm.set("location_id", null);					    
					}
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: "true",
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.locationDS
                }).data("kendoDropDownList");		

				var grid = $("#grid").kendoGrid({
                    dataSource: vm.dataSource,
                    autoBind: false,
                    scrollable: false,
                    columns: [
                        { field:"worder", title: vm.lang.lang.order1 },				    	
				    	{ field:"wnumber", title:vm.lang.lang.number },
				    	{ field:"fullname", title:vm.lang.lang.customer }
                    ]
                }).data("kendoGrid");

                grid.table.kendoSortable({
                    filter: ">tbody >tr",
                    hint: $.noop,
                    cursor: "move",
                    placeholder: function(element) {
                        return element.clone().addClass("k-state-hover").css("opacity", 0.65);
                    },
                    container: "#grid tbody",
                    change: function(e) {
                        var skip = grid.dataSource.skip(),
                            oldIndex = e.oldIndex + skip,
                            newIndex = e.newIndex + skip,
                            data = grid.dataSource.data(),
                            dataItem = grid.dataSource.getByUid(e.item.data("uid"));
						
                        grid.dataSource.remove(dataItem);
                        grid.dataSource.insert(newIndex, dataItem);
                    }
                });
			}							
		}
	});
	banhji.router.route("/wInstallment(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wInstallment);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);								
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wInstallment;

			if(banhji.pageLoaded["wInstallment"]==undefined){							
				banhji.pageLoaded["wInstallment"] = true;				

		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});	        	
			}

			vm.pageLoad(id);
		}				
	});
	banhji.router.route("/wDeposit(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.wDeposit);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wDeposit;
			
			if(banhji.pageLoaded["wDeposit"]==undefined){
				banhji.pageLoaded["wDeposit"] = true;

				vm.setItem();
				
				$("#ddlPaymentMethod").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: dataStore(baseUrl + "payment_methods")
		        }).data("kendoDropDownList");

		        $("#ddlCashAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 6 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlDepositAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", operator:"where_in", value: [14,16] }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");							
				
				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}	
	});
	banhji.router.route("/wDeposit_witdraw(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.wDepositWitdraw);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wDepositWitdraw;
			
			if(banhji.pageLoaded["wDeposit_witdraw"]==undefined){
				banhji.pageLoaded["wDeposit_witdraw"] = true;				

				$("#ddlCashAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 6 }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");

		        $("#ddlDepositAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: baseUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", operator:"where_in", value: [14,16] }
					},
					template: '#=code# #=name#'             
		        }).data("kendoDropDownList");										
				
				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			
		}	
	});
	banhji.router.route("/wMeter(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wMeter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);								
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wMeter;

			if(banhji.pageLoaded["wMeter"]==undefined){							
				banhji.pageLoaded["wMeter"] = true;

				vm.itemDS.filter({ field:"item_type_id", value: 1 });

		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate() && (vm.get("isDuplicateNumber")==false)){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});	        	
			}

			vm.pageLoad(id);
		}				
	});
	banhji.router.route("/wReading_center(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wReadingCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wReadingCenter;
			
			if(banhji.pageLoaded["wReading_center"]==undefined){
				banhji.pageLoaded["wReading_center"] = true;

				vm.meterDS.filter({ field:"utility_id", value: 2 });				
			}

			vm.pageLoad(id);
		}		
	});
	banhji.router.route("/wEdit_reading/:id", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wEditReading);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wEditReading;
			
			if(banhji.pageLoaded["wEdit_reading"]==undefined){
				banhji.pageLoaded["wEdit_reading"] = true;	            
				
				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);
		}		
	});
	banhji.router.route("/wReading", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wReading);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wReading;
			
			if(banhji.pageLoaded["wReading"]==undefined){
				banhji.pageLoaded["wReading"] = true;

				vm.branchDS.filter({ field:"utility_id", value:2 });
				vm.meterDS.filter({ field:"utility_id", value:2 });
				vm.readerDS.filter({ field:"contact_type_id", value:3 });				

	            var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: "true",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.branchDS,
                    change: function(e) {
					    vm.set("location_id", null);					    
					}
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- រើស Location ---)",
                    autoBind: false,
                    valuePrimitive: "true",
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.locationDS
                }).data("kendoDropDownList");				

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}
			vm.pageLoad();
		}		
	});
	banhji.router.route("/wIR_reader", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wIRReader);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wIRReader;
			
			if(banhji.pageLoaded["wIR_reader"]==undefined){
				banhji.pageLoaded["wIR_reader"] = true;

				vm.readerDS.filter({ field:"contact_type_id", value:3 });

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad();
		}		
	});
	banhji.router.route("/wReading_book", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wReadingBook);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);			
			
			if(banhji.pageLoaded["wReading_book"]==undefined){
				banhji.pageLoaded["wReading_book"] = true;

				var dataSource = dataStore(baseUrl + "meters/wbook");

				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: "true",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: dataStore(baseUrl + "contacts/branch")
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: "true",
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: dataStore(baseUrl + "locations")
                }).data("kendoDropDownList");
				
				$("#grid").kendoGrid({
		            toolbar: ["excel"],
		            excel: {
		                fileName: "readingbook.xlsx"
		            },		            		           
		            dataSource: dataSource,		           		                        
		            reorderable: true,
		            resizable: true,
		            columns: [
		                { field: "contact_number", title: langVM.lang.number },
		                { field: "fullname", title: langVM.lang.customer },
		                { field: "location_name", title: langVM.lang.location },
		                { field: "month_of", title: langVM.lang.month_of },
		                { field: "number", title: langVM.lang.meter },	                
		                { field: "reading", title: langVM.lang.reading },
		            ]
		        });		       

				$("#search").click(function(){
					var para = [];
				
					if(ddlLocation.value()){
						para.push({ field:"location_id", value:ddlLocation.value() });
					}else if(ddlBranch.value()){
						para.push({ field:"company_id", value:ddlBranch.value() });
					}
					
					dataSource.filter(para);
				});
			}			
		}		
	});
	banhji.router.route("/wInvoice", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wInvoice);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wInvoice;

			if(banhji.pageLoaded["wInvoice"]==undefined){
				banhji.pageLoaded["wInvoice"] = true;			

				vm.pageLoad();
				vm.branchDS.filter({ field:"utility_id", value:2 });
				vm.meterDS.filter({ field:"utility_id", value:2 });				

	            var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: "true",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.branchDS,
                    change: function(e) {
					    vm.set("location_id", null);					    
					}
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- រើស Location ---)",
                    autoBind: false,
                    valuePrimitive: "true",
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.locationDS
                }).data("kendoDropDownList");				

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}
		}		
	});
	banhji.router.route("/wPrint_center(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wPrintCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wPrintCenter;
			
			if(banhji.pageLoaded["wPrint_center"]==undefined){
				banhji.pageLoaded["wPrint_center"] = true;				
				
				vm.branchDS.filter({ field:"utility_id", value:2 });				
			}

			vm.pageLoad(id);
		}							
	});
	banhji.router.route("/wInvoice_print(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wInvoicePrint);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wInvoicePrint;
			
			if(banhji.pageLoaded["wInvoice_print"]==undefined){
				banhji.pageLoaded["wInvoice_print"] = true;							

			}

			vm.pageLoad(id);
		}							
	});
	banhji.router.route("/wInventory_item", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wInventoryItem);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
					
			var vm = banhji.wInventoryItem;			
			
			if(banhji.pageLoaded["wInventory_item"]==undefined){
				banhji.pageLoaded["wInventory_item"] = true;
				
				vm.dataSource.filter({ field:"item_type_id", value:1 });

				var categories = $("#categories").kendoDropDownList({
                    optionLabel: "(--- Select ---)",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.categoryDS,
                    change: function(e) {
					    //var value = this.value();
					    vm.set("item_group_id", 0);
					}
                }).data("kendoDropDownList");

                var itemGroups = $("#itemGroups").kendoDropDownList({
                    autoBind: false,
                    cascadeFrom: "categories",
                    cascadeFromField: "category_id",
                    optionLabel: "(--- Select ---)",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.itemGroupDS
                }).data("kendoDropDownList");											
			}

			vm.pageLoad();				
		}
	});	
	banhji.router.route("/wSettings", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wSettings);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wSettings;
			
			if(banhji.pageLoaded["wSettings"]==undefined){
				banhji.pageLoaded["wSettings"] = true;

				vm.branchDS.filter({ field:"utility_id", value: 2 });
			}

			vm.pageLoad();			     		
		}
	});
	banhji.router.route("/wBranch(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wBranch);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wBranch;
			
			if(banhji.pageLoaded["wBranch"]==undefined){
				banhji.pageLoaded["wBranch"] = true;

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({				    
				    autoHideAfter: 5000,
				    width: 300,				    
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){				
					e.preventDefault();

					if(validator.validate() && vm.get("isExisting")==false){
		            	vm.save();

		            	notification.success("Save Successful");			  
			        }else{
			        	notification.error("Warning, please review it again!");			           
			        }		            
				});
			}

			vm.pageLoad(id);			     		
		}
	});


	//Water Reports
	banhji.router.route("/wReport_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wReportCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);

			var vm = banhji.wReportCenter;			
			
			if(banhji.pageLoaded["wReport_center"]==undefined){
				banhji.pageLoaded["wReport_center"] = true;				

				vm.branchDS.query({
					filter: { field:"utility_id", value: 2 },
					page: 1,
					take: 100
				}).then(function(){
					var view = vm.branchDS.view();

					if(view.length>0){
						vm.set("branch_id", view[0].id);						
						vm.loadKPI(view[0].id);
					}
				});									
			}			
		}		
	});
	banhji.router.route("/wCustomer_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wCustomerList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();			
			
			if(banhji.pageLoaded["wCustomer_list"]==undefined){
				banhji.pageLoaded["wCustomer_list"] = true;

				var dataSource = dataStore(baseUrl + "contacts/wlist"),
				branchDS =  dataStore(baseUrl + "contacts/branch"),
				locationDS =  dataStore(baseUrl + "locations");

				branchDS.filter({ field:"utility_id", value:2 });

				$("#grid").kendoGrid({
				    dataSource: dataSource,
				    groupable: true,
				    sortable: true,				    				    
				    pageable: true,				    
				    columns:[
				    	{ field: "wnumber", title:"Number" },
				    	{ field: "fullname", title:"Fullname" },
				    	{ field: "contact_type_name", title:"Type" },
				    	{ field: "wlocation_name", title:"Location" },
				    	{ field: "wbranch_name", title:"License" }
				    ]				    
				});

				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: true,
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: branchDS
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: locationDS
                }).data("kendoDropDownList");

				$("#search").click(function(){
					if(ddlLocation.value()){
						dataSource.filter({ field:"wlocation_id", value:ddlLocation.value() });
					}else if(ddlBranch.value()){
						dataSource.filter({ field:"wbranch_id", value:ddlBranch.value() });
					}else{
						dataSource.filter([]);
					}
				});
		    }      
		}	
	});
	banhji.router.route("/wCustomer_no_meter", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wCustomerNoMeter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wCustomerNoMeter;			
			
			if(banhji.pageLoaded["wCustomer_no_meter"]==undefined){
				banhji.pageLoaded["wCustomer_no_meter"] = true;		
				
				vm.branchDS.filter({ field:"utility_id", value:2 });				 
			}
		}
	});
	banhji.router.route("/wBrand_new_customer", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wBrandNewCustomer);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wBrandNewCustomer;			
			
			if(banhji.pageLoaded["wBrand_new_customer"]==undefined){
				banhji.pageLoaded["wBrand_new_customer"] = true;		
				
				vm.sorterChanges();
				vm.branchDS.filter({ field:"utility_id", value:2 });

				var container = $("#employeeForm");
                kendo.init(container);
                container.kendoValidator({
                    rules: {
                        greaterdate: function (input) {
                            if (input.is("[data-greaterdate-msg]") && input.val() != "") {                                    
                                var date = kendo.parseDate(input.val()),
                                    otherDate = kendo.parseDate($("[name='" + input.data("greaterdateField") + "']").val());
                                return otherDate == null || otherDate.getTime() < date.getTime();
                            }

                            return true;
                        }
                    }
                });

                var validator = $("#employeeForm").data("kendoValidator");
                validator.validate();				
			}
		}
	});
	banhji.router.route("/wCustomer_balance", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wCustomerBalance);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();			
			
			if(banhji.pageLoaded["wCustomer_balance"]==undefined){
				banhji.pageLoaded["wCustomer_balance"] = true;

				var dataSource =  dataStore(baseUrl + "contacts/wbalance"),
				branchDS =  dataStore(baseUrl + "contacts/branch"),
				locationDS =  dataStore(baseUrl + "locations");

				branchDS.filter({ field:"utility_id", value:2 });

				$("#grid").kendoGrid({
				    dataSource: dataSource,
				    groupable: true,				    
				    pageable: true,        
				    columns: [ 
			    		{ field: "wnumber", title: "Number" }, 
			    		{ field: "fullname", title: "Fullname" },
			    		{ field: "contact_type_name", title: "Type" },
			    		{ field: "wlocation_name", title: "Location" },
			    		{ field: "wbranch_name", title: "License" },
			    		{ field: "balance", title: "Balance", template: '#=kendo.toString(balance, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} }
				    ]
				});

				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: true,
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: branchDS
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: locationDS
                }).data("kendoDropDownList");

				$("#search").click(function(){
					if(ddlLocation.value()){
						dataSource.filter({ field:"wlocation_id", value:ddlLocation.value() });
					}else if(ddlBranch.value()){
						dataSource.filter({ field:"wbranch_id", value:ddlBranch.value() });
					}else{
						dataSource.filter([]);
					}
				});
		    }      
		}	
	});
	banhji.router.route("/wCustomer_deposit", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wCustomerDeposit);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();			
			
			if(banhji.pageLoaded["wCustomer_deposit"]==undefined){
				banhji.pageLoaded["wCustomer_deposit"] = true;

				var dataSource =  dataStore(baseUrl + "contacts/wdeposit"),
				branchDS =  dataStore(baseUrl + "contacts/branch"),
				locationDS =  dataStore(baseUrl + "locations");

				branchDS.filter({ field:"utility_id", value:2 });

				$("#grid").kendoGrid({
				    dataSource: dataSource,
				    groupable: true,				    
				    pageable: true,        
				    columns: [ 
			    		{ field: "wnumber", title: "Number" }, 
			    		{ field: "fullname", title: "Fullname" },
			    		{ field: "contact_type_name", title: "Type" },
			    		{ field: "wlocation_name", title: "Location" },
			    		{ field: "wbranch_name", title: "License" },
			    		{ field: "deposit", title: "Deposit", template: '#=kendo.toString(deposit, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} }
				    ]
				});

				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: true,
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: branchDS
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: locationDS
                }).data("kendoDropDownList");

				$("#search").click(function(){
					if(ddlLocation.value()){
						dataSource.filter({ field:"wlocation_id", value:ddlLocation.value() });
					}else if(ddlBranch.value()){
						dataSource.filter({ field:"wbranch_id", value:ddlBranch.value() });
					}else{
						dataSource.filter([]);
					}
				});
		    }      
		}	
	});
	banhji.router.route("/wAging_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wAgingSummary);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();			
			
			var vm = banhji.wAgingSummary;

			if(banhji.pageLoaded["wAging_summary"]==undefined){
				banhji.pageLoaded["wAging_summary"] = true;				

				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.branchDS,
                    change: function(e) {
					    vm.set("location_id", null);					    
					}
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.locationDS
                }).data("kendoDropDownList");                
			}
		}
	});
	banhji.router.route("/wAging_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wAgingDetail);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wAgingDetail;			
			
			if(banhji.pageLoaded["wAging_detail"]==undefined){
				banhji.pageLoaded["wAging_detail"] = true;		
				
				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: "false",
                    valuePrimitive: true,
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.branchDS,
                    change: function(e) {
					    vm.set("location_id", null);					    
					}
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.locationDS
                }).data("kendoDropDownList");

                $("#grid").kendoGrid({
                    dataSource: vm.dataSource,
                    autoBind: false,
                    sortable: true,
                    scrollable: false,
                    pageable: true,
                    columns: [
                        { field: "number", title: "Number", groupFooterTemplate: "Total:" },
                        { field: "issued_date", title: "Date", template:'#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#' },
                        { field: "fullIdName", title: "Customer" },                        
                        { field: "due_date", title: "Due Date", template:'#=kendo.toString(new Date(due_date), "dd-MM-yyyy")#' },
                        { field: "age", title: "Aging" },                       
                        { field: "amount", title: "Amount",
                        	attributes: {
						      "class": "table-cell",
						      style: "text-align: right;"
						    },
                        	template: "#=kendo.toString(amount, 'c0', banhji.institute.locale)#", 
                        	aggregates: ["sum"], groupFooterTemplate: "<div align='right'>#=kendo.toString(sum, 'c0', banhji.institute.locale)#</div>", 
                        	groupHeaderTemplate: "#= value #"                        	
                        }
                    ]
                });
			}
		}
	});
	banhji.router.route("/wSale_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wSaleSummary);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);			
			
			var vm = banhji.wSaleSummary;

			if(banhji.pageLoaded["wSale_summary"]==undefined){
				banhji.pageLoaded["wSale_summary"] = true;
								
				$("#grid").kendoGrid({
		            toolbar: ["excel"],
		            excel: {
		                fileName: "sale_summary.xlsx"
		            },		            		           
		            dataSource: vm.dataSource,
		            groupable: true,		           		                        
		            reorderable: true,
		            resizable: true,
		            columns: [		                
		                { field: "branch_name", title: "License" },
		                { field: "location_name", title: "Location" },		                
		                { field: "usage", title:"m3", template:'#=kendo.toString(usage, "n0")#', attributes:{style:"text-align:right;"} },		                
		                { field: "amount", title:"Amount", template:'#=kendo.toString(amount, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} },
		            ]
		        });		       			
			}
		}		
	});
	banhji.router.route("/wSale_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wSaleDetail);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);			
			
			var vm = banhji.wSaleDetail;

			if(banhji.pageLoaded["wSale_detail"]==undefined){
				banhji.pageLoaded["wSale_detail"] = true;

				vm.branchDS.filter({ field:"utility_id", value:2 });
								
				$("#grid").kendoGrid({
		            toolbar: ["excel"],
		            excel: {
		                fileName: "sale_detail.xlsx"
		            },		            		           
		            dataSource: vm.dataSource,
		            groupable: true,
		            sortable: true,		           		                        
		            reorderable: true,
		            resizable: true,
		            columns: [		                
		                { field: "contact_number", title: "Number" },
		                { field: "fullname", title: "Customer" },
		                { field: "contact_type_name", title: "Type" },
		                { field: "location_name", title: "Location" },		                
		                { field: "usage", title:"Usage", template:'#=kendo.toString(usage, "n0")#', attributes:{style:"text-align:right;"}, sortable: false },		                
		                { field: "amount", title:"Amount", template:'#=kendo.toString(amount, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} },
		            ]
		        });		       			
			}
		}		
	});
	banhji.router.route("/wPayment_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wPaymentSummary);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();			
			
			var vm = banhji.wPaymentSummary;

			if(banhji.pageLoaded["wPayment_summary"]==undefined){
				banhji.pageLoaded["wPayment_summary"] = true;		
				
				vm.sorterChanges();

				var container = $("#employeeForm");
                kendo.init(container);
                container.kendoValidator({
                    rules: {
                        greaterdate: function (input) {
                            if (input.is("[data-greaterdate-msg]") && input.val() != "") {                                    
                                var date = kendo.parseDate(input.val()),
                                    otherDate = kendo.parseDate($("[name='" + input.data("greaterdateField") + "']").val());
                                return otherDate == null || otherDate.getTime() < date.getTime();
                            }

                            return true;
                        }
                    }
                });

                var validator = $("#employeeForm").data("kendoValidator");
                validator.validate();
			}
		}
	});
	banhji.router.route("/wPayment_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wPaymentDetail);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.wPaymentDetail;			
			
			if(banhji.pageLoaded["wPayment_detail"]==undefined){
				banhji.pageLoaded["wPayment_detail"] = true;		
				
				vm.sorterChanges();

				var container = $("#employeeForm");
                kendo.init(container);
                container.kendoValidator({
                    rules: {
                        greaterdate: function (input) {
                            if (input.is("[data-greaterdate-msg]") && input.val() != "") {                                    
                                var date = kendo.parseDate(input.val()),
                                    otherDate = kendo.parseDate($("[name='" + input.data("greaterdateField") + "']").val());
                                return otherDate == null || otherDate.getTime() < date.getTime();
                            }

                            return true;
                        }
                    }
                });

                var validator = $("#employeeForm").data("kendoValidator");
                validator.validate();
			}
		}
	});
	banhji.router.route("/wPayment_by_source_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wPaymentBySourceSummary);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);			
			
			var vm = banhji.wPaymentBySourceSummary;

			if(banhji.pageLoaded["wPayment_by_source_summary"]==undefined){
				banhji.pageLoaded["wPayment_by_source_summary"] = true;
								
				$("#grid").kendoGrid({
		            toolbar: ["excel"],
		            excel: {
		                fileName: "payment_by_resource_summary.xlsx"
		            },		            		           
		            dataSource: vm.dataSource,
		            groupable: true,		           		                        
		            reorderable: true,
		            resizable: true,
		            columns: [		                
		                { field: "branch_name", title: "License" },
		                { field: "location_name", title: "Location" },		                
		                { field: "cash", title:"Cash", template:'#=kendo.toString(cash, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} },		                
		                { field: "check", title:"Cheque", template:'#=kendo.toString(check, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} },
		                { field: "bank", title:"Bank", template:'#=kendo.toString(bank, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} },		                
		                { field: "direct", title:"Home", template:'#=kendo.toString(direct, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} },
		                { field: "internet", title:"Internet", template:'#=kendo.toString(internet, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} }
		            ]
		        });		       			
			}
		}		
	});
	banhji.router.route("/wPayment_by_source_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wPaymentBySourceDetail);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);			
			
			var vm = banhji.wPaymentBySourceDetail;

			if(banhji.pageLoaded["wPayment_by_source_detail"]==undefined){
				banhji.pageLoaded["wPayment_by_source_detail"] = true;

				vm.branchDS.filter({ field:"utility_id", value:2 });
								
				$("#grid").kendoGrid({
		            toolbar: ["excel"],
		            excel: {
		                fileName: "payment_by_resource_detail.xlsx"
		            },		            		           
		            dataSource: vm.dataSource,
		            groupable: true,
		            sortable: true,		           		                        
		            reorderable: true,
		            resizable: true,
		            columns: [		                
		                { field: "contact_id", title: "Number", template:'#=contact_number#' },
		                { field: "contact_id", title: "Customer", template:'#=fullname#' },
		                { field: "contact_type_name", title: "Type" },
		                { field: "cashier_id", title: "បេឡាករ", template:'#=cashier_name#' },
		                { field: "payment_method_id", title: "Payment Method", template:'#=payment_method_name#' },		                		                
		                { field: "amount", title:"Amount", template:'#=kendo.toString(amount, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} },
		            ]
		        });		       			
			}
		}		
	});	
	banhji.router.route("/wLow_consumption", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wLowConsumption);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();			
			
			if(banhji.pageLoaded["wLow_consumption"]==undefined){
				banhji.pageLoaded["wLow_consumption"] = true;

				var dataSource =  dataStore(baseUrl + "meters/wlow_consumption"),
				branchDS =  dataStore(baseUrl + "contacts/branch"),
				locationDS =  dataStore(baseUrl + "locations");

				branchDS.filter({ field:"utility_id", value:2 });

				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: branchDS
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: locationDS
                }).data("kendoDropDownList");

				var monthpicker = $("#monthpicker").kendoDatePicker({        	     	
		            start: "year",            
		            depth: "year",
		            format: "MM-yyyy",            
		            change: function() {
				        var value = this.value();
				        value.setDate(1);				        		        
				        $("#strDate").text("As Of " + kendo.toString(value, "MM-yyyy")); 
				    }
		        }).data("kendoDatePicker");

				var usage = $("#usage").kendoNumericTextBox({
                    format: "<= # m3",
                    min: 1,
                    value: 20
                }).data("kendoNumericTextBox");

				$("#grid").kendoGrid({
				    dataSource: dataSource,
				    autoBind: false,
				    groupable: true,
				    sortable: true,				    				    
				    pageable: true,				    
				    columns:[				    	
				    	{ field: "contact_number", title:"Number" },
				    	{ field: "fullname", title:"Fullname" },				    	
				    	{ field: "location_name", title:"Location" },
				    	{ field: "branch_name", title:"License" },
				    	{ field: "meter_number", title:"Meter" },
				    	{ field: "usage", title:"Usage" }
				    ]				    
				});				

				$("#search").click(function(){
					var para = [];
				
					if(ddlLocation.value()){
						para.push({ field:"location_id", operator:"join_meter", value:ddlLocation.value() });
					}else if(ddlBranch.value()){
						para.push({ field:"company_id", operator:"join_meter", value:ddlBranch.value() });
					}

					if(monthpicker.value()){
						para.push({ field:"month_of", value: kendo.toString(monthpicker.value(), "yyyy-MM-dd") });
					}

					if(usage.value()){
						para.push({ field:"usage <=", value: usage.value() });
					}
					
					dataSource.filter(para);
				});
		    }      
		}	
	});
	banhji.router.route("/wDisconnect_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.wDisconnectList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
			kendo.fx($("#slide-form")).slideIn("down").play();			
			
			if(banhji.pageLoaded["wDisconnect_list"]==undefined){
				banhji.pageLoaded["wDisconnect_list"] = true;

				var dataSource =  dataStore(baseUrl + "invoices/wdisconnect"),
				branchDS =  dataStore(baseUrl + "contacts/branch"),
				locationDS =  dataStore(baseUrl + "locations");

				branchDS.filter({ field:"utility_id", value:2 });

				var ddlBranch = $("#ddlBranch").kendoDropDownList({
                    optionLabel: "(--- License ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: branchDS
                }).data("kendoDropDownList");

                var ddlLocation = $("#ddlLocation").kendoDropDownList({
                	optionLabel: "(--- Location ---)",
                    autoBind: false,
                    valuePrimitive: true,
                    cascadeFrom: "ddlBranch",                    
                    cascadeFromField: "company_id",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: locationDS
                }).data("kendoDropDownList");				

				var days = $("#days").kendoNumericTextBox({
                    format: "<= # days",
                    min: 1,
                    value: 10
                }).data("kendoNumericTextBox");

				$("#grid").kendoGrid({
				    dataSource: dataSource,
				    autoBind: false,
				    groupable: true,
				    sortable: true,				    				    
				    pageable: true,				    
				    columns:[				    	
				    	{ field: "contact_number", title:"Number" },
				    	{ field: "fullname", title:"Fullname" },	
				    	{ field: "location_name", title:"Location" },				    	
				    	{ field: "number", title:"Number" },
				    	{ field: "due_date", title:"Due Date" },
				    	{ field: "amount", title:"Amount", template:'#=kendo.toString(amount, "c0", banhji.institute.locale)#', attributes:{style:"text-align:right;"} },				    	
				    	{ field: "days", title:"Number of days", attributes:{style:"text-align:right;"} }
				    ]				    
				});				

				$("#search").click(function(){
					var para = [];
				
					if(ddlLocation.value()){
						para.push({ field:"location_id", operator:"join_meter", value:ddlLocation.value() });
					}else if(ddlBranch.value()){
						para.push({ field:"company_id", operator:"join_meter", value:ddlBranch.value() });
					}					

					if(days.value()){
						para.push({ field:"days", operator:"days", value: days.value() });
					}
					
					dataSource.filter(para);
				});
		    }      
		}	
	});	
	//END OF DAWINE  ---------------------------------------------------------------------------------
	
	// portal mockup data
	// dataSource
	dataSource = [
		{
			id: 1, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:2, name: 'Tiger Beer'}, 
			invoice_number: 'inv-343424', 
			data: [
				{itemCode: 'MT-213', amount: 232}, 
				{itemCode: 'MT-100', amount: 500}
			],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 2, 
			type: 'so', 
			sentFrom: {id:10, name: 'Hello Beer'}, 
			sentTo: {id: 3, name: 'Johner Runner'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 3, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:10, name: 'Hello Beer'}, 
			invoice_number: 
			'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 4, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id: 3, name: 'Johner Runner'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 5, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:10, name: 'Hello Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 6, 
			type: 'po', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:10, name: 'Hello Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 7, 
			type: 'so', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id: 3, name: 'Johner Runner'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 8, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:2, name: 'Tiger Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 9, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:10, name: 'Hello Beer'}, invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 10, 
			type: 'so', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:2, name: 'Tiger Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 11, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:2, name: 'Tiger Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 12, 
			type: 'invoice', 
			sentFrom: {id:9, name: 'Good Luck'}, 
			sentTo: {id:10, name: 'Hello Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 13, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:2, name: 'Tiger Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 14, 
			type: 'invoice', 
			sentFrom: {id:9, name: 'Good Luck'}, 
			sentTo: {id:2, name: 'Tiger Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 15, 
			type: 'po', 
			sentFrom: {id:9, name: 'Good Luck'}, 
			sentTo: {id:2, name: 'Tiger Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 16, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:10, name: 'Hello Beer'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 17, 
			type: 'po', 
			sentFrom: {id:9, name: 'Good Luck'}, 
			sentTo: {id:5, name: 'DayOne'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 18, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:5, name: 'DayOne'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		},
		{
			id: 19, 
			type: 'invoice', 
			sentFrom: {id:7, name: 'Best Luck'}, 
			sentTo: {id:5, name: 'DayOne'}, 
			invoice_number: 'inv-343424', 
			data: [{itemCode: 'MT-213', amount: 232}, {itemCode: 'MT-100', amount: 500}],
			created: '2016-01-05', 
			status: false
		}
	];
	banhji.portal = kendo.observable({
		dataStore 	: dataSource,
		close  		: function() {
			window.history.back(-1);
		},
		receive 	: function(e) {
			e.data.set('status', true);
			// bootbox.alert("កត់ត្រាបានសំរេច", function(result){});
			alert("You added the bill.");
		}
	});
	// view
	vendorView = new kendo.View('#vendorReceiveBill', {model: banhji.portal});
	customerView=new kendo.View('#customerInvoiceSent', {model: banhji.portal});
	banhji.router.route('/vendorReceiveBill', function(){
		banhji.view.layout.showIn("#content", vendorView);
	});
	banhji.router.route('/customerInvoiceSent', function(){
		banhji.view.layout.showIn("#content", customerView);
	});
	$(function() {	
		banhji.router.start();		
		if(!banhji.userManagement.getLogin()){
			window.location.assign("<?php echo base_url(); ?>home");
		} else {
			if(banhji.currency.dataSource.data().length === 0) {
				banhji.currency.dataSource.read();
			}	
		}
	});
</script>